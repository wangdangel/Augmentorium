(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function kg(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ry={exports:{}},Qh={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AA;function LU(){if(AA)return Qh;AA=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,s){var o=null;if(s!==void 0&&(o=""+s),r.key!==void 0&&(o=""+r.key),"key"in r){s={};for(var u in r)u!=="key"&&(s[u]=r[u])}else s=r;return r=s.ref,{$$typeof:i,type:n,key:o,ref:r!==void 0?r:null,props:s}}return Qh.Fragment=e,Qh.jsx=t,Qh.jsxs=t,Qh}var wA;function UU(){return wA||(wA=1,Ry.exports=LU()),Ry.exports}var U=UU(),Cy={exports:{}},Ut={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RA;function OU(){if(RA)return Ut;RA=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),m=Symbol.iterator;function g(z){return z===null||typeof z!="object"?null:(z=m&&z[m]||z["@@iterator"],typeof z=="function"?z:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,S={};function b(z,le,Ee){this.props=z,this.context=le,this.refs=S,this.updater=Ee||_}b.prototype.isReactComponent={},b.prototype.setState=function(z,le){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,le,"setState")},b.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function x(){}x.prototype=b.prototype;function E(z,le,Ee){this.props=z,this.context=le,this.refs=S,this.updater=Ee||_}var M=E.prototype=new x;M.constructor=E,v(M,b.prototype),M.isPureReactComponent=!0;var A=Array.isArray,C={H:null,A:null,T:null,S:null,V:null},w=Object.prototype.hasOwnProperty;function N(z,le,Ee,De,q,Z){return Ee=Z.ref,{$$typeof:i,type:z,key:le,ref:Ee!==void 0?Ee:null,props:Z}}function L(z,le){return N(z.type,le,void 0,void 0,void 0,z.props)}function P(z){return typeof z=="object"&&z!==null&&z.$$typeof===i}function D(z){var le={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(Ee){return le[Ee]})}var I=/\/+/g;function j(z,le){return typeof z=="object"&&z!==null&&z.key!=null?D(""+z.key):le.toString(36)}function J(){}function ue(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(J,J):(z.status="pending",z.then(function(le){z.status==="pending"&&(z.status="fulfilled",z.value=le)},function(le){z.status==="pending"&&(z.status="rejected",z.reason=le)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function $(z,le,Ee,De,q){var Z=typeof z;(Z==="undefined"||Z==="boolean")&&(z=null);var Y=!1;if(z===null)Y=!0;else switch(Z){case"bigint":case"string":case"number":Y=!0;break;case"object":switch(z.$$typeof){case i:case e:Y=!0;break;case d:return Y=z._init,$(Y(z._payload),le,Ee,De,q)}}if(Y)return q=q(z),Y=De===""?"."+j(z,0):De,A(q)?(Ee="",Y!=null&&(Ee=Y.replace(I,"$&/")+"/"),$(q,le,Ee,"",function(Ve){return Ve})):q!=null&&(P(q)&&(q=L(q,Ee+(q.key==null||z&&z.key===q.key?"":(""+q.key).replace(I,"$&/")+"/")+Y)),le.push(q)),1;Y=0;var ie=De===""?".":De+":";if(A(z))for(var xe=0;xe<z.length;xe++)De=z[xe],Z=ie+j(De,xe),Y+=$(De,le,Ee,Z,q);else if(xe=g(z),typeof xe=="function")for(z=xe.call(z),xe=0;!(De=z.next()).done;)De=De.value,Z=ie+j(De,xe++),Y+=$(De,le,Ee,Z,q);else if(Z==="object"){if(typeof z.then=="function")return $(ue(z),le,Ee,De,q);throw le=String(z),Error("Objects are not valid as a React child (found: "+(le==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":le)+"). If you meant to render a collection of children, use an array instead.")}return Y}function k(z,le,Ee){if(z==null)return z;var De=[],q=0;return $(z,De,"","",function(Z){return le.call(Ee,Z,q++)}),De}function G(z){if(z._status===-1){var le=z._result;le=le(),le.then(function(Ee){(z._status===0||z._status===-1)&&(z._status=1,z._result=Ee)},function(Ee){(z._status===0||z._status===-1)&&(z._status=2,z._result=Ee)}),z._status===-1&&(z._status=0,z._result=le)}if(z._status===1)return z._result.default;throw z._result}var W=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var le=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(le))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)};function ce(){}return Ut.Children={map:k,forEach:function(z,le,Ee){k(z,function(){le.apply(this,arguments)},Ee)},count:function(z){var le=0;return k(z,function(){le++}),le},toArray:function(z){return k(z,function(le){return le})||[]},only:function(z){if(!P(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},Ut.Component=b,Ut.Fragment=t,Ut.Profiler=r,Ut.PureComponent=E,Ut.StrictMode=n,Ut.Suspense=c,Ut.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,Ut.__COMPILER_RUNTIME={__proto__:null,c:function(z){return C.H.useMemoCache(z)}},Ut.cache=function(z){return function(){return z.apply(null,arguments)}},Ut.cloneElement=function(z,le,Ee){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var De=v({},z.props),q=z.key,Z=void 0;if(le!=null)for(Y in le.ref!==void 0&&(Z=void 0),le.key!==void 0&&(q=""+le.key),le)!w.call(le,Y)||Y==="key"||Y==="__self"||Y==="__source"||Y==="ref"&&le.ref===void 0||(De[Y]=le[Y]);var Y=arguments.length-2;if(Y===1)De.children=Ee;else if(1<Y){for(var ie=Array(Y),xe=0;xe<Y;xe++)ie[xe]=arguments[xe+2];De.children=ie}return N(z.type,q,void 0,void 0,Z,De)},Ut.createContext=function(z){return z={$$typeof:o,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:s,_context:z},z},Ut.createElement=function(z,le,Ee){var De,q={},Z=null;if(le!=null)for(De in le.key!==void 0&&(Z=""+le.key),le)w.call(le,De)&&De!=="key"&&De!=="__self"&&De!=="__source"&&(q[De]=le[De]);var Y=arguments.length-2;if(Y===1)q.children=Ee;else if(1<Y){for(var ie=Array(Y),xe=0;xe<Y;xe++)ie[xe]=arguments[xe+2];q.children=ie}if(z&&z.defaultProps)for(De in Y=z.defaultProps,Y)q[De]===void 0&&(q[De]=Y[De]);return N(z,Z,void 0,void 0,null,q)},Ut.createRef=function(){return{current:null}},Ut.forwardRef=function(z){return{$$typeof:u,render:z}},Ut.isValidElement=P,Ut.lazy=function(z){return{$$typeof:d,_payload:{_status:-1,_result:z},_init:G}},Ut.memo=function(z,le){return{$$typeof:f,type:z,compare:le===void 0?null:le}},Ut.startTransition=function(z){var le=C.T,Ee={};C.T=Ee;try{var De=z(),q=C.S;q!==null&&q(Ee,De),typeof De=="object"&&De!==null&&typeof De.then=="function"&&De.then(ce,W)}catch(Z){W(Z)}finally{C.T=le}},Ut.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},Ut.use=function(z){return C.H.use(z)},Ut.useActionState=function(z,le,Ee){return C.H.useActionState(z,le,Ee)},Ut.useCallback=function(z,le){return C.H.useCallback(z,le)},Ut.useContext=function(z){return C.H.useContext(z)},Ut.useDebugValue=function(){},Ut.useDeferredValue=function(z,le){return C.H.useDeferredValue(z,le)},Ut.useEffect=function(z,le,Ee){var De=C.H;if(typeof Ee=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return De.useEffect(z,le)},Ut.useId=function(){return C.H.useId()},Ut.useImperativeHandle=function(z,le,Ee){return C.H.useImperativeHandle(z,le,Ee)},Ut.useInsertionEffect=function(z,le){return C.H.useInsertionEffect(z,le)},Ut.useLayoutEffect=function(z,le){return C.H.useLayoutEffect(z,le)},Ut.useMemo=function(z,le){return C.H.useMemo(z,le)},Ut.useOptimistic=function(z,le){return C.H.useOptimistic(z,le)},Ut.useReducer=function(z,le,Ee){return C.H.useReducer(z,le,Ee)},Ut.useRef=function(z){return C.H.useRef(z)},Ut.useState=function(z){return C.H.useState(z)},Ut.useSyncExternalStore=function(z,le,Ee){return C.H.useSyncExternalStore(z,le,Ee)},Ut.useTransition=function(){return C.H.useTransition()},Ut.version="19.1.0",Ut}var CA;function vb(){return CA||(CA=1,Cy.exports=OU()),Cy.exports}var he=vb();const BU=kg(he);var Ny={exports:{}},Zh={},Dy={exports:{}},Py={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NA;function FU(){return NA||(NA=1,function(i){function e(k,G){var W=k.length;k.push(G);e:for(;0<W;){var ce=W-1>>>1,z=k[ce];if(0<r(z,G))k[ce]=G,k[W]=z,W=ce;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var G=k[0],W=k.pop();if(W!==G){k[0]=W;e:for(var ce=0,z=k.length,le=z>>>1;ce<le;){var Ee=2*(ce+1)-1,De=k[Ee],q=Ee+1,Z=k[q];if(0>r(De,W))q<z&&0>r(Z,De)?(k[ce]=Z,k[q]=W,ce=q):(k[ce]=De,k[Ee]=W,ce=Ee);else if(q<z&&0>r(Z,W))k[ce]=Z,k[q]=W,ce=q;else break e}}return G}function r(k,G){var W=k.sortIndex-G.sortIndex;return W!==0?W:k.id-G.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,u=o.now();i.unstable_now=function(){return o.now()-u}}var c=[],f=[],d=1,m=null,g=3,_=!1,v=!1,S=!1,b=!1,x=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function A(k){for(var G=t(f);G!==null;){if(G.callback===null)n(f);else if(G.startTime<=k)n(f),G.sortIndex=G.expirationTime,e(c,G);else break;G=t(f)}}function C(k){if(S=!1,A(k),!v)if(t(c)!==null)v=!0,w||(w=!0,j());else{var G=t(f);G!==null&&$(C,G.startTime-k)}}var w=!1,N=-1,L=5,P=-1;function D(){return b?!0:!(i.unstable_now()-P<L)}function I(){if(b=!1,w){var k=i.unstable_now();P=k;var G=!0;try{e:{v=!1,S&&(S=!1,E(N),N=-1),_=!0;var W=g;try{t:{for(A(k),m=t(c);m!==null&&!(m.expirationTime>k&&D());){var ce=m.callback;if(typeof ce=="function"){m.callback=null,g=m.priorityLevel;var z=ce(m.expirationTime<=k);if(k=i.unstable_now(),typeof z=="function"){m.callback=z,A(k),G=!0;break t}m===t(c)&&n(c),A(k)}else n(c);m=t(c)}if(m!==null)G=!0;else{var le=t(f);le!==null&&$(C,le.startTime-k),G=!1}}break e}finally{m=null,g=W,_=!1}G=void 0}}finally{G?j():w=!1}}}var j;if(typeof M=="function")j=function(){M(I)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,ue=J.port2;J.port1.onmessage=I,j=function(){ue.postMessage(null)}}else j=function(){x(I,0)};function $(k,G){N=x(function(){k(i.unstable_now())},G)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(k){k.callback=null},i.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<k?Math.floor(1e3/k):5},i.unstable_getCurrentPriorityLevel=function(){return g},i.unstable_next=function(k){switch(g){case 1:case 2:case 3:var G=3;break;default:G=g}var W=g;g=G;try{return k()}finally{g=W}},i.unstable_requestPaint=function(){b=!0},i.unstable_runWithPriority=function(k,G){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var W=g;g=k;try{return G()}finally{g=W}},i.unstable_scheduleCallback=function(k,G,W){var ce=i.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ce+W:ce):W=ce,k){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=W+z,k={id:d++,callback:G,priorityLevel:k,startTime:W,expirationTime:z,sortIndex:-1},W>ce?(k.sortIndex=W,e(f,k),t(c)===null&&k===t(f)&&(S?(E(N),N=-1):S=!0,$(C,W-ce))):(k.sortIndex=z,e(c,k),v||_||(v=!0,w||(w=!0,j()))),k},i.unstable_shouldYield=D,i.unstable_wrapCallback=function(k){var G=g;return function(){var W=g;g=G;try{return k.apply(this,arguments)}finally{g=W}}}}(Py)),Py}var DA;function IU(){return DA||(DA=1,Dy.exports=FU()),Dy.exports}var Ly={exports:{}},Vi={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PA;function zU(){if(PA)return Vi;PA=1;var i=vb();function e(c){var f="https://react.dev/errors/"+c;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)f+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function s(c,f,d){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:m==null?null:""+m,children:c,containerInfo:f,implementation:d}}var o=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(c,f){if(c==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Vi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Vi.createPortal=function(c,f){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return s(c,f,null,d)},Vi.flushSync=function(c){var f=o.T,d=n.p;try{if(o.T=null,n.p=2,c)return c()}finally{o.T=f,n.p=d,n.d.f()}},Vi.preconnect=function(c,f){typeof c=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(c,f))},Vi.prefetchDNS=function(c){typeof c=="string"&&n.d.D(c)},Vi.preinit=function(c,f){if(typeof c=="string"&&f&&typeof f.as=="string"){var d=f.as,m=u(d,f.crossOrigin),g=typeof f.integrity=="string"?f.integrity:void 0,_=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;d==="style"?n.d.S(c,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:m,integrity:g,fetchPriority:_}):d==="script"&&n.d.X(c,{crossOrigin:m,integrity:g,fetchPriority:_,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Vi.preinitModule=function(c,f){if(typeof c=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var d=u(f.as,f.crossOrigin);n.d.M(c,{crossOrigin:d,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(c)},Vi.preload=function(c,f){if(typeof c=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var d=f.as,m=u(d,f.crossOrigin);n.d.L(c,d,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Vi.preloadModule=function(c,f){if(typeof c=="string")if(f){var d=u(f.as,f.crossOrigin);n.d.m(c,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:d,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(c)},Vi.requestFormReset=function(c){n.d.r(c)},Vi.unstable_batchedUpdates=function(c,f){return c(f)},Vi.useFormState=function(c,f,d){return o.H.useFormState(c,f,d)},Vi.useFormStatus=function(){return o.H.useHostTransitionStatus()},Vi.version="19.1.0",Vi}var LA;function kU(){if(LA)return Ly.exports;LA=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Ly.exports=zU(),Ly.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UA;function GU(){if(UA)return Zh;UA=1;var i=IU(),e=vb(),t=kU();function n(a){var l="https://react.dev/errors/"+a;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var l=a,h=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(h=l.return),a=l.return;while(a)}return l.tag===3?h:null}function o(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function u(a){if(s(a)!==a)throw Error(n(188))}function c(a){var l=a.alternate;if(!l){if(l=s(a),l===null)throw Error(n(188));return l!==a?null:a}for(var h=a,p=l;;){var y=h.return;if(y===null)break;var T=y.alternate;if(T===null){if(p=y.return,p!==null){h=p;continue}break}if(y.child===T.child){for(T=y.child;T;){if(T===h)return u(y),a;if(T===p)return u(y),l;T=T.sibling}throw Error(n(188))}if(h.return!==p.return)h=y,p=T;else{for(var R=!1,O=y.child;O;){if(O===h){R=!0,h=y,p=T;break}if(O===p){R=!0,p=y,h=T;break}O=O.sibling}if(!R){for(O=T.child;O;){if(O===h){R=!0,h=T,p=y;break}if(O===p){R=!0,p=T,h=y;break}O=O.sibling}if(!R)throw Error(n(189))}}if(h.alternate!==p)throw Error(n(190))}if(h.tag!==3)throw Error(n(188));return h.stateNode.current===h?a:l}function f(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a;for(a=a.child;a!==null;){if(l=f(a),l!==null)return l;a=a.sibling}return null}var d=Object.assign,m=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),x=Symbol.for("react.provider"),E=Symbol.for("react.consumer"),M=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),I=Symbol.iterator;function j(a){return a===null||typeof a!="object"?null:(a=I&&a[I]||a["@@iterator"],typeof a=="function"?a:null)}var J=Symbol.for("react.client.reference");function ue(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===J?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case v:return"Fragment";case b:return"Profiler";case S:return"StrictMode";case C:return"Suspense";case w:return"SuspenseList";case P:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case _:return"Portal";case M:return(a.displayName||"Context")+".Provider";case E:return(a._context.displayName||"Context")+".Consumer";case A:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case N:return l=a.displayName||null,l!==null?l:ue(a.type)||"Memo";case L:l=a._payload,a=a._init;try{return ue(a(l))}catch{}}return null}var $=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},ce=[],z=-1;function le(a){return{current:a}}function Ee(a){0>z||(a.current=ce[z],ce[z]=null,z--)}function De(a,l){z++,ce[z]=a.current,a.current=l}var q=le(null),Z=le(null),Y=le(null),ie=le(null);function xe(a,l){switch(De(Y,l),De(Z,a),De(q,null),l.nodeType){case 9:case 11:a=(a=l.documentElement)&&(a=a.namespaceURI)?eA(a):0;break;default:if(a=l.tagName,l=l.namespaceURI)l=eA(l),a=tA(l,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Ee(q),De(q,a)}function Ve(){Ee(q),Ee(Z),Ee(Y)}function ke(a){a.memoizedState!==null&&De(ie,a);var l=q.current,h=tA(l,a.type);l!==h&&(De(Z,a),De(q,h))}function st(a){Z.current===a&&(Ee(q),Ee(Z)),ie.current===a&&(Ee(ie),qh._currentValue=W)}var Ct=Object.prototype.hasOwnProperty,vt=i.unstable_scheduleCallback,K=i.unstable_cancelCallback,Cn=i.unstable_shouldYield,Ot=i.unstable_requestPaint,yt=i.unstable_now,ct=i.unstable_getCurrentPriorityLevel,hn=i.unstable_ImmediatePriority,at=i.unstable_UserBlockingPriority,V=i.unstable_NormalPriority,B=i.unstable_LowPriority,pe=i.unstable_IdlePriority,Pe=i.log,Ue=i.unstable_setDisableYieldValue,we=null,Je=null;function je(a){if(typeof Pe=="function"&&Ue(a),Je&&typeof Je.setStrictMode=="function")try{Je.setStrictMode(we,a)}catch{}}var We=Math.clz32?Math.clz32:tt,$t=Math.log,ze=Math.LN2;function tt(a){return a>>>=0,a===0?32:31-($t(a)/ze|0)|0}var dt=256,mt=4194304;function Qe(a){var l=a&42;if(l!==0)return l;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function zt(a,l,h){var p=a.pendingLanes;if(p===0)return 0;var y=0,T=a.suspendedLanes,R=a.pingedLanes;a=a.warmLanes;var O=p&134217727;return O!==0?(p=O&~T,p!==0?y=Qe(p):(R&=O,R!==0?y=Qe(R):h||(h=O&~a,h!==0&&(y=Qe(h))))):(O=p&~T,O!==0?y=Qe(O):R!==0?y=Qe(R):h||(h=p&~a,h!==0&&(y=Qe(h)))),y===0?0:l!==0&&l!==y&&(l&T)===0&&(T=y&-y,h=l&-l,T>=h||T===32&&(h&4194048)!==0)?l:y}function Et(a,l){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&l)===0}function fn(a,l){switch(a){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function te(){var a=dt;return dt<<=1,(dt&4194048)===0&&(dt=256),a}function Ye(){var a=mt;return mt<<=1,(mt&62914560)===0&&(mt=4194304),a}function Se(a){for(var l=[],h=0;31>h;h++)l.push(a);return l}function Ce(a,l){a.pendingLanes|=l,l!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ze(a,l,h,p,y,T){var R=a.pendingLanes;a.pendingLanes=h,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=h,a.entangledLanes&=h,a.errorRecoveryDisabledLanes&=h,a.shellSuspendCounter=0;var O=a.entanglements,X=a.expirationTimes,de=a.hiddenUpdates;for(h=R&~h;0<h;){var Me=31-We(h),Ne=1<<Me;O[Me]=0,X[Me]=-1;var me=de[Me];if(me!==null)for(de[Me]=null,Me=0;Me<me.length;Me++){var ge=me[Me];ge!==null&&(ge.lane&=-536870913)}h&=~Ne}p!==0&&Ke(a,p,0),T!==0&&y===0&&a.tag!==0&&(a.suspendedLanes|=T&~(R&~l))}function Ke(a,l,h){a.pendingLanes|=l,a.suspendedLanes&=~l;var p=31-We(l);a.entangledLanes|=l,a.entanglements[p]=a.entanglements[p]|1073741824|h&4194090}function Nt(a,l){var h=a.entangledLanes|=l;for(a=a.entanglements;h;){var p=31-We(h),y=1<<p;y&l|a[p]&l&&(a[p]|=l),h&=~y}}function En(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Jn(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function en(){var a=G.p;return a!==0?a:(a=window.event,a===void 0?32:xA(a.type))}function wr(a,l){var h=G.p;try{return G.p=a,l()}finally{G.p=h}}var bi=Math.random().toString(36).slice(2),ci="__reactFiber$"+bi,Ni="__reactProps$"+bi,ar="__reactContainer$"+bi,el="__reactEvents$"+bi,Hd="__reactListeners$"+bi,jd="__reactHandles$"+bi,tl="__reactResources$"+bi,Ja="__reactMarker$"+bi;function eo(a){delete a[ci],delete a[Ni],delete a[el],delete a[Hd],delete a[jd]}function ea(a){var l=a[ci];if(l)return l;for(var h=a.parentNode;h;){if(l=h[ar]||h[ci]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(a=sA(a);a!==null;){if(h=a[ci])return h;a=sA(a)}return l}a=h,h=a.parentNode}return null}function ta(a){if(a=a[ci]||a[ar]){var l=a.tag;if(l===5||l===6||l===13||l===26||l===27||l===3)return a}return null}function nl(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a.stateNode;throw Error(n(33))}function to(a){var l=a[tl];return l||(l=a[tl]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function ei(a){a[Ja]=!0}var Wd=new Set,qd={};function na(a,l){F(a,l),F(a+"Capture",l)}function F(a,l){for(qd[a]=l,a=0;a<l.length;a++)Wd.add(l[a])}var se=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),_e={},ve={};function ae(a){return Ct.call(ve,a)?!0:Ct.call(_e,a)?!1:se.test(a)?ve[a]=!0:(_e[a]=!0,!1)}function Be(a,l,h){if(ae(l))if(h===null)a.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":a.removeAttribute(l);return;case"boolean":var p=l.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(l);return}}a.setAttribute(l,""+h)}}function qe(a,l,h){if(h===null)a.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttribute(l,""+h)}}function $e(a,l,h,p){if(p===null)a.removeAttribute(h);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(h);return}a.setAttributeNS(l,h,""+p)}}var et,bt;function ht(a){if(et===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);et=l&&l[1]||"",bt=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+et+a+bt}var lt=!1;function Ht(a,l){if(!a||lt)return"";lt=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(l){var Ne=function(){throw Error()};if(Object.defineProperty(Ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ne,[])}catch(ge){var me=ge}Reflect.construct(a,[],Ne)}else{try{Ne.call()}catch(ge){me=ge}a.call(Ne.prototype)}}else{try{throw Error()}catch(ge){me=ge}(Ne=a())&&typeof Ne.catch=="function"&&Ne.catch(function(){})}}catch(ge){if(ge&&me&&typeof ge.stack=="string")return[ge.stack,me.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=p.DetermineComponentFrameRoot(),R=T[0],O=T[1];if(R&&O){var X=R.split(`
`),de=O.split(`
`);for(y=p=0;p<X.length&&!X[p].includes("DetermineComponentFrameRoot");)p++;for(;y<de.length&&!de[y].includes("DetermineComponentFrameRoot");)y++;if(p===X.length||y===de.length)for(p=X.length-1,y=de.length-1;1<=p&&0<=y&&X[p]!==de[y];)y--;for(;1<=p&&0<=y;p--,y--)if(X[p]!==de[y]){if(p!==1||y!==1)do if(p--,y--,0>y||X[p]!==de[y]){var Me=`
`+X[p].replace(" at new "," at ");return a.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",a.displayName)),Me}while(1<=p&&0<=y);break}}}finally{lt=!1,Error.prepareStackTrace=h}return(h=a?a.displayName||a.name:"")?ht(h):""}function tn(a){switch(a.tag){case 26:case 27:case 5:return ht(a.type);case 16:return ht("Lazy");case 13:return ht("Suspense");case 19:return ht("SuspenseList");case 0:case 15:return Ht(a.type,!1);case 11:return Ht(a.type.render,!1);case 1:return Ht(a.type,!0);case 31:return ht("Activity");default:return""}}function Fn(a){try{var l="";do l+=tn(a),a=a.return;while(a);return l}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}function Xt(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Yt(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function ft(a){var l=Yt(a)?"checked":"value",h=Object.getOwnPropertyDescriptor(a.constructor.prototype,l),p=""+a[l];if(!a.hasOwnProperty(l)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var y=h.get,T=h.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return y.call(this)},set:function(R){p=""+R,T.call(this,R)}}),Object.defineProperty(a,l,{enumerable:h.enumerable}),{getValue:function(){return p},setValue:function(R){p=""+R},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function Vn(a){a._valueTracker||(a._valueTracker=ft(a))}function Qt(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var h=l.getValue(),p="";return a&&(p=Yt(a)?a.checked?"true":"false":a.value),a=p,a!==h?(l.setValue(a),!0):!1}function zi(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var no=/[\n"\\]/g;function Mn(a){return a.replace(no,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function ia(a,l,h,p,y,T,R,O){a.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?a.type=R:a.removeAttribute("type"),l!=null?R==="number"?(l===0&&a.value===""||a.value!=l)&&(a.value=""+Xt(l)):a.value!==""+Xt(l)&&(a.value=""+Xt(l)):R!=="submit"&&R!=="reset"||a.removeAttribute("value"),l!=null?ki(a,R,Xt(l)):h!=null?ki(a,R,Xt(h)):p!=null&&a.removeAttribute("value"),y==null&&T!=null&&(a.defaultChecked=!!T),y!=null&&(a.checked=y&&typeof y!="function"&&typeof y!="symbol"),O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?a.name=""+Xt(O):a.removeAttribute("name")}function vn(a,l,h,p,y,T,R,O){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(a.type=T),l!=null||h!=null){if(!(T!=="submit"&&T!=="reset"||l!=null))return;h=h!=null?""+Xt(h):"",l=l!=null?""+Xt(l):h,O||l===a.value||(a.value=l),a.defaultValue=l}p=p??y,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=O?a.checked:!!p,a.defaultChecked=!!p,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.name=R)}function ki(a,l,h){l==="number"&&zi(a.ownerDocument)===a||a.defaultValue===""+h||(a.defaultValue=""+h)}function hi(a,l,h,p){if(a=a.options,l){l={};for(var y=0;y<h.length;y++)l["$"+h[y]]=!0;for(h=0;h<a.length;h++)y=l.hasOwnProperty("$"+a[h].value),a[h].selected!==y&&(a[h].selected=y),y&&p&&(a[h].defaultSelected=!0)}else{for(h=""+Xt(h),l=null,y=0;y<a.length;y++){if(a[y].value===h){a[y].selected=!0,p&&(a[y].defaultSelected=!0);return}l!==null||a[y].disabled||(l=a[y])}l!==null&&(l.selected=!0)}}function Si(a,l,h){if(l!=null&&(l=""+Xt(l),l!==a.value&&(a.value=l),h==null)){a.defaultValue!==l&&(a.defaultValue=l);return}a.defaultValue=h!=null?""+Xt(h):""}function Di(a,l,h,p){if(l==null){if(p!=null){if(h!=null)throw Error(n(92));if($(p)){if(1<p.length)throw Error(n(93));p=p[0]}h=p}h==null&&(h=""),l=h}h=Xt(l),a.defaultValue=h,p=a.textContent,p===h&&p!==""&&p!==null&&(a.value=p)}function Ds(a,l){if(l){var h=a.firstChild;if(h&&h===a.lastChild&&h.nodeType===3){h.nodeValue=l;return}}a.textContent=l}var ra=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function eT(a,l,h){var p=l.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?p?a.setProperty(l,""):l==="float"?a.cssFloat="":a[l]="":p?a.setProperty(l,h):typeof h!="number"||h===0||ra.has(l)?l==="float"?a.cssFloat=h:a[l]=(""+h).trim():a[l]=h+"px"}function tT(a,l,h){if(l!=null&&typeof l!="object")throw Error(n(62));if(a=a.style,h!=null){for(var p in h)!h.hasOwnProperty(p)||l!=null&&l.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var y in l)p=l[y],l.hasOwnProperty(y)&&h[y]!==p&&eT(a,y,p)}else for(var T in l)l.hasOwnProperty(T)&&eT(a,T,l[T])}function w_(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var DP=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),PP=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function $d(a){return PP.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var R_=null;function C_(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var ru=null,su=null;function nT(a){var l=ta(a);if(l&&(a=l.stateNode)){var h=a[Ni]||null;e:switch(a=l.stateNode,l.type){case"input":if(ia(a,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),l=h.name,h.type==="radio"&&l!=null){for(h=a;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+Mn(""+l)+'"][type="radio"]'),l=0;l<h.length;l++){var p=h[l];if(p!==a&&p.form===a.form){var y=p[Ni]||null;if(!y)throw Error(n(90));ia(p,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(l=0;l<h.length;l++)p=h[l],p.form===a.form&&Qt(p)}break e;case"textarea":Si(a,h.value,h.defaultValue);break e;case"select":l=h.value,l!=null&&hi(a,!!h.multiple,l,!1)}}}var N_=!1;function iT(a,l,h){if(N_)return a(l,h);N_=!0;try{var p=a(l);return p}finally{if(N_=!1,(ru!==null||su!==null)&&(Pp(),ru&&(l=ru,a=su,su=ru=null,nT(l),a)))for(l=0;l<a.length;l++)nT(a[l])}}function sh(a,l){var h=a.stateNode;if(h===null)return null;var p=h[Ni]||null;if(p===null)return null;h=p[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(h&&typeof h!="function")throw Error(n(231,l,typeof h));return h}var sa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),D_=!1;if(sa)try{var ah={};Object.defineProperty(ah,"passive",{get:function(){D_=!0}}),window.addEventListener("test",ah,ah),window.removeEventListener("test",ah,ah)}catch{D_=!1}var io=null,P_=null,Xd=null;function rT(){if(Xd)return Xd;var a,l=P_,h=l.length,p,y="value"in io?io.value:io.textContent,T=y.length;for(a=0;a<h&&l[a]===y[a];a++);var R=h-a;for(p=1;p<=R&&l[h-p]===y[T-p];p++);return Xd=y.slice(a,1<p?1-p:void 0)}function Yd(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function Kd(){return!0}function sT(){return!1}function or(a){function l(h,p,y,T,R){this._reactName=h,this._targetInst=y,this.type=p,this.nativeEvent=T,this.target=R,this.currentTarget=null;for(var O in a)a.hasOwnProperty(O)&&(h=a[O],this[O]=h?h(T):T[O]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Kd:sT,this.isPropagationStopped=sT,this}return d(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Kd)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Kd)},persist:function(){},isPersistent:Kd}),l}var il={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qd=or(il),oh=d({},il,{view:0,detail:0}),LP=or(oh),L_,U_,lh,Zd=d({},oh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:B_,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==lh&&(lh&&a.type==="mousemove"?(L_=a.screenX-lh.screenX,U_=a.screenY-lh.screenY):U_=L_=0,lh=a),L_)},movementY:function(a){return"movementY"in a?a.movementY:U_}}),aT=or(Zd),UP=d({},Zd,{dataTransfer:0}),OP=or(UP),BP=d({},oh,{relatedTarget:0}),O_=or(BP),FP=d({},il,{animationName:0,elapsedTime:0,pseudoElement:0}),IP=or(FP),zP=d({},il,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),kP=or(zP),GP=d({},il,{data:0}),oT=or(GP),VP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},HP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function WP(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=jP[a])?!!l[a]:!1}function B_(){return WP}var qP=d({},oh,{key:function(a){if(a.key){var l=VP[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=Yd(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?HP[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:B_,charCode:function(a){return a.type==="keypress"?Yd(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Yd(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),$P=or(qP),XP=d({},Zd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lT=or(XP),YP=d({},oh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:B_}),KP=or(YP),QP=d({},il,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZP=or(QP),JP=d({},Zd,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),eL=or(JP),tL=d({},il,{newState:0,oldState:0}),nL=or(tL),iL=[9,13,27,32],F_=sa&&"CompositionEvent"in window,uh=null;sa&&"documentMode"in document&&(uh=document.documentMode);var rL=sa&&"TextEvent"in window&&!uh,uT=sa&&(!F_||uh&&8<uh&&11>=uh),cT=" ",hT=!1;function fT(a,l){switch(a){case"keyup":return iL.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dT(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var au=!1;function sL(a,l){switch(a){case"compositionend":return dT(l);case"keypress":return l.which!==32?null:(hT=!0,cT);case"textInput":return a=l.data,a===cT&&hT?null:a;default:return null}}function aL(a,l){if(au)return a==="compositionend"||!F_&&fT(a,l)?(a=rT(),Xd=P_=io=null,au=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return uT&&l.locale!=="ko"?null:l.data;default:return null}}var oL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pT(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!oL[a.type]:l==="textarea"}function mT(a,l,h,p){ru?su?su.push(p):su=[p]:ru=p,l=Ip(l,"onChange"),0<l.length&&(h=new Qd("onChange","change",null,h,p),a.push({event:h,listeners:l}))}var ch=null,hh=null;function lL(a){YM(a,0)}function Jd(a){var l=nl(a);if(Qt(l))return a}function gT(a,l){if(a==="change")return l}var _T=!1;if(sa){var I_;if(sa){var z_="oninput"in document;if(!z_){var vT=document.createElement("div");vT.setAttribute("oninput","return;"),z_=typeof vT.oninput=="function"}I_=z_}else I_=!1;_T=I_&&(!document.documentMode||9<document.documentMode)}function yT(){ch&&(ch.detachEvent("onpropertychange",xT),hh=ch=null)}function xT(a){if(a.propertyName==="value"&&Jd(hh)){var l=[];mT(l,hh,a,C_(a)),iT(lL,l)}}function uL(a,l,h){a==="focusin"?(yT(),ch=l,hh=h,ch.attachEvent("onpropertychange",xT)):a==="focusout"&&yT()}function cL(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Jd(hh)}function hL(a,l){if(a==="click")return Jd(l)}function fL(a,l){if(a==="input"||a==="change")return Jd(l)}function dL(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var Rr=typeof Object.is=="function"?Object.is:dL;function fh(a,l){if(Rr(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var h=Object.keys(a),p=Object.keys(l);if(h.length!==p.length)return!1;for(p=0;p<h.length;p++){var y=h[p];if(!Ct.call(l,y)||!Rr(a[y],l[y]))return!1}return!0}function bT(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ST(a,l){var h=bT(a);a=0;for(var p;h;){if(h.nodeType===3){if(p=a+h.textContent.length,a<=l&&p>=l)return{node:h,offset:l-a};a=p}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=bT(h)}}function TT(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?TT(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function ET(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var l=zi(a.document);l instanceof a.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)a=l.contentWindow;else break;l=zi(a.document)}return l}function k_(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}var pL=sa&&"documentMode"in document&&11>=document.documentMode,ou=null,G_=null,dh=null,V_=!1;function MT(a,l,h){var p=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;V_||ou==null||ou!==zi(p)||(p=ou,"selectionStart"in p&&k_(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),dh&&fh(dh,p)||(dh=p,p=Ip(G_,"onSelect"),0<p.length&&(l=new Qd("onSelect","select",null,l,h),a.push({event:l,listeners:p}),l.target=ou)))}function rl(a,l){var h={};return h[a.toLowerCase()]=l.toLowerCase(),h["Webkit"+a]="webkit"+l,h["Moz"+a]="moz"+l,h}var lu={animationend:rl("Animation","AnimationEnd"),animationiteration:rl("Animation","AnimationIteration"),animationstart:rl("Animation","AnimationStart"),transitionrun:rl("Transition","TransitionRun"),transitionstart:rl("Transition","TransitionStart"),transitioncancel:rl("Transition","TransitionCancel"),transitionend:rl("Transition","TransitionEnd")},H_={},AT={};sa&&(AT=document.createElement("div").style,"AnimationEvent"in window||(delete lu.animationend.animation,delete lu.animationiteration.animation,delete lu.animationstart.animation),"TransitionEvent"in window||delete lu.transitionend.transition);function sl(a){if(H_[a])return H_[a];if(!lu[a])return a;var l=lu[a],h;for(h in l)if(l.hasOwnProperty(h)&&h in AT)return H_[a]=l[h];return a}var wT=sl("animationend"),RT=sl("animationiteration"),CT=sl("animationstart"),mL=sl("transitionrun"),gL=sl("transitionstart"),_L=sl("transitioncancel"),NT=sl("transitionend"),DT=new Map,j_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");j_.push("scrollEnd");function hs(a,l){DT.set(a,l),na(l,[a])}var PT=new WeakMap;function $r(a,l){if(typeof a=="object"&&a!==null){var h=PT.get(a);return h!==void 0?h:(l={value:a,source:l,stack:Fn(l)},PT.set(a,l),l)}return{value:a,source:l,stack:Fn(l)}}var Xr=[],uu=0,W_=0;function ep(){for(var a=uu,l=W_=uu=0;l<a;){var h=Xr[l];Xr[l++]=null;var p=Xr[l];Xr[l++]=null;var y=Xr[l];Xr[l++]=null;var T=Xr[l];if(Xr[l++]=null,p!==null&&y!==null){var R=p.pending;R===null?y.next=y:(y.next=R.next,R.next=y),p.pending=y}T!==0&&LT(h,y,T)}}function tp(a,l,h,p){Xr[uu++]=a,Xr[uu++]=l,Xr[uu++]=h,Xr[uu++]=p,W_|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function q_(a,l,h,p){return tp(a,l,h,p),np(a)}function cu(a,l){return tp(a,null,null,l),np(a)}function LT(a,l,h){a.lanes|=h;var p=a.alternate;p!==null&&(p.lanes|=h);for(var y=!1,T=a.return;T!==null;)T.childLanes|=h,p=T.alternate,p!==null&&(p.childLanes|=h),T.tag===22&&(a=T.stateNode,a===null||a._visibility&1||(y=!0)),a=T,T=T.return;return a.tag===3?(T=a.stateNode,y&&l!==null&&(y=31-We(h),a=T.hiddenUpdates,p=a[y],p===null?a[y]=[l]:p.push(l),l.lane=h|536870912),T):null}function np(a){if(50<Ih)throw Ih=0,Zv=null,Error(n(185));for(var l=a.return;l!==null;)a=l,l=a.return;return a.tag===3?a.stateNode:null}var hu={};function vL(a,l,h,p){this.tag=a,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cr(a,l,h,p){return new vL(a,l,h,p)}function $_(a){return a=a.prototype,!(!a||!a.isReactComponent)}function aa(a,l){var h=a.alternate;return h===null?(h=Cr(a.tag,l,a.key,a.mode),h.elementType=a.elementType,h.type=a.type,h.stateNode=a.stateNode,h.alternate=a,a.alternate=h):(h.pendingProps=l,h.type=a.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=a.flags&65011712,h.childLanes=a.childLanes,h.lanes=a.lanes,h.child=a.child,h.memoizedProps=a.memoizedProps,h.memoizedState=a.memoizedState,h.updateQueue=a.updateQueue,l=a.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=a.sibling,h.index=a.index,h.ref=a.ref,h.refCleanup=a.refCleanup,h}function UT(a,l){a.flags&=65011714;var h=a.alternate;return h===null?(a.childLanes=0,a.lanes=l,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=h.childLanes,a.lanes=h.lanes,a.child=h.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=h.memoizedProps,a.memoizedState=h.memoizedState,a.updateQueue=h.updateQueue,a.type=h.type,l=h.dependencies,a.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),a}function ip(a,l,h,p,y,T){var R=0;if(p=a,typeof a=="function")$_(a)&&(R=1);else if(typeof a=="string")R=xU(a,h,q.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case P:return a=Cr(31,h,l,y),a.elementType=P,a.lanes=T,a;case v:return al(h.children,y,T,l);case S:R=8,y|=24;break;case b:return a=Cr(12,h,l,y|2),a.elementType=b,a.lanes=T,a;case C:return a=Cr(13,h,l,y),a.elementType=C,a.lanes=T,a;case w:return a=Cr(19,h,l,y),a.elementType=w,a.lanes=T,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case x:case M:R=10;break e;case E:R=9;break e;case A:R=11;break e;case N:R=14;break e;case L:R=16,p=null;break e}R=29,h=Error(n(130,a===null?"null":typeof a,"")),p=null}return l=Cr(R,h,l,y),l.elementType=a,l.type=p,l.lanes=T,l}function al(a,l,h,p){return a=Cr(7,a,p,l),a.lanes=h,a}function X_(a,l,h){return a=Cr(6,a,null,l),a.lanes=h,a}function Y_(a,l,h){return l=Cr(4,a.children!==null?a.children:[],a.key,l),l.lanes=h,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}var fu=[],du=0,rp=null,sp=0,Yr=[],Kr=0,ol=null,oa=1,la="";function ll(a,l){fu[du++]=sp,fu[du++]=rp,rp=a,sp=l}function OT(a,l,h){Yr[Kr++]=oa,Yr[Kr++]=la,Yr[Kr++]=ol,ol=a;var p=oa;a=la;var y=32-We(p)-1;p&=~(1<<y),h+=1;var T=32-We(l)+y;if(30<T){var R=y-y%5;T=(p&(1<<R)-1).toString(32),p>>=R,y-=R,oa=1<<32-We(l)+y|h<<y|p,la=T+a}else oa=1<<T|h<<y|p,la=a}function K_(a){a.return!==null&&(ll(a,1),OT(a,1,0))}function Q_(a){for(;a===rp;)rp=fu[--du],fu[du]=null,sp=fu[--du],fu[du]=null;for(;a===ol;)ol=Yr[--Kr],Yr[Kr]=null,la=Yr[--Kr],Yr[Kr]=null,oa=Yr[--Kr],Yr[Kr]=null}var Ki=null,Hn=null,rn=!1,ul=null,Ps=!1,Z_=Error(n(519));function cl(a){var l=Error(n(418,""));throw gh($r(l,a)),Z_}function BT(a){var l=a.stateNode,h=a.type,p=a.memoizedProps;switch(l[ci]=a,l[Ni]=p,h){case"dialog":Wt("cancel",l),Wt("close",l);break;case"iframe":case"object":case"embed":Wt("load",l);break;case"video":case"audio":for(h=0;h<kh.length;h++)Wt(kh[h],l);break;case"source":Wt("error",l);break;case"img":case"image":case"link":Wt("error",l),Wt("load",l);break;case"details":Wt("toggle",l);break;case"input":Wt("invalid",l),vn(l,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Vn(l);break;case"select":Wt("invalid",l);break;case"textarea":Wt("invalid",l),Di(l,p.value,p.defaultValue,p.children),Vn(l)}h=p.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||l.textContent===""+h||p.suppressHydrationWarning===!0||JM(l.textContent,h)?(p.popover!=null&&(Wt("beforetoggle",l),Wt("toggle",l)),p.onScroll!=null&&Wt("scroll",l),p.onScrollEnd!=null&&Wt("scrollend",l),p.onClick!=null&&(l.onclick=zp),l=!0):l=!1,l||cl(a)}function FT(a){for(Ki=a.return;Ki;)switch(Ki.tag){case 5:case 13:Ps=!1;return;case 27:case 3:Ps=!0;return;default:Ki=Ki.return}}function ph(a){if(a!==Ki)return!1;if(!rn)return FT(a),rn=!0,!1;var l=a.tag,h;if((h=l!==3&&l!==27)&&((h=l===5)&&(h=a.type,h=!(h!=="form"&&h!=="button")||py(a.type,a.memoizedProps)),h=!h),h&&Hn&&cl(a),FT(a),l===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));e:{for(a=a.nextSibling,l=0;a;){if(a.nodeType===8)if(h=a.data,h==="/$"){if(l===0){Hn=ds(a.nextSibling);break e}l--}else h!=="$"&&h!=="$!"&&h!=="$?"||l++;a=a.nextSibling}Hn=null}}else l===27?(l=Hn,xo(a.type)?(a=vy,vy=null,Hn=a):Hn=l):Hn=Ki?ds(a.stateNode.nextSibling):null;return!0}function mh(){Hn=Ki=null,rn=!1}function IT(){var a=ul;return a!==null&&(cr===null?cr=a:cr.push.apply(cr,a),ul=null),a}function gh(a){ul===null?ul=[a]:ul.push(a)}var J_=le(null),hl=null,ua=null;function ro(a,l,h){De(J_,l._currentValue),l._currentValue=h}function ca(a){a._currentValue=J_.current,Ee(J_)}function ev(a,l,h){for(;a!==null;){var p=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,p!==null&&(p.childLanes|=l)):p!==null&&(p.childLanes&l)!==l&&(p.childLanes|=l),a===h)break;a=a.return}}function tv(a,l,h,p){var y=a.child;for(y!==null&&(y.return=a);y!==null;){var T=y.dependencies;if(T!==null){var R=y.child;T=T.firstContext;e:for(;T!==null;){var O=T;T=y;for(var X=0;X<l.length;X++)if(O.context===l[X]){T.lanes|=h,O=T.alternate,O!==null&&(O.lanes|=h),ev(T.return,h,a),p||(R=null);break e}T=O.next}}else if(y.tag===18){if(R=y.return,R===null)throw Error(n(341));R.lanes|=h,T=R.alternate,T!==null&&(T.lanes|=h),ev(R,h,a),R=null}else R=y.child;if(R!==null)R.return=y;else for(R=y;R!==null;){if(R===a){R=null;break}if(y=R.sibling,y!==null){y.return=R.return,R=y;break}R=R.return}y=R}}function _h(a,l,h,p){a=null;for(var y=l,T=!1;y!==null;){if(!T){if((y.flags&524288)!==0)T=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var R=y.alternate;if(R===null)throw Error(n(387));if(R=R.memoizedProps,R!==null){var O=y.type;Rr(y.pendingProps.value,R.value)||(a!==null?a.push(O):a=[O])}}else if(y===ie.current){if(R=y.alternate,R===null)throw Error(n(387));R.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(a!==null?a.push(qh):a=[qh])}y=y.return}a!==null&&tv(l,a,h,p),l.flags|=262144}function ap(a){for(a=a.firstContext;a!==null;){if(!Rr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function fl(a){hl=a,ua=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Gi(a){return zT(hl,a)}function op(a,l){return hl===null&&fl(a),zT(a,l)}function zT(a,l){var h=l._currentValue;if(l={context:l,memoizedValue:h,next:null},ua===null){if(a===null)throw Error(n(308));ua=l,a.dependencies={lanes:0,firstContext:l},a.flags|=524288}else ua=ua.next=l;return h}var yL=typeof AbortController<"u"?AbortController:function(){var a=[],l=this.signal={aborted:!1,addEventListener:function(h,p){a.push(p)}};this.abort=function(){l.aborted=!0,a.forEach(function(h){return h()})}},xL=i.unstable_scheduleCallback,bL=i.unstable_NormalPriority,fi={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function nv(){return{controller:new yL,data:new Map,refCount:0}}function vh(a){a.refCount--,a.refCount===0&&xL(bL,function(){a.controller.abort()})}var yh=null,iv=0,pu=0,mu=null;function SL(a,l){if(yh===null){var h=yh=[];iv=0,pu=sy(),mu={status:"pending",value:void 0,then:function(p){h.push(p)}}}return iv++,l.then(kT,kT),l}function kT(){if(--iv===0&&yh!==null){mu!==null&&(mu.status="fulfilled");var a=yh;yh=null,pu=0,mu=null;for(var l=0;l<a.length;l++)(0,a[l])()}}function TL(a,l){var h=[],p={status:"pending",value:null,reason:null,then:function(y){h.push(y)}};return a.then(function(){p.status="fulfilled",p.value=l;for(var y=0;y<h.length;y++)(0,h[y])(l)},function(y){for(p.status="rejected",p.reason=y,y=0;y<h.length;y++)(0,h[y])(void 0)}),p}var GT=k.S;k.S=function(a,l){typeof l=="object"&&l!==null&&typeof l.then=="function"&&SL(a,l),GT!==null&&GT(a,l)};var dl=le(null);function rv(){var a=dl.current;return a!==null?a:An.pooledCache}function lp(a,l){l===null?De(dl,dl.current):De(dl,l.pool)}function VT(){var a=rv();return a===null?null:{parent:fi._currentValue,pool:a}}var xh=Error(n(460)),HT=Error(n(474)),up=Error(n(542)),sv={then:function(){}};function jT(a){return a=a.status,a==="fulfilled"||a==="rejected"}function cp(){}function WT(a,l,h){switch(h=a[h],h===void 0?a.push(l):h!==l&&(l.then(cp,cp),l=h),l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,$T(a),a;default:if(typeof l.status=="string")l.then(cp,cp);else{if(a=An,a!==null&&100<a.shellSuspendCounter)throw Error(n(482));a=l,a.status="pending",a.then(function(p){if(l.status==="pending"){var y=l;y.status="fulfilled",y.value=p}},function(p){if(l.status==="pending"){var y=l;y.status="rejected",y.reason=p}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,$T(a),a}throw bh=l,xh}}var bh=null;function qT(){if(bh===null)throw Error(n(459));var a=bh;return bh=null,a}function $T(a){if(a===xh||a===up)throw Error(n(483))}var so=!1;function av(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ov(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ao(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function oo(a,l,h){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(un&2)!==0){var y=p.pending;return y===null?l.next=l:(l.next=y.next,y.next=l),p.pending=l,l=np(a),LT(a,null,h),l}return tp(a,p,l,h),np(a)}function Sh(a,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194048)!==0)){var p=l.lanes;p&=a.pendingLanes,h|=p,l.lanes=h,Nt(a,h)}}function lv(a,l){var h=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,h===p)){var y=null,T=null;if(h=h.firstBaseUpdate,h!==null){do{var R={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};T===null?y=T=R:T=T.next=R,h=h.next}while(h!==null);T===null?y=T=l:T=T.next=l}else y=T=l;h={baseState:p.baseState,firstBaseUpdate:y,lastBaseUpdate:T,shared:p.shared,callbacks:p.callbacks},a.updateQueue=h;return}a=h.lastBaseUpdate,a===null?h.firstBaseUpdate=l:a.next=l,h.lastBaseUpdate=l}var uv=!1;function Th(){if(uv){var a=mu;if(a!==null)throw a}}function Eh(a,l,h,p){uv=!1;var y=a.updateQueue;so=!1;var T=y.firstBaseUpdate,R=y.lastBaseUpdate,O=y.shared.pending;if(O!==null){y.shared.pending=null;var X=O,de=X.next;X.next=null,R===null?T=de:R.next=de,R=X;var Me=a.alternate;Me!==null&&(Me=Me.updateQueue,O=Me.lastBaseUpdate,O!==R&&(O===null?Me.firstBaseUpdate=de:O.next=de,Me.lastBaseUpdate=X))}if(T!==null){var Ne=y.baseState;R=0,Me=de=X=null,O=T;do{var me=O.lane&-536870913,ge=me!==O.lane;if(ge?(Kt&me)===me:(p&me)===me){me!==0&&me===pu&&(uv=!0),Me!==null&&(Me=Me.next={lane:0,tag:O.tag,payload:O.payload,callback:null,next:null});e:{var St=a,pt=O;me=l;var mn=h;switch(pt.tag){case 1:if(St=pt.payload,typeof St=="function"){Ne=St.call(mn,Ne,me);break e}Ne=St;break e;case 3:St.flags=St.flags&-65537|128;case 0:if(St=pt.payload,me=typeof St=="function"?St.call(mn,Ne,me):St,me==null)break e;Ne=d({},Ne,me);break e;case 2:so=!0}}me=O.callback,me!==null&&(a.flags|=64,ge&&(a.flags|=8192),ge=y.callbacks,ge===null?y.callbacks=[me]:ge.push(me))}else ge={lane:me,tag:O.tag,payload:O.payload,callback:O.callback,next:null},Me===null?(de=Me=ge,X=Ne):Me=Me.next=ge,R|=me;if(O=O.next,O===null){if(O=y.shared.pending,O===null)break;ge=O,O=ge.next,ge.next=null,y.lastBaseUpdate=ge,y.shared.pending=null}}while(!0);Me===null&&(X=Ne),y.baseState=X,y.firstBaseUpdate=de,y.lastBaseUpdate=Me,T===null&&(y.shared.lanes=0),go|=R,a.lanes=R,a.memoizedState=Ne}}function XT(a,l){if(typeof a!="function")throw Error(n(191,a));a.call(l)}function YT(a,l){var h=a.callbacks;if(h!==null)for(a.callbacks=null,a=0;a<h.length;a++)XT(h[a],l)}var gu=le(null),hp=le(0);function KT(a,l){a=_a,De(hp,a),De(gu,l),_a=a|l.baseLanes}function cv(){De(hp,_a),De(gu,gu.current)}function hv(){_a=hp.current,Ee(gu),Ee(hp)}var lo=0,kt=null,dn=null,ti=null,fp=!1,_u=!1,pl=!1,dp=0,Mh=0,vu=null,EL=0;function $n(){throw Error(n(321))}function fv(a,l){if(l===null)return!1;for(var h=0;h<l.length&&h<a.length;h++)if(!Rr(a[h],l[h]))return!1;return!0}function dv(a,l,h,p,y,T){return lo=T,kt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,k.H=a===null||a.memoizedState===null?LE:UE,pl=!1,T=h(p,y),pl=!1,_u&&(T=ZT(l,h,p,y)),QT(a),T}function QT(a){k.H=yp;var l=dn!==null&&dn.next!==null;if(lo=0,ti=dn=kt=null,fp=!1,Mh=0,vu=null,l)throw Error(n(300));a===null||Ti||(a=a.dependencies,a!==null&&ap(a)&&(Ti=!0))}function ZT(a,l,h,p){kt=a;var y=0;do{if(_u&&(vu=null),Mh=0,_u=!1,25<=y)throw Error(n(301));if(y+=1,ti=dn=null,a.updateQueue!=null){var T=a.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}k.H=DL,T=l(h,p)}while(_u);return T}function ML(){var a=k.H,l=a.useState()[0];return l=typeof l.then=="function"?Ah(l):l,a=a.useState()[0],(dn!==null?dn.memoizedState:null)!==a&&(kt.flags|=1024),l}function pv(){var a=dp!==0;return dp=0,a}function mv(a,l,h){l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~h}function gv(a){if(fp){for(a=a.memoizedState;a!==null;){var l=a.queue;l!==null&&(l.pending=null),a=a.next}fp=!1}lo=0,ti=dn=kt=null,_u=!1,Mh=dp=0,vu=null}function lr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ti===null?kt.memoizedState=ti=a:ti=ti.next=a,ti}function ni(){if(dn===null){var a=kt.alternate;a=a!==null?a.memoizedState:null}else a=dn.next;var l=ti===null?kt.memoizedState:ti.next;if(l!==null)ti=l,dn=a;else{if(a===null)throw kt.alternate===null?Error(n(467)):Error(n(310));dn=a,a={memoizedState:dn.memoizedState,baseState:dn.baseState,baseQueue:dn.baseQueue,queue:dn.queue,next:null},ti===null?kt.memoizedState=ti=a:ti=ti.next=a}return ti}function _v(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ah(a){var l=Mh;return Mh+=1,vu===null&&(vu=[]),a=WT(vu,a,l),l=kt,(ti===null?l.memoizedState:ti.next)===null&&(l=l.alternate,k.H=l===null||l.memoizedState===null?LE:UE),a}function pp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Ah(a);if(a.$$typeof===M)return Gi(a)}throw Error(n(438,String(a)))}function vv(a){var l=null,h=kt.updateQueue;if(h!==null&&(l=h.memoCache),l==null){var p=kt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(l={data:p.data.map(function(y){return y.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),h===null&&(h=_v(),kt.updateQueue=h),h.memoCache=l,h=l.data[l.index],h===void 0)for(h=l.data[l.index]=Array(a),p=0;p<a;p++)h[p]=D;return l.index++,h}function ha(a,l){return typeof l=="function"?l(a):l}function mp(a){var l=ni();return yv(l,dn,a)}function yv(a,l,h){var p=a.queue;if(p===null)throw Error(n(311));p.lastRenderedReducer=h;var y=a.baseQueue,T=p.pending;if(T!==null){if(y!==null){var R=y.next;y.next=T.next,T.next=R}l.baseQueue=y=T,p.pending=null}if(T=a.baseState,y===null)a.memoizedState=T;else{l=y.next;var O=R=null,X=null,de=l,Me=!1;do{var Ne=de.lane&-536870913;if(Ne!==de.lane?(Kt&Ne)===Ne:(lo&Ne)===Ne){var me=de.revertLane;if(me===0)X!==null&&(X=X.next={lane:0,revertLane:0,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null}),Ne===pu&&(Me=!0);else if((lo&me)===me){de=de.next,me===pu&&(Me=!0);continue}else Ne={lane:0,revertLane:de.revertLane,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},X===null?(O=X=Ne,R=T):X=X.next=Ne,kt.lanes|=me,go|=me;Ne=de.action,pl&&h(T,Ne),T=de.hasEagerState?de.eagerState:h(T,Ne)}else me={lane:Ne,revertLane:de.revertLane,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},X===null?(O=X=me,R=T):X=X.next=me,kt.lanes|=Ne,go|=Ne;de=de.next}while(de!==null&&de!==l);if(X===null?R=T:X.next=O,!Rr(T,a.memoizedState)&&(Ti=!0,Me&&(h=mu,h!==null)))throw h;a.memoizedState=T,a.baseState=R,a.baseQueue=X,p.lastRenderedState=T}return y===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function xv(a){var l=ni(),h=l.queue;if(h===null)throw Error(n(311));h.lastRenderedReducer=a;var p=h.dispatch,y=h.pending,T=l.memoizedState;if(y!==null){h.pending=null;var R=y=y.next;do T=a(T,R.action),R=R.next;while(R!==y);Rr(T,l.memoizedState)||(Ti=!0),l.memoizedState=T,l.baseQueue===null&&(l.baseState=T),h.lastRenderedState=T}return[T,p]}function JT(a,l,h){var p=kt,y=ni(),T=rn;if(T){if(h===void 0)throw Error(n(407));h=h()}else h=l();var R=!Rr((dn||y).memoizedState,h);R&&(y.memoizedState=h,Ti=!0),y=y.queue;var O=nE.bind(null,p,y,a);if(wh(2048,8,O,[a]),y.getSnapshot!==l||R||ti!==null&&ti.memoizedState.tag&1){if(p.flags|=2048,yu(9,gp(),tE.bind(null,p,y,h,l),null),An===null)throw Error(n(349));T||(lo&124)!==0||eE(p,l,h)}return h}function eE(a,l,h){a.flags|=16384,a={getSnapshot:l,value:h},l=kt.updateQueue,l===null?(l=_v(),kt.updateQueue=l,l.stores=[a]):(h=l.stores,h===null?l.stores=[a]:h.push(a))}function tE(a,l,h,p){l.value=h,l.getSnapshot=p,iE(l)&&rE(a)}function nE(a,l,h){return h(function(){iE(l)&&rE(a)})}function iE(a){var l=a.getSnapshot;a=a.value;try{var h=l();return!Rr(a,h)}catch{return!0}}function rE(a){var l=cu(a,2);l!==null&&Ur(l,a,2)}function bv(a){var l=lr();if(typeof a=="function"){var h=a;if(a=h(),pl){je(!0);try{h()}finally{je(!1)}}}return l.memoizedState=l.baseState=a,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ha,lastRenderedState:a},l}function sE(a,l,h,p){return a.baseState=h,yv(a,dn,typeof p=="function"?p:ha)}function AL(a,l,h,p,y){if(vp(a))throw Error(n(485));if(a=l.action,a!==null){var T={payload:y,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){T.listeners.push(R)}};k.T!==null?h(!0):T.isTransition=!1,p(T),h=l.pending,h===null?(T.next=l.pending=T,aE(l,T)):(T.next=h.next,l.pending=h.next=T)}}function aE(a,l){var h=l.action,p=l.payload,y=a.state;if(l.isTransition){var T=k.T,R={};k.T=R;try{var O=h(y,p),X=k.S;X!==null&&X(R,O),oE(a,l,O)}catch(de){Sv(a,l,de)}finally{k.T=T}}else try{T=h(y,p),oE(a,l,T)}catch(de){Sv(a,l,de)}}function oE(a,l,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(p){lE(a,l,p)},function(p){return Sv(a,l,p)}):lE(a,l,h)}function lE(a,l,h){l.status="fulfilled",l.value=h,uE(l),a.state=h,l=a.pending,l!==null&&(h=l.next,h===l?a.pending=null:(h=h.next,l.next=h,aE(a,h)))}function Sv(a,l,h){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do l.status="rejected",l.reason=h,uE(l),l=l.next;while(l!==p)}a.action=null}function uE(a){a=a.listeners;for(var l=0;l<a.length;l++)(0,a[l])()}function cE(a,l){return l}function hE(a,l){if(rn){var h=An.formState;if(h!==null){e:{var p=kt;if(rn){if(Hn){t:{for(var y=Hn,T=Ps;y.nodeType!==8;){if(!T){y=null;break t}if(y=ds(y.nextSibling),y===null){y=null;break t}}T=y.data,y=T==="F!"||T==="F"?y:null}if(y){Hn=ds(y.nextSibling),p=y.data==="F!";break e}}cl(p)}p=!1}p&&(l=h[0])}}return h=lr(),h.memoizedState=h.baseState=l,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cE,lastRenderedState:l},h.queue=p,h=NE.bind(null,kt,p),p.dispatch=h,p=bv(!1),T=wv.bind(null,kt,!1,p.queue),p=lr(),y={state:l,dispatch:null,action:a,pending:null},p.queue=y,h=AL.bind(null,kt,y,T,h),y.dispatch=h,p.memoizedState=a,[l,h,!1]}function fE(a){var l=ni();return dE(l,dn,a)}function dE(a,l,h){if(l=yv(a,l,cE)[0],a=mp(ha)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var p=Ah(l)}catch(R){throw R===xh?up:R}else p=l;l=ni();var y=l.queue,T=y.dispatch;return h!==l.memoizedState&&(kt.flags|=2048,yu(9,gp(),wL.bind(null,y,h),null)),[p,T,a]}function wL(a,l){a.action=l}function pE(a){var l=ni(),h=dn;if(h!==null)return dE(l,h,a);ni(),l=l.memoizedState,h=ni();var p=h.queue.dispatch;return h.memoizedState=a,[l,p,!1]}function yu(a,l,h,p){return a={tag:a,create:h,deps:p,inst:l,next:null},l=kt.updateQueue,l===null&&(l=_v(),kt.updateQueue=l),h=l.lastEffect,h===null?l.lastEffect=a.next=a:(p=h.next,h.next=a,a.next=p,l.lastEffect=a),a}function gp(){return{destroy:void 0,resource:void 0}}function mE(){return ni().memoizedState}function _p(a,l,h,p){var y=lr();p=p===void 0?null:p,kt.flags|=a,y.memoizedState=yu(1|l,gp(),h,p)}function wh(a,l,h,p){var y=ni();p=p===void 0?null:p;var T=y.memoizedState.inst;dn!==null&&p!==null&&fv(p,dn.memoizedState.deps)?y.memoizedState=yu(l,T,h,p):(kt.flags|=a,y.memoizedState=yu(1|l,T,h,p))}function gE(a,l){_p(8390656,8,a,l)}function _E(a,l){wh(2048,8,a,l)}function vE(a,l){return wh(4,2,a,l)}function yE(a,l){return wh(4,4,a,l)}function xE(a,l){if(typeof l=="function"){a=a();var h=l(a);return function(){typeof h=="function"?h():l(null)}}if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function bE(a,l,h){h=h!=null?h.concat([a]):null,wh(4,4,xE.bind(null,l,a),h)}function Tv(){}function SE(a,l){var h=ni();l=l===void 0?null:l;var p=h.memoizedState;return l!==null&&fv(l,p[1])?p[0]:(h.memoizedState=[a,l],a)}function TE(a,l){var h=ni();l=l===void 0?null:l;var p=h.memoizedState;if(l!==null&&fv(l,p[1]))return p[0];if(p=a(),pl){je(!0);try{a()}finally{je(!1)}}return h.memoizedState=[p,l],p}function Ev(a,l,h){return h===void 0||(lo&1073741824)!==0?a.memoizedState=l:(a.memoizedState=h,a=AM(),kt.lanes|=a,go|=a,h)}function EE(a,l,h,p){return Rr(h,l)?h:gu.current!==null?(a=Ev(a,h,p),Rr(a,l)||(Ti=!0),a):(lo&42)===0?(Ti=!0,a.memoizedState=h):(a=AM(),kt.lanes|=a,go|=a,l)}function ME(a,l,h,p,y){var T=G.p;G.p=T!==0&&8>T?T:8;var R=k.T,O={};k.T=O,wv(a,!1,l,h);try{var X=y(),de=k.S;if(de!==null&&de(O,X),X!==null&&typeof X=="object"&&typeof X.then=="function"){var Me=TL(X,p);Rh(a,l,Me,Lr(a))}else Rh(a,l,p,Lr(a))}catch(Ne){Rh(a,l,{then:function(){},status:"rejected",reason:Ne},Lr())}finally{G.p=T,k.T=R}}function RL(){}function Mv(a,l,h,p){if(a.tag!==5)throw Error(n(476));var y=AE(a).queue;ME(a,y,l,W,h===null?RL:function(){return wE(a),h(p)})}function AE(a){var l=a.memoizedState;if(l!==null)return l;l={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ha,lastRenderedState:W},next:null};var h={};return l.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ha,lastRenderedState:h},next:null},a.memoizedState=l,a=a.alternate,a!==null&&(a.memoizedState=l),l}function wE(a){var l=AE(a).next.queue;Rh(a,l,{},Lr())}function Av(){return Gi(qh)}function RE(){return ni().memoizedState}function CE(){return ni().memoizedState}function CL(a){for(var l=a.return;l!==null;){switch(l.tag){case 24:case 3:var h=Lr();a=ao(h);var p=oo(l,a,h);p!==null&&(Ur(p,l,h),Sh(p,l,h)),l={cache:nv()},a.payload=l;return}l=l.return}}function NL(a,l,h){var p=Lr();h={lane:p,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null},vp(a)?DE(l,h):(h=q_(a,l,h,p),h!==null&&(Ur(h,a,p),PE(h,l,p)))}function NE(a,l,h){var p=Lr();Rh(a,l,h,p)}function Rh(a,l,h,p){var y={lane:p,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null};if(vp(a))DE(l,y);else{var T=a.alternate;if(a.lanes===0&&(T===null||T.lanes===0)&&(T=l.lastRenderedReducer,T!==null))try{var R=l.lastRenderedState,O=T(R,h);if(y.hasEagerState=!0,y.eagerState=O,Rr(O,R))return tp(a,l,y,0),An===null&&ep(),!1}catch{}finally{}if(h=q_(a,l,y,p),h!==null)return Ur(h,a,p),PE(h,l,p),!0}return!1}function wv(a,l,h,p){if(p={lane:2,revertLane:sy(),action:p,hasEagerState:!1,eagerState:null,next:null},vp(a)){if(l)throw Error(n(479))}else l=q_(a,h,p,2),l!==null&&Ur(l,a,2)}function vp(a){var l=a.alternate;return a===kt||l!==null&&l===kt}function DE(a,l){_u=fp=!0;var h=a.pending;h===null?l.next=l:(l.next=h.next,h.next=l),a.pending=l}function PE(a,l,h){if((h&4194048)!==0){var p=l.lanes;p&=a.pendingLanes,h|=p,l.lanes=h,Nt(a,h)}}var yp={readContext:Gi,use:pp,useCallback:$n,useContext:$n,useEffect:$n,useImperativeHandle:$n,useLayoutEffect:$n,useInsertionEffect:$n,useMemo:$n,useReducer:$n,useRef:$n,useState:$n,useDebugValue:$n,useDeferredValue:$n,useTransition:$n,useSyncExternalStore:$n,useId:$n,useHostTransitionStatus:$n,useFormState:$n,useActionState:$n,useOptimistic:$n,useMemoCache:$n,useCacheRefresh:$n},LE={readContext:Gi,use:pp,useCallback:function(a,l){return lr().memoizedState=[a,l===void 0?null:l],a},useContext:Gi,useEffect:gE,useImperativeHandle:function(a,l,h){h=h!=null?h.concat([a]):null,_p(4194308,4,xE.bind(null,l,a),h)},useLayoutEffect:function(a,l){return _p(4194308,4,a,l)},useInsertionEffect:function(a,l){_p(4,2,a,l)},useMemo:function(a,l){var h=lr();l=l===void 0?null:l;var p=a();if(pl){je(!0);try{a()}finally{je(!1)}}return h.memoizedState=[p,l],p},useReducer:function(a,l,h){var p=lr();if(h!==void 0){var y=h(l);if(pl){je(!0);try{h(l)}finally{je(!1)}}}else y=l;return p.memoizedState=p.baseState=y,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:y},p.queue=a,a=a.dispatch=NL.bind(null,kt,a),[p.memoizedState,a]},useRef:function(a){var l=lr();return a={current:a},l.memoizedState=a},useState:function(a){a=bv(a);var l=a.queue,h=NE.bind(null,kt,l);return l.dispatch=h,[a.memoizedState,h]},useDebugValue:Tv,useDeferredValue:function(a,l){var h=lr();return Ev(h,a,l)},useTransition:function(){var a=bv(!1);return a=ME.bind(null,kt,a.queue,!0,!1),lr().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,l,h){var p=kt,y=lr();if(rn){if(h===void 0)throw Error(n(407));h=h()}else{if(h=l(),An===null)throw Error(n(349));(Kt&124)!==0||eE(p,l,h)}y.memoizedState=h;var T={value:h,getSnapshot:l};return y.queue=T,gE(nE.bind(null,p,T,a),[a]),p.flags|=2048,yu(9,gp(),tE.bind(null,p,T,h,l),null),h},useId:function(){var a=lr(),l=An.identifierPrefix;if(rn){var h=la,p=oa;h=(p&~(1<<32-We(p)-1)).toString(32)+h,l="«"+l+"R"+h,h=dp++,0<h&&(l+="H"+h.toString(32)),l+="»"}else h=EL++,l="«"+l+"r"+h.toString(32)+"»";return a.memoizedState=l},useHostTransitionStatus:Av,useFormState:hE,useActionState:hE,useOptimistic:function(a){var l=lr();l.memoizedState=l.baseState=a;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=h,l=wv.bind(null,kt,!0,h),h.dispatch=l,[a,l]},useMemoCache:vv,useCacheRefresh:function(){return lr().memoizedState=CL.bind(null,kt)}},UE={readContext:Gi,use:pp,useCallback:SE,useContext:Gi,useEffect:_E,useImperativeHandle:bE,useInsertionEffect:vE,useLayoutEffect:yE,useMemo:TE,useReducer:mp,useRef:mE,useState:function(){return mp(ha)},useDebugValue:Tv,useDeferredValue:function(a,l){var h=ni();return EE(h,dn.memoizedState,a,l)},useTransition:function(){var a=mp(ha)[0],l=ni().memoizedState;return[typeof a=="boolean"?a:Ah(a),l]},useSyncExternalStore:JT,useId:RE,useHostTransitionStatus:Av,useFormState:fE,useActionState:fE,useOptimistic:function(a,l){var h=ni();return sE(h,dn,a,l)},useMemoCache:vv,useCacheRefresh:CE},DL={readContext:Gi,use:pp,useCallback:SE,useContext:Gi,useEffect:_E,useImperativeHandle:bE,useInsertionEffect:vE,useLayoutEffect:yE,useMemo:TE,useReducer:xv,useRef:mE,useState:function(){return xv(ha)},useDebugValue:Tv,useDeferredValue:function(a,l){var h=ni();return dn===null?Ev(h,a,l):EE(h,dn.memoizedState,a,l)},useTransition:function(){var a=xv(ha)[0],l=ni().memoizedState;return[typeof a=="boolean"?a:Ah(a),l]},useSyncExternalStore:JT,useId:RE,useHostTransitionStatus:Av,useFormState:pE,useActionState:pE,useOptimistic:function(a,l){var h=ni();return dn!==null?sE(h,dn,a,l):(h.baseState=a,[a,h.queue.dispatch])},useMemoCache:vv,useCacheRefresh:CE},xu=null,Ch=0;function xp(a){var l=Ch;return Ch+=1,xu===null&&(xu=[]),WT(xu,a,l)}function Nh(a,l){l=l.props.ref,a.ref=l!==void 0?l:null}function bp(a,l){throw l.$$typeof===m?Error(n(525)):(a=Object.prototype.toString.call(l),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a)))}function OE(a){var l=a._init;return l(a._payload)}function BE(a){function l(re,ee){if(a){var fe=re.deletions;fe===null?(re.deletions=[ee],re.flags|=16):fe.push(ee)}}function h(re,ee){if(!a)return null;for(;ee!==null;)l(re,ee),ee=ee.sibling;return null}function p(re){for(var ee=new Map;re!==null;)re.key!==null?ee.set(re.key,re):ee.set(re.index,re),re=re.sibling;return ee}function y(re,ee){return re=aa(re,ee),re.index=0,re.sibling=null,re}function T(re,ee,fe){return re.index=fe,a?(fe=re.alternate,fe!==null?(fe=fe.index,fe<ee?(re.flags|=67108866,ee):fe):(re.flags|=67108866,ee)):(re.flags|=1048576,ee)}function R(re){return a&&re.alternate===null&&(re.flags|=67108866),re}function O(re,ee,fe,Re){return ee===null||ee.tag!==6?(ee=X_(fe,re.mode,Re),ee.return=re,ee):(ee=y(ee,fe),ee.return=re,ee)}function X(re,ee,fe,Re){var nt=fe.type;return nt===v?Me(re,ee,fe.props.children,Re,fe.key):ee!==null&&(ee.elementType===nt||typeof nt=="object"&&nt!==null&&nt.$$typeof===L&&OE(nt)===ee.type)?(ee=y(ee,fe.props),Nh(ee,fe),ee.return=re,ee):(ee=ip(fe.type,fe.key,fe.props,null,re.mode,Re),Nh(ee,fe),ee.return=re,ee)}function de(re,ee,fe,Re){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==fe.containerInfo||ee.stateNode.implementation!==fe.implementation?(ee=Y_(fe,re.mode,Re),ee.return=re,ee):(ee=y(ee,fe.children||[]),ee.return=re,ee)}function Me(re,ee,fe,Re,nt){return ee===null||ee.tag!==7?(ee=al(fe,re.mode,Re,nt),ee.return=re,ee):(ee=y(ee,fe),ee.return=re,ee)}function Ne(re,ee,fe){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return ee=X_(""+ee,re.mode,fe),ee.return=re,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case g:return fe=ip(ee.type,ee.key,ee.props,null,re.mode,fe),Nh(fe,ee),fe.return=re,fe;case _:return ee=Y_(ee,re.mode,fe),ee.return=re,ee;case L:var Re=ee._init;return ee=Re(ee._payload),Ne(re,ee,fe)}if($(ee)||j(ee))return ee=al(ee,re.mode,fe,null),ee.return=re,ee;if(typeof ee.then=="function")return Ne(re,xp(ee),fe);if(ee.$$typeof===M)return Ne(re,op(re,ee),fe);bp(re,ee)}return null}function me(re,ee,fe,Re){var nt=ee!==null?ee.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return nt!==null?null:O(re,ee,""+fe,Re);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case g:return fe.key===nt?X(re,ee,fe,Re):null;case _:return fe.key===nt?de(re,ee,fe,Re):null;case L:return nt=fe._init,fe=nt(fe._payload),me(re,ee,fe,Re)}if($(fe)||j(fe))return nt!==null?null:Me(re,ee,fe,Re,null);if(typeof fe.then=="function")return me(re,ee,xp(fe),Re);if(fe.$$typeof===M)return me(re,ee,op(re,fe),Re);bp(re,fe)}return null}function ge(re,ee,fe,Re,nt){if(typeof Re=="string"&&Re!==""||typeof Re=="number"||typeof Re=="bigint")return re=re.get(fe)||null,O(ee,re,""+Re,nt);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case g:return re=re.get(Re.key===null?fe:Re.key)||null,X(ee,re,Re,nt);case _:return re=re.get(Re.key===null?fe:Re.key)||null,de(ee,re,Re,nt);case L:var Gt=Re._init;return Re=Gt(Re._payload),ge(re,ee,fe,Re,nt)}if($(Re)||j(Re))return re=re.get(fe)||null,Me(ee,re,Re,nt,null);if(typeof Re.then=="function")return ge(re,ee,fe,xp(Re),nt);if(Re.$$typeof===M)return ge(re,ee,fe,op(ee,Re),nt);bp(ee,Re)}return null}function St(re,ee,fe,Re){for(var nt=null,Gt=null,ot=ee,gt=ee=0,Mi=null;ot!==null&&gt<fe.length;gt++){ot.index>gt?(Mi=ot,ot=null):Mi=ot.sibling;var nn=me(re,ot,fe[gt],Re);if(nn===null){ot===null&&(ot=Mi);break}a&&ot&&nn.alternate===null&&l(re,ot),ee=T(nn,ee,gt),Gt===null?nt=nn:Gt.sibling=nn,Gt=nn,ot=Mi}if(gt===fe.length)return h(re,ot),rn&&ll(re,gt),nt;if(ot===null){for(;gt<fe.length;gt++)ot=Ne(re,fe[gt],Re),ot!==null&&(ee=T(ot,ee,gt),Gt===null?nt=ot:Gt.sibling=ot,Gt=ot);return rn&&ll(re,gt),nt}for(ot=p(ot);gt<fe.length;gt++)Mi=ge(ot,re,gt,fe[gt],Re),Mi!==null&&(a&&Mi.alternate!==null&&ot.delete(Mi.key===null?gt:Mi.key),ee=T(Mi,ee,gt),Gt===null?nt=Mi:Gt.sibling=Mi,Gt=Mi);return a&&ot.forEach(function(Mo){return l(re,Mo)}),rn&&ll(re,gt),nt}function pt(re,ee,fe,Re){if(fe==null)throw Error(n(151));for(var nt=null,Gt=null,ot=ee,gt=ee=0,Mi=null,nn=fe.next();ot!==null&&!nn.done;gt++,nn=fe.next()){ot.index>gt?(Mi=ot,ot=null):Mi=ot.sibling;var Mo=me(re,ot,nn.value,Re);if(Mo===null){ot===null&&(ot=Mi);break}a&&ot&&Mo.alternate===null&&l(re,ot),ee=T(Mo,ee,gt),Gt===null?nt=Mo:Gt.sibling=Mo,Gt=Mo,ot=Mi}if(nn.done)return h(re,ot),rn&&ll(re,gt),nt;if(ot===null){for(;!nn.done;gt++,nn=fe.next())nn=Ne(re,nn.value,Re),nn!==null&&(ee=T(nn,ee,gt),Gt===null?nt=nn:Gt.sibling=nn,Gt=nn);return rn&&ll(re,gt),nt}for(ot=p(ot);!nn.done;gt++,nn=fe.next())nn=ge(ot,re,gt,nn.value,Re),nn!==null&&(a&&nn.alternate!==null&&ot.delete(nn.key===null?gt:nn.key),ee=T(nn,ee,gt),Gt===null?nt=nn:Gt.sibling=nn,Gt=nn);return a&&ot.forEach(function(PU){return l(re,PU)}),rn&&ll(re,gt),nt}function mn(re,ee,fe,Re){if(typeof fe=="object"&&fe!==null&&fe.type===v&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case g:e:{for(var nt=fe.key;ee!==null;){if(ee.key===nt){if(nt=fe.type,nt===v){if(ee.tag===7){h(re,ee.sibling),Re=y(ee,fe.props.children),Re.return=re,re=Re;break e}}else if(ee.elementType===nt||typeof nt=="object"&&nt!==null&&nt.$$typeof===L&&OE(nt)===ee.type){h(re,ee.sibling),Re=y(ee,fe.props),Nh(Re,fe),Re.return=re,re=Re;break e}h(re,ee);break}else l(re,ee);ee=ee.sibling}fe.type===v?(Re=al(fe.props.children,re.mode,Re,fe.key),Re.return=re,re=Re):(Re=ip(fe.type,fe.key,fe.props,null,re.mode,Re),Nh(Re,fe),Re.return=re,re=Re)}return R(re);case _:e:{for(nt=fe.key;ee!==null;){if(ee.key===nt)if(ee.tag===4&&ee.stateNode.containerInfo===fe.containerInfo&&ee.stateNode.implementation===fe.implementation){h(re,ee.sibling),Re=y(ee,fe.children||[]),Re.return=re,re=Re;break e}else{h(re,ee);break}else l(re,ee);ee=ee.sibling}Re=Y_(fe,re.mode,Re),Re.return=re,re=Re}return R(re);case L:return nt=fe._init,fe=nt(fe._payload),mn(re,ee,fe,Re)}if($(fe))return St(re,ee,fe,Re);if(j(fe)){if(nt=j(fe),typeof nt!="function")throw Error(n(150));return fe=nt.call(fe),pt(re,ee,fe,Re)}if(typeof fe.then=="function")return mn(re,ee,xp(fe),Re);if(fe.$$typeof===M)return mn(re,ee,op(re,fe),Re);bp(re,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint"?(fe=""+fe,ee!==null&&ee.tag===6?(h(re,ee.sibling),Re=y(ee,fe),Re.return=re,re=Re):(h(re,ee),Re=X_(fe,re.mode,Re),Re.return=re,re=Re),R(re)):h(re,ee)}return function(re,ee,fe,Re){try{Ch=0;var nt=mn(re,ee,fe,Re);return xu=null,nt}catch(ot){if(ot===xh||ot===up)throw ot;var Gt=Cr(29,ot,null,re.mode);return Gt.lanes=Re,Gt.return=re,Gt}finally{}}}var bu=BE(!0),FE=BE(!1),Qr=le(null),Ls=null;function uo(a){var l=a.alternate;De(di,di.current&1),De(Qr,a),Ls===null&&(l===null||gu.current!==null||l.memoizedState!==null)&&(Ls=a)}function IE(a){if(a.tag===22){if(De(di,di.current),De(Qr,a),Ls===null){var l=a.alternate;l!==null&&l.memoizedState!==null&&(Ls=a)}}else co()}function co(){De(di,di.current),De(Qr,Qr.current)}function fa(a){Ee(Qr),Ls===a&&(Ls=null),Ee(di)}var di=le(0);function Sp(a){for(var l=a;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||_y(h)))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}function Rv(a,l,h,p){l=a.memoizedState,h=h(p,l),h=h==null?l:d({},l,h),a.memoizedState=h,a.lanes===0&&(a.updateQueue.baseState=h)}var Cv={enqueueSetState:function(a,l,h){a=a._reactInternals;var p=Lr(),y=ao(p);y.payload=l,h!=null&&(y.callback=h),l=oo(a,y,p),l!==null&&(Ur(l,a,p),Sh(l,a,p))},enqueueReplaceState:function(a,l,h){a=a._reactInternals;var p=Lr(),y=ao(p);y.tag=1,y.payload=l,h!=null&&(y.callback=h),l=oo(a,y,p),l!==null&&(Ur(l,a,p),Sh(l,a,p))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var h=Lr(),p=ao(h);p.tag=2,l!=null&&(p.callback=l),l=oo(a,p,h),l!==null&&(Ur(l,a,h),Sh(l,a,h))}};function zE(a,l,h,p,y,T,R){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,T,R):l.prototype&&l.prototype.isPureReactComponent?!fh(h,p)||!fh(y,T):!0}function kE(a,l,h,p){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,p),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,p),l.state!==a&&Cv.enqueueReplaceState(l,l.state,null)}function ml(a,l){var h=l;if("ref"in l){h={};for(var p in l)p!=="ref"&&(h[p]=l[p])}if(a=a.defaultProps){h===l&&(h=d({},h));for(var y in a)h[y]===void 0&&(h[y]=a[y])}return h}var Tp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function GE(a){Tp(a)}function VE(a){console.error(a)}function HE(a){Tp(a)}function Ep(a,l){try{var h=a.onUncaughtError;h(l.value,{componentStack:l.stack})}catch(p){setTimeout(function(){throw p})}}function jE(a,l,h){try{var p=a.onCaughtError;p(h.value,{componentStack:h.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function Nv(a,l,h){return h=ao(h),h.tag=3,h.payload={element:null},h.callback=function(){Ep(a,l)},h}function WE(a){return a=ao(a),a.tag=3,a}function qE(a,l,h,p){var y=h.type.getDerivedStateFromError;if(typeof y=="function"){var T=p.value;a.payload=function(){return y(T)},a.callback=function(){jE(l,h,p)}}var R=h.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(a.callback=function(){jE(l,h,p),typeof y!="function"&&(_o===null?_o=new Set([this]):_o.add(this));var O=p.stack;this.componentDidCatch(p.value,{componentStack:O!==null?O:""})})}function PL(a,l,h,p,y){if(h.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(l=h.alternate,l!==null&&_h(l,h,y,!0),h=Qr.current,h!==null){switch(h.tag){case 13:return Ls===null?ey():h.alternate===null&&jn===0&&(jn=3),h.flags&=-257,h.flags|=65536,h.lanes=y,p===sv?h.flags|=16384:(l=h.updateQueue,l===null?h.updateQueue=new Set([p]):l.add(p),ny(a,p,y)),!1;case 22:return h.flags|=65536,p===sv?h.flags|=16384:(l=h.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([p])},h.updateQueue=l):(h=l.retryQueue,h===null?l.retryQueue=new Set([p]):h.add(p)),ny(a,p,y)),!1}throw Error(n(435,h.tag))}return ny(a,p,y),ey(),!1}if(rn)return l=Qr.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=y,p!==Z_&&(a=Error(n(422),{cause:p}),gh($r(a,h)))):(p!==Z_&&(l=Error(n(423),{cause:p}),gh($r(l,h))),a=a.current.alternate,a.flags|=65536,y&=-y,a.lanes|=y,p=$r(p,h),y=Nv(a.stateNode,p,y),lv(a,y),jn!==4&&(jn=2)),!1;var T=Error(n(520),{cause:p});if(T=$r(T,h),Fh===null?Fh=[T]:Fh.push(T),jn!==4&&(jn=2),l===null)return!0;p=$r(p,h),h=l;do{switch(h.tag){case 3:return h.flags|=65536,a=y&-y,h.lanes|=a,a=Nv(h.stateNode,p,a),lv(h,a),!1;case 1:if(l=h.type,T=h.stateNode,(h.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(_o===null||!_o.has(T))))return h.flags|=65536,y&=-y,h.lanes|=y,y=WE(y),qE(y,a,h,p),lv(h,y),!1}h=h.return}while(h!==null);return!1}var $E=Error(n(461)),Ti=!1;function Pi(a,l,h,p){l.child=a===null?FE(l,null,h,p):bu(l,a.child,h,p)}function XE(a,l,h,p,y){h=h.render;var T=l.ref;if("ref"in p){var R={};for(var O in p)O!=="ref"&&(R[O]=p[O])}else R=p;return fl(l),p=dv(a,l,h,R,T,y),O=pv(),a!==null&&!Ti?(mv(a,l,y),da(a,l,y)):(rn&&O&&K_(l),l.flags|=1,Pi(a,l,p,y),l.child)}function YE(a,l,h,p,y){if(a===null){var T=h.type;return typeof T=="function"&&!$_(T)&&T.defaultProps===void 0&&h.compare===null?(l.tag=15,l.type=T,KE(a,l,T,p,y)):(a=ip(h.type,null,p,l,l.mode,y),a.ref=l.ref,a.return=l,l.child=a)}if(T=a.child,!Iv(a,y)){var R=T.memoizedProps;if(h=h.compare,h=h!==null?h:fh,h(R,p)&&a.ref===l.ref)return da(a,l,y)}return l.flags|=1,a=aa(T,p),a.ref=l.ref,a.return=l,l.child=a}function KE(a,l,h,p,y){if(a!==null){var T=a.memoizedProps;if(fh(T,p)&&a.ref===l.ref)if(Ti=!1,l.pendingProps=p=T,Iv(a,y))(a.flags&131072)!==0&&(Ti=!0);else return l.lanes=a.lanes,da(a,l,y)}return Dv(a,l,h,p,y)}function QE(a,l,h){var p=l.pendingProps,y=p.children,T=a!==null?a.memoizedState:null;if(p.mode==="hidden"){if((l.flags&128)!==0){if(p=T!==null?T.baseLanes|h:h,a!==null){for(y=l.child=a.child,T=0;y!==null;)T=T|y.lanes|y.childLanes,y=y.sibling;l.childLanes=T&~p}else l.childLanes=0,l.child=null;return ZE(a,l,p,h)}if((h&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},a!==null&&lp(l,T!==null?T.cachePool:null),T!==null?KT(l,T):cv(),IE(l);else return l.lanes=l.childLanes=536870912,ZE(a,l,T!==null?T.baseLanes|h:h,h)}else T!==null?(lp(l,T.cachePool),KT(l,T),co(),l.memoizedState=null):(a!==null&&lp(l,null),cv(),co());return Pi(a,l,y,h),l.child}function ZE(a,l,h,p){var y=rv();return y=y===null?null:{parent:fi._currentValue,pool:y},l.memoizedState={baseLanes:h,cachePool:y},a!==null&&lp(l,null),cv(),IE(l),a!==null&&_h(a,l,p,!0),null}function Mp(a,l){var h=l.ref;if(h===null)a!==null&&a.ref!==null&&(l.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(n(284));(a===null||a.ref!==h)&&(l.flags|=4194816)}}function Dv(a,l,h,p,y){return fl(l),h=dv(a,l,h,p,void 0,y),p=pv(),a!==null&&!Ti?(mv(a,l,y),da(a,l,y)):(rn&&p&&K_(l),l.flags|=1,Pi(a,l,h,y),l.child)}function JE(a,l,h,p,y,T){return fl(l),l.updateQueue=null,h=ZT(l,p,h,y),QT(a),p=pv(),a!==null&&!Ti?(mv(a,l,T),da(a,l,T)):(rn&&p&&K_(l),l.flags|=1,Pi(a,l,h,T),l.child)}function eM(a,l,h,p,y){if(fl(l),l.stateNode===null){var T=hu,R=h.contextType;typeof R=="object"&&R!==null&&(T=Gi(R)),T=new h(p,T),l.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=Cv,l.stateNode=T,T._reactInternals=l,T=l.stateNode,T.props=p,T.state=l.memoizedState,T.refs={},av(l),R=h.contextType,T.context=typeof R=="object"&&R!==null?Gi(R):hu,T.state=l.memoizedState,R=h.getDerivedStateFromProps,typeof R=="function"&&(Rv(l,h,R,p),T.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(R=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),R!==T.state&&Cv.enqueueReplaceState(T,T.state,null),Eh(l,p,T,y),Th(),T.state=l.memoizedState),typeof T.componentDidMount=="function"&&(l.flags|=4194308),p=!0}else if(a===null){T=l.stateNode;var O=l.memoizedProps,X=ml(h,O);T.props=X;var de=T.context,Me=h.contextType;R=hu,typeof Me=="object"&&Me!==null&&(R=Gi(Me));var Ne=h.getDerivedStateFromProps;Me=typeof Ne=="function"||typeof T.getSnapshotBeforeUpdate=="function",O=l.pendingProps!==O,Me||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(O||de!==R)&&kE(l,T,p,R),so=!1;var me=l.memoizedState;T.state=me,Eh(l,p,T,y),Th(),de=l.memoizedState,O||me!==de||so?(typeof Ne=="function"&&(Rv(l,h,Ne,p),de=l.memoizedState),(X=so||zE(l,h,X,p,me,de,R))?(Me||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(l.flags|=4194308)):(typeof T.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=p,l.memoizedState=de),T.props=p,T.state=de,T.context=R,p=X):(typeof T.componentDidMount=="function"&&(l.flags|=4194308),p=!1)}else{T=l.stateNode,ov(a,l),R=l.memoizedProps,Me=ml(h,R),T.props=Me,Ne=l.pendingProps,me=T.context,de=h.contextType,X=hu,typeof de=="object"&&de!==null&&(X=Gi(de)),O=h.getDerivedStateFromProps,(de=typeof O=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(R!==Ne||me!==X)&&kE(l,T,p,X),so=!1,me=l.memoizedState,T.state=me,Eh(l,p,T,y),Th();var ge=l.memoizedState;R!==Ne||me!==ge||so||a!==null&&a.dependencies!==null&&ap(a.dependencies)?(typeof O=="function"&&(Rv(l,h,O,p),ge=l.memoizedState),(Me=so||zE(l,h,Me,p,me,ge,X)||a!==null&&a.dependencies!==null&&ap(a.dependencies))?(de||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(p,ge,X),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(p,ge,X)),typeof T.componentDidUpdate=="function"&&(l.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof T.componentDidUpdate!="function"||R===a.memoizedProps&&me===a.memoizedState||(l.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&me===a.memoizedState||(l.flags|=1024),l.memoizedProps=p,l.memoizedState=ge),T.props=p,T.state=ge,T.context=X,p=Me):(typeof T.componentDidUpdate!="function"||R===a.memoizedProps&&me===a.memoizedState||(l.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&me===a.memoizedState||(l.flags|=1024),p=!1)}return T=p,Mp(a,l),p=(l.flags&128)!==0,T||p?(T=l.stateNode,h=p&&typeof h.getDerivedStateFromError!="function"?null:T.render(),l.flags|=1,a!==null&&p?(l.child=bu(l,a.child,null,y),l.child=bu(l,null,h,y)):Pi(a,l,h,y),l.memoizedState=T.state,a=l.child):a=da(a,l,y),a}function tM(a,l,h,p){return mh(),l.flags|=256,Pi(a,l,h,p),l.child}var Pv={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Lv(a){return{baseLanes:a,cachePool:VT()}}function Uv(a,l,h){return a=a!==null?a.childLanes&~h:0,l&&(a|=Zr),a}function nM(a,l,h){var p=l.pendingProps,y=!1,T=(l.flags&128)!==0,R;if((R=T)||(R=a!==null&&a.memoizedState===null?!1:(di.current&2)!==0),R&&(y=!0,l.flags&=-129),R=(l.flags&32)!==0,l.flags&=-33,a===null){if(rn){if(y?uo(l):co(),rn){var O=Hn,X;if(X=O){e:{for(X=O,O=Ps;X.nodeType!==8;){if(!O){O=null;break e}if(X=ds(X.nextSibling),X===null){O=null;break e}}O=X}O!==null?(l.memoizedState={dehydrated:O,treeContext:ol!==null?{id:oa,overflow:la}:null,retryLane:536870912,hydrationErrors:null},X=Cr(18,null,null,0),X.stateNode=O,X.return=l,l.child=X,Ki=l,Hn=null,X=!0):X=!1}X||cl(l)}if(O=l.memoizedState,O!==null&&(O=O.dehydrated,O!==null))return _y(O)?l.lanes=32:l.lanes=536870912,null;fa(l)}return O=p.children,p=p.fallback,y?(co(),y=l.mode,O=Ap({mode:"hidden",children:O},y),p=al(p,y,h,null),O.return=l,p.return=l,O.sibling=p,l.child=O,y=l.child,y.memoizedState=Lv(h),y.childLanes=Uv(a,R,h),l.memoizedState=Pv,p):(uo(l),Ov(l,O))}if(X=a.memoizedState,X!==null&&(O=X.dehydrated,O!==null)){if(T)l.flags&256?(uo(l),l.flags&=-257,l=Bv(a,l,h)):l.memoizedState!==null?(co(),l.child=a.child,l.flags|=128,l=null):(co(),y=p.fallback,O=l.mode,p=Ap({mode:"visible",children:p.children},O),y=al(y,O,h,null),y.flags|=2,p.return=l,y.return=l,p.sibling=y,l.child=p,bu(l,a.child,null,h),p=l.child,p.memoizedState=Lv(h),p.childLanes=Uv(a,R,h),l.memoizedState=Pv,l=y);else if(uo(l),_y(O)){if(R=O.nextSibling&&O.nextSibling.dataset,R)var de=R.dgst;R=de,p=Error(n(419)),p.stack="",p.digest=R,gh({value:p,source:null,stack:null}),l=Bv(a,l,h)}else if(Ti||_h(a,l,h,!1),R=(h&a.childLanes)!==0,Ti||R){if(R=An,R!==null&&(p=h&-h,p=(p&42)!==0?1:En(p),p=(p&(R.suspendedLanes|h))!==0?0:p,p!==0&&p!==X.retryLane))throw X.retryLane=p,cu(a,p),Ur(R,a,p),$E;O.data==="$?"||ey(),l=Bv(a,l,h)}else O.data==="$?"?(l.flags|=192,l.child=a.child,l=null):(a=X.treeContext,Hn=ds(O.nextSibling),Ki=l,rn=!0,ul=null,Ps=!1,a!==null&&(Yr[Kr++]=oa,Yr[Kr++]=la,Yr[Kr++]=ol,oa=a.id,la=a.overflow,ol=l),l=Ov(l,p.children),l.flags|=4096);return l}return y?(co(),y=p.fallback,O=l.mode,X=a.child,de=X.sibling,p=aa(X,{mode:"hidden",children:p.children}),p.subtreeFlags=X.subtreeFlags&65011712,de!==null?y=aa(de,y):(y=al(y,O,h,null),y.flags|=2),y.return=l,p.return=l,p.sibling=y,l.child=p,p=y,y=l.child,O=a.child.memoizedState,O===null?O=Lv(h):(X=O.cachePool,X!==null?(de=fi._currentValue,X=X.parent!==de?{parent:de,pool:de}:X):X=VT(),O={baseLanes:O.baseLanes|h,cachePool:X}),y.memoizedState=O,y.childLanes=Uv(a,R,h),l.memoizedState=Pv,p):(uo(l),h=a.child,a=h.sibling,h=aa(h,{mode:"visible",children:p.children}),h.return=l,h.sibling=null,a!==null&&(R=l.deletions,R===null?(l.deletions=[a],l.flags|=16):R.push(a)),l.child=h,l.memoizedState=null,h)}function Ov(a,l){return l=Ap({mode:"visible",children:l},a.mode),l.return=a,a.child=l}function Ap(a,l){return a=Cr(22,a,null,l),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function Bv(a,l,h){return bu(l,a.child,null,h),a=Ov(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function iM(a,l,h){a.lanes|=l;var p=a.alternate;p!==null&&(p.lanes|=l),ev(a.return,l,h)}function Fv(a,l,h,p,y){var T=a.memoizedState;T===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:p,tail:h,tailMode:y}:(T.isBackwards=l,T.rendering=null,T.renderingStartTime=0,T.last=p,T.tail=h,T.tailMode=y)}function rM(a,l,h){var p=l.pendingProps,y=p.revealOrder,T=p.tail;if(Pi(a,l,p.children,h),p=di.current,(p&2)!==0)p=p&1|2,l.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&iM(a,h,l);else if(a.tag===19)iM(a,h,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}p&=1}switch(De(di,p),y){case"forwards":for(h=l.child,y=null;h!==null;)a=h.alternate,a!==null&&Sp(a)===null&&(y=h),h=h.sibling;h=y,h===null?(y=l.child,l.child=null):(y=h.sibling,h.sibling=null),Fv(l,!1,y,h,T);break;case"backwards":for(h=null,y=l.child,l.child=null;y!==null;){if(a=y.alternate,a!==null&&Sp(a)===null){l.child=y;break}a=y.sibling,y.sibling=h,h=y,y=a}Fv(l,!0,h,null,T);break;case"together":Fv(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function da(a,l,h){if(a!==null&&(l.dependencies=a.dependencies),go|=l.lanes,(h&l.childLanes)===0)if(a!==null){if(_h(a,l,h,!1),(h&l.childLanes)===0)return null}else return null;if(a!==null&&l.child!==a.child)throw Error(n(153));if(l.child!==null){for(a=l.child,h=aa(a,a.pendingProps),l.child=h,h.return=l;a.sibling!==null;)a=a.sibling,h=h.sibling=aa(a,a.pendingProps),h.return=l;h.sibling=null}return l.child}function Iv(a,l){return(a.lanes&l)!==0?!0:(a=a.dependencies,!!(a!==null&&ap(a)))}function LL(a,l,h){switch(l.tag){case 3:xe(l,l.stateNode.containerInfo),ro(l,fi,a.memoizedState.cache),mh();break;case 27:case 5:ke(l);break;case 4:xe(l,l.stateNode.containerInfo);break;case 10:ro(l,l.type,l.memoizedProps.value);break;case 13:var p=l.memoizedState;if(p!==null)return p.dehydrated!==null?(uo(l),l.flags|=128,null):(h&l.child.childLanes)!==0?nM(a,l,h):(uo(l),a=da(a,l,h),a!==null?a.sibling:null);uo(l);break;case 19:var y=(a.flags&128)!==0;if(p=(h&l.childLanes)!==0,p||(_h(a,l,h,!1),p=(h&l.childLanes)!==0),y){if(p)return rM(a,l,h);l.flags|=128}if(y=l.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),De(di,di.current),p)break;return null;case 22:case 23:return l.lanes=0,QE(a,l,h);case 24:ro(l,fi,a.memoizedState.cache)}return da(a,l,h)}function sM(a,l,h){if(a!==null)if(a.memoizedProps!==l.pendingProps)Ti=!0;else{if(!Iv(a,h)&&(l.flags&128)===0)return Ti=!1,LL(a,l,h);Ti=(a.flags&131072)!==0}else Ti=!1,rn&&(l.flags&1048576)!==0&&OT(l,sp,l.index);switch(l.lanes=0,l.tag){case 16:e:{a=l.pendingProps;var p=l.elementType,y=p._init;if(p=y(p._payload),l.type=p,typeof p=="function")$_(p)?(a=ml(p,a),l.tag=1,l=eM(null,l,p,a,h)):(l.tag=0,l=Dv(null,l,p,a,h));else{if(p!=null){if(y=p.$$typeof,y===A){l.tag=11,l=XE(null,l,p,a,h);break e}else if(y===N){l.tag=14,l=YE(null,l,p,a,h);break e}}throw l=ue(p)||p,Error(n(306,l,""))}}return l;case 0:return Dv(a,l,l.type,l.pendingProps,h);case 1:return p=l.type,y=ml(p,l.pendingProps),eM(a,l,p,y,h);case 3:e:{if(xe(l,l.stateNode.containerInfo),a===null)throw Error(n(387));p=l.pendingProps;var T=l.memoizedState;y=T.element,ov(a,l),Eh(l,p,null,h);var R=l.memoizedState;if(p=R.cache,ro(l,fi,p),p!==T.cache&&tv(l,[fi],h,!0),Th(),p=R.element,T.isDehydrated)if(T={element:p,isDehydrated:!1,cache:R.cache},l.updateQueue.baseState=T,l.memoizedState=T,l.flags&256){l=tM(a,l,p,h);break e}else if(p!==y){y=$r(Error(n(424)),l),gh(y),l=tM(a,l,p,h);break e}else{switch(a=l.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Hn=ds(a.firstChild),Ki=l,rn=!0,ul=null,Ps=!0,h=FE(l,null,p,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling}else{if(mh(),p===y){l=da(a,l,h);break e}Pi(a,l,p,h)}l=l.child}return l;case 26:return Mp(a,l),a===null?(h=uA(l.type,null,l.pendingProps,null))?l.memoizedState=h:rn||(h=l.type,a=l.pendingProps,p=kp(Y.current).createElement(h),p[ci]=l,p[Ni]=a,Ui(p,h,a),ei(p),l.stateNode=p):l.memoizedState=uA(l.type,a.memoizedProps,l.pendingProps,a.memoizedState),null;case 27:return ke(l),a===null&&rn&&(p=l.stateNode=aA(l.type,l.pendingProps,Y.current),Ki=l,Ps=!0,y=Hn,xo(l.type)?(vy=y,Hn=ds(p.firstChild)):Hn=y),Pi(a,l,l.pendingProps.children,h),Mp(a,l),a===null&&(l.flags|=4194304),l.child;case 5:return a===null&&rn&&((y=p=Hn)&&(p=oU(p,l.type,l.pendingProps,Ps),p!==null?(l.stateNode=p,Ki=l,Hn=ds(p.firstChild),Ps=!1,y=!0):y=!1),y||cl(l)),ke(l),y=l.type,T=l.pendingProps,R=a!==null?a.memoizedProps:null,p=T.children,py(y,T)?p=null:R!==null&&py(y,R)&&(l.flags|=32),l.memoizedState!==null&&(y=dv(a,l,ML,null,null,h),qh._currentValue=y),Mp(a,l),Pi(a,l,p,h),l.child;case 6:return a===null&&rn&&((a=h=Hn)&&(h=lU(h,l.pendingProps,Ps),h!==null?(l.stateNode=h,Ki=l,Hn=null,a=!0):a=!1),a||cl(l)),null;case 13:return nM(a,l,h);case 4:return xe(l,l.stateNode.containerInfo),p=l.pendingProps,a===null?l.child=bu(l,null,p,h):Pi(a,l,p,h),l.child;case 11:return XE(a,l,l.type,l.pendingProps,h);case 7:return Pi(a,l,l.pendingProps,h),l.child;case 8:return Pi(a,l,l.pendingProps.children,h),l.child;case 12:return Pi(a,l,l.pendingProps.children,h),l.child;case 10:return p=l.pendingProps,ro(l,l.type,p.value),Pi(a,l,p.children,h),l.child;case 9:return y=l.type._context,p=l.pendingProps.children,fl(l),y=Gi(y),p=p(y),l.flags|=1,Pi(a,l,p,h),l.child;case 14:return YE(a,l,l.type,l.pendingProps,h);case 15:return KE(a,l,l.type,l.pendingProps,h);case 19:return rM(a,l,h);case 31:return p=l.pendingProps,h=l.mode,p={mode:p.mode,children:p.children},a===null?(h=Ap(p,h),h.ref=l.ref,l.child=h,h.return=l,l=h):(h=aa(a.child,p),h.ref=l.ref,l.child=h,h.return=l,l=h),l;case 22:return QE(a,l,h);case 24:return fl(l),p=Gi(fi),a===null?(y=rv(),y===null&&(y=An,T=nv(),y.pooledCache=T,T.refCount++,T!==null&&(y.pooledCacheLanes|=h),y=T),l.memoizedState={parent:p,cache:y},av(l),ro(l,fi,y)):((a.lanes&h)!==0&&(ov(a,l),Eh(l,null,null,h),Th()),y=a.memoizedState,T=l.memoizedState,y.parent!==p?(y={parent:p,cache:p},l.memoizedState=y,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=y),ro(l,fi,p)):(p=T.cache,ro(l,fi,p),p!==y.cache&&tv(l,[fi],h,!0))),Pi(a,l,l.pendingProps.children,h),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function pa(a){a.flags|=4}function aM(a,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!pA(l)){if(l=Qr.current,l!==null&&((Kt&4194048)===Kt?Ls!==null:(Kt&62914560)!==Kt&&(Kt&536870912)===0||l!==Ls))throw bh=sv,HT;a.flags|=8192}}function wp(a,l){l!==null&&(a.flags|=4),a.flags&16384&&(l=a.tag!==22?Ye():536870912,a.lanes|=l,Mu|=l)}function Dh(a,l){if(!rn)switch(a.tailMode){case"hidden":l=a.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?a.tail=null:h.sibling=null;break;case"collapsed":h=a.tail;for(var p=null;h!==null;)h.alternate!==null&&(p=h),h=h.sibling;p===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function In(a){var l=a.alternate!==null&&a.alternate.child===a.child,h=0,p=0;if(l)for(var y=a.child;y!==null;)h|=y.lanes|y.childLanes,p|=y.subtreeFlags&65011712,p|=y.flags&65011712,y.return=a,y=y.sibling;else for(y=a.child;y!==null;)h|=y.lanes|y.childLanes,p|=y.subtreeFlags,p|=y.flags,y.return=a,y=y.sibling;return a.subtreeFlags|=p,a.childLanes=h,l}function UL(a,l,h){var p=l.pendingProps;switch(Q_(l),l.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return In(l),null;case 1:return In(l),null;case 3:return h=l.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),l.memoizedState.cache!==p&&(l.flags|=2048),ca(fi),Ve(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(a===null||a.child===null)&&(ph(l)?pa(l):a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,IT())),In(l),null;case 26:return h=l.memoizedState,a===null?(pa(l),h!==null?(In(l),aM(l,h)):(In(l),l.flags&=-16777217)):h?h!==a.memoizedState?(pa(l),In(l),aM(l,h)):(In(l),l.flags&=-16777217):(a.memoizedProps!==p&&pa(l),In(l),l.flags&=-16777217),null;case 27:st(l),h=Y.current;var y=l.type;if(a!==null&&l.stateNode!=null)a.memoizedProps!==p&&pa(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return In(l),null}a=q.current,ph(l)?BT(l):(a=aA(y,p,h),l.stateNode=a,pa(l))}return In(l),null;case 5:if(st(l),h=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==p&&pa(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return In(l),null}if(a=q.current,ph(l))BT(l);else{switch(y=kp(Y.current),a){case 1:a=y.createElementNS("http://www.w3.org/2000/svg",h);break;case 2:a=y.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;default:switch(h){case"svg":a=y.createElementNS("http://www.w3.org/2000/svg",h);break;case"math":a=y.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;case"script":a=y.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof p.is=="string"?y.createElement("select",{is:p.is}):y.createElement("select"),p.multiple?a.multiple=!0:p.size&&(a.size=p.size);break;default:a=typeof p.is=="string"?y.createElement(h,{is:p.is}):y.createElement(h)}}a[ci]=l,a[Ni]=p;e:for(y=l.child;y!==null;){if(y.tag===5||y.tag===6)a.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===l)break e;for(;y.sibling===null;){if(y.return===null||y.return===l)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}l.stateNode=a;e:switch(Ui(a,h,p),h){case"button":case"input":case"select":case"textarea":a=!!p.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&pa(l)}}return In(l),l.flags&=-16777217,null;case 6:if(a&&l.stateNode!=null)a.memoizedProps!==p&&pa(l);else{if(typeof p!="string"&&l.stateNode===null)throw Error(n(166));if(a=Y.current,ph(l)){if(a=l.stateNode,h=l.memoizedProps,p=null,y=Ki,y!==null)switch(y.tag){case 27:case 5:p=y.memoizedProps}a[ci]=l,a=!!(a.nodeValue===h||p!==null&&p.suppressHydrationWarning===!0||JM(a.nodeValue,h)),a||cl(l)}else a=kp(a).createTextNode(p),a[ci]=l,l.stateNode=a}return In(l),null;case 13:if(p=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(y=ph(l),p!==null&&p.dehydrated!==null){if(a===null){if(!y)throw Error(n(318));if(y=l.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[ci]=l}else mh(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;In(l),y=!1}else y=IT(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=y),y=!0;if(!y)return l.flags&256?(fa(l),l):(fa(l),null)}if(fa(l),(l.flags&128)!==0)return l.lanes=h,l;if(h=p!==null,a=a!==null&&a.memoizedState!==null,h){p=l.child,y=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(y=p.alternate.memoizedState.cachePool.pool);var T=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(T=p.memoizedState.cachePool.pool),T!==y&&(p.flags|=2048)}return h!==a&&h&&(l.child.flags|=8192),wp(l,l.updateQueue),In(l),null;case 4:return Ve(),a===null&&uy(l.stateNode.containerInfo),In(l),null;case 10:return ca(l.type),In(l),null;case 19:if(Ee(di),y=l.memoizedState,y===null)return In(l),null;if(p=(l.flags&128)!==0,T=y.rendering,T===null)if(p)Dh(y,!1);else{if(jn!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(T=Sp(a),T!==null){for(l.flags|=128,Dh(y,!1),a=T.updateQueue,l.updateQueue=a,wp(l,a),l.subtreeFlags=0,a=h,h=l.child;h!==null;)UT(h,a),h=h.sibling;return De(di,di.current&1|2),l.child}a=a.sibling}y.tail!==null&&yt()>Np&&(l.flags|=128,p=!0,Dh(y,!1),l.lanes=4194304)}else{if(!p)if(a=Sp(T),a!==null){if(l.flags|=128,p=!0,a=a.updateQueue,l.updateQueue=a,wp(l,a),Dh(y,!0),y.tail===null&&y.tailMode==="hidden"&&!T.alternate&&!rn)return In(l),null}else 2*yt()-y.renderingStartTime>Np&&h!==536870912&&(l.flags|=128,p=!0,Dh(y,!1),l.lanes=4194304);y.isBackwards?(T.sibling=l.child,l.child=T):(a=y.last,a!==null?a.sibling=T:l.child=T,y.last=T)}return y.tail!==null?(l=y.tail,y.rendering=l,y.tail=l.sibling,y.renderingStartTime=yt(),l.sibling=null,a=di.current,De(di,p?a&1|2:a&1),l):(In(l),null);case 22:case 23:return fa(l),hv(),p=l.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(l.flags|=8192):p&&(l.flags|=8192),p?(h&536870912)!==0&&(l.flags&128)===0&&(In(l),l.subtreeFlags&6&&(l.flags|=8192)):In(l),h=l.updateQueue,h!==null&&wp(l,h.retryQueue),h=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),p=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),p!==h&&(l.flags|=2048),a!==null&&Ee(dl),null;case 24:return h=null,a!==null&&(h=a.memoizedState.cache),l.memoizedState.cache!==h&&(l.flags|=2048),ca(fi),In(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function OL(a,l){switch(Q_(l),l.tag){case 1:return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return ca(fi),Ve(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 26:case 27:case 5:return st(l),null;case 13:if(fa(l),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(n(340));mh()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return Ee(di),null;case 4:return Ve(),null;case 10:return ca(l.type),null;case 22:case 23:return fa(l),hv(),a!==null&&Ee(dl),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 24:return ca(fi),null;case 25:return null;default:return null}}function oM(a,l){switch(Q_(l),l.tag){case 3:ca(fi),Ve();break;case 26:case 27:case 5:st(l);break;case 4:Ve();break;case 13:fa(l);break;case 19:Ee(di);break;case 10:ca(l.type);break;case 22:case 23:fa(l),hv(),a!==null&&Ee(dl);break;case 24:ca(fi)}}function Ph(a,l){try{var h=l.updateQueue,p=h!==null?h.lastEffect:null;if(p!==null){var y=p.next;h=y;do{if((h.tag&a)===a){p=void 0;var T=h.create,R=h.inst;p=T(),R.destroy=p}h=h.next}while(h!==y)}}catch(O){yn(l,l.return,O)}}function ho(a,l,h){try{var p=l.updateQueue,y=p!==null?p.lastEffect:null;if(y!==null){var T=y.next;p=T;do{if((p.tag&a)===a){var R=p.inst,O=R.destroy;if(O!==void 0){R.destroy=void 0,y=l;var X=h,de=O;try{de()}catch(Me){yn(y,X,Me)}}}p=p.next}while(p!==T)}}catch(Me){yn(l,l.return,Me)}}function lM(a){var l=a.updateQueue;if(l!==null){var h=a.stateNode;try{YT(l,h)}catch(p){yn(a,a.return,p)}}}function uM(a,l,h){h.props=ml(a.type,a.memoizedProps),h.state=a.memoizedState;try{h.componentWillUnmount()}catch(p){yn(a,l,p)}}function Lh(a,l){try{var h=a.ref;if(h!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof h=="function"?a.refCleanup=h(p):h.current=p}}catch(y){yn(a,l,y)}}function Us(a,l){var h=a.ref,p=a.refCleanup;if(h!==null)if(typeof p=="function")try{p()}catch(y){yn(a,l,y)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(y){yn(a,l,y)}else h.current=null}function cM(a){var l=a.type,h=a.memoizedProps,p=a.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":h.autoFocus&&p.focus();break e;case"img":h.src?p.src=h.src:h.srcSet&&(p.srcset=h.srcSet)}}catch(y){yn(a,a.return,y)}}function zv(a,l,h){try{var p=a.stateNode;nU(p,a.type,h,l),p[Ni]=l}catch(y){yn(a,a.return,y)}}function hM(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&xo(a.type)||a.tag===4}function kv(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||hM(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&xo(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Gv(a,l,h){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(a,l):(l=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,l.appendChild(a),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=zp));else if(p!==4&&(p===27&&xo(a.type)&&(h=a.stateNode,l=null),a=a.child,a!==null))for(Gv(a,l,h),a=a.sibling;a!==null;)Gv(a,l,h),a=a.sibling}function Rp(a,l,h){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?h.insertBefore(a,l):h.appendChild(a);else if(p!==4&&(p===27&&xo(a.type)&&(h=a.stateNode),a=a.child,a!==null))for(Rp(a,l,h),a=a.sibling;a!==null;)Rp(a,l,h),a=a.sibling}function fM(a){var l=a.stateNode,h=a.memoizedProps;try{for(var p=a.type,y=l.attributes;y.length;)l.removeAttributeNode(y[0]);Ui(l,p,h),l[ci]=a,l[Ni]=h}catch(T){yn(a,a.return,T)}}var ma=!1,Xn=!1,Vv=!1,dM=typeof WeakSet=="function"?WeakSet:Set,Ei=null;function BL(a,l){if(a=a.containerInfo,fy=qp,a=ET(a),k_(a)){if("selectionStart"in a)var h={start:a.selectionStart,end:a.selectionEnd};else e:{h=(h=a.ownerDocument)&&h.defaultView||window;var p=h.getSelection&&h.getSelection();if(p&&p.rangeCount!==0){h=p.anchorNode;var y=p.anchorOffset,T=p.focusNode;p=p.focusOffset;try{h.nodeType,T.nodeType}catch{h=null;break e}var R=0,O=-1,X=-1,de=0,Me=0,Ne=a,me=null;t:for(;;){for(var ge;Ne!==h||y!==0&&Ne.nodeType!==3||(O=R+y),Ne!==T||p!==0&&Ne.nodeType!==3||(X=R+p),Ne.nodeType===3&&(R+=Ne.nodeValue.length),(ge=Ne.firstChild)!==null;)me=Ne,Ne=ge;for(;;){if(Ne===a)break t;if(me===h&&++de===y&&(O=R),me===T&&++Me===p&&(X=R),(ge=Ne.nextSibling)!==null)break;Ne=me,me=Ne.parentNode}Ne=ge}h=O===-1||X===-1?null:{start:O,end:X}}else h=null}h=h||{start:0,end:0}}else h=null;for(dy={focusedElem:a,selectionRange:h},qp=!1,Ei=l;Ei!==null;)if(l=Ei,a=l.child,(l.subtreeFlags&1024)!==0&&a!==null)a.return=l,Ei=a;else for(;Ei!==null;){switch(l=Ei,T=l.alternate,a=l.flags,l.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&T!==null){a=void 0,h=l,y=T.memoizedProps,T=T.memoizedState,p=h.stateNode;try{var St=ml(h.type,y,h.elementType===h.type);a=p.getSnapshotBeforeUpdate(St,T),p.__reactInternalSnapshotBeforeUpdate=a}catch(pt){yn(h,h.return,pt)}}break;case 3:if((a&1024)!==0){if(a=l.stateNode.containerInfo,h=a.nodeType,h===9)gy(a);else if(h===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":gy(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(n(163))}if(a=l.sibling,a!==null){a.return=l.return,Ei=a;break}Ei=l.return}}function pM(a,l,h){var p=h.flags;switch(h.tag){case 0:case 11:case 15:fo(a,h),p&4&&Ph(5,h);break;case 1:if(fo(a,h),p&4)if(a=h.stateNode,l===null)try{a.componentDidMount()}catch(R){yn(h,h.return,R)}else{var y=ml(h.type,l.memoizedProps);l=l.memoizedState;try{a.componentDidUpdate(y,l,a.__reactInternalSnapshotBeforeUpdate)}catch(R){yn(h,h.return,R)}}p&64&&lM(h),p&512&&Lh(h,h.return);break;case 3:if(fo(a,h),p&64&&(a=h.updateQueue,a!==null)){if(l=null,h.child!==null)switch(h.child.tag){case 27:case 5:l=h.child.stateNode;break;case 1:l=h.child.stateNode}try{YT(a,l)}catch(R){yn(h,h.return,R)}}break;case 27:l===null&&p&4&&fM(h);case 26:case 5:fo(a,h),l===null&&p&4&&cM(h),p&512&&Lh(h,h.return);break;case 12:fo(a,h);break;case 13:fo(a,h),p&4&&_M(a,h),p&64&&(a=h.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(h=WL.bind(null,h),uU(a,h))));break;case 22:if(p=h.memoizedState!==null||ma,!p){l=l!==null&&l.memoizedState!==null||Xn,y=ma;var T=Xn;ma=p,(Xn=l)&&!T?po(a,h,(h.subtreeFlags&8772)!==0):fo(a,h),ma=y,Xn=T}break;case 30:break;default:fo(a,h)}}function mM(a){var l=a.alternate;l!==null&&(a.alternate=null,mM(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&eo(l)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Pn=null,ur=!1;function ga(a,l,h){for(h=h.child;h!==null;)gM(a,l,h),h=h.sibling}function gM(a,l,h){if(Je&&typeof Je.onCommitFiberUnmount=="function")try{Je.onCommitFiberUnmount(we,h)}catch{}switch(h.tag){case 26:Xn||Us(h,l),ga(a,l,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:Xn||Us(h,l);var p=Pn,y=ur;xo(h.type)&&(Pn=h.stateNode,ur=!1),ga(a,l,h),Vh(h.stateNode),Pn=p,ur=y;break;case 5:Xn||Us(h,l);case 6:if(p=Pn,y=ur,Pn=null,ga(a,l,h),Pn=p,ur=y,Pn!==null)if(ur)try{(Pn.nodeType===9?Pn.body:Pn.nodeName==="HTML"?Pn.ownerDocument.body:Pn).removeChild(h.stateNode)}catch(T){yn(h,l,T)}else try{Pn.removeChild(h.stateNode)}catch(T){yn(h,l,T)}break;case 18:Pn!==null&&(ur?(a=Pn,rA(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,h.stateNode),Kh(a)):rA(Pn,h.stateNode));break;case 4:p=Pn,y=ur,Pn=h.stateNode.containerInfo,ur=!0,ga(a,l,h),Pn=p,ur=y;break;case 0:case 11:case 14:case 15:Xn||ho(2,h,l),Xn||ho(4,h,l),ga(a,l,h);break;case 1:Xn||(Us(h,l),p=h.stateNode,typeof p.componentWillUnmount=="function"&&uM(h,l,p)),ga(a,l,h);break;case 21:ga(a,l,h);break;case 22:Xn=(p=Xn)||h.memoizedState!==null,ga(a,l,h),Xn=p;break;default:ga(a,l,h)}}function _M(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Kh(a)}catch(h){yn(l,l.return,h)}}function FL(a){switch(a.tag){case 13:case 19:var l=a.stateNode;return l===null&&(l=a.stateNode=new dM),l;case 22:return a=a.stateNode,l=a._retryCache,l===null&&(l=a._retryCache=new dM),l;default:throw Error(n(435,a.tag))}}function Hv(a,l){var h=FL(a);l.forEach(function(p){var y=qL.bind(null,a,p);h.has(p)||(h.add(p),p.then(y,y))})}function Nr(a,l){var h=l.deletions;if(h!==null)for(var p=0;p<h.length;p++){var y=h[p],T=a,R=l,O=R;e:for(;O!==null;){switch(O.tag){case 27:if(xo(O.type)){Pn=O.stateNode,ur=!1;break e}break;case 5:Pn=O.stateNode,ur=!1;break e;case 3:case 4:Pn=O.stateNode.containerInfo,ur=!0;break e}O=O.return}if(Pn===null)throw Error(n(160));gM(T,R,y),Pn=null,ur=!1,T=y.alternate,T!==null&&(T.return=null),y.return=null}if(l.subtreeFlags&13878)for(l=l.child;l!==null;)vM(l,a),l=l.sibling}var fs=null;function vM(a,l){var h=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Nr(l,a),Dr(a),p&4&&(ho(3,a,a.return),Ph(3,a),ho(5,a,a.return));break;case 1:Nr(l,a),Dr(a),p&512&&(Xn||h===null||Us(h,h.return)),p&64&&ma&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(h=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=h===null?p:h.concat(p))));break;case 26:var y=fs;if(Nr(l,a),Dr(a),p&512&&(Xn||h===null||Us(h,h.return)),p&4){var T=h!==null?h.memoizedState:null;if(p=a.memoizedState,h===null)if(p===null)if(a.stateNode===null){e:{p=a.type,h=a.memoizedProps,y=y.ownerDocument||y;t:switch(p){case"title":T=y.getElementsByTagName("title")[0],(!T||T[Ja]||T[ci]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=y.createElement(p),y.head.insertBefore(T,y.querySelector("head > title"))),Ui(T,p,h),T[ci]=a,ei(T),p=T;break e;case"link":var R=fA("link","href",y).get(p+(h.href||""));if(R){for(var O=0;O<R.length;O++)if(T=R[O],T.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&T.getAttribute("rel")===(h.rel==null?null:h.rel)&&T.getAttribute("title")===(h.title==null?null:h.title)&&T.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){R.splice(O,1);break t}}T=y.createElement(p),Ui(T,p,h),y.head.appendChild(T);break;case"meta":if(R=fA("meta","content",y).get(p+(h.content||""))){for(O=0;O<R.length;O++)if(T=R[O],T.getAttribute("content")===(h.content==null?null:""+h.content)&&T.getAttribute("name")===(h.name==null?null:h.name)&&T.getAttribute("property")===(h.property==null?null:h.property)&&T.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&T.getAttribute("charset")===(h.charSet==null?null:h.charSet)){R.splice(O,1);break t}}T=y.createElement(p),Ui(T,p,h),y.head.appendChild(T);break;default:throw Error(n(468,p))}T[ci]=a,ei(T),p=T}a.stateNode=p}else dA(y,a.type,a.stateNode);else a.stateNode=hA(y,p,a.memoizedProps);else T!==p?(T===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):T.count--,p===null?dA(y,a.type,a.stateNode):hA(y,p,a.memoizedProps)):p===null&&a.stateNode!==null&&zv(a,a.memoizedProps,h.memoizedProps)}break;case 27:Nr(l,a),Dr(a),p&512&&(Xn||h===null||Us(h,h.return)),h!==null&&p&4&&zv(a,a.memoizedProps,h.memoizedProps);break;case 5:if(Nr(l,a),Dr(a),p&512&&(Xn||h===null||Us(h,h.return)),a.flags&32){y=a.stateNode;try{Ds(y,"")}catch(ge){yn(a,a.return,ge)}}p&4&&a.stateNode!=null&&(y=a.memoizedProps,zv(a,y,h!==null?h.memoizedProps:y)),p&1024&&(Vv=!0);break;case 6:if(Nr(l,a),Dr(a),p&4){if(a.stateNode===null)throw Error(n(162));p=a.memoizedProps,h=a.stateNode;try{h.nodeValue=p}catch(ge){yn(a,a.return,ge)}}break;case 3:if(Hp=null,y=fs,fs=Gp(l.containerInfo),Nr(l,a),fs=y,Dr(a),p&4&&h!==null&&h.memoizedState.isDehydrated)try{Kh(l.containerInfo)}catch(ge){yn(a,a.return,ge)}Vv&&(Vv=!1,yM(a));break;case 4:p=fs,fs=Gp(a.stateNode.containerInfo),Nr(l,a),Dr(a),fs=p;break;case 12:Nr(l,a),Dr(a);break;case 13:Nr(l,a),Dr(a),a.child.flags&8192&&a.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(Yv=yt()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Hv(a,p)));break;case 22:y=a.memoizedState!==null;var X=h!==null&&h.memoizedState!==null,de=ma,Me=Xn;if(ma=de||y,Xn=Me||X,Nr(l,a),Xn=Me,ma=de,Dr(a),p&8192)e:for(l=a.stateNode,l._visibility=y?l._visibility&-2:l._visibility|1,y&&(h===null||X||ma||Xn||gl(a)),h=null,l=a;;){if(l.tag===5||l.tag===26){if(h===null){X=h=l;try{if(T=X.stateNode,y)R=T.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{O=X.stateNode;var Ne=X.memoizedProps.style,me=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null;O.style.display=me==null||typeof me=="boolean"?"":(""+me).trim()}}catch(ge){yn(X,X.return,ge)}}}else if(l.tag===6){if(h===null){X=l;try{X.stateNode.nodeValue=y?"":X.memoizedProps}catch(ge){yn(X,X.return,ge)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===a)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break e;for(;l.sibling===null;){if(l.return===null||l.return===a)break e;h===l&&(h=null),l=l.return}h===l&&(h=null),l.sibling.return=l.return,l=l.sibling}p&4&&(p=a.updateQueue,p!==null&&(h=p.retryQueue,h!==null&&(p.retryQueue=null,Hv(a,h))));break;case 19:Nr(l,a),Dr(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Hv(a,p)));break;case 30:break;case 21:break;default:Nr(l,a),Dr(a)}}function Dr(a){var l=a.flags;if(l&2){try{for(var h,p=a.return;p!==null;){if(hM(p)){h=p;break}p=p.return}if(h==null)throw Error(n(160));switch(h.tag){case 27:var y=h.stateNode,T=kv(a);Rp(a,T,y);break;case 5:var R=h.stateNode;h.flags&32&&(Ds(R,""),h.flags&=-33);var O=kv(a);Rp(a,O,R);break;case 3:case 4:var X=h.stateNode.containerInfo,de=kv(a);Gv(a,de,X);break;default:throw Error(n(161))}}catch(Me){yn(a,a.return,Me)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function yM(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var l=a;yM(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),a=a.sibling}}function fo(a,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)pM(a,l.alternate,l),l=l.sibling}function gl(a){for(a=a.child;a!==null;){var l=a;switch(l.tag){case 0:case 11:case 14:case 15:ho(4,l,l.return),gl(l);break;case 1:Us(l,l.return);var h=l.stateNode;typeof h.componentWillUnmount=="function"&&uM(l,l.return,h),gl(l);break;case 27:Vh(l.stateNode);case 26:case 5:Us(l,l.return),gl(l);break;case 22:l.memoizedState===null&&gl(l);break;case 30:gl(l);break;default:gl(l)}a=a.sibling}}function po(a,l,h){for(h=h&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var p=l.alternate,y=a,T=l,R=T.flags;switch(T.tag){case 0:case 11:case 15:po(y,T,h),Ph(4,T);break;case 1:if(po(y,T,h),p=T,y=p.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(de){yn(p,p.return,de)}if(p=T,y=p.updateQueue,y!==null){var O=p.stateNode;try{var X=y.shared.hiddenCallbacks;if(X!==null)for(y.shared.hiddenCallbacks=null,y=0;y<X.length;y++)XT(X[y],O)}catch(de){yn(p,p.return,de)}}h&&R&64&&lM(T),Lh(T,T.return);break;case 27:fM(T);case 26:case 5:po(y,T,h),h&&p===null&&R&4&&cM(T),Lh(T,T.return);break;case 12:po(y,T,h);break;case 13:po(y,T,h),h&&R&4&&_M(y,T);break;case 22:T.memoizedState===null&&po(y,T,h),Lh(T,T.return);break;case 30:break;default:po(y,T,h)}l=l.sibling}}function jv(a,l){var h=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),a=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(a=l.memoizedState.cachePool.pool),a!==h&&(a!=null&&a.refCount++,h!=null&&vh(h))}function Wv(a,l){a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&vh(a))}function Os(a,l,h,p){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)xM(a,l,h,p),l=l.sibling}function xM(a,l,h,p){var y=l.flags;switch(l.tag){case 0:case 11:case 15:Os(a,l,h,p),y&2048&&Ph(9,l);break;case 1:Os(a,l,h,p);break;case 3:Os(a,l,h,p),y&2048&&(a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&vh(a)));break;case 12:if(y&2048){Os(a,l,h,p),a=l.stateNode;try{var T=l.memoizedProps,R=T.id,O=T.onPostCommit;typeof O=="function"&&O(R,l.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(X){yn(l,l.return,X)}}else Os(a,l,h,p);break;case 13:Os(a,l,h,p);break;case 23:break;case 22:T=l.stateNode,R=l.alternate,l.memoizedState!==null?T._visibility&2?Os(a,l,h,p):Uh(a,l):T._visibility&2?Os(a,l,h,p):(T._visibility|=2,Su(a,l,h,p,(l.subtreeFlags&10256)!==0)),y&2048&&jv(R,l);break;case 24:Os(a,l,h,p),y&2048&&Wv(l.alternate,l);break;default:Os(a,l,h,p)}}function Su(a,l,h,p,y){for(y=y&&(l.subtreeFlags&10256)!==0,l=l.child;l!==null;){var T=a,R=l,O=h,X=p,de=R.flags;switch(R.tag){case 0:case 11:case 15:Su(T,R,O,X,y),Ph(8,R);break;case 23:break;case 22:var Me=R.stateNode;R.memoizedState!==null?Me._visibility&2?Su(T,R,O,X,y):Uh(T,R):(Me._visibility|=2,Su(T,R,O,X,y)),y&&de&2048&&jv(R.alternate,R);break;case 24:Su(T,R,O,X,y),y&&de&2048&&Wv(R.alternate,R);break;default:Su(T,R,O,X,y)}l=l.sibling}}function Uh(a,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var h=a,p=l,y=p.flags;switch(p.tag){case 22:Uh(h,p),y&2048&&jv(p.alternate,p);break;case 24:Uh(h,p),y&2048&&Wv(p.alternate,p);break;default:Uh(h,p)}l=l.sibling}}var Oh=8192;function Tu(a){if(a.subtreeFlags&Oh)for(a=a.child;a!==null;)bM(a),a=a.sibling}function bM(a){switch(a.tag){case 26:Tu(a),a.flags&Oh&&a.memoizedState!==null&&SU(fs,a.memoizedState,a.memoizedProps);break;case 5:Tu(a);break;case 3:case 4:var l=fs;fs=Gp(a.stateNode.containerInfo),Tu(a),fs=l;break;case 22:a.memoizedState===null&&(l=a.alternate,l!==null&&l.memoizedState!==null?(l=Oh,Oh=16777216,Tu(a),Oh=l):Tu(a));break;default:Tu(a)}}function SM(a){var l=a.alternate;if(l!==null&&(a=l.child,a!==null)){l.child=null;do l=a.sibling,a.sibling=null,a=l;while(a!==null)}}function Bh(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var p=l[h];Ei=p,EM(p,a)}SM(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)TM(a),a=a.sibling}function TM(a){switch(a.tag){case 0:case 11:case 15:Bh(a),a.flags&2048&&ho(9,a,a.return);break;case 3:Bh(a);break;case 12:Bh(a);break;case 22:var l=a.stateNode;a.memoizedState!==null&&l._visibility&2&&(a.return===null||a.return.tag!==13)?(l._visibility&=-3,Cp(a)):Bh(a);break;default:Bh(a)}}function Cp(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var p=l[h];Ei=p,EM(p,a)}SM(a)}for(a=a.child;a!==null;){switch(l=a,l.tag){case 0:case 11:case 15:ho(8,l,l.return),Cp(l);break;case 22:h=l.stateNode,h._visibility&2&&(h._visibility&=-3,Cp(l));break;default:Cp(l)}a=a.sibling}}function EM(a,l){for(;Ei!==null;){var h=Ei;switch(h.tag){case 0:case 11:case 15:ho(8,h,l);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var p=h.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:vh(h.memoizedState.cache)}if(p=h.child,p!==null)p.return=h,Ei=p;else e:for(h=a;Ei!==null;){p=Ei;var y=p.sibling,T=p.return;if(mM(p),p===h){Ei=null;break e}if(y!==null){y.return=T,Ei=y;break e}Ei=T}}}var IL={getCacheForType:function(a){var l=Gi(fi),h=l.data.get(a);return h===void 0&&(h=a(),l.data.set(a,h)),h}},zL=typeof WeakMap=="function"?WeakMap:Map,un=0,An=null,jt=null,Kt=0,cn=0,Pr=null,mo=!1,Eu=!1,qv=!1,_a=0,jn=0,go=0,_l=0,$v=0,Zr=0,Mu=0,Fh=null,cr=null,Xv=!1,Yv=0,Np=1/0,Dp=null,_o=null,Li=0,vo=null,Au=null,wu=0,Kv=0,Qv=null,MM=null,Ih=0,Zv=null;function Lr(){if((un&2)!==0&&Kt!==0)return Kt&-Kt;if(k.T!==null){var a=pu;return a!==0?a:sy()}return en()}function AM(){Zr===0&&(Zr=(Kt&536870912)===0||rn?te():536870912);var a=Qr.current;return a!==null&&(a.flags|=32),Zr}function Ur(a,l,h){(a===An&&(cn===2||cn===9)||a.cancelPendingCommit!==null)&&(Ru(a,0),yo(a,Kt,Zr,!1)),Ce(a,h),((un&2)===0||a!==An)&&(a===An&&((un&2)===0&&(_l|=h),jn===4&&yo(a,Kt,Zr,!1)),Bs(a))}function wM(a,l,h){if((un&6)!==0)throw Error(n(327));var p=!h&&(l&124)===0&&(l&a.expiredLanes)===0||Et(a,l),y=p?VL(a,l):ty(a,l,!0),T=p;do{if(y===0){Eu&&!p&&yo(a,l,0,!1);break}else{if(h=a.current.alternate,T&&!kL(h)){y=ty(a,l,!1),T=!1;continue}if(y===2){if(T=l,a.errorRecoveryDisabledLanes&T)var R=0;else R=a.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){l=R;e:{var O=a;y=Fh;var X=O.current.memoizedState.isDehydrated;if(X&&(Ru(O,R).flags|=256),R=ty(O,R,!1),R!==2){if(qv&&!X){O.errorRecoveryDisabledLanes|=T,_l|=T,y=4;break e}T=cr,cr=y,T!==null&&(cr===null?cr=T:cr.push.apply(cr,T))}y=R}if(T=!1,y!==2)continue}}if(y===1){Ru(a,0),yo(a,l,0,!0);break}e:{switch(p=a,T=y,T){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:yo(p,l,Zr,!mo);break e;case 2:cr=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(y=Yv+300-yt(),10<y)){if(yo(p,l,Zr,!mo),zt(p,0,!0)!==0)break e;p.timeoutHandle=nA(RM.bind(null,p,h,cr,Dp,Xv,l,Zr,_l,Mu,mo,T,2,-0,0),y);break e}RM(p,h,cr,Dp,Xv,l,Zr,_l,Mu,mo,T,0,-0,0)}}break}while(!0);Bs(a)}function RM(a,l,h,p,y,T,R,O,X,de,Me,Ne,me,ge){if(a.timeoutHandle=-1,Ne=l.subtreeFlags,(Ne&8192||(Ne&16785408)===16785408)&&(Wh={stylesheets:null,count:0,unsuspend:bU},bM(l),Ne=TU(),Ne!==null)){a.cancelPendingCommit=Ne(OM.bind(null,a,l,T,h,p,y,R,O,X,Me,1,me,ge)),yo(a,T,R,!de);return}OM(a,l,T,h,p,y,R,O,X)}function kL(a){for(var l=a;;){var h=l.tag;if((h===0||h===11||h===15)&&l.flags&16384&&(h=l.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var p=0;p<h.length;p++){var y=h[p],T=y.getSnapshot;y=y.value;try{if(!Rr(T(),y))return!1}catch{return!1}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function yo(a,l,h,p){l&=~$v,l&=~_l,a.suspendedLanes|=l,a.pingedLanes&=~l,p&&(a.warmLanes|=l),p=a.expirationTimes;for(var y=l;0<y;){var T=31-We(y),R=1<<T;p[T]=-1,y&=~R}h!==0&&Ke(a,h,l)}function Pp(){return(un&6)===0?(zh(0),!1):!0}function Jv(){if(jt!==null){if(cn===0)var a=jt.return;else a=jt,ua=hl=null,gv(a),xu=null,Ch=0,a=jt;for(;a!==null;)oM(a.alternate,a),a=a.return;jt=null}}function Ru(a,l){var h=a.timeoutHandle;h!==-1&&(a.timeoutHandle=-1,rU(h)),h=a.cancelPendingCommit,h!==null&&(a.cancelPendingCommit=null,h()),Jv(),An=a,jt=h=aa(a.current,null),Kt=l,cn=0,Pr=null,mo=!1,Eu=Et(a,l),qv=!1,Mu=Zr=$v=_l=go=jn=0,cr=Fh=null,Xv=!1,(l&8)!==0&&(l|=l&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=l;0<p;){var y=31-We(p),T=1<<y;l|=a[y],p&=~T}return _a=l,ep(),h}function CM(a,l){kt=null,k.H=yp,l===xh||l===up?(l=qT(),cn=3):l===HT?(l=qT(),cn=4):cn=l===$E?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,Pr=l,jt===null&&(jn=1,Ep(a,$r(l,a.current)))}function NM(){var a=k.H;return k.H=yp,a===null?yp:a}function DM(){var a=k.A;return k.A=IL,a}function ey(){jn=4,mo||(Kt&4194048)!==Kt&&Qr.current!==null||(Eu=!0),(go&134217727)===0&&(_l&134217727)===0||An===null||yo(An,Kt,Zr,!1)}function ty(a,l,h){var p=un;un|=2;var y=NM(),T=DM();(An!==a||Kt!==l)&&(Dp=null,Ru(a,l)),l=!1;var R=jn;e:do try{if(cn!==0&&jt!==null){var O=jt,X=Pr;switch(cn){case 8:Jv(),R=6;break e;case 3:case 2:case 9:case 6:Qr.current===null&&(l=!0);var de=cn;if(cn=0,Pr=null,Cu(a,O,X,de),h&&Eu){R=0;break e}break;default:de=cn,cn=0,Pr=null,Cu(a,O,X,de)}}GL(),R=jn;break}catch(Me){CM(a,Me)}while(!0);return l&&a.shellSuspendCounter++,ua=hl=null,un=p,k.H=y,k.A=T,jt===null&&(An=null,Kt=0,ep()),R}function GL(){for(;jt!==null;)PM(jt)}function VL(a,l){var h=un;un|=2;var p=NM(),y=DM();An!==a||Kt!==l?(Dp=null,Np=yt()+500,Ru(a,l)):Eu=Et(a,l);e:do try{if(cn!==0&&jt!==null){l=jt;var T=Pr;t:switch(cn){case 1:cn=0,Pr=null,Cu(a,l,T,1);break;case 2:case 9:if(jT(T)){cn=0,Pr=null,LM(l);break}l=function(){cn!==2&&cn!==9||An!==a||(cn=7),Bs(a)},T.then(l,l);break e;case 3:cn=7;break e;case 4:cn=5;break e;case 7:jT(T)?(cn=0,Pr=null,LM(l)):(cn=0,Pr=null,Cu(a,l,T,7));break;case 5:var R=null;switch(jt.tag){case 26:R=jt.memoizedState;case 5:case 27:var O=jt;if(!R||pA(R)){cn=0,Pr=null;var X=O.sibling;if(X!==null)jt=X;else{var de=O.return;de!==null?(jt=de,Lp(de)):jt=null}break t}}cn=0,Pr=null,Cu(a,l,T,5);break;case 6:cn=0,Pr=null,Cu(a,l,T,6);break;case 8:Jv(),jn=6;break e;default:throw Error(n(462))}}HL();break}catch(Me){CM(a,Me)}while(!0);return ua=hl=null,k.H=p,k.A=y,un=h,jt!==null?0:(An=null,Kt=0,ep(),jn)}function HL(){for(;jt!==null&&!Cn();)PM(jt)}function PM(a){var l=sM(a.alternate,a,_a);a.memoizedProps=a.pendingProps,l===null?Lp(a):jt=l}function LM(a){var l=a,h=l.alternate;switch(l.tag){case 15:case 0:l=JE(h,l,l.pendingProps,l.type,void 0,Kt);break;case 11:l=JE(h,l,l.pendingProps,l.type.render,l.ref,Kt);break;case 5:gv(l);default:oM(h,l),l=jt=UT(l,_a),l=sM(h,l,_a)}a.memoizedProps=a.pendingProps,l===null?Lp(a):jt=l}function Cu(a,l,h,p){ua=hl=null,gv(l),xu=null,Ch=0;var y=l.return;try{if(PL(a,y,l,h,Kt)){jn=1,Ep(a,$r(h,a.current)),jt=null;return}}catch(T){if(y!==null)throw jt=y,T;jn=1,Ep(a,$r(h,a.current)),jt=null;return}l.flags&32768?(rn||p===1?a=!0:Eu||(Kt&536870912)!==0?a=!1:(mo=a=!0,(p===2||p===9||p===3||p===6)&&(p=Qr.current,p!==null&&p.tag===13&&(p.flags|=16384))),UM(l,a)):Lp(l)}function Lp(a){var l=a;do{if((l.flags&32768)!==0){UM(l,mo);return}a=l.return;var h=UL(l.alternate,l,_a);if(h!==null){jt=h;return}if(l=l.sibling,l!==null){jt=l;return}jt=l=a}while(l!==null);jn===0&&(jn=5)}function UM(a,l){do{var h=OL(a.alternate,a);if(h!==null){h.flags&=32767,jt=h;return}if(h=a.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!l&&(a=a.sibling,a!==null)){jt=a;return}jt=a=h}while(a!==null);jn=6,jt=null}function OM(a,l,h,p,y,T,R,O,X){a.cancelPendingCommit=null;do Up();while(Li!==0);if((un&6)!==0)throw Error(n(327));if(l!==null){if(l===a.current)throw Error(n(177));if(T=l.lanes|l.childLanes,T|=W_,Ze(a,h,T,R,O,X),a===An&&(jt=An=null,Kt=0),Au=l,vo=a,wu=h,Kv=T,Qv=y,MM=p,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,$L(V,function(){return kM(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||p){p=k.T,k.T=null,y=G.p,G.p=2,R=un,un|=4;try{BL(a,l,h)}finally{un=R,G.p=y,k.T=p}}Li=1,BM(),FM(),IM()}}function BM(){if(Li===1){Li=0;var a=vo,l=Au,h=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||h){h=k.T,k.T=null;var p=G.p;G.p=2;var y=un;un|=4;try{vM(l,a);var T=dy,R=ET(a.containerInfo),O=T.focusedElem,X=T.selectionRange;if(R!==O&&O&&O.ownerDocument&&TT(O.ownerDocument.documentElement,O)){if(X!==null&&k_(O)){var de=X.start,Me=X.end;if(Me===void 0&&(Me=de),"selectionStart"in O)O.selectionStart=de,O.selectionEnd=Math.min(Me,O.value.length);else{var Ne=O.ownerDocument||document,me=Ne&&Ne.defaultView||window;if(me.getSelection){var ge=me.getSelection(),St=O.textContent.length,pt=Math.min(X.start,St),mn=X.end===void 0?pt:Math.min(X.end,St);!ge.extend&&pt>mn&&(R=mn,mn=pt,pt=R);var re=ST(O,pt),ee=ST(O,mn);if(re&&ee&&(ge.rangeCount!==1||ge.anchorNode!==re.node||ge.anchorOffset!==re.offset||ge.focusNode!==ee.node||ge.focusOffset!==ee.offset)){var fe=Ne.createRange();fe.setStart(re.node,re.offset),ge.removeAllRanges(),pt>mn?(ge.addRange(fe),ge.extend(ee.node,ee.offset)):(fe.setEnd(ee.node,ee.offset),ge.addRange(fe))}}}}for(Ne=[],ge=O;ge=ge.parentNode;)ge.nodeType===1&&Ne.push({element:ge,left:ge.scrollLeft,top:ge.scrollTop});for(typeof O.focus=="function"&&O.focus(),O=0;O<Ne.length;O++){var Re=Ne[O];Re.element.scrollLeft=Re.left,Re.element.scrollTop=Re.top}}qp=!!fy,dy=fy=null}finally{un=y,G.p=p,k.T=h}}a.current=l,Li=2}}function FM(){if(Li===2){Li=0;var a=vo,l=Au,h=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||h){h=k.T,k.T=null;var p=G.p;G.p=2;var y=un;un|=4;try{pM(a,l.alternate,l)}finally{un=y,G.p=p,k.T=h}}Li=3}}function IM(){if(Li===4||Li===3){Li=0,Ot();var a=vo,l=Au,h=wu,p=MM;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Li=5:(Li=0,Au=vo=null,zM(a,a.pendingLanes));var y=a.pendingLanes;if(y===0&&(_o=null),Jn(h),l=l.stateNode,Je&&typeof Je.onCommitFiberRoot=="function")try{Je.onCommitFiberRoot(we,l,void 0,(l.current.flags&128)===128)}catch{}if(p!==null){l=k.T,y=G.p,G.p=2,k.T=null;try{for(var T=a.onRecoverableError,R=0;R<p.length;R++){var O=p[R];T(O.value,{componentStack:O.stack})}}finally{k.T=l,G.p=y}}(wu&3)!==0&&Up(),Bs(a),y=a.pendingLanes,(h&4194090)!==0&&(y&42)!==0?a===Zv?Ih++:(Ih=0,Zv=a):Ih=0,zh(0)}}function zM(a,l){(a.pooledCacheLanes&=l)===0&&(l=a.pooledCache,l!=null&&(a.pooledCache=null,vh(l)))}function Up(a){return BM(),FM(),IM(),kM()}function kM(){if(Li!==5)return!1;var a=vo,l=Kv;Kv=0;var h=Jn(wu),p=k.T,y=G.p;try{G.p=32>h?32:h,k.T=null,h=Qv,Qv=null;var T=vo,R=wu;if(Li=0,Au=vo=null,wu=0,(un&6)!==0)throw Error(n(331));var O=un;if(un|=4,TM(T.current),xM(T,T.current,R,h),un=O,zh(0,!1),Je&&typeof Je.onPostCommitFiberRoot=="function")try{Je.onPostCommitFiberRoot(we,T)}catch{}return!0}finally{G.p=y,k.T=p,zM(a,l)}}function GM(a,l,h){l=$r(h,l),l=Nv(a.stateNode,l,2),a=oo(a,l,2),a!==null&&(Ce(a,2),Bs(a))}function yn(a,l,h){if(a.tag===3)GM(a,a,h);else for(;l!==null;){if(l.tag===3){GM(l,a,h);break}else if(l.tag===1){var p=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(_o===null||!_o.has(p))){a=$r(h,a),h=WE(2),p=oo(l,h,2),p!==null&&(qE(h,p,l,a),Ce(p,2),Bs(p));break}}l=l.return}}function ny(a,l,h){var p=a.pingCache;if(p===null){p=a.pingCache=new zL;var y=new Set;p.set(l,y)}else y=p.get(l),y===void 0&&(y=new Set,p.set(l,y));y.has(h)||(qv=!0,y.add(h),a=jL.bind(null,a,l,h),l.then(a,a))}function jL(a,l,h){var p=a.pingCache;p!==null&&p.delete(l),a.pingedLanes|=a.suspendedLanes&h,a.warmLanes&=~h,An===a&&(Kt&h)===h&&(jn===4||jn===3&&(Kt&62914560)===Kt&&300>yt()-Yv?(un&2)===0&&Ru(a,0):$v|=h,Mu===Kt&&(Mu=0)),Bs(a)}function VM(a,l){l===0&&(l=Ye()),a=cu(a,l),a!==null&&(Ce(a,l),Bs(a))}function WL(a){var l=a.memoizedState,h=0;l!==null&&(h=l.retryLane),VM(a,h)}function qL(a,l){var h=0;switch(a.tag){case 13:var p=a.stateNode,y=a.memoizedState;y!==null&&(h=y.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(n(314))}p!==null&&p.delete(l),VM(a,h)}function $L(a,l){return vt(a,l)}var Op=null,Nu=null,iy=!1,Bp=!1,ry=!1,vl=0;function Bs(a){a!==Nu&&a.next===null&&(Nu===null?Op=Nu=a:Nu=Nu.next=a),Bp=!0,iy||(iy=!0,YL())}function zh(a,l){if(!ry&&Bp){ry=!0;do for(var h=!1,p=Op;p!==null;){if(a!==0){var y=p.pendingLanes;if(y===0)var T=0;else{var R=p.suspendedLanes,O=p.pingedLanes;T=(1<<31-We(42|a)+1)-1,T&=y&~(R&~O),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(h=!0,qM(p,T))}else T=Kt,T=zt(p,p===An?T:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(T&3)===0||Et(p,T)||(h=!0,qM(p,T));p=p.next}while(h);ry=!1}}function XL(){HM()}function HM(){Bp=iy=!1;var a=0;vl!==0&&(iU()&&(a=vl),vl=0);for(var l=yt(),h=null,p=Op;p!==null;){var y=p.next,T=jM(p,l);T===0?(p.next=null,h===null?Op=y:h.next=y,y===null&&(Nu=h)):(h=p,(a!==0||(T&3)!==0)&&(Bp=!0)),p=y}zh(a)}function jM(a,l){for(var h=a.suspendedLanes,p=a.pingedLanes,y=a.expirationTimes,T=a.pendingLanes&-62914561;0<T;){var R=31-We(T),O=1<<R,X=y[R];X===-1?((O&h)===0||(O&p)!==0)&&(y[R]=fn(O,l)):X<=l&&(a.expiredLanes|=O),T&=~O}if(l=An,h=Kt,h=zt(a,a===l?h:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,h===0||a===l&&(cn===2||cn===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&K(p),a.callbackNode=null,a.callbackPriority=0;if((h&3)===0||Et(a,h)){if(l=h&-h,l===a.callbackPriority)return l;switch(p!==null&&K(p),Jn(h)){case 2:case 8:h=at;break;case 32:h=V;break;case 268435456:h=pe;break;default:h=V}return p=WM.bind(null,a),h=vt(h,p),a.callbackPriority=l,a.callbackNode=h,l}return p!==null&&p!==null&&K(p),a.callbackPriority=2,a.callbackNode=null,2}function WM(a,l){if(Li!==0&&Li!==5)return a.callbackNode=null,a.callbackPriority=0,null;var h=a.callbackNode;if(Up()&&a.callbackNode!==h)return null;var p=Kt;return p=zt(a,a===An?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(wM(a,p,l),jM(a,yt()),a.callbackNode!=null&&a.callbackNode===h?WM.bind(null,a):null)}function qM(a,l){if(Up())return null;wM(a,l,!0)}function YL(){sU(function(){(un&6)!==0?vt(hn,XL):HM()})}function sy(){return vl===0&&(vl=te()),vl}function $M(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:$d(""+a)}function XM(a,l){var h=l.ownerDocument.createElement("input");return h.name=l.name,h.value=l.value,a.id&&h.setAttribute("form",a.id),l.parentNode.insertBefore(h,l),a=new FormData(a),h.parentNode.removeChild(h),a}function KL(a,l,h,p,y){if(l==="submit"&&h&&h.stateNode===y){var T=$M((y[Ni]||null).action),R=p.submitter;R&&(l=(l=R[Ni]||null)?$M(l.formAction):R.getAttribute("formAction"),l!==null&&(T=l,R=null));var O=new Qd("action","action",null,p,y);a.push({event:O,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(vl!==0){var X=R?XM(y,R):new FormData(y);Mv(h,{pending:!0,data:X,method:y.method,action:T},null,X)}}else typeof T=="function"&&(O.preventDefault(),X=R?XM(y,R):new FormData(y),Mv(h,{pending:!0,data:X,method:y.method,action:T},T,X))},currentTarget:y}]})}}for(var ay=0;ay<j_.length;ay++){var oy=j_[ay],QL=oy.toLowerCase(),ZL=oy[0].toUpperCase()+oy.slice(1);hs(QL,"on"+ZL)}hs(wT,"onAnimationEnd"),hs(RT,"onAnimationIteration"),hs(CT,"onAnimationStart"),hs("dblclick","onDoubleClick"),hs("focusin","onFocus"),hs("focusout","onBlur"),hs(mL,"onTransitionRun"),hs(gL,"onTransitionStart"),hs(_L,"onTransitionCancel"),hs(NT,"onTransitionEnd"),F("onMouseEnter",["mouseout","mouseover"]),F("onMouseLeave",["mouseout","mouseover"]),F("onPointerEnter",["pointerout","pointerover"]),F("onPointerLeave",["pointerout","pointerover"]),na("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),na("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),na("onBeforeInput",["compositionend","keypress","textInput","paste"]),na("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),na("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),na("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),JL=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(kh));function YM(a,l){l=(l&4)!==0;for(var h=0;h<a.length;h++){var p=a[h],y=p.event;p=p.listeners;e:{var T=void 0;if(l)for(var R=p.length-1;0<=R;R--){var O=p[R],X=O.instance,de=O.currentTarget;if(O=O.listener,X!==T&&y.isPropagationStopped())break e;T=O,y.currentTarget=de;try{T(y)}catch(Me){Tp(Me)}y.currentTarget=null,T=X}else for(R=0;R<p.length;R++){if(O=p[R],X=O.instance,de=O.currentTarget,O=O.listener,X!==T&&y.isPropagationStopped())break e;T=O,y.currentTarget=de;try{T(y)}catch(Me){Tp(Me)}y.currentTarget=null,T=X}}}}function Wt(a,l){var h=l[el];h===void 0&&(h=l[el]=new Set);var p=a+"__bubble";h.has(p)||(KM(l,a,2,!1),h.add(p))}function ly(a,l,h){var p=0;l&&(p|=4),KM(h,a,p,l)}var Fp="_reactListening"+Math.random().toString(36).slice(2);function uy(a){if(!a[Fp]){a[Fp]=!0,Wd.forEach(function(h){h!=="selectionchange"&&(JL.has(h)||ly(h,!1,a),ly(h,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[Fp]||(l[Fp]=!0,ly("selectionchange",!1,l))}}function KM(a,l,h,p){switch(xA(l)){case 2:var y=AU;break;case 8:y=wU;break;default:y=Ty}h=y.bind(null,l,h,a),y=void 0,!D_||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(y=!0),p?y!==void 0?a.addEventListener(l,h,{capture:!0,passive:y}):a.addEventListener(l,h,!0):y!==void 0?a.addEventListener(l,h,{passive:y}):a.addEventListener(l,h,!1)}function cy(a,l,h,p,y){var T=p;if((l&1)===0&&(l&2)===0&&p!==null)e:for(;;){if(p===null)return;var R=p.tag;if(R===3||R===4){var O=p.stateNode.containerInfo;if(O===y)break;if(R===4)for(R=p.return;R!==null;){var X=R.tag;if((X===3||X===4)&&R.stateNode.containerInfo===y)return;R=R.return}for(;O!==null;){if(R=ea(O),R===null)return;if(X=R.tag,X===5||X===6||X===26||X===27){p=T=R;continue e}O=O.parentNode}}p=p.return}iT(function(){var de=T,Me=C_(h),Ne=[];e:{var me=DT.get(a);if(me!==void 0){var ge=Qd,St=a;switch(a){case"keypress":if(Yd(h)===0)break e;case"keydown":case"keyup":ge=$P;break;case"focusin":St="focus",ge=O_;break;case"focusout":St="blur",ge=O_;break;case"beforeblur":case"afterblur":ge=O_;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=aT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=OP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=KP;break;case wT:case RT:case CT:ge=IP;break;case NT:ge=ZP;break;case"scroll":case"scrollend":ge=LP;break;case"wheel":ge=eL;break;case"copy":case"cut":case"paste":ge=kP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=lT;break;case"toggle":case"beforetoggle":ge=nL}var pt=(l&4)!==0,mn=!pt&&(a==="scroll"||a==="scrollend"),re=pt?me!==null?me+"Capture":null:me;pt=[];for(var ee=de,fe;ee!==null;){var Re=ee;if(fe=Re.stateNode,Re=Re.tag,Re!==5&&Re!==26&&Re!==27||fe===null||re===null||(Re=sh(ee,re),Re!=null&&pt.push(Gh(ee,Re,fe))),mn)break;ee=ee.return}0<pt.length&&(me=new ge(me,St,null,h,Me),Ne.push({event:me,listeners:pt}))}}if((l&7)===0){e:{if(me=a==="mouseover"||a==="pointerover",ge=a==="mouseout"||a==="pointerout",me&&h!==R_&&(St=h.relatedTarget||h.fromElement)&&(ea(St)||St[ar]))break e;if((ge||me)&&(me=Me.window===Me?Me:(me=Me.ownerDocument)?me.defaultView||me.parentWindow:window,ge?(St=h.relatedTarget||h.toElement,ge=de,St=St?ea(St):null,St!==null&&(mn=s(St),pt=St.tag,St!==mn||pt!==5&&pt!==27&&pt!==6)&&(St=null)):(ge=null,St=de),ge!==St)){if(pt=aT,Re="onMouseLeave",re="onMouseEnter",ee="mouse",(a==="pointerout"||a==="pointerover")&&(pt=lT,Re="onPointerLeave",re="onPointerEnter",ee="pointer"),mn=ge==null?me:nl(ge),fe=St==null?me:nl(St),me=new pt(Re,ee+"leave",ge,h,Me),me.target=mn,me.relatedTarget=fe,Re=null,ea(Me)===de&&(pt=new pt(re,ee+"enter",St,h,Me),pt.target=fe,pt.relatedTarget=mn,Re=pt),mn=Re,ge&&St)t:{for(pt=ge,re=St,ee=0,fe=pt;fe;fe=Du(fe))ee++;for(fe=0,Re=re;Re;Re=Du(Re))fe++;for(;0<ee-fe;)pt=Du(pt),ee--;for(;0<fe-ee;)re=Du(re),fe--;for(;ee--;){if(pt===re||re!==null&&pt===re.alternate)break t;pt=Du(pt),re=Du(re)}pt=null}else pt=null;ge!==null&&QM(Ne,me,ge,pt,!1),St!==null&&mn!==null&&QM(Ne,mn,St,pt,!0)}}e:{if(me=de?nl(de):window,ge=me.nodeName&&me.nodeName.toLowerCase(),ge==="select"||ge==="input"&&me.type==="file")var nt=gT;else if(pT(me))if(_T)nt=fL;else{nt=cL;var Gt=uL}else ge=me.nodeName,!ge||ge.toLowerCase()!=="input"||me.type!=="checkbox"&&me.type!=="radio"?de&&w_(de.elementType)&&(nt=gT):nt=hL;if(nt&&(nt=nt(a,de))){mT(Ne,nt,h,Me);break e}Gt&&Gt(a,me,de),a==="focusout"&&de&&me.type==="number"&&de.memoizedProps.value!=null&&ki(me,"number",me.value)}switch(Gt=de?nl(de):window,a){case"focusin":(pT(Gt)||Gt.contentEditable==="true")&&(ou=Gt,G_=de,dh=null);break;case"focusout":dh=G_=ou=null;break;case"mousedown":V_=!0;break;case"contextmenu":case"mouseup":case"dragend":V_=!1,MT(Ne,h,Me);break;case"selectionchange":if(pL)break;case"keydown":case"keyup":MT(Ne,h,Me)}var ot;if(F_)e:{switch(a){case"compositionstart":var gt="onCompositionStart";break e;case"compositionend":gt="onCompositionEnd";break e;case"compositionupdate":gt="onCompositionUpdate";break e}gt=void 0}else au?fT(a,h)&&(gt="onCompositionEnd"):a==="keydown"&&h.keyCode===229&&(gt="onCompositionStart");gt&&(uT&&h.locale!=="ko"&&(au||gt!=="onCompositionStart"?gt==="onCompositionEnd"&&au&&(ot=rT()):(io=Me,P_="value"in io?io.value:io.textContent,au=!0)),Gt=Ip(de,gt),0<Gt.length&&(gt=new oT(gt,a,null,h,Me),Ne.push({event:gt,listeners:Gt}),ot?gt.data=ot:(ot=dT(h),ot!==null&&(gt.data=ot)))),(ot=rL?sL(a,h):aL(a,h))&&(gt=Ip(de,"onBeforeInput"),0<gt.length&&(Gt=new oT("onBeforeInput","beforeinput",null,h,Me),Ne.push({event:Gt,listeners:gt}),Gt.data=ot)),KL(Ne,a,de,h,Me)}YM(Ne,l)})}function Gh(a,l,h){return{instance:a,listener:l,currentTarget:h}}function Ip(a,l){for(var h=l+"Capture",p=[];a!==null;){var y=a,T=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||T===null||(y=sh(a,h),y!=null&&p.unshift(Gh(a,y,T)),y=sh(a,l),y!=null&&p.push(Gh(a,y,T))),a.tag===3)return p;a=a.return}return[]}function Du(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function QM(a,l,h,p,y){for(var T=l._reactName,R=[];h!==null&&h!==p;){var O=h,X=O.alternate,de=O.stateNode;if(O=O.tag,X!==null&&X===p)break;O!==5&&O!==26&&O!==27||de===null||(X=de,y?(de=sh(h,T),de!=null&&R.unshift(Gh(h,de,X))):y||(de=sh(h,T),de!=null&&R.push(Gh(h,de,X)))),h=h.return}R.length!==0&&a.push({event:l,listeners:R})}var eU=/\r\n?/g,tU=/\u0000|\uFFFD/g;function ZM(a){return(typeof a=="string"?a:""+a).replace(eU,`
`).replace(tU,"")}function JM(a,l){return l=ZM(l),ZM(a)===l}function zp(){}function pn(a,l,h,p,y,T){switch(h){case"children":typeof p=="string"?l==="body"||l==="textarea"&&p===""||Ds(a,p):(typeof p=="number"||typeof p=="bigint")&&l!=="body"&&Ds(a,""+p);break;case"className":qe(a,"class",p);break;case"tabIndex":qe(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":qe(a,h,p);break;case"style":tT(a,p,T);break;case"data":if(l!=="object"){qe(a,"data",p);break}case"src":case"href":if(p===""&&(l!=="a"||h!=="href")){a.removeAttribute(h);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(h);break}p=$d(""+p),a.setAttribute(h,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(h==="formAction"?(l!=="input"&&pn(a,l,"name",y.name,y,null),pn(a,l,"formEncType",y.formEncType,y,null),pn(a,l,"formMethod",y.formMethod,y,null),pn(a,l,"formTarget",y.formTarget,y,null)):(pn(a,l,"encType",y.encType,y,null),pn(a,l,"method",y.method,y,null),pn(a,l,"target",y.target,y,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(h);break}p=$d(""+p),a.setAttribute(h,p);break;case"onClick":p!=null&&(a.onclick=zp);break;case"onScroll":p!=null&&Wt("scroll",a);break;case"onScrollEnd":p!=null&&Wt("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(h=p.__html,h!=null){if(y.children!=null)throw Error(n(60));a.innerHTML=h}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}h=$d(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(h,""+p):a.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(h,""):a.removeAttribute(h);break;case"capture":case"download":p===!0?a.setAttribute(h,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(h,p):a.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(h,p):a.removeAttribute(h);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(h):a.setAttribute(h,p);break;case"popover":Wt("beforetoggle",a),Wt("toggle",a),Be(a,"popover",p);break;case"xlinkActuate":$e(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":$e(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":$e(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":$e(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":$e(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":$e(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":$e(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":$e(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":$e(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Be(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=DP.get(h)||h,Be(a,h,p))}}function hy(a,l,h,p,y,T){switch(h){case"style":tT(a,p,T);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(h=p.__html,h!=null){if(y.children!=null)throw Error(n(60));a.innerHTML=h}}break;case"children":typeof p=="string"?Ds(a,p):(typeof p=="number"||typeof p=="bigint")&&Ds(a,""+p);break;case"onScroll":p!=null&&Wt("scroll",a);break;case"onScrollEnd":p!=null&&Wt("scrollend",a);break;case"onClick":p!=null&&(a.onclick=zp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qd.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(y=h.endsWith("Capture"),l=h.slice(2,y?h.length-7:void 0),T=a[Ni]||null,T=T!=null?T[h]:null,typeof T=="function"&&a.removeEventListener(l,T,y),typeof p=="function")){typeof T!="function"&&T!==null&&(h in a?a[h]=null:a.hasAttribute(h)&&a.removeAttribute(h)),a.addEventListener(l,p,y);break e}h in a?a[h]=p:p===!0?a.setAttribute(h,""):Be(a,h,p)}}}function Ui(a,l,h){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Wt("error",a),Wt("load",a);var p=!1,y=!1,T;for(T in h)if(h.hasOwnProperty(T)){var R=h[T];if(R!=null)switch(T){case"src":p=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:pn(a,l,T,R,h,null)}}y&&pn(a,l,"srcSet",h.srcSet,h,null),p&&pn(a,l,"src",h.src,h,null);return;case"input":Wt("invalid",a);var O=T=R=y=null,X=null,de=null;for(p in h)if(h.hasOwnProperty(p)){var Me=h[p];if(Me!=null)switch(p){case"name":y=Me;break;case"type":R=Me;break;case"checked":X=Me;break;case"defaultChecked":de=Me;break;case"value":T=Me;break;case"defaultValue":O=Me;break;case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(n(137,l));break;default:pn(a,l,p,Me,h,null)}}vn(a,T,O,X,de,R,y,!1),Vn(a);return;case"select":Wt("invalid",a),p=R=T=null;for(y in h)if(h.hasOwnProperty(y)&&(O=h[y],O!=null))switch(y){case"value":T=O;break;case"defaultValue":R=O;break;case"multiple":p=O;default:pn(a,l,y,O,h,null)}l=T,h=R,a.multiple=!!p,l!=null?hi(a,!!p,l,!1):h!=null&&hi(a,!!p,h,!0);return;case"textarea":Wt("invalid",a),T=y=p=null;for(R in h)if(h.hasOwnProperty(R)&&(O=h[R],O!=null))switch(R){case"value":p=O;break;case"defaultValue":y=O;break;case"children":T=O;break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(n(91));break;default:pn(a,l,R,O,h,null)}Di(a,p,y,T),Vn(a);return;case"option":for(X in h)if(h.hasOwnProperty(X)&&(p=h[X],p!=null))switch(X){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:pn(a,l,X,p,h,null)}return;case"dialog":Wt("beforetoggle",a),Wt("toggle",a),Wt("cancel",a),Wt("close",a);break;case"iframe":case"object":Wt("load",a);break;case"video":case"audio":for(p=0;p<kh.length;p++)Wt(kh[p],a);break;case"image":Wt("error",a),Wt("load",a);break;case"details":Wt("toggle",a);break;case"embed":case"source":case"link":Wt("error",a),Wt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(de in h)if(h.hasOwnProperty(de)&&(p=h[de],p!=null))switch(de){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:pn(a,l,de,p,h,null)}return;default:if(w_(l)){for(Me in h)h.hasOwnProperty(Me)&&(p=h[Me],p!==void 0&&hy(a,l,Me,p,h,void 0));return}}for(O in h)h.hasOwnProperty(O)&&(p=h[O],p!=null&&pn(a,l,O,p,h,null))}function nU(a,l,h,p){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,T=null,R=null,O=null,X=null,de=null,Me=null;for(ge in h){var Ne=h[ge];if(h.hasOwnProperty(ge)&&Ne!=null)switch(ge){case"checked":break;case"value":break;case"defaultValue":X=Ne;default:p.hasOwnProperty(ge)||pn(a,l,ge,null,p,Ne)}}for(var me in p){var ge=p[me];if(Ne=h[me],p.hasOwnProperty(me)&&(ge!=null||Ne!=null))switch(me){case"type":T=ge;break;case"name":y=ge;break;case"checked":de=ge;break;case"defaultChecked":Me=ge;break;case"value":R=ge;break;case"defaultValue":O=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(n(137,l));break;default:ge!==Ne&&pn(a,l,me,ge,p,Ne)}}ia(a,R,O,X,de,Me,T,y);return;case"select":ge=R=O=me=null;for(T in h)if(X=h[T],h.hasOwnProperty(T)&&X!=null)switch(T){case"value":break;case"multiple":ge=X;default:p.hasOwnProperty(T)||pn(a,l,T,null,p,X)}for(y in p)if(T=p[y],X=h[y],p.hasOwnProperty(y)&&(T!=null||X!=null))switch(y){case"value":me=T;break;case"defaultValue":O=T;break;case"multiple":R=T;default:T!==X&&pn(a,l,y,T,p,X)}l=O,h=R,p=ge,me!=null?hi(a,!!h,me,!1):!!p!=!!h&&(l!=null?hi(a,!!h,l,!0):hi(a,!!h,h?[]:"",!1));return;case"textarea":ge=me=null;for(O in h)if(y=h[O],h.hasOwnProperty(O)&&y!=null&&!p.hasOwnProperty(O))switch(O){case"value":break;case"children":break;default:pn(a,l,O,null,p,y)}for(R in p)if(y=p[R],T=h[R],p.hasOwnProperty(R)&&(y!=null||T!=null))switch(R){case"value":me=y;break;case"defaultValue":ge=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(n(91));break;default:y!==T&&pn(a,l,R,y,p,T)}Si(a,me,ge);return;case"option":for(var St in h)if(me=h[St],h.hasOwnProperty(St)&&me!=null&&!p.hasOwnProperty(St))switch(St){case"selected":a.selected=!1;break;default:pn(a,l,St,null,p,me)}for(X in p)if(me=p[X],ge=h[X],p.hasOwnProperty(X)&&me!==ge&&(me!=null||ge!=null))switch(X){case"selected":a.selected=me&&typeof me!="function"&&typeof me!="symbol";break;default:pn(a,l,X,me,p,ge)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pt in h)me=h[pt],h.hasOwnProperty(pt)&&me!=null&&!p.hasOwnProperty(pt)&&pn(a,l,pt,null,p,me);for(de in p)if(me=p[de],ge=h[de],p.hasOwnProperty(de)&&me!==ge&&(me!=null||ge!=null))switch(de){case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(n(137,l));break;default:pn(a,l,de,me,p,ge)}return;default:if(w_(l)){for(var mn in h)me=h[mn],h.hasOwnProperty(mn)&&me!==void 0&&!p.hasOwnProperty(mn)&&hy(a,l,mn,void 0,p,me);for(Me in p)me=p[Me],ge=h[Me],!p.hasOwnProperty(Me)||me===ge||me===void 0&&ge===void 0||hy(a,l,Me,me,p,ge);return}}for(var re in h)me=h[re],h.hasOwnProperty(re)&&me!=null&&!p.hasOwnProperty(re)&&pn(a,l,re,null,p,me);for(Ne in p)me=p[Ne],ge=h[Ne],!p.hasOwnProperty(Ne)||me===ge||me==null&&ge==null||pn(a,l,Ne,me,p,ge)}var fy=null,dy=null;function kp(a){return a.nodeType===9?a:a.ownerDocument}function eA(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function tA(a,l){if(a===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&l==="foreignObject"?0:a}function py(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var my=null;function iU(){var a=window.event;return a&&a.type==="popstate"?a===my?!1:(my=a,!0):(my=null,!1)}var nA=typeof setTimeout=="function"?setTimeout:void 0,rU=typeof clearTimeout=="function"?clearTimeout:void 0,iA=typeof Promise=="function"?Promise:void 0,sU=typeof queueMicrotask=="function"?queueMicrotask:typeof iA<"u"?function(a){return iA.resolve(null).then(a).catch(aU)}:nA;function aU(a){setTimeout(function(){throw a})}function xo(a){return a==="head"}function rA(a,l){var h=l,p=0,y=0;do{var T=h.nextSibling;if(a.removeChild(h),T&&T.nodeType===8)if(h=T.data,h==="/$"){if(0<p&&8>p){h=p;var R=a.ownerDocument;if(h&1&&Vh(R.documentElement),h&2&&Vh(R.body),h&4)for(h=R.head,Vh(h),R=h.firstChild;R;){var O=R.nextSibling,X=R.nodeName;R[Ja]||X==="SCRIPT"||X==="STYLE"||X==="LINK"&&R.rel.toLowerCase()==="stylesheet"||h.removeChild(R),R=O}}if(y===0){a.removeChild(T),Kh(l);return}y--}else h==="$"||h==="$?"||h==="$!"?y++:p=h.charCodeAt(0)-48;else p=0;h=T}while(h);Kh(l)}function gy(a){var l=a.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var h=l;switch(l=l.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":gy(h),eo(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}a.removeChild(h)}}function oU(a,l,h,p){for(;a.nodeType===1;){var y=h;if(a.nodeName.toLowerCase()!==l.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[Ja])switch(l){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(T=a.getAttribute("rel"),T==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(T!==y.rel||a.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||a.getAttribute("title")!==(y.title==null?null:y.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(T=a.getAttribute("src"),(T!==(y.src==null?null:y.src)||a.getAttribute("type")!==(y.type==null?null:y.type)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&T&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(l==="input"&&a.type==="hidden"){var T=y.name==null?null:""+y.name;if(y.type==="hidden"&&a.getAttribute("name")===T)return a}else return a;if(a=ds(a.nextSibling),a===null)break}return null}function lU(a,l,h){if(l==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!h||(a=ds(a.nextSibling),a===null))return null;return a}function _y(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function uU(a,l){var h=a.ownerDocument;if(a.data!=="$?"||h.readyState==="complete")l();else{var p=function(){l(),h.removeEventListener("DOMContentLoaded",p)};h.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function ds(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?"||l==="F!"||l==="F")break;if(l==="/$")return null}}return a}var vy=null;function sA(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var h=a.data;if(h==="$"||h==="$!"||h==="$?"){if(l===0)return a;l--}else h==="/$"&&l++}a=a.previousSibling}return null}function aA(a,l,h){switch(l=kp(h),a){case"html":if(a=l.documentElement,!a)throw Error(n(452));return a;case"head":if(a=l.head,!a)throw Error(n(453));return a;case"body":if(a=l.body,!a)throw Error(n(454));return a;default:throw Error(n(451))}}function Vh(a){for(var l=a.attributes;l.length;)a.removeAttributeNode(l[0]);eo(a)}var Jr=new Map,oA=new Set;function Gp(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var va=G.d;G.d={f:cU,r:hU,D:fU,C:dU,L:pU,m:mU,X:_U,S:gU,M:vU};function cU(){var a=va.f(),l=Pp();return a||l}function hU(a){var l=ta(a);l!==null&&l.tag===5&&l.type==="form"?wE(l):va.r(a)}var Pu=typeof document>"u"?null:document;function lA(a,l,h){var p=Pu;if(p&&typeof l=="string"&&l){var y=Mn(l);y='link[rel="'+a+'"][href="'+y+'"]',typeof h=="string"&&(y+='[crossorigin="'+h+'"]'),oA.has(y)||(oA.add(y),a={rel:a,crossOrigin:h,href:l},p.querySelector(y)===null&&(l=p.createElement("link"),Ui(l,"link",a),ei(l),p.head.appendChild(l)))}}function fU(a){va.D(a),lA("dns-prefetch",a,null)}function dU(a,l){va.C(a,l),lA("preconnect",a,l)}function pU(a,l,h){va.L(a,l,h);var p=Pu;if(p&&a&&l){var y='link[rel="preload"][as="'+Mn(l)+'"]';l==="image"&&h&&h.imageSrcSet?(y+='[imagesrcset="'+Mn(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(y+='[imagesizes="'+Mn(h.imageSizes)+'"]')):y+='[href="'+Mn(a)+'"]';var T=y;switch(l){case"style":T=Lu(a);break;case"script":T=Uu(a)}Jr.has(T)||(a=d({rel:"preload",href:l==="image"&&h&&h.imageSrcSet?void 0:a,as:l},h),Jr.set(T,a),p.querySelector(y)!==null||l==="style"&&p.querySelector(Hh(T))||l==="script"&&p.querySelector(jh(T))||(l=p.createElement("link"),Ui(l,"link",a),ei(l),p.head.appendChild(l)))}}function mU(a,l){va.m(a,l);var h=Pu;if(h&&a){var p=l&&typeof l.as=="string"?l.as:"script",y='link[rel="modulepreload"][as="'+Mn(p)+'"][href="'+Mn(a)+'"]',T=y;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=Uu(a)}if(!Jr.has(T)&&(a=d({rel:"modulepreload",href:a},l),Jr.set(T,a),h.querySelector(y)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(jh(T)))return}p=h.createElement("link"),Ui(p,"link",a),ei(p),h.head.appendChild(p)}}}function gU(a,l,h){va.S(a,l,h);var p=Pu;if(p&&a){var y=to(p).hoistableStyles,T=Lu(a);l=l||"default";var R=y.get(T);if(!R){var O={loading:0,preload:null};if(R=p.querySelector(Hh(T)))O.loading=5;else{a=d({rel:"stylesheet",href:a,"data-precedence":l},h),(h=Jr.get(T))&&yy(a,h);var X=R=p.createElement("link");ei(X),Ui(X,"link",a),X._p=new Promise(function(de,Me){X.onload=de,X.onerror=Me}),X.addEventListener("load",function(){O.loading|=1}),X.addEventListener("error",function(){O.loading|=2}),O.loading|=4,Vp(R,l,p)}R={type:"stylesheet",instance:R,count:1,state:O},y.set(T,R)}}}function _U(a,l){va.X(a,l);var h=Pu;if(h&&a){var p=to(h).hoistableScripts,y=Uu(a),T=p.get(y);T||(T=h.querySelector(jh(y)),T||(a=d({src:a,async:!0},l),(l=Jr.get(y))&&xy(a,l),T=h.createElement("script"),ei(T),Ui(T,"link",a),h.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},p.set(y,T))}}function vU(a,l){va.M(a,l);var h=Pu;if(h&&a){var p=to(h).hoistableScripts,y=Uu(a),T=p.get(y);T||(T=h.querySelector(jh(y)),T||(a=d({src:a,async:!0,type:"module"},l),(l=Jr.get(y))&&xy(a,l),T=h.createElement("script"),ei(T),Ui(T,"link",a),h.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},p.set(y,T))}}function uA(a,l,h,p){var y=(y=Y.current)?Gp(y):null;if(!y)throw Error(n(446));switch(a){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(l=Lu(h.href),h=to(y).hoistableStyles,p=h.get(l),p||(p={type:"style",instance:null,count:0,state:null},h.set(l,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){a=Lu(h.href);var T=to(y).hoistableStyles,R=T.get(a);if(R||(y=y.ownerDocument||y,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(a,R),(T=y.querySelector(Hh(a)))&&!T._p&&(R.instance=T,R.state.loading=5),Jr.has(a)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},Jr.set(a,h),T||yU(y,a,h,R.state))),l&&p===null)throw Error(n(528,""));return R}if(l&&p!==null)throw Error(n(529,""));return null;case"script":return l=h.async,h=h.src,typeof h=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=Uu(h),h=to(y).hoistableScripts,p=h.get(l),p||(p={type:"script",instance:null,count:0,state:null},h.set(l,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,a))}}function Lu(a){return'href="'+Mn(a)+'"'}function Hh(a){return'link[rel="stylesheet"]['+a+"]"}function cA(a){return d({},a,{"data-precedence":a.precedence,precedence:null})}function yU(a,l,h,p){a.querySelector('link[rel="preload"][as="style"]['+l+"]")?p.loading=1:(l=a.createElement("link"),p.preload=l,l.addEventListener("load",function(){return p.loading|=1}),l.addEventListener("error",function(){return p.loading|=2}),Ui(l,"link",h),ei(l),a.head.appendChild(l))}function Uu(a){return'[src="'+Mn(a)+'"]'}function jh(a){return"script[async]"+a}function hA(a,l,h){if(l.count++,l.instance===null)switch(l.type){case"style":var p=a.querySelector('style[data-href~="'+Mn(h.href)+'"]');if(p)return l.instance=p,ei(p),p;var y=d({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),ei(p),Ui(p,"style",y),Vp(p,h.precedence,a),l.instance=p;case"stylesheet":y=Lu(h.href);var T=a.querySelector(Hh(y));if(T)return l.state.loading|=4,l.instance=T,ei(T),T;p=cA(h),(y=Jr.get(y))&&yy(p,y),T=(a.ownerDocument||a).createElement("link"),ei(T);var R=T;return R._p=new Promise(function(O,X){R.onload=O,R.onerror=X}),Ui(T,"link",p),l.state.loading|=4,Vp(T,h.precedence,a),l.instance=T;case"script":return T=Uu(h.src),(y=a.querySelector(jh(T)))?(l.instance=y,ei(y),y):(p=h,(y=Jr.get(T))&&(p=d({},h),xy(p,y)),a=a.ownerDocument||a,y=a.createElement("script"),ei(y),Ui(y,"link",p),a.head.appendChild(y),l.instance=y);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(p=l.instance,l.state.loading|=4,Vp(p,h.precedence,a));return l.instance}function Vp(a,l,h){for(var p=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=p.length?p[p.length-1]:null,T=y,R=0;R<p.length;R++){var O=p[R];if(O.dataset.precedence===l)T=O;else if(T!==y)break}T?T.parentNode.insertBefore(a,T.nextSibling):(l=h.nodeType===9?h.head:h,l.insertBefore(a,l.firstChild))}function yy(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.title==null&&(a.title=l.title)}function xy(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.integrity==null&&(a.integrity=l.integrity)}var Hp=null;function fA(a,l,h){if(Hp===null){var p=new Map,y=Hp=new Map;y.set(h,p)}else y=Hp,p=y.get(h),p||(p=new Map,y.set(h,p));if(p.has(a))return p;for(p.set(a,null),h=h.getElementsByTagName(a),y=0;y<h.length;y++){var T=h[y];if(!(T[Ja]||T[ci]||a==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var R=T.getAttribute(l)||"";R=a+R;var O=p.get(R);O?O.push(T):p.set(R,[T])}}return p}function dA(a,l,h){a=a.ownerDocument||a,a.head.insertBefore(h,l==="title"?a.querySelector("head > title"):null)}function xU(a,l,h){if(h===1||l.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return a=l.disabled,typeof l.precedence=="string"&&a==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function pA(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Wh=null;function bU(){}function SU(a,l,h){if(Wh===null)throw Error(n(475));var p=Wh;if(l.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var y=Lu(h.href),T=a.querySelector(Hh(y));if(T){a=T._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(p.count++,p=jp.bind(p),a.then(p,p)),l.state.loading|=4,l.instance=T,ei(T);return}T=a.ownerDocument||a,h=cA(h),(y=Jr.get(y))&&yy(h,y),T=T.createElement("link"),ei(T);var R=T;R._p=new Promise(function(O,X){R.onload=O,R.onerror=X}),Ui(T,"link",h),l.instance=T}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(l,a),(a=l.state.preload)&&(l.state.loading&3)===0&&(p.count++,l=jp.bind(p),a.addEventListener("load",l),a.addEventListener("error",l))}}function TU(){if(Wh===null)throw Error(n(475));var a=Wh;return a.stylesheets&&a.count===0&&by(a,a.stylesheets),0<a.count?function(l){var h=setTimeout(function(){if(a.stylesheets&&by(a,a.stylesheets),a.unsuspend){var p=a.unsuspend;a.unsuspend=null,p()}},6e4);return a.unsuspend=l,function(){a.unsuspend=null,clearTimeout(h)}}:null}function jp(){if(this.count--,this.count===0){if(this.stylesheets)by(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Wp=null;function by(a,l){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Wp=new Map,l.forEach(EU,a),Wp=null,jp.call(a))}function EU(a,l){if(!(l.state.loading&4)){var h=Wp.get(a);if(h)var p=h.get(null);else{h=new Map,Wp.set(a,h);for(var y=a.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<y.length;T++){var R=y[T];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(h.set(R.dataset.precedence,R),p=R)}p&&h.set(null,p)}y=l.instance,R=y.getAttribute("data-precedence"),T=h.get(R)||p,T===p&&h.set(null,y),h.set(R,y),this.count++,p=jp.bind(this),y.addEventListener("load",p),y.addEventListener("error",p),T?T.parentNode.insertBefore(y,T.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(y,a.firstChild)),l.state.loading|=4}}var qh={$$typeof:M,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function MU(a,l,h,p,y,T,R,O){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Se(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Se(0),this.hiddenUpdates=Se(null),this.identifierPrefix=p,this.onUncaughtError=y,this.onCaughtError=T,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=O,this.incompleteTransitions=new Map}function mA(a,l,h,p,y,T,R,O,X,de,Me,Ne){return a=new MU(a,l,h,R,O,X,de,Ne),l=1,T===!0&&(l|=24),T=Cr(3,null,null,l),a.current=T,T.stateNode=a,l=nv(),l.refCount++,a.pooledCache=l,l.refCount++,T.memoizedState={element:p,isDehydrated:h,cache:l},av(T),a}function gA(a){return a?(a=hu,a):hu}function _A(a,l,h,p,y,T){y=gA(y),p.context===null?p.context=y:p.pendingContext=y,p=ao(l),p.payload={element:h},T=T===void 0?null:T,T!==null&&(p.callback=T),h=oo(a,p,l),h!==null&&(Ur(h,a,l),Sh(h,a,l))}function vA(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var h=a.retryLane;a.retryLane=h!==0&&h<l?h:l}}function Sy(a,l){vA(a,l),(a=a.alternate)&&vA(a,l)}function yA(a){if(a.tag===13){var l=cu(a,67108864);l!==null&&Ur(l,a,67108864),Sy(a,67108864)}}var qp=!0;function AU(a,l,h,p){var y=k.T;k.T=null;var T=G.p;try{G.p=2,Ty(a,l,h,p)}finally{G.p=T,k.T=y}}function wU(a,l,h,p){var y=k.T;k.T=null;var T=G.p;try{G.p=8,Ty(a,l,h,p)}finally{G.p=T,k.T=y}}function Ty(a,l,h,p){if(qp){var y=Ey(p);if(y===null)cy(a,l,p,$p,h),bA(a,p);else if(CU(y,a,l,h,p))p.stopPropagation();else if(bA(a,p),l&4&&-1<RU.indexOf(a)){for(;y!==null;){var T=ta(y);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var R=Qe(T.pendingLanes);if(R!==0){var O=T;for(O.pendingLanes|=2,O.entangledLanes|=2;R;){var X=1<<31-We(R);O.entanglements[1]|=X,R&=~X}Bs(T),(un&6)===0&&(Np=yt()+500,zh(0))}}break;case 13:O=cu(T,2),O!==null&&Ur(O,T,2),Pp(),Sy(T,2)}if(T=Ey(p),T===null&&cy(a,l,p,$p,h),T===y)break;y=T}y!==null&&p.stopPropagation()}else cy(a,l,p,null,h)}}function Ey(a){return a=C_(a),My(a)}var $p=null;function My(a){if($p=null,a=ea(a),a!==null){var l=s(a);if(l===null)a=null;else{var h=l.tag;if(h===13){if(a=o(l),a!==null)return a;a=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null)}}return $p=a,null}function xA(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ct()){case hn:return 2;case at:return 8;case V:case B:return 32;case pe:return 268435456;default:return 32}default:return 32}}var Ay=!1,bo=null,So=null,To=null,$h=new Map,Xh=new Map,Eo=[],RU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bA(a,l){switch(a){case"focusin":case"focusout":bo=null;break;case"dragenter":case"dragleave":So=null;break;case"mouseover":case"mouseout":To=null;break;case"pointerover":case"pointerout":$h.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xh.delete(l.pointerId)}}function Yh(a,l,h,p,y,T){return a===null||a.nativeEvent!==T?(a={blockedOn:l,domEventName:h,eventSystemFlags:p,nativeEvent:T,targetContainers:[y]},l!==null&&(l=ta(l),l!==null&&yA(l)),a):(a.eventSystemFlags|=p,l=a.targetContainers,y!==null&&l.indexOf(y)===-1&&l.push(y),a)}function CU(a,l,h,p,y){switch(l){case"focusin":return bo=Yh(bo,a,l,h,p,y),!0;case"dragenter":return So=Yh(So,a,l,h,p,y),!0;case"mouseover":return To=Yh(To,a,l,h,p,y),!0;case"pointerover":var T=y.pointerId;return $h.set(T,Yh($h.get(T)||null,a,l,h,p,y)),!0;case"gotpointercapture":return T=y.pointerId,Xh.set(T,Yh(Xh.get(T)||null,a,l,h,p,y)),!0}return!1}function SA(a){var l=ea(a.target);if(l!==null){var h=s(l);if(h!==null){if(l=h.tag,l===13){if(l=o(h),l!==null){a.blockedOn=l,wr(a.priority,function(){if(h.tag===13){var p=Lr();p=En(p);var y=cu(h,p);y!==null&&Ur(y,h,p),Sy(h,p)}});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){a.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Xp(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var h=Ey(a.nativeEvent);if(h===null){h=a.nativeEvent;var p=new h.constructor(h.type,h);R_=p,h.target.dispatchEvent(p),R_=null}else return l=ta(h),l!==null&&yA(l),a.blockedOn=h,!1;l.shift()}return!0}function TA(a,l,h){Xp(a)&&h.delete(l)}function NU(){Ay=!1,bo!==null&&Xp(bo)&&(bo=null),So!==null&&Xp(So)&&(So=null),To!==null&&Xp(To)&&(To=null),$h.forEach(TA),Xh.forEach(TA)}function Yp(a,l){a.blockedOn===l&&(a.blockedOn=null,Ay||(Ay=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,NU)))}var Kp=null;function EA(a){Kp!==a&&(Kp=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Kp===a&&(Kp=null);for(var l=0;l<a.length;l+=3){var h=a[l],p=a[l+1],y=a[l+2];if(typeof p!="function"){if(My(p||h)===null)continue;break}var T=ta(h);T!==null&&(a.splice(l,3),l-=3,Mv(T,{pending:!0,data:y,method:h.method,action:p},p,y))}}))}function Kh(a){function l(X){return Yp(X,a)}bo!==null&&Yp(bo,a),So!==null&&Yp(So,a),To!==null&&Yp(To,a),$h.forEach(l),Xh.forEach(l);for(var h=0;h<Eo.length;h++){var p=Eo[h];p.blockedOn===a&&(p.blockedOn=null)}for(;0<Eo.length&&(h=Eo[0],h.blockedOn===null);)SA(h),h.blockedOn===null&&Eo.shift();if(h=(a.ownerDocument||a).$$reactFormReplay,h!=null)for(p=0;p<h.length;p+=3){var y=h[p],T=h[p+1],R=y[Ni]||null;if(typeof T=="function")R||EA(h);else if(R){var O=null;if(T&&T.hasAttribute("formAction")){if(y=T,R=T[Ni]||null)O=R.formAction;else if(My(y)!==null)continue}else O=R.action;typeof O=="function"?h[p+1]=O:(h.splice(p,3),p-=3),EA(h)}}}function wy(a){this._internalRoot=a}Qp.prototype.render=wy.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(n(409));var h=l.current,p=Lr();_A(h,p,a,l,null,null)},Qp.prototype.unmount=wy.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;_A(a.current,2,null,a,null,null),Pp(),l[ar]=null}};function Qp(a){this._internalRoot=a}Qp.prototype.unstable_scheduleHydration=function(a){if(a){var l=en();a={blockedOn:null,target:a,priority:l};for(var h=0;h<Eo.length&&l!==0&&l<Eo[h].priority;h++);Eo.splice(h,0,a),h===0&&SA(a)}};var MA=e.version;if(MA!=="19.1.0")throw Error(n(527,MA,"19.1.0"));G.findDOMNode=function(a){var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=c(l),a=a!==null?f(a):null,a=a===null?null:a.stateNode,a};var DU={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zp.isDisabled&&Zp.supportsFiber)try{we=Zp.inject(DU),Je=Zp}catch{}}return Zh.createRoot=function(a,l){if(!r(a))throw Error(n(299));var h=!1,p="",y=GE,T=VE,R=HE,O=null;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(y=l.onUncaughtError),l.onCaughtError!==void 0&&(T=l.onCaughtError),l.onRecoverableError!==void 0&&(R=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(O=l.unstable_transitionCallbacks)),l=mA(a,1,!1,null,null,h,p,y,T,R,O,null),a[ar]=l.current,uy(a),new wy(l)},Zh.hydrateRoot=function(a,l,h){if(!r(a))throw Error(n(299));var p=!1,y="",T=GE,R=VE,O=HE,X=null,de=null;return h!=null&&(h.unstable_strictMode===!0&&(p=!0),h.identifierPrefix!==void 0&&(y=h.identifierPrefix),h.onUncaughtError!==void 0&&(T=h.onUncaughtError),h.onCaughtError!==void 0&&(R=h.onCaughtError),h.onRecoverableError!==void 0&&(O=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(X=h.unstable_transitionCallbacks),h.formState!==void 0&&(de=h.formState)),l=mA(a,1,!0,l,h??null,p,y,T,R,O,X,de),l.context=gA(null),h=l.current,p=Lr(),p=En(p),y=ao(p),y.callback=null,oo(h,y,p),h=p,l.current.lanes=h,Ce(l,h),Bs(l),a[ar]=l.current,uy(a),new Qp(l)},Zh.version="19.1.0",Zh}var OA;function VU(){if(OA)return Ny.exports;OA=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Ny.exports=GU(),Ny.exports}var HU=VU(),Jh={},BA;function jU(){if(BA)return Jh;BA=1,Object.defineProperty(Jh,"__esModule",{value:!0}),Jh.parse=o,Jh.serialize=f;const i=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,r=Object.prototype.toString,s=(()=>{const g=function(){};return g.prototype=Object.create(null),g})();function o(g,_){const v=new s,S=g.length;if(S<2)return v;const b=(_==null?void 0:_.decode)||d;let x=0;do{const E=g.indexOf("=",x);if(E===-1)break;const M=g.indexOf(";",x),A=M===-1?S:M;if(E>A){x=g.lastIndexOf(";",E-1)+1;continue}const C=u(g,x,E),w=c(g,E,C),N=g.slice(C,w);if(v[N]===void 0){let L=u(g,E+1,A),P=c(g,A,L);const D=b(g.slice(L,P));v[N]=D}x=A+1}while(x<S);return v}function u(g,_,v){do{const S=g.charCodeAt(_);if(S!==32&&S!==9)return _}while(++_<v);return v}function c(g,_,v){for(;_>v;){const S=g.charCodeAt(--_);if(S!==32&&S!==9)return _+1}return v}function f(g,_,v){const S=(v==null?void 0:v.encode)||encodeURIComponent;if(!i.test(g))throw new TypeError(`argument name is invalid: ${g}`);const b=S(_);if(!e.test(b))throw new TypeError(`argument val is invalid: ${_}`);let x=g+"="+b;if(!v)return x;if(v.maxAge!==void 0){if(!Number.isInteger(v.maxAge))throw new TypeError(`option maxAge is invalid: ${v.maxAge}`);x+="; Max-Age="+v.maxAge}if(v.domain){if(!t.test(v.domain))throw new TypeError(`option domain is invalid: ${v.domain}`);x+="; Domain="+v.domain}if(v.path){if(!n.test(v.path))throw new TypeError(`option path is invalid: ${v.path}`);x+="; Path="+v.path}if(v.expires){if(!m(v.expires)||!Number.isFinite(v.expires.valueOf()))throw new TypeError(`option expires is invalid: ${v.expires}`);x+="; Expires="+v.expires.toUTCString()}if(v.httpOnly&&(x+="; HttpOnly"),v.secure&&(x+="; Secure"),v.partitioned&&(x+="; Partitioned"),v.priority)switch(typeof v.priority=="string"?v.priority.toLowerCase():void 0){case"low":x+="; Priority=Low";break;case"medium":x+="; Priority=Medium";break;case"high":x+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${v.priority}`)}if(v.sameSite)switch(typeof v.sameSite=="string"?v.sameSite.toLowerCase():v.sameSite){case!0:case"strict":x+="; SameSite=Strict";break;case"lax":x+="; SameSite=Lax";break;case"none":x+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${v.sameSite}`)}return x}function d(g){if(g.indexOf("%")===-1)return g;try{return decodeURIComponent(g)}catch{return g}}function m(g){return r.call(g)==="[object Date]"}return Jh}jU();/**
 * react-router v7.5.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var FA="popstate";function WU(i={}){function e(n,r){let{pathname:s,search:o,hash:u}=n.location;return wx("",{pathname:s,search:o,hash:u},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:qf(r)}return $U(e,t,null,i)}function Gn(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function $s(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function qU(){return Math.random().toString(36).substring(2,10)}function IA(i,e){return{usr:i.state,key:i.key,idx:e}}function wx(i,e,t=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?Xc(e):e,state:t,key:e&&e.key||n||qU()}}function qf({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function Xc(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let n=i.indexOf("?");n>=0&&(e.search=i.substring(n),i=i.substring(0,n)),i&&(e.pathname=i)}return e}function $U(i,e,t,n={}){let{window:r=document.defaultView,v5Compat:s=!1}=n,o=r.history,u="POP",c=null,f=d();f==null&&(f=0,o.replaceState({...o.state,idx:f},""));function d(){return(o.state||{idx:null}).idx}function m(){u="POP";let b=d(),x=b==null?null:b-f;f=b,c&&c({action:u,location:S.location,delta:x})}function g(b,x){u="PUSH";let E=wx(S.location,b,x);f=d()+1;let M=IA(E,f),A=S.createHref(E);try{o.pushState(M,"",A)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;r.location.assign(A)}s&&c&&c({action:u,location:S.location,delta:1})}function _(b,x){u="REPLACE";let E=wx(S.location,b,x);f=d();let M=IA(E,f),A=S.createHref(E);o.replaceState(M,"",A),s&&c&&c({action:u,location:S.location,delta:0})}function v(b){let x=r.location.origin!=="null"?r.location.origin:r.location.href,E=typeof b=="string"?b:qf(b);return E=E.replace(/ $/,"%20"),Gn(x,`No window.location.(origin|href) available to create URL for href: ${E}`),new URL(E,x)}let S={get action(){return u},get location(){return i(r,o)},listen(b){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(FA,m),c=b,()=>{r.removeEventListener(FA,m),c=null}},createHref(b){return e(r,b)},createURL:v,encodeLocation(b){let x=v(b);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:g,replace:_,go(b){return o.go(b)}};return S}function AC(i,e,t="/"){return XU(i,e,t,!1)}function XU(i,e,t,n){let r=typeof e=="string"?Xc(e):e,s=Ha(r.pathname||"/",t);if(s==null)return null;let o=wC(i);YU(o);let u=null;for(let c=0;u==null&&c<o.length;++c){let f=aO(s);u=rO(o[c],f,n)}return u}function wC(i,e=[],t=[],n=""){let r=(s,o,u)=>{let c={relativePath:u===void 0?s.path||"":u,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(Gn(c.relativePath.startsWith(n),`Absolute route path "${c.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(n.length));let f=Ia([n,c.relativePath]),d=t.concat(c);s.children&&s.children.length>0&&(Gn(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),wC(s.children,e,d,f)),!(s.path==null&&!s.index)&&e.push({path:f,score:nO(f,s.index),routesMeta:d})};return i.forEach((s,o)=>{var u;if(s.path===""||!((u=s.path)!=null&&u.includes("?")))r(s,o);else for(let c of RC(s.path))r(s,o,c)}),e}function RC(i){let e=i.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return r?[s,""]:[s];let o=RC(n.join("/")),u=[];return u.push(...o.map(c=>c===""?s:[s,c].join("/"))),r&&u.push(...o),u.map(c=>i.startsWith("/")&&c===""?"/":c)}function YU(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:iO(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var KU=/^:[\w-]+$/,QU=3,ZU=2,JU=1,eO=10,tO=-2,zA=i=>i==="*";function nO(i,e){let t=i.split("/"),n=t.length;return t.some(zA)&&(n+=tO),e&&(n+=ZU),t.filter(r=>!zA(r)).reduce((r,s)=>r+(KU.test(s)?QU:s===""?JU:eO),n)}function iO(i,e){return i.length===e.length&&i.slice(0,-1).every((n,r)=>n===e[r])?i[i.length-1]-e[e.length-1]:0}function rO(i,e,t=!1){let{routesMeta:n}=i,r={},s="/",o=[];for(let u=0;u<n.length;++u){let c=n[u],f=u===n.length-1,d=s==="/"?e:e.slice(s.length)||"/",m=gg({path:c.relativePath,caseSensitive:c.caseSensitive,end:f},d),g=c.route;if(!m&&f&&t&&!n[n.length-1].route.index&&(m=gg({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!m)return null;Object.assign(r,m.params),o.push({params:r,pathname:Ia([s,m.pathname]),pathnameBase:cO(Ia([s,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(s=Ia([s,m.pathnameBase]))}return o}function gg(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=sO(i.path,i.caseSensitive,i.end),r=e.match(t);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),u=r.slice(1);return{params:n.reduce((f,{paramName:d,isOptional:m},g)=>{if(d==="*"){let v=u[g]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const _=u[g];return m&&!_?f[d]=void 0:f[d]=(_||"").replace(/%2F/g,"/"),f},{}),pathname:s,pathnameBase:o,pattern:i}}function sO(i,e=!1,t=!0){$s(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],r="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,u,c)=>(n.push({paramName:u,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(n.push({paramName:"*"}),r+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":i!==""&&i!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function aO(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return $s(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Ha(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=i.charAt(t);return n&&n!=="/"?null:i.slice(t)||"/"}function oO(i,e="/"){let{pathname:t,search:n="",hash:r=""}=typeof i=="string"?Xc(i):i;return{pathname:t?t.startsWith("/")?t:lO(t,e):e,search:hO(n),hash:fO(r)}}function lO(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function Uy(i,e,t,n){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function uO(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function CC(i){let e=uO(i);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function NC(i,e,t,n=!1){let r;typeof i=="string"?r=Xc(i):(r={...i},Gn(!r.pathname||!r.pathname.includes("?"),Uy("?","pathname","search",r)),Gn(!r.pathname||!r.pathname.includes("#"),Uy("#","pathname","hash",r)),Gn(!r.search||!r.search.includes("#"),Uy("#","search","hash",r)));let s=i===""||r.pathname==="",o=s?"/":r.pathname,u;if(o==null)u=t;else{let m=e.length-1;if(!n&&o.startsWith("..")){let g=o.split("/");for(;g[0]==="..";)g.shift(),m-=1;r.pathname=g.join("/")}u=m>=0?e[m]:"/"}let c=oO(r,u),f=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(f||d)&&(c.pathname+="/"),c}var Ia=i=>i.join("/").replace(/\/\/+/g,"/"),cO=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),hO=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,fO=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function dO(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}var DC=["POST","PUT","PATCH","DELETE"];new Set(DC);var pO=["GET",...DC];new Set(pO);var Yc=he.createContext(null);Yc.displayName="DataRouter";var Gg=he.createContext(null);Gg.displayName="DataRouterState";var PC=he.createContext({isTransitioning:!1});PC.displayName="ViewTransition";var mO=he.createContext(new Map);mO.displayName="Fetchers";var gO=he.createContext(null);gO.displayName="Await";var Zs=he.createContext(null);Zs.displayName="Navigation";var Ed=he.createContext(null);Ed.displayName="Location";var Xa=he.createContext({outlet:null,matches:[],isDataRoute:!1});Xa.displayName="Route";var yb=he.createContext(null);yb.displayName="RouteError";function _O(i,{relative:e}={}){Gn(Md(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=he.useContext(Zs),{hash:r,pathname:s,search:o}=Ad(i,{relative:e}),u=s;return t!=="/"&&(u=s==="/"?t:Ia([t,s])),n.createHref({pathname:u,search:o,hash:r})}function Md(){return he.useContext(Ed)!=null}function Zl(){return Gn(Md(),"useLocation() may be used only in the context of a <Router> component."),he.useContext(Ed).location}var LC="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function UC(i){he.useContext(Zs).static||he.useLayoutEffect(i)}function vO(){let{isDataRoute:i}=he.useContext(Xa);return i?DO():yO()}function yO(){Gn(Md(),"useNavigate() may be used only in the context of a <Router> component.");let i=he.useContext(Yc),{basename:e,navigator:t}=he.useContext(Zs),{matches:n}=he.useContext(Xa),{pathname:r}=Zl(),s=JSON.stringify(CC(n)),o=he.useRef(!1);return UC(()=>{o.current=!0}),he.useCallback((c,f={})=>{if($s(o.current,LC),!o.current)return;if(typeof c=="number"){t.go(c);return}let d=NC(c,JSON.parse(s),r,f.relative==="path");i==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Ia([e,d.pathname])),(f.replace?t.replace:t.push)(d,f.state,f)},[e,t,s,r,i])}he.createContext(null);function Ad(i,{relative:e}={}){let{matches:t}=he.useContext(Xa),{pathname:n}=Zl(),r=JSON.stringify(CC(t));return he.useMemo(()=>NC(i,JSON.parse(r),n,e==="path"),[i,r,n,e])}function xO(i,e){return OC(i,e)}function OC(i,e,t,n){var E;Gn(Md(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r,static:s}=he.useContext(Zs),{matches:o}=he.useContext(Xa),u=o[o.length-1],c=u?u.params:{},f=u?u.pathname:"/",d=u?u.pathnameBase:"/",m=u&&u.route;{let M=m&&m.path||"";BC(f,!m||M.endsWith("*")||M.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${M}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${M}"> to <Route path="${M==="/"?"*":`${M}/*`}">.`)}let g=Zl(),_;if(e){let M=typeof e=="string"?Xc(e):e;Gn(d==="/"||((E=M.pathname)==null?void 0:E.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${M.pathname}" was given in the \`location\` prop.`),_=M}else _=g;let v=_.pathname||"/",S=v;if(d!=="/"){let M=d.replace(/^\//,"").split("/");S="/"+v.replace(/^\//,"").split("/").slice(M.length).join("/")}let b=!s&&t&&t.matches&&t.matches.length>0?t.matches:AC(i,{pathname:S});$s(m||b!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),$s(b==null||b[b.length-1].route.element!==void 0||b[b.length-1].route.Component!==void 0||b[b.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let x=MO(b&&b.map(M=>Object.assign({},M,{params:Object.assign({},c,M.params),pathname:Ia([d,r.encodeLocation?r.encodeLocation(M.pathname).pathname:M.pathname]),pathnameBase:M.pathnameBase==="/"?d:Ia([d,r.encodeLocation?r.encodeLocation(M.pathnameBase).pathname:M.pathnameBase])})),o,t,n);return e&&x?he.createElement(Ed.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},x):x}function bO(){let i=NO(),e=dO(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",i),o=he.createElement(he.Fragment,null,he.createElement("p",null,"💿 Hey developer 👋"),he.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",he.createElement("code",{style:s},"ErrorBoundary")," or"," ",he.createElement("code",{style:s},"errorElement")," prop on your route.")),he.createElement(he.Fragment,null,he.createElement("h2",null,"Unexpected Application Error!"),he.createElement("h3",{style:{fontStyle:"italic"}},e),t?he.createElement("pre",{style:r},t):null,o)}var SO=he.createElement(bO,null),TO=class extends he.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){console.error("React Router caught the following error during render",i,e)}render(){return this.state.error!==void 0?he.createElement(Xa.Provider,{value:this.props.routeContext},he.createElement(yb.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function EO({routeContext:i,match:e,children:t}){let n=he.useContext(Yc);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),he.createElement(Xa.Provider,{value:i},t)}function MO(i,e=[],t=null,n=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let r=i,s=t==null?void 0:t.errors;if(s!=null){let c=r.findIndex(f=>f.route.id&&(s==null?void 0:s[f.route.id])!==void 0);Gn(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),r=r.slice(0,Math.min(r.length,c+1))}let o=!1,u=-1;if(t)for(let c=0;c<r.length;c++){let f=r[c];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=c),f.route.id){let{loaderData:d,errors:m}=t,g=f.route.loader&&!d.hasOwnProperty(f.route.id)&&(!m||m[f.route.id]===void 0);if(f.route.lazy||g){o=!0,u>=0?r=r.slice(0,u+1):r=[r[0]];break}}}return r.reduceRight((c,f,d)=>{let m,g=!1,_=null,v=null;t&&(m=s&&f.route.id?s[f.route.id]:void 0,_=f.route.errorElement||SO,o&&(u<0&&d===0?(BC("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),g=!0,v=null):u===d&&(g=!0,v=f.route.hydrateFallbackElement||null)));let S=e.concat(r.slice(0,d+1)),b=()=>{let x;return m?x=_:g?x=v:f.route.Component?x=he.createElement(f.route.Component,null):f.route.element?x=f.route.element:x=c,he.createElement(EO,{match:f,routeContext:{outlet:c,matches:S,isDataRoute:t!=null},children:x})};return t&&(f.route.ErrorBoundary||f.route.errorElement||d===0)?he.createElement(TO,{location:t.location,revalidation:t.revalidation,component:_,error:m,children:b(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):b()},null)}function xb(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function AO(i){let e=he.useContext(Yc);return Gn(e,xb(i)),e}function wO(i){let e=he.useContext(Gg);return Gn(e,xb(i)),e}function RO(i){let e=he.useContext(Xa);return Gn(e,xb(i)),e}function bb(i){let e=RO(i),t=e.matches[e.matches.length-1];return Gn(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function CO(){return bb("useRouteId")}function NO(){var n;let i=he.useContext(yb),e=wO("useRouteError"),t=bb("useRouteError");return i!==void 0?i:(n=e.errors)==null?void 0:n[t]}function DO(){let{router:i}=AO("useNavigate"),e=bb("useNavigate"),t=he.useRef(!1);return UC(()=>{t.current=!0}),he.useCallback(async(r,s={})=>{$s(t.current,LC),t.current&&(typeof r=="number"?i.navigate(r):await i.navigate(r,{fromRouteId:e,...s}))},[i,e])}var kA={};function BC(i,e,t){!e&&!kA[i]&&(kA[i]=!0,$s(!1,t))}he.memo(PO);function PO({routes:i,future:e,state:t}){return OC(i,void 0,t,e)}function sc(i){Gn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function LO({basename:i="/",children:e=null,location:t,navigationType:n="POP",navigator:r,static:s=!1}){Gn(!Md(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=i.replace(/^\/*/,"/"),u=he.useMemo(()=>({basename:o,navigator:r,static:s,future:{}}),[o,r,s]);typeof t=="string"&&(t=Xc(t));let{pathname:c="/",search:f="",hash:d="",state:m=null,key:g="default"}=t,_=he.useMemo(()=>{let v=Ha(c,o);return v==null?null:{location:{pathname:v,search:f,hash:d,state:m,key:g},navigationType:n}},[o,c,f,d,m,g,n]);return $s(_!=null,`<Router basename="${o}"> is not able to match the URL "${c}${f}${d}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:he.createElement(Zs.Provider,{value:u},he.createElement(Ed.Provider,{children:e,value:_}))}function UO({children:i,location:e}){return xO(Rx(i),e)}function Rx(i,e=[]){let t=[];return he.Children.forEach(i,(n,r)=>{if(!he.isValidElement(n))return;let s=[...e,r];if(n.type===he.Fragment){t.push.apply(t,Rx(n.props.children,s));return}Gn(n.type===sc,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Gn(!n.props.index||!n.props.children,"An index route cannot have child routes.");let o={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=Rx(n.props.children,s)),t.push(o)}),t}var tg="get",ng="application/x-www-form-urlencoded";function Vg(i){return i!=null&&typeof i.tagName=="string"}function OO(i){return Vg(i)&&i.tagName.toLowerCase()==="button"}function BO(i){return Vg(i)&&i.tagName.toLowerCase()==="form"}function FO(i){return Vg(i)&&i.tagName.toLowerCase()==="input"}function IO(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function zO(i,e){return i.button===0&&(!e||e==="_self")&&!IO(i)}var Jp=null;function kO(){if(Jp===null)try{new FormData(document.createElement("form"),0),Jp=!1}catch{Jp=!0}return Jp}var GO=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Oy(i){return i!=null&&!GO.has(i)?($s(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ng}"`),null):i}function VO(i,e){let t,n,r,s,o;if(BO(i)){let u=i.getAttribute("action");n=u?Ha(u,e):null,t=i.getAttribute("method")||tg,r=Oy(i.getAttribute("enctype"))||ng,s=new FormData(i)}else if(OO(i)||FO(i)&&(i.type==="submit"||i.type==="image")){let u=i.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=i.getAttribute("formaction")||u.getAttribute("action");if(n=c?Ha(c,e):null,t=i.getAttribute("formmethod")||u.getAttribute("method")||tg,r=Oy(i.getAttribute("formenctype"))||Oy(u.getAttribute("enctype"))||ng,s=new FormData(u,i),!kO()){let{name:f,type:d,value:m}=i;if(d==="image"){let g=f?`${f}.`:"";s.append(`${g}x`,"0"),s.append(`${g}y`,"0")}else f&&s.append(f,m)}}else{if(Vg(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=tg,n=null,r=ng,o=i}return s&&r==="text/plain"&&(o=s,s=void 0),{action:n,method:t.toLowerCase(),encType:r,formData:s,body:o}}function Sb(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}async function HO(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function jO(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function WO(i,e,t){let n=await Promise.all(i.map(async r=>{let s=e.routes[r.route.id];if(s){let o=await HO(s,t);return o.links?o.links():[]}return[]}));return YO(n.flat(1).filter(jO).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function GA(i,e,t,n,r,s){let o=(c,f)=>t[f]?c.route.id!==t[f].route.id:!0,u=(c,f)=>{var d;return t[f].pathname!==c.pathname||((d=t[f].route.path)==null?void 0:d.endsWith("*"))&&t[f].params["*"]!==c.params["*"]};return s==="assets"?e.filter((c,f)=>o(c,f)||u(c,f)):s==="data"?e.filter((c,f)=>{var m;let d=n.routes[c.route.id];if(!d||!d.hasLoader)return!1;if(o(c,f)||u(c,f))return!0;if(c.route.shouldRevalidate){let g=c.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((m=t[0])==null?void 0:m.params)||{},nextUrl:new URL(i,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function qO(i,e,{includeHydrateFallback:t}={}){return $O(i.map(n=>{let r=e.routes[n.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function $O(i){return[...new Set(i)]}function XO(i){let e={},t=Object.keys(i).sort();for(let n of t)e[n]=i[n];return e}function YO(i,e){let t=new Set;return new Set(e),i.reduce((n,r)=>{let s=JSON.stringify(XO(r));return t.has(s)||(t.add(s),n.push({key:s,link:r})),n},[])}function KO(i,e){let t=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return t.pathname==="/"?t.pathname="_root.data":e&&Ha(t.pathname,e)==="/"?t.pathname=`${e.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function FC(){let i=he.useContext(Yc);return Sb(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function QO(){let i=he.useContext(Gg);return Sb(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var Tb=he.createContext(void 0);Tb.displayName="FrameworkContext";function IC(){let i=he.useContext(Tb);return Sb(i,"You must render this element inside a <HydratedRouter> element"),i}function ZO(i,e){let t=he.useContext(Tb),[n,r]=he.useState(!1),[s,o]=he.useState(!1),{onFocus:u,onBlur:c,onMouseEnter:f,onMouseLeave:d,onTouchStart:m}=e,g=he.useRef(null);he.useEffect(()=>{if(i==="render"&&o(!0),i==="viewport"){let S=x=>{x.forEach(E=>{o(E.isIntersecting)})},b=new IntersectionObserver(S,{threshold:.5});return g.current&&b.observe(g.current),()=>{b.disconnect()}}},[i]),he.useEffect(()=>{if(n){let S=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(S)}}},[n]);let _=()=>{r(!0)},v=()=>{r(!1),o(!1)};return t?i!=="intent"?[s,g,{}]:[s,g,{onFocus:ef(u,_),onBlur:ef(c,v),onMouseEnter:ef(f,_),onMouseLeave:ef(d,v),onTouchStart:ef(m,_)}]:[!1,g,{}]}function ef(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function JO({page:i,...e}){let{router:t}=FC(),n=he.useMemo(()=>AC(t.routes,i,t.basename),[t.routes,i,t.basename]);return n?he.createElement(tB,{page:i,matches:n,...e}):null}function eB(i){let{manifest:e,routeModules:t}=IC(),[n,r]=he.useState([]);return he.useEffect(()=>{let s=!1;return WO(i,e,t).then(o=>{s||r(o)}),()=>{s=!0}},[i,e,t]),n}function tB({page:i,matches:e,...t}){let n=Zl(),{manifest:r,routeModules:s}=IC(),{basename:o}=FC(),{loaderData:u,matches:c}=QO(),f=he.useMemo(()=>GA(i,e,c,r,n,"data"),[i,e,c,r,n]),d=he.useMemo(()=>GA(i,e,c,r,n,"assets"),[i,e,c,r,n]),m=he.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let v=new Set,S=!1;if(e.forEach(x=>{var M;let E=r.routes[x.route.id];!E||!E.hasLoader||(!f.some(A=>A.route.id===x.route.id)&&x.route.id in u&&((M=s[x.route.id])!=null&&M.shouldRevalidate)||E.hasClientLoader?S=!0:v.add(x.route.id))}),v.size===0)return[];let b=KO(i,o);return S&&v.size>0&&b.searchParams.set("_routes",e.filter(x=>v.has(x.route.id)).map(x=>x.route.id).join(",")),[b.pathname+b.search]},[o,u,n,r,f,e,i,s]),g=he.useMemo(()=>qO(d,r),[d,r]),_=eB(d);return he.createElement(he.Fragment,null,m.map(v=>he.createElement("link",{key:v,rel:"prefetch",as:"fetch",href:v,...t})),g.map(v=>he.createElement("link",{key:v,rel:"modulepreload",href:v,...t})),_.map(({key:v,link:S})=>he.createElement("link",{key:v,...S})))}function nB(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var zC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{zC&&(window.__reactRouterVersion="7.5.0")}catch{}function iB({basename:i,children:e,window:t}){let n=he.useRef();n.current==null&&(n.current=WU({window:t,v5Compat:!0}));let r=n.current,[s,o]=he.useState({action:r.action,location:r.location}),u=he.useCallback(c=>{he.startTransition(()=>o(c))},[o]);return he.useLayoutEffect(()=>r.listen(u),[r,u]),he.createElement(LO,{basename:i,children:e,location:s.location,navigationType:s.action,navigator:r})}var kC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,GC=he.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:s,replace:o,state:u,target:c,to:f,preventScrollReset:d,viewTransition:m,...g},_){let{basename:v}=he.useContext(Zs),S=typeof f=="string"&&kC.test(f),b,x=!1;if(typeof f=="string"&&S&&(b=f,zC))try{let P=new URL(window.location.href),D=f.startsWith("//")?new URL(P.protocol+f):new URL(f),I=Ha(D.pathname,v);D.origin===P.origin&&I!=null?f=I+D.search+D.hash:x=!0}catch{$s(!1,`<Link to="${f}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let E=_O(f,{relative:r}),[M,A,C]=ZO(n,g),w=aB(f,{replace:o,state:u,target:c,preventScrollReset:d,relative:r,viewTransition:m});function N(P){e&&e(P),P.defaultPrevented||w(P)}let L=he.createElement("a",{...g,...C,href:b||E,onClick:x||s?e:N,ref:nB(_,A),target:c,"data-discover":!S&&t==="render"?"true":void 0});return M&&!S?he.createElement(he.Fragment,null,L,he.createElement(JO,{page:E})):L});GC.displayName="Link";var ac=he.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:s,to:o,viewTransition:u,children:c,...f},d){let m=Ad(o,{relative:f.relative}),g=Zl(),_=he.useContext(Gg),{navigator:v,basename:S}=he.useContext(Zs),b=_!=null&&hB(m)&&u===!0,x=v.encodeLocation?v.encodeLocation(m).pathname:m.pathname,E=g.pathname,M=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;t||(E=E.toLowerCase(),M=M?M.toLowerCase():null,x=x.toLowerCase()),M&&S&&(M=Ha(M,S)||M);const A=x!=="/"&&x.endsWith("/")?x.length-1:x.length;let C=E===x||!r&&E.startsWith(x)&&E.charAt(A)==="/",w=M!=null&&(M===x||!r&&M.startsWith(x)&&M.charAt(x.length)==="/"),N={isActive:C,isPending:w,isTransitioning:b},L=C?e:void 0,P;typeof n=="function"?P=n(N):P=[n,C?"active":null,w?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let D=typeof s=="function"?s(N):s;return he.createElement(GC,{...f,"aria-current":L,className:P,ref:d,style:D,to:o,viewTransition:u},typeof c=="function"?c(N):c)});ac.displayName="NavLink";var rB=he.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:r,state:s,method:o=tg,action:u,onSubmit:c,relative:f,preventScrollReset:d,viewTransition:m,...g},_)=>{let v=uB(),S=cB(u,{relative:f}),b=o.toLowerCase()==="get"?"get":"post",x=typeof u=="string"&&kC.test(u),E=M=>{if(c&&c(M),M.defaultPrevented)return;M.preventDefault();let A=M.nativeEvent.submitter,C=(A==null?void 0:A.getAttribute("formmethod"))||o;v(A||M.currentTarget,{fetcherKey:e,method:C,navigate:t,replace:r,state:s,relative:f,preventScrollReset:d,viewTransition:m})};return he.createElement("form",{ref:_,method:b,action:S,onSubmit:n?c:E,...g,"data-discover":!x&&i==="render"?"true":void 0})});rB.displayName="Form";function sB(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function VC(i){let e=he.useContext(Yc);return Gn(e,sB(i)),e}function aB(i,{target:e,replace:t,state:n,preventScrollReset:r,relative:s,viewTransition:o}={}){let u=vO(),c=Zl(),f=Ad(i,{relative:s});return he.useCallback(d=>{if(zO(d,e)){d.preventDefault();let m=t!==void 0?t:qf(c)===qf(f);u(i,{replace:m,state:n,preventScrollReset:r,relative:s,viewTransition:o})}},[c,u,f,t,n,e,i,r,s,o])}var oB=0,lB=()=>`__${String(++oB)}__`;function uB(){let{router:i}=VC("useSubmit"),{basename:e}=he.useContext(Zs),t=CO();return he.useCallback(async(n,r={})=>{let{action:s,method:o,encType:u,formData:c,body:f}=VO(n,e);if(r.navigate===!1){let d=r.fetcherKey||lB();await i.fetch(d,t,r.action||s,{preventScrollReset:r.preventScrollReset,formData:c,body:f,formMethod:r.method||o,formEncType:r.encType||u,flushSync:r.flushSync})}else await i.navigate(r.action||s,{preventScrollReset:r.preventScrollReset,formData:c,body:f,formMethod:r.method||o,formEncType:r.encType||u,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[i,e,t])}function cB(i,{relative:e}={}){let{basename:t}=he.useContext(Zs),n=he.useContext(Xa);Gn(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),s={...Ad(i||".",{relative:e})},o=Zl();if(i==null){s.search=o.search;let u=new URLSearchParams(s.search),c=u.getAll("index");if(c.some(d=>d==="")){u.delete("index"),c.filter(m=>m).forEach(m=>u.append("index",m));let d=u.toString();s.search=d?`?${d}`:""}}return(!i||i===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:Ia([t,s.pathname])),qf(s)}function hB(i,e={}){let t=he.useContext(PC);Gn(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=VC("useViewTransitionState"),r=Ad(i,{relative:e.relative});if(!t.isTransitioning)return!1;let s=Ha(t.currentLocation.pathname,n)||t.currentLocation.pathname,o=Ha(t.nextLocation.pathname,n)||t.nextLocation.pathname;return gg(r.pathname,o)!=null||gg(r.pathname,s)!=null}new TextEncoder;async function Eb(){try{console.log("[fetchProjects] Request: GET /api/projects");const i=await fetch("/api/projects/");if(console.log("[fetchProjects] Response status:",i.status),!i.ok)return console.error("[fetchProjects] Failed to fetch projects"),[];const e=await i.json();return console.log("[fetchProjects] Response body:",e),!e||!e.projects?[]:Array.isArray(e.projects)?e.projects:typeof e.projects=="object"?Object.entries(e.projects).map(([t,n])=>({name:t,path:n})):[]}catch(i){return console.error("[fetchProjects] Error:",i),[]}}async function fB(i,e){console.log("[addProject] Request: POST /api/projects",{path:i,name:e});const t=await fetch("/api/projects/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:i,name:e})});console.log("[addProject] Response status:",t.status);try{const n=await t.json();console.log("[addProject] Response body:",n)}catch(n){console.log("[addProject] No JSON response or error:",n)}return t.ok}async function dB(i){console.log("[removeProject] Request: DELETE /api/projects/"+encodeURIComponent(i));const e=await fetch(`/api/projects/${encodeURIComponent(i)}/`,{method:"DELETE"});console.log("[removeProject] Response status:",e.status);try{const t=await e.json();console.log("[removeProject] Response body:",t)}catch(t){console.log("[removeProject] No JSON response or error:",t)}return e.ok}async function pB(i){console.log("[reinitializeProject] Request: POST /api/projects/"+encodeURIComponent(i)+"/reinitialize");const e=await fetch(`/api/projects/${encodeURIComponent(i)}/reinitialize`,{method:"POST"});console.log("[reinitializeProject] Response status:",e.status);try{const t=await e.json();console.log("[reinitializeProject] Response body:",t)}catch(t){console.log("[reinitializeProject] No JSON response or error:",t)}return e.ok}const mB=({onAdd:i})=>{const[e,t]=he.useState(""),[n,r]=he.useState(""),[s,o]=he.useState(!1),u=async c=>{if(c.preventDefault(),!e)return;o(!0);const f=e.trim().replace(/^["']|["']$/g,"");await i(f,n)?(t(""),r("")):alert("Failed to add project"),o(!1)};return U.jsxs("form",{onSubmit:u,style:{marginBottom:"1rem"},children:[U.jsx("input",{type:"text",placeholder:"Project path",value:e,onChange:c=>t(c.target.value),style:{marginRight:"0.5rem"},required:!0}),U.jsx("input",{type:"text",placeholder:"Project name (optional)",value:n,onChange:c=>r(c.target.value),style:{marginRight:"0.5rem"}}),U.jsx("button",{type:"submit",disabled:s,children:s?"Adding...":"Add Project"})]})},gB=({projects:i,onRemove:e})=>{const[t,n]=he.useState(null),[r,s]=he.useState(null),o=async c=>{if(!window.confirm(`Are you sure you want to remove project "${c}"?`))return;n(c),await e(c)||alert("Failed to remove project"),n(null)},u=async c=>{if(!window.confirm(`Are you sure you want to reinitialize project "${c}"? This will delete and rebuild all metadata.`))return;s(c),await pB(c)||alert("Failed to reinitialize project"),s(null)};return U.jsxs("div",{children:[U.jsx("ul",{style:{listStyle:"none",padding:0},children:i.map(c=>U.jsxs("li",{style:{marginBottom:"1rem",border:"1px solid var(--project-card-border, #e0e0e0)",borderRadius:"8px",padding:"1rem",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",background:"var(--project-card-bg, #fafbfc)",maxWidth:480},children:[U.jsx("div",{style:{fontWeight:700,fontSize:"1.1rem",color:"var(--project-card-title, #222)"},children:c.name}),U.jsx("div",{style:{color:"var(--project-card-path, #888)",fontSize:"0.97rem",marginBottom:"0.4rem"},children:c.path}),U.jsxs("div",{style:{display:"flex",gap:"2rem",marginBottom:"0.4rem",fontSize:"0.96rem"},children:[typeof c.size=="number"&&U.jsxs("span",{style:{color:"var(--project-card-size, #bbb)"},children:[U.jsx("strong",{children:"Size:"})," ",(c.size/(1024*1024)).toFixed(2)," MB"]}),c.status&&U.jsxs("span",{style:{color:c.status==="indexing"?"#e67e22":"var(--project-card-status, #27ae60)"},children:[U.jsx("strong",{children:"Status:"})," ",c.status]})]}),c.lastIndexed&&U.jsxs("div",{style:{color:"var(--project-card-last, #888)",fontSize:"0.95rem",marginBottom:"0.5rem"},children:[U.jsx("strong",{children:"Last Indexed:"})," ",new Date(c.lastIndexed).toLocaleString()]}),U.jsxs("div",{children:[U.jsx("button",{style:{marginRight:"0.7rem"},onClick:()=>o(c.name),disabled:t===c.name,children:t===c.name?"Removing...":"Remove"}),U.jsx("button",{onClick:()=>u(c.name),disabled:r===c.name,children:r===c.name?"Reinitializing...":"Reinitialize"})]})]},c.name))}),U.jsx("p",{style:{fontStyle:"italic",marginTop:"1rem"},children:"All open projects are continuously indexed in the background."})]})},_B=()=>{const[i,e]=he.useState([]),[t,n]=he.useState(!1),[r,s]=he.useState(null),o=async()=>{n(!0),s(null);try{const f=await Eb();e(f)}catch(f){console.error(f),s("Failed to load projects")}finally{n(!1)}};he.useEffect(()=>{o()},[]);const u=async(f,d)=>{const m=await fB(f,d);return m&&await o(),m},c=async f=>{const d=await dB(f);return await o(),d};return U.jsxs("div",{children:[U.jsx("h1",{children:"Projects"}),U.jsx(mB,{onAdd:u}),t&&U.jsx("p",{children:"Loading projects..."}),r&&U.jsx("p",{style:{color:"red"},children:r}),U.jsx(gB,{projects:i,onRemove:c})]})},vB=({nResults:i,setNResults:e,minScore:t,setMinScore:n,includeMetadata:r,setIncludeMetadata:s})=>U.jsxs("div",{style:{marginBottom:"1rem"},children:[U.jsxs("label",{style:{marginRight:"1rem"},children:["Results:",U.jsx("input",{type:"number",min:1,max:100,value:i,onChange:o=>e(Number(o.target.value)),style:{width:"4rem",marginLeft:"0.5rem"}})]}),U.jsxs("label",{style:{marginRight:"1rem"},children:["Min Score:",U.jsx("input",{type:"number",step:.01,min:0,max:1,value:t,onChange:o=>n(Number(o.target.value)),style:{width:"4rem",marginLeft:"0.5rem"}})]}),U.jsxs("label",{style:{marginRight:"1rem"},children:["Include Metadata:",U.jsx("input",{type:"checkbox",checked:r,onChange:o=>s(o.target.checked),style:{marginLeft:"0.5rem"}})]})]}),yB=()=>{const[i,e]=he.useState([]),[t,n]=he.useState(!1),[r,s]=he.useState(""),[o,u]=he.useState(""),[c,f]=he.useState(""),[d,m]=he.useState([]),[g,_]=he.useState(!1),[v,S]=he.useState(null),[b,x]=he.useState(10),[E,M]=he.useState(0),[A,C]=he.useState(!0);he.useEffect(()=>{let L=!0;return Eb().then(P=>{L&&(e(P),n(!0))}),()=>{L=!1}},[]),he.useEffect(()=>{t&&i.length>0&&s(i[0].name)},[t,i]);const w=async()=>{if(!(!o||!r)){_(!0),S(null);try{const P=await(await fetch("/api/query/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project:r,query:o,n_results:b,min_score:E,include_metadata:A})})).json();f(P.context||""),m(P.results||[])}catch(L){console.error(L),S("Query failed")}finally{_(!1)}}},N=L=>{if(!o)return L;const P=new RegExp(o,"gi");return L.split(P).reduce((D,I,j,J)=>j<J.length-1?[...D,I,U.jsx("mark",{children:o},j)]:[...D,I],[])};return U.jsxs("div",{children:[U.jsx("h1",{children:"Query"}),U.jsxs("div",{className:"query-instructions",children:[U.jsx("strong",{children:"Tips for best results:"}),U.jsxs("ul",{children:[U.jsxs("li",{children:["Use function or class names if you know them (e.g., ",U.jsx("code",{children:"process_documents"}),")."]}),U.jsx("li",{children:"Paste a code snippet or line for precise matches."}),U.jsx("li",{children:"Try searching with docstring or comment text."}),U.jsx("li",{children:"Describe what the code does in plain English if unsure."}),U.jsx("li",{children:'Adjust "Results" and "Min Score" for more or fewer matches.'})]})]}),U.jsxs("div",{style:{marginBottom:"1rem"},children:[U.jsx("label",{htmlFor:"project-select",children:"Project: "}),U.jsx("select",{id:"project-select",value:r,onChange:L=>s(L.target.value),children:i.map(L=>U.jsx("option",{value:L.name,children:L.name},L.name))})]}),U.jsx("input",{type:"text",placeholder:"Enter your query",value:o,onChange:L=>u(L.target.value),className:"query-input",style:{width:"60%",marginRight:"0.5rem"}}),U.jsx("button",{onClick:w,disabled:g||!r||!o,children:g?"Querying...":"Query"}),U.jsx("button",{onClick:()=>xB(c),style:{marginLeft:"0.5rem"},children:"Export Context"}),U.jsx(vB,{nResults:b,setNResults:x,minScore:E,setMinScore:M,includeMetadata:A,setIncludeMetadata:C}),v&&U.jsx("p",{style:{color:"red"},children:v}),U.jsx("h2",{children:"Context Preview"}),U.jsx("pre",{className:"context-preview",children:c}),U.jsx("h2",{children:"Results"}),U.jsx("ul",{children:d.map(L=>U.jsxs("li",{style:{marginBottom:"1rem"},children:[U.jsxs("div",{children:[U.jsx("strong",{children:"Score:"})," ",L.score.toFixed(2)]}),L.metadata.file_path&&U.jsxs("div",{children:[U.jsx("strong",{children:"File:"})," ",L.metadata.file_path]}),L.metadata.class_name&&U.jsxs("div",{children:[U.jsx("strong",{children:"Class:"})," ",L.metadata.class_name]}),L.metadata.function_name&&U.jsxs("div",{children:[U.jsx("strong",{children:"Function:"})," ",L.metadata.function_name]}),L.metadata.docstring&&U.jsxs("div",{children:[U.jsx("strong",{children:"Docstring:"})," ",L.metadata.docstring]}),U.jsx("pre",{className:"result-text-box",children:N(L.text)})]},L.chunk_id))})]})},xB=i=>{const e=new Blob([i],{type:"text/plain"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="context.txt",n.click(),URL.revokeObjectURL(t)};function bB(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,f=!1;try{if(s=(t=t.call(i)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){f=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw r}}return u}}function SB(i,e,t){return e=NB(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function VA(i,e){return MB(i)||bB(i,e)||HC(i,e)||RB()}function TB(i){return EB(i)||AB(i)||HC(i)||wB()}function EB(i){if(Array.isArray(i))return Cx(i)}function MB(i){if(Array.isArray(i))return i}function AB(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function HC(i,e){if(i){if(typeof i=="string")return Cx(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Cx(i,e)}}function Cx(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=i[t];return n}function wB(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CB(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function NB(i){var e=CB(i,"string");return typeof e=="symbol"?e:String(e)}var DB=function(e,t){var n=new Set(t);return Object.assign.apply(Object,[{}].concat(TB(Object.entries(e).filter(function(r){var s=VA(r,1),o=s[0];return!n.has(o)}).map(function(r){var s=VA(r,2),o=s[0],u=s[1];return SB({},o,u)}))))};function Nx(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function PB(i){if(Array.isArray(i))return i}function LB(i){if(Array.isArray(i))return Nx(i)}function UB(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function OB(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,f=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){f=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw r}}return u}}function BB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FB(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IB(i,e){return PB(i)||OB(i,e)||jC(i,e)||BB()}function HA(i){return LB(i)||UB(i)||jC(i)||FB()}function jC(i,e){if(i){if(typeof i=="string")return Nx(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Nx(i,e):void 0}}function zB(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,n=t===void 0?"div":t,r=e.nodeMapper,s=r===void 0?function(d){return d}:r,o=e.methodNames,u=o===void 0?[]:o,c=e.initPropNames,f=c===void 0?[]:c;return he.forwardRef(function(d,m){var g=he.useRef(),_=he.useMemo(function(){var b=Object.fromEntries(f.filter(function(x){return d.hasOwnProperty(x)}).map(function(x){return[x,d[x]]}));return i(b)},[]);jA(function(){_(s(g.current))},he.useLayoutEffect),jA(function(){return _._destructor instanceof Function?_._destructor:void 0});var v=he.useCallback(function(b){for(var x=arguments.length,E=new Array(x>1?x-1:0),M=1;M<x;M++)E[M-1]=arguments[M];return _[b]instanceof Function?_[b].apply(_,E):void 0},[_]),S=he.useRef({});return Object.keys(DB(d,[].concat(HA(u),HA(f)))).filter(function(b){return S.current[b]!==d[b]}).forEach(function(b){return v(b,d[b])}),S.current=d,he.useImperativeHandle(m,function(){return Object.fromEntries(u.map(function(b){return[b,function(){for(var x=arguments.length,E=new Array(x),M=0;M<x;M++)E[M]=arguments[M];return v.apply(void 0,[b].concat(E))}]}))},[v]),BU.createElement(n,{ref:g})})}function jA(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:he.useEffect,t=he.useRef(),n=he.useRef(!1),r=he.useRef(!1),s=he.useState(0),o=IB(s,2);o[0];var u=o[1];n.current&&(r.current=!0),e(function(){return n.current||(t.current=i(),n.current=!0),u(function(c){return c+1}),function(){r.current&&t.current&&t.current()}},[])}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Kc="175",Bi={ROTATE:0,DOLLY:1,PAN:2},Ua={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},WC=0,Dx=1,qC=2,kB=0,Mb=1,GB=2,Gr=3,xr=0,Tn=1,Ji=2,br=0,rs=1,bc=2,Sc=3,Tc=4,pc=5,qi=100,Ab=101,wb=102,$C=103,XC=104,wa=200,Rb=201,Cb=202,Nb=203,$f=204,Xf=205,Db=206,Pb=207,Lb=208,Ub=209,Ob=210,VB=211,HB=212,jB=213,WB=214,Yf=0,Kf=1,Qf=2,Ho=3,Zf=4,Jf=5,ed=6,td=7,wd=0,YC=1,KC=2,Sr=0,QC=1,ZC=2,JC=3,eN=4,qB=5,tN=6,nN=7,Bb=300,os=301,ls=302,jo=303,Wo=304,Wl=306,ql=1e3,Hs=1001,$l=1002,Rn=1003,Fb=1004,Oa=1005,gi=1006,mc=1007,mr=1008,Wn=1009,zl=1010,kl=1011,Ms=1012,Ri=1013,Sn=1014,Yn=1015,Xi=1016,Hg=1017,jg=1018,Hr=1020,Wg=35902,Ib=1021,Rd=1022,qn=1023,zb=1024,kb=1025,jr=1026,Wr=1027,Cd=1028,Qc=1029,Xl=1030,Zc=1031,$B=1032,Jc=1033,Gl=33776,Io=33777,zo=33778,ko=33779,nd=35840,id=35841,rd=35842,sd=35843,ad=36196,Ec=37492,Mc=37496,Ac=37808,wc=37809,Rc=37810,Cc=37811,Nc=37812,Dc=37813,Pc=37814,Lc=37815,Uc=37816,Oc=37817,Bc=37818,Fc=37819,Ic=37820,zc=37821,Vl=36492,Px=36494,Lx=36495,Gb=36283,od=36284,ld=36285,ud=36286,XB=3200,YB=3201,ja=0,iN=1,Vr="",ut="srgb",qs="srgb-linear",_g="linear",on="srgb",KB=0,Rl=7680,QB=7681,ZB=7682,JB=7683,e3=34055,t3=34056,n3=5386,i3=512,r3=513,s3=514,a3=515,o3=516,l3=517,u3=518,Ux=519,Vb=512,qg=513,Hb=514,$g=515,jb=516,Wb=517,qb=518,$b=519,vg=35044,oc=35048,WA="300 es",gr=2e3,qo=2001;class Ya{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const r=n[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Hi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let qA=1234567;const Of=Math.PI/180,Yl=180/Math.PI;function za(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Hi[i&255]+Hi[i>>8&255]+Hi[i>>16&255]+Hi[i>>24&255]+"-"+Hi[e&255]+Hi[e>>8&255]+"-"+Hi[e>>16&15|64]+Hi[e>>24&255]+"-"+Hi[t&63|128]+Hi[t>>8&255]+"-"+Hi[t>>16&255]+Hi[t>>24&255]+Hi[n&255]+Hi[n>>8&255]+Hi[n>>16&255]+Hi[n>>24&255]).toLowerCase()}function Lt(i,e,t){return Math.max(e,Math.min(t,i))}function Xb(i,e){return(i%e+e)%e}function c3(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function h3(i,e,t){return i!==e?(t-i)/(e-i):0}function Bf(i,e,t){return(1-t)*i+t*e}function f3(i,e,t,n){return Bf(i,e,1-Math.exp(-t*n))}function d3(i,e=1){return e-Math.abs(Xb(i,e*2)-e)}function p3(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function m3(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function g3(i,e){return i+Math.floor(Math.random()*(e-i+1))}function _3(i,e){return i+Math.random()*(e-i)}function v3(i){return i*(.5-Math.random())}function y3(i){i!==void 0&&(qA=i);let e=qA+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function x3(i){return i*Of}function b3(i){return i*Yl}function S3(i){return(i&i-1)===0&&i!==0}function T3(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function E3(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function M3(i,e,t,n,r){const s=Math.cos,o=Math.sin,u=s(t/2),c=o(t/2),f=s((e+n)/2),d=o((e+n)/2),m=s((e-n)/2),g=o((e-n)/2),_=s((n-e)/2),v=o((n-e)/2);switch(r){case"XYX":i.set(u*d,c*m,c*g,u*f);break;case"YZY":i.set(c*g,u*d,c*m,u*f);break;case"ZXZ":i.set(c*m,c*g,u*d,u*f);break;case"XZX":i.set(u*d,c*v,c*_,u*f);break;case"YXY":i.set(c*_,u*d,c*v,u*f);break;case"ZYZ":i.set(c*v,c*_,u*d,u*f);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function er(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Pt(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const yg={DEG2RAD:Of,RAD2DEG:Yl,generateUUID:za,clamp:Lt,euclideanModulo:Xb,mapLinear:c3,inverseLerp:h3,lerp:Bf,damp:f3,pingpong:d3,smoothstep:p3,smootherstep:m3,randInt:g3,randFloat:_3,randFloatSpread:v3,seededRandom:y3,degToRad:x3,radToDeg:b3,isPowerOfTwo:S3,ceilPowerOfTwo:T3,floorPowerOfTwo:E3,setQuaternionFromProperEuler:M3,normalize:Pt,denormalize:er};class Oe{constructor(e=0,t=0){Oe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Lt(this.x,e.x,t.x),this.y=Lt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Lt(this.x,e,t),this.y=Lt(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Lt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Lt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Mt{constructor(e,t,n,r,s,o,u,c,f){Mt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,u,c,f)}set(e,t,n,r,s,o,u,c,f){const d=this.elements;return d[0]=e,d[1]=r,d[2]=u,d[3]=t,d[4]=s,d[5]=c,d[6]=n,d[7]=o,d[8]=f,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],u=n[3],c=n[6],f=n[1],d=n[4],m=n[7],g=n[2],_=n[5],v=n[8],S=r[0],b=r[3],x=r[6],E=r[1],M=r[4],A=r[7],C=r[2],w=r[5],N=r[8];return s[0]=o*S+u*E+c*C,s[3]=o*b+u*M+c*w,s[6]=o*x+u*A+c*N,s[1]=f*S+d*E+m*C,s[4]=f*b+d*M+m*w,s[7]=f*x+d*A+m*N,s[2]=g*S+_*E+v*C,s[5]=g*b+_*M+v*w,s[8]=g*x+_*A+v*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],u=e[5],c=e[6],f=e[7],d=e[8];return t*o*d-t*u*f-n*s*d+n*u*c+r*s*f-r*o*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],u=e[5],c=e[6],f=e[7],d=e[8],m=d*o-u*f,g=u*c-d*s,_=f*s-o*c,v=t*m+n*g+r*_;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const S=1/v;return e[0]=m*S,e[1]=(r*f-d*n)*S,e[2]=(u*n-r*o)*S,e[3]=g*S,e[4]=(d*t-r*c)*S,e[5]=(r*s-u*t)*S,e[6]=_*S,e[7]=(n*c-f*t)*S,e[8]=(o*t-n*s)*S,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,u){const c=Math.cos(s),f=Math.sin(s);return this.set(n*c,n*f,-n*(c*o+f*u)+o+e,-r*f,r*c,-r*(-f*o+c*u)+u+t,0,0,1),this}scale(e,t){return this.premultiply(By.makeScale(e,t)),this}rotate(e){return this.premultiply(By.makeRotation(-e)),this}translate(e,t){return this.premultiply(By.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const By=new Mt;function Yb(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function cd(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function rN(){const i=cd("canvas");return i.style.display="block",i}const $A={};function ws(i){i in $A||($A[i]=!0,console.warn(i))}function A3(i,e,t){return new Promise(function(n,r){function s(){switch(i.clientWaitSync(e,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:r();break;case i.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:n()}}setTimeout(s,t)})}function w3(i){const e=i.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function R3(i){const e=i.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const XA=new Mt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),YA=new Mt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function C3(){const i={enabled:!0,workingColorSpace:qs,spaces:{},convert:function(r,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===on&&(r.r=ka(r.r),r.g=ka(r.g),r.b=ka(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===on&&(r.r=gc(r.r),r.g=gc(r.g),r.b=gc(r.b))),r},fromWorkingColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},toWorkingColorSpace:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Vr?_g:this.spaces[r].transfer},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[qs]:{primaries:e,whitePoint:n,transfer:_g,toXYZ:XA,fromXYZ:YA,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:ut},outputColorSpaceConfig:{drawingBufferColorSpace:ut}},[ut]:{primaries:e,whitePoint:n,transfer:on,toXYZ:XA,fromXYZ:YA,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:ut}}}),i}const Ft=C3();function ka(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function gc(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let Ou;class N3{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Ou===void 0&&(Ou=cd("canvas")),Ou.width=e.width,Ou.height=e.height;const r=Ou.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=Ou}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=cd("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=ka(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(ka(t[n]/255)*255):t[n]=ka(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let D3=0;class Kb{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:D3++}),this.uuid=za(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,u=r.length;o<u;o++)r[o].isDataTexture?s.push(Fy(r[o].image)):s.push(Fy(r[o]))}else s=Fy(r);n.url=s}return t||(e.images[this.uuid]=n),n}}function Fy(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?N3.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let P3=0;class _i extends Ya{constructor(e=_i.DEFAULT_IMAGE,t=_i.DEFAULT_MAPPING,n=Hs,r=Hs,s=gi,o=mr,u=qn,c=Wn,f=_i.DEFAULT_ANISOTROPY,d=Vr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:P3++}),this.uuid=za(),this.name="",this.source=new Kb(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=f,this.format=u,this.internalFormat=null,this.type=c,this.offset=new Oe(0,0),this.repeat=new Oe(1,1),this.center=new Oe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Mt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Bb)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ql:e.x=e.x-Math.floor(e.x);break;case Hs:e.x=e.x<0?0:1;break;case $l:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ql:e.y=e.y-Math.floor(e.y);break;case Hs:e.y=e.y<0?0:1;break;case $l:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}_i.DEFAULT_IMAGE=null;_i.DEFAULT_MAPPING=Bb;_i.DEFAULT_ANISOTROPY=1;class xt{constructor(e=0,t=0,n=0,r=1){xt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const c=e.elements,f=c[0],d=c[4],m=c[8],g=c[1],_=c[5],v=c[9],S=c[2],b=c[6],x=c[10];if(Math.abs(d-g)<.01&&Math.abs(m-S)<.01&&Math.abs(v-b)<.01){if(Math.abs(d+g)<.1&&Math.abs(m+S)<.1&&Math.abs(v+b)<.1&&Math.abs(f+_+x-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const M=(f+1)/2,A=(_+1)/2,C=(x+1)/2,w=(d+g)/4,N=(m+S)/4,L=(v+b)/4;return M>A&&M>C?M<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(M),r=w/n,s=N/n):A>C?A<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(A),n=w/r,s=L/r):C<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(C),n=N/s,r=L/s),this.set(n,r,s,t),this}let E=Math.sqrt((b-v)*(b-v)+(m-S)*(m-S)+(g-d)*(g-d));return Math.abs(E)<.001&&(E=1),this.x=(b-v)/E,this.y=(m-S)/E,this.z=(g-d)/E,this.w=Math.acos((f+_+x-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Lt(this.x,e.x,t.x),this.y=Lt(this.y,e.y,t.y),this.z=Lt(this.z,e.z,t.z),this.w=Lt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Lt(this.x,e,t),this.y=Lt(this.y,e,t),this.z=Lt(this.z,e,t),this.w=Lt(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Lt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Jl extends Ya{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new xt(0,0,e,t),this.scissorTest=!1,this.viewport=new xt(0,0,e,t);const r={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:gi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const s=new _i(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);s.flipY=!1,s.generateMipmaps=n.generateMipmaps,s.internalFormat=n.internalFormat,this.textures=[];const o=n.count;for(let u=0;u<o;u++)this.textures[u]=s.clone(),this.textures[u].isRenderTargetTexture=!0,this.textures[u].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new Kb(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class $o extends Jl{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Qb extends _i{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Rn,this.minFilter=Rn,this.wrapR=Hs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class L3 extends _i{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Rn,this.minFilter=Rn,this.wrapR=Hs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Rs{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,u){let c=n[r+0],f=n[r+1],d=n[r+2],m=n[r+3];const g=s[o+0],_=s[o+1],v=s[o+2],S=s[o+3];if(u===0){e[t+0]=c,e[t+1]=f,e[t+2]=d,e[t+3]=m;return}if(u===1){e[t+0]=g,e[t+1]=_,e[t+2]=v,e[t+3]=S;return}if(m!==S||c!==g||f!==_||d!==v){let b=1-u;const x=c*g+f*_+d*v+m*S,E=x>=0?1:-1,M=1-x*x;if(M>Number.EPSILON){const C=Math.sqrt(M),w=Math.atan2(C,x*E);b=Math.sin(b*w)/C,u=Math.sin(u*w)/C}const A=u*E;if(c=c*b+g*A,f=f*b+_*A,d=d*b+v*A,m=m*b+S*A,b===1-u){const C=1/Math.sqrt(c*c+f*f+d*d+m*m);c*=C,f*=C,d*=C,m*=C}}e[t]=c,e[t+1]=f,e[t+2]=d,e[t+3]=m}static multiplyQuaternionsFlat(e,t,n,r,s,o){const u=n[r],c=n[r+1],f=n[r+2],d=n[r+3],m=s[o],g=s[o+1],_=s[o+2],v=s[o+3];return e[t]=u*v+d*m+c*_-f*g,e[t+1]=c*v+d*g+f*m-u*_,e[t+2]=f*v+d*_+u*g-c*m,e[t+3]=d*v-u*m-c*g-f*_,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,s=e._z,o=e._order,u=Math.cos,c=Math.sin,f=u(n/2),d=u(r/2),m=u(s/2),g=c(n/2),_=c(r/2),v=c(s/2);switch(o){case"XYZ":this._x=g*d*m+f*_*v,this._y=f*_*m-g*d*v,this._z=f*d*v+g*_*m,this._w=f*d*m-g*_*v;break;case"YXZ":this._x=g*d*m+f*_*v,this._y=f*_*m-g*d*v,this._z=f*d*v-g*_*m,this._w=f*d*m+g*_*v;break;case"ZXY":this._x=g*d*m-f*_*v,this._y=f*_*m+g*d*v,this._z=f*d*v+g*_*m,this._w=f*d*m-g*_*v;break;case"ZYX":this._x=g*d*m-f*_*v,this._y=f*_*m+g*d*v,this._z=f*d*v-g*_*m,this._w=f*d*m+g*_*v;break;case"YZX":this._x=g*d*m+f*_*v,this._y=f*_*m+g*d*v,this._z=f*d*v-g*_*m,this._w=f*d*m-g*_*v;break;case"XZY":this._x=g*d*m-f*_*v,this._y=f*_*m-g*d*v,this._z=f*d*v+g*_*m,this._w=f*d*m+g*_*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],u=t[5],c=t[9],f=t[2],d=t[6],m=t[10],g=n+u+m;if(g>0){const _=.5/Math.sqrt(g+1);this._w=.25/_,this._x=(d-c)*_,this._y=(s-f)*_,this._z=(o-r)*_}else if(n>u&&n>m){const _=2*Math.sqrt(1+n-u-m);this._w=(d-c)/_,this._x=.25*_,this._y=(r+o)/_,this._z=(s+f)/_}else if(u>m){const _=2*Math.sqrt(1+u-n-m);this._w=(s-f)/_,this._x=(r+o)/_,this._y=.25*_,this._z=(c+d)/_}else{const _=2*Math.sqrt(1+m-n-u);this._w=(o-r)/_,this._x=(s+f)/_,this._y=(c+d)/_,this._z=.25*_}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Lt(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,u=t._x,c=t._y,f=t._z,d=t._w;return this._x=n*d+o*u+r*f-s*c,this._y=r*d+o*c+s*u-n*f,this._z=s*d+o*f+n*c-r*u,this._w=o*d-n*u-r*c-s*f,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let u=o*e._w+n*e._x+r*e._y+s*e._z;if(u<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,u=-u):this.copy(e),u>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const c=1-u*u;if(c<=Number.EPSILON){const _=1-t;return this._w=_*o+t*this._w,this._x=_*n+t*this._x,this._y=_*r+t*this._y,this._z=_*s+t*this._z,this.normalize(),this}const f=Math.sqrt(c),d=Math.atan2(f,u),m=Math.sin((1-t)*d)/f,g=Math.sin(t*d)/f;return this._w=o*m+this._w*g,this._x=n*m+this._x*g,this._y=r*m+this._y*g,this._z=s*m+this._z*g,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class H{constructor(e=0,t=0,n=0){H.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(KA.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(KA.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,u=e.z,c=e.w,f=2*(o*r-u*n),d=2*(u*t-s*r),m=2*(s*n-o*t);return this.x=t+c*f+o*m-u*d,this.y=n+c*d+u*f-s*m,this.z=r+c*m+s*d-o*f,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Lt(this.x,e.x,t.x),this.y=Lt(this.y,e.y,t.y),this.z=Lt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Lt(this.x,e,t),this.y=Lt(this.y,e,t),this.z=Lt(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Lt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,u=t.y,c=t.z;return this.x=r*c-s*u,this.y=s*o-n*c,this.z=n*u-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Iy.copy(this).projectOnVector(e),this.sub(Iy)}reflect(e){return this.sub(Iy.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Lt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Iy=new H,KA=new Rs;class eu{constructor(e=new H(1/0,1/0,1/0),t=new H(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(ps.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(ps.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ps.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,u=s.count;o<u;o++)e.isMesh===!0?e.getVertexPosition(o,ps):ps.fromBufferAttribute(s,o),ps.applyMatrix4(e.matrixWorld),this.expandByPoint(ps);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),em.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),em.copy(n.boundingBox)),em.applyMatrix4(e.matrixWorld),this.union(em)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ps),ps.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(tf),tm.subVectors(this.max,tf),Bu.subVectors(e.a,tf),Fu.subVectors(e.b,tf),Iu.subVectors(e.c,tf),Ao.subVectors(Fu,Bu),wo.subVectors(Iu,Fu),yl.subVectors(Bu,Iu);let t=[0,-Ao.z,Ao.y,0,-wo.z,wo.y,0,-yl.z,yl.y,Ao.z,0,-Ao.x,wo.z,0,-wo.x,yl.z,0,-yl.x,-Ao.y,Ao.x,0,-wo.y,wo.x,0,-yl.y,yl.x,0];return!zy(t,Bu,Fu,Iu,tm)||(t=[1,0,0,0,1,0,0,0,1],!zy(t,Bu,Fu,Iu,tm))?!1:(nm.crossVectors(Ao,wo),t=[nm.x,nm.y,nm.z],zy(t,Bu,Fu,Iu,tm))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ps).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ps).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ya[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ya[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ya[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ya[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ya[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ya[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ya[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ya[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ya),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ya=[new H,new H,new H,new H,new H,new H,new H,new H],ps=new H,em=new eu,Bu=new H,Fu=new H,Iu=new H,Ao=new H,wo=new H,yl=new H,tf=new H,tm=new H,nm=new H,xl=new H;function zy(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){xl.fromArray(i,s);const u=r.x*Math.abs(xl.x)+r.y*Math.abs(xl.y)+r.z*Math.abs(xl.z),c=e.dot(xl),f=t.dot(xl),d=n.dot(xl);if(Math.max(-Math.max(c,f,d),Math.min(c,f,d))>u)return!1}return!0}const U3=new eu,nf=new H,ky=new H;class Nd{constructor(e=new H,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):U3.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;nf.subVectors(e,this.center);const t=nf.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(nf,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(ky.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(nf.copy(e.center).add(ky)),this.expandByPoint(nf.copy(e.center).sub(ky))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const xa=new H,Gy=new H,im=new H,Ro=new H,Vy=new H,rm=new H,Hy=new H;class Xg{constructor(e=new H,t=new H(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,xa)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=xa.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(xa.copy(this.origin).addScaledVector(this.direction,t),xa.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Gy.copy(e).add(t).multiplyScalar(.5),im.copy(t).sub(e).normalize(),Ro.copy(this.origin).sub(Gy);const s=e.distanceTo(t)*.5,o=-this.direction.dot(im),u=Ro.dot(this.direction),c=-Ro.dot(im),f=Ro.lengthSq(),d=Math.abs(1-o*o);let m,g,_,v;if(d>0)if(m=o*c-u,g=o*u-c,v=s*d,m>=0)if(g>=-v)if(g<=v){const S=1/d;m*=S,g*=S,_=m*(m+o*g+2*u)+g*(o*m+g+2*c)+f}else g=s,m=Math.max(0,-(o*g+u)),_=-m*m+g*(g+2*c)+f;else g=-s,m=Math.max(0,-(o*g+u)),_=-m*m+g*(g+2*c)+f;else g<=-v?(m=Math.max(0,-(-o*s+u)),g=m>0?-s:Math.min(Math.max(-s,-c),s),_=-m*m+g*(g+2*c)+f):g<=v?(m=0,g=Math.min(Math.max(-s,-c),s),_=g*(g+2*c)+f):(m=Math.max(0,-(o*s+u)),g=m>0?s:Math.min(Math.max(-s,-c),s),_=-m*m+g*(g+2*c)+f);else g=o>0?-s:s,m=Math.max(0,-(o*g+u)),_=-m*m+g*(g+2*c)+f;return n&&n.copy(this.origin).addScaledVector(this.direction,m),r&&r.copy(Gy).addScaledVector(im,g),_}intersectSphere(e,t){xa.subVectors(e.center,this.origin);const n=xa.dot(this.direction),r=xa.dot(xa)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),u=n-o,c=n+o;return c<0?null:u<0?this.at(c,t):this.at(u,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,u,c;const f=1/this.direction.x,d=1/this.direction.y,m=1/this.direction.z,g=this.origin;return f>=0?(n=(e.min.x-g.x)*f,r=(e.max.x-g.x)*f):(n=(e.max.x-g.x)*f,r=(e.min.x-g.x)*f),d>=0?(s=(e.min.y-g.y)*d,o=(e.max.y-g.y)*d):(s=(e.max.y-g.y)*d,o=(e.min.y-g.y)*d),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),m>=0?(u=(e.min.z-g.z)*m,c=(e.max.z-g.z)*m):(u=(e.max.z-g.z)*m,c=(e.min.z-g.z)*m),n>c||u>r)||((u>n||n!==n)&&(n=u),(c<r||r!==r)&&(r=c),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,xa)!==null}intersectTriangle(e,t,n,r,s){Vy.subVectors(t,e),rm.subVectors(n,e),Hy.crossVectors(Vy,rm);let o=this.direction.dot(Hy),u;if(o>0){if(r)return null;u=1}else if(o<0)u=-1,o=-o;else return null;Ro.subVectors(this.origin,e);const c=u*this.direction.dot(rm.crossVectors(Ro,rm));if(c<0)return null;const f=u*this.direction.dot(Vy.cross(Ro));if(f<0||c+f>o)return null;const d=-u*Ro.dot(Hy);return d<0?null:this.at(d/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class qt{constructor(e,t,n,r,s,o,u,c,f,d,m,g,_,v,S,b){qt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,u,c,f,d,m,g,_,v,S,b)}set(e,t,n,r,s,o,u,c,f,d,m,g,_,v,S,b){const x=this.elements;return x[0]=e,x[4]=t,x[8]=n,x[12]=r,x[1]=s,x[5]=o,x[9]=u,x[13]=c,x[2]=f,x[6]=d,x[10]=m,x[14]=g,x[3]=_,x[7]=v,x[11]=S,x[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new qt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/zu.setFromMatrixColumn(e,0).length(),s=1/zu.setFromMatrixColumn(e,1).length(),o=1/zu.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),u=Math.sin(n),c=Math.cos(r),f=Math.sin(r),d=Math.cos(s),m=Math.sin(s);if(e.order==="XYZ"){const g=o*d,_=o*m,v=u*d,S=u*m;t[0]=c*d,t[4]=-c*m,t[8]=f,t[1]=_+v*f,t[5]=g-S*f,t[9]=-u*c,t[2]=S-g*f,t[6]=v+_*f,t[10]=o*c}else if(e.order==="YXZ"){const g=c*d,_=c*m,v=f*d,S=f*m;t[0]=g+S*u,t[4]=v*u-_,t[8]=o*f,t[1]=o*m,t[5]=o*d,t[9]=-u,t[2]=_*u-v,t[6]=S+g*u,t[10]=o*c}else if(e.order==="ZXY"){const g=c*d,_=c*m,v=f*d,S=f*m;t[0]=g-S*u,t[4]=-o*m,t[8]=v+_*u,t[1]=_+v*u,t[5]=o*d,t[9]=S-g*u,t[2]=-o*f,t[6]=u,t[10]=o*c}else if(e.order==="ZYX"){const g=o*d,_=o*m,v=u*d,S=u*m;t[0]=c*d,t[4]=v*f-_,t[8]=g*f+S,t[1]=c*m,t[5]=S*f+g,t[9]=_*f-v,t[2]=-f,t[6]=u*c,t[10]=o*c}else if(e.order==="YZX"){const g=o*c,_=o*f,v=u*c,S=u*f;t[0]=c*d,t[4]=S-g*m,t[8]=v*m+_,t[1]=m,t[5]=o*d,t[9]=-u*d,t[2]=-f*d,t[6]=_*m+v,t[10]=g-S*m}else if(e.order==="XZY"){const g=o*c,_=o*f,v=u*c,S=u*f;t[0]=c*d,t[4]=-m,t[8]=f*d,t[1]=g*m+S,t[5]=o*d,t[9]=_*m-v,t[2]=v*m-_,t[6]=u*d,t[10]=S*m+g}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(O3,e,B3)}lookAt(e,t,n){const r=this.elements;return Or.subVectors(e,t),Or.lengthSq()===0&&(Or.z=1),Or.normalize(),Co.crossVectors(n,Or),Co.lengthSq()===0&&(Math.abs(n.z)===1?Or.x+=1e-4:Or.z+=1e-4,Or.normalize(),Co.crossVectors(n,Or)),Co.normalize(),sm.crossVectors(Or,Co),r[0]=Co.x,r[4]=sm.x,r[8]=Or.x,r[1]=Co.y,r[5]=sm.y,r[9]=Or.y,r[2]=Co.z,r[6]=sm.z,r[10]=Or.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],u=n[4],c=n[8],f=n[12],d=n[1],m=n[5],g=n[9],_=n[13],v=n[2],S=n[6],b=n[10],x=n[14],E=n[3],M=n[7],A=n[11],C=n[15],w=r[0],N=r[4],L=r[8],P=r[12],D=r[1],I=r[5],j=r[9],J=r[13],ue=r[2],$=r[6],k=r[10],G=r[14],W=r[3],ce=r[7],z=r[11],le=r[15];return s[0]=o*w+u*D+c*ue+f*W,s[4]=o*N+u*I+c*$+f*ce,s[8]=o*L+u*j+c*k+f*z,s[12]=o*P+u*J+c*G+f*le,s[1]=d*w+m*D+g*ue+_*W,s[5]=d*N+m*I+g*$+_*ce,s[9]=d*L+m*j+g*k+_*z,s[13]=d*P+m*J+g*G+_*le,s[2]=v*w+S*D+b*ue+x*W,s[6]=v*N+S*I+b*$+x*ce,s[10]=v*L+S*j+b*k+x*z,s[14]=v*P+S*J+b*G+x*le,s[3]=E*w+M*D+A*ue+C*W,s[7]=E*N+M*I+A*$+C*ce,s[11]=E*L+M*j+A*k+C*z,s[15]=E*P+M*J+A*G+C*le,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],u=e[5],c=e[9],f=e[13],d=e[2],m=e[6],g=e[10],_=e[14],v=e[3],S=e[7],b=e[11],x=e[15];return v*(+s*c*m-r*f*m-s*u*g+n*f*g+r*u*_-n*c*_)+S*(+t*c*_-t*f*g+s*o*g-r*o*_+r*f*d-s*c*d)+b*(+t*f*m-t*u*_-s*o*m+n*o*_+s*u*d-n*f*d)+x*(-r*u*d-t*c*m+t*u*g+r*o*m-n*o*g+n*c*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],u=e[5],c=e[6],f=e[7],d=e[8],m=e[9],g=e[10],_=e[11],v=e[12],S=e[13],b=e[14],x=e[15],E=m*b*f-S*g*f+S*c*_-u*b*_-m*c*x+u*g*x,M=v*g*f-d*b*f-v*c*_+o*b*_+d*c*x-o*g*x,A=d*S*f-v*m*f+v*u*_-o*S*_-d*u*x+o*m*x,C=v*m*c-d*S*c-v*u*g+o*S*g+d*u*b-o*m*b,w=t*E+n*M+r*A+s*C;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const N=1/w;return e[0]=E*N,e[1]=(S*g*s-m*b*s-S*r*_+n*b*_+m*r*x-n*g*x)*N,e[2]=(u*b*s-S*c*s+S*r*f-n*b*f-u*r*x+n*c*x)*N,e[3]=(m*c*s-u*g*s-m*r*f+n*g*f+u*r*_-n*c*_)*N,e[4]=M*N,e[5]=(d*b*s-v*g*s+v*r*_-t*b*_-d*r*x+t*g*x)*N,e[6]=(v*c*s-o*b*s-v*r*f+t*b*f+o*r*x-t*c*x)*N,e[7]=(o*g*s-d*c*s+d*r*f-t*g*f-o*r*_+t*c*_)*N,e[8]=A*N,e[9]=(v*m*s-d*S*s-v*n*_+t*S*_+d*n*x-t*m*x)*N,e[10]=(o*S*s-v*u*s+v*n*f-t*S*f-o*n*x+t*u*x)*N,e[11]=(d*u*s-o*m*s-d*n*f+t*m*f+o*n*_-t*u*_)*N,e[12]=C*N,e[13]=(d*S*r-v*m*r+v*n*g-t*S*g-d*n*b+t*m*b)*N,e[14]=(v*u*r-o*S*r-v*n*c+t*S*c+o*n*b-t*u*b)*N,e[15]=(o*m*r-d*u*r+d*n*c-t*m*c-o*n*g+t*u*g)*N,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,u=e.y,c=e.z,f=s*o,d=s*u;return this.set(f*o+n,f*u-r*c,f*c+r*u,0,f*u+r*c,d*u+n,d*c-r*o,0,f*c-r*u,d*c+r*o,s*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,u=t._z,c=t._w,f=s+s,d=o+o,m=u+u,g=s*f,_=s*d,v=s*m,S=o*d,b=o*m,x=u*m,E=c*f,M=c*d,A=c*m,C=n.x,w=n.y,N=n.z;return r[0]=(1-(S+x))*C,r[1]=(_+A)*C,r[2]=(v-M)*C,r[3]=0,r[4]=(_-A)*w,r[5]=(1-(g+x))*w,r[6]=(b+E)*w,r[7]=0,r[8]=(v+M)*N,r[9]=(b-E)*N,r[10]=(1-(g+S))*N,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=zu.set(r[0],r[1],r[2]).length();const o=zu.set(r[4],r[5],r[6]).length(),u=zu.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],ms.copy(this);const f=1/s,d=1/o,m=1/u;return ms.elements[0]*=f,ms.elements[1]*=f,ms.elements[2]*=f,ms.elements[4]*=d,ms.elements[5]*=d,ms.elements[6]*=d,ms.elements[8]*=m,ms.elements[9]*=m,ms.elements[10]*=m,t.setFromRotationMatrix(ms),n.x=s,n.y=o,n.z=u,this}makePerspective(e,t,n,r,s,o,u=gr){const c=this.elements,f=2*s/(t-e),d=2*s/(n-r),m=(t+e)/(t-e),g=(n+r)/(n-r);let _,v;if(u===gr)_=-(o+s)/(o-s),v=-2*o*s/(o-s);else if(u===qo)_=-o/(o-s),v=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=f,c[4]=0,c[8]=m,c[12]=0,c[1]=0,c[5]=d,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=_,c[14]=v,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,r,s,o,u=gr){const c=this.elements,f=1/(t-e),d=1/(n-r),m=1/(o-s),g=(t+e)*f,_=(n+r)*d;let v,S;if(u===gr)v=(o+s)*m,S=-2*m;else if(u===qo)v=s*m,S=-1*m;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*f,c[4]=0,c[8]=0,c[12]=-g,c[1]=0,c[5]=2*d,c[9]=0,c[13]=-_,c[2]=0,c[6]=0,c[10]=S,c[14]=-v,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const zu=new H,ms=new qt,O3=new H(0,0,0),B3=new H(1,1,1),Co=new H,sm=new H,Or=new H,QA=new qt,ZA=new Rs;class Tr{constructor(e=0,t=0,n=0,r=Tr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],u=r[8],c=r[1],f=r[5],d=r[9],m=r[2],g=r[6],_=r[10];switch(t){case"XYZ":this._y=Math.asin(Lt(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-d,_),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(g,f),this._z=0);break;case"YXZ":this._x=Math.asin(-Lt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(u,_),this._z=Math.atan2(c,f)):(this._y=Math.atan2(-m,s),this._z=0);break;case"ZXY":this._x=Math.asin(Lt(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-m,_),this._z=Math.atan2(-o,f)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Lt(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(g,_),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,f));break;case"YZX":this._z=Math.asin(Lt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,f),this._y=Math.atan2(-m,s)):(this._x=0,this._y=Math.atan2(u,_));break;case"XZY":this._z=Math.asin(-Lt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(g,f),this._y=Math.atan2(u,s)):(this._x=Math.atan2(-d,_),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return QA.makeRotationFromQuaternion(e),this.setFromRotationMatrix(QA,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ZA.setFromEuler(this),this.setFromQuaternion(ZA,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Tr.DEFAULT_ORDER="XYZ";class Zb{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let F3=0;const JA=new H,ku=new Rs,ba=new qt,am=new H,rf=new H,I3=new H,z3=new Rs,ew=new H(1,0,0),tw=new H(0,1,0),nw=new H(0,0,1),iw={type:"added"},k3={type:"removed"},Gu={type:"childadded",child:null},jy={type:"childremoved",child:null};class li extends Ya{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:F3++}),this.uuid=za(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=li.DEFAULT_UP.clone();const e=new H,t=new Tr,n=new Rs,r=new H(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new qt},normalMatrix:{value:new Mt}}),this.matrix=new qt,this.matrixWorld=new qt,this.matrixAutoUpdate=li.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=li.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Zb,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ku.setFromAxisAngle(e,t),this.quaternion.multiply(ku),this}rotateOnWorldAxis(e,t){return ku.setFromAxisAngle(e,t),this.quaternion.premultiply(ku),this}rotateX(e){return this.rotateOnAxis(ew,e)}rotateY(e){return this.rotateOnAxis(tw,e)}rotateZ(e){return this.rotateOnAxis(nw,e)}translateOnAxis(e,t){return JA.copy(e).applyQuaternion(this.quaternion),this.position.add(JA.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ew,e)}translateY(e){return this.translateOnAxis(tw,e)}translateZ(e){return this.translateOnAxis(nw,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ba.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?am.copy(e):am.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),rf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ba.lookAt(rf,am,this.up):ba.lookAt(am,rf,this.up),this.quaternion.setFromRotationMatrix(ba),r&&(ba.extractRotation(r.matrixWorld),ku.setFromRotationMatrix(ba),this.quaternion.premultiply(ku.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(iw),Gu.child=e,this.dispatchEvent(Gu),Gu.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(k3),jy.child=e,this.dispatchEvent(jy),jy.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ba.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ba.multiply(e.parent.matrixWorld)),e.applyMatrix4(ba),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(iw),Gu.child=e,this.dispatchEvent(Gu),Gu.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rf,e,I3),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rf,z3,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let f=0,d=c.length;f<d;f++){const m=c[f];s(e.shapes,m)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,f=this.material.length;c<f;c++)u.push(s(e.materials,this.material[c]));r.material=u}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let u=0;u<this.children.length;u++)r.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];r.animations.push(s(e.animations,c))}}if(t){const u=o(e.geometries),c=o(e.materials),f=o(e.textures),d=o(e.images),m=o(e.shapes),g=o(e.skeletons),_=o(e.animations),v=o(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),f.length>0&&(n.textures=f),d.length>0&&(n.images=d),m.length>0&&(n.shapes=m),g.length>0&&(n.skeletons=g),_.length>0&&(n.animations=_),v.length>0&&(n.nodes=v)}return n.object=r,n;function o(u){const c=[];for(const f in u){const d=u[f];delete d.metadata,c.push(d)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}li.DEFAULT_UP=new H(0,1,0);li.DEFAULT_MATRIX_AUTO_UPDATE=!0;li.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const gs=new H,Sa=new H,Wy=new H,Ta=new H,Vu=new H,Hu=new H,rw=new H,qy=new H,$y=new H,Xy=new H,Yy=new xt,Ky=new xt,Qy=new xt;class Ts{constructor(e=new H,t=new H,n=new H){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),gs.subVectors(e,t),r.cross(gs);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){gs.subVectors(r,t),Sa.subVectors(n,t),Wy.subVectors(e,t);const o=gs.dot(gs),u=gs.dot(Sa),c=gs.dot(Wy),f=Sa.dot(Sa),d=Sa.dot(Wy),m=o*f-u*u;if(m===0)return s.set(0,0,0),null;const g=1/m,_=(f*c-u*d)*g,v=(o*d-u*c)*g;return s.set(1-_-v,v,_)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Ta)===null?!1:Ta.x>=0&&Ta.y>=0&&Ta.x+Ta.y<=1}static getInterpolation(e,t,n,r,s,o,u,c){return this.getBarycoord(e,t,n,r,Ta)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,Ta.x),c.addScaledVector(o,Ta.y),c.addScaledVector(u,Ta.z),c)}static getInterpolatedAttribute(e,t,n,r,s,o){return Yy.setScalar(0),Ky.setScalar(0),Qy.setScalar(0),Yy.fromBufferAttribute(e,t),Ky.fromBufferAttribute(e,n),Qy.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(Yy,s.x),o.addScaledVector(Ky,s.y),o.addScaledVector(Qy,s.z),o}static isFrontFacing(e,t,n,r){return gs.subVectors(n,t),Sa.subVectors(e,t),gs.cross(Sa).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return gs.subVectors(this.c,this.b),Sa.subVectors(this.a,this.b),gs.cross(Sa).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ts.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ts.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,s){return Ts.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return Ts.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ts.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,u;Vu.subVectors(r,n),Hu.subVectors(s,n),qy.subVectors(e,n);const c=Vu.dot(qy),f=Hu.dot(qy);if(c<=0&&f<=0)return t.copy(n);$y.subVectors(e,r);const d=Vu.dot($y),m=Hu.dot($y);if(d>=0&&m<=d)return t.copy(r);const g=c*m-d*f;if(g<=0&&c>=0&&d<=0)return o=c/(c-d),t.copy(n).addScaledVector(Vu,o);Xy.subVectors(e,s);const _=Vu.dot(Xy),v=Hu.dot(Xy);if(v>=0&&_<=v)return t.copy(s);const S=_*f-c*v;if(S<=0&&f>=0&&v<=0)return u=f/(f-v),t.copy(n).addScaledVector(Hu,u);const b=d*v-_*m;if(b<=0&&m-d>=0&&_-v>=0)return rw.subVectors(s,r),u=(m-d)/(m-d+(_-v)),t.copy(r).addScaledVector(rw,u);const x=1/(b+S+g);return o=S*x,u=g*x,t.copy(n).addScaledVector(Vu,o).addScaledVector(Hu,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const sN={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},No={h:0,s:0,l:0},om={h:0,s:0,l:0};function Zy(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class it{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ut){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ft.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=Ft.workingColorSpace){return this.r=e,this.g=t,this.b=n,Ft.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=Ft.workingColorSpace){if(e=Xb(e,1),t=Lt(t,0,1),n=Lt(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=Zy(o,s,e+1/3),this.g=Zy(o,s,e),this.b=Zy(o,s,e-1/3)}return Ft.toWorkingColorSpace(this,r),this}setStyle(e,t=ut){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],u=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ut){const n=sN[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ka(e.r),this.g=ka(e.g),this.b=ka(e.b),this}copyLinearToSRGB(e){return this.r=gc(e.r),this.g=gc(e.g),this.b=gc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ut){return Ft.fromWorkingColorSpace(ji.copy(this),e),Math.round(Lt(ji.r*255,0,255))*65536+Math.round(Lt(ji.g*255,0,255))*256+Math.round(Lt(ji.b*255,0,255))}getHexString(e=ut){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ft.workingColorSpace){Ft.fromWorkingColorSpace(ji.copy(this),t);const n=ji.r,r=ji.g,s=ji.b,o=Math.max(n,r,s),u=Math.min(n,r,s);let c,f;const d=(u+o)/2;if(u===o)c=0,f=0;else{const m=o-u;switch(f=d<=.5?m/(o+u):m/(2-o-u),o){case n:c=(r-s)/m+(r<s?6:0);break;case r:c=(s-n)/m+2;break;case s:c=(n-r)/m+4;break}c/=6}return e.h=c,e.s=f,e.l=d,e}getRGB(e,t=Ft.workingColorSpace){return Ft.fromWorkingColorSpace(ji.copy(this),t),e.r=ji.r,e.g=ji.g,e.b=ji.b,e}getStyle(e=ut){Ft.fromWorkingColorSpace(ji.copy(this),e);const t=ji.r,n=ji.g,r=ji.b;return e!==ut?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(No),this.setHSL(No.h+e,No.s+t,No.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(No),e.getHSL(om);const n=Bf(No.h,om.h,t),r=Bf(No.s,om.s,t),s=Bf(No.l,om.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ji=new it;it.NAMES=sN;let G3=0;class Yi extends Ya{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:G3++}),this.uuid=za(),this.name="",this.type="Material",this.blending=rs,this.side=xr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=$f,this.blendDst=Xf,this.blendEquation=qi,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new it(0,0,0),this.blendAlpha=0,this.depthFunc=Ho,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ux,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Rl,this.stencilZFail=Rl,this.stencilZPass=Rl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==rs&&(n.blending=this.blending),this.side!==xr&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==$f&&(n.blendSrc=this.blendSrc),this.blendDst!==Xf&&(n.blendDst=this.blendDst),this.blendEquation!==qi&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Ho&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Ux&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Rl&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Rl&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Rl&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const u in s){const c=s[u];delete c.metadata,o.push(c)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Gs extends Yi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new it(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tr,this.combine=wd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Na=V3();function V3(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),r=new Uint32Array(512);for(let c=0;c<256;++c){const f=c-127;f<-27?(n[c]=0,n[c|256]=32768,r[c]=24,r[c|256]=24):f<-14?(n[c]=1024>>-f-14,n[c|256]=1024>>-f-14|32768,r[c]=-f-1,r[c|256]=-f-1):f<=15?(n[c]=f+15<<10,n[c|256]=f+15<<10|32768,r[c]=13,r[c|256]=13):f<128?(n[c]=31744,n[c|256]=64512,r[c]=24,r[c|256]=24):(n[c]=31744,n[c|256]=64512,r[c]=13,r[c|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),u=new Uint32Array(64);for(let c=1;c<1024;++c){let f=c<<13,d=0;for(;(f&8388608)===0;)f<<=1,d-=8388608;f&=-8388609,d+=947912704,s[c]=f|d}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(u[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:u}}function Br(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=Lt(i,-65504,65504),Na.floatView[0]=i;const e=Na.uint32View[0],t=e>>23&511;return Na.baseTable[t]+((e&8388607)>>Na.shiftTable[t])}function lm(i){const e=i>>10;return Na.uint32View[0]=Na.mantissaTable[Na.offsetTable[e]+(i&1023)]+Na.exponentTable[e],Na.floatView[0]}const ii=new H,um=new Oe;let H3=0;class Fi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:H3++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=vg,this.updateRanges=[],this.gpuType=Yn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)um.fromBufferAttribute(this,t),um.applyMatrix3(e),this.setXY(t,um.x,um.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)ii.fromBufferAttribute(this,t),ii.applyMatrix3(e),this.setXYZ(t,ii.x,ii.y,ii.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ii.fromBufferAttribute(this,t),ii.applyMatrix4(e),this.setXYZ(t,ii.x,ii.y,ii.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ii.fromBufferAttribute(this,t),ii.applyNormalMatrix(e),this.setXYZ(t,ii.x,ii.y,ii.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ii.fromBufferAttribute(this,t),ii.transformDirection(e),this.setXYZ(t,ii.x,ii.y,ii.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=er(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Pt(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=er(t,this.array)),t}setX(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=er(t,this.array)),t}setY(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=er(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=er(t,this.array)),t}setW(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),r=Pt(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),r=Pt(r,this.array),s=Pt(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==vg&&(e.usage=this.usage),e}}class Jb extends Fi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class eS extends Fi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class aN extends Fi{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=lm(this.array[e*this.itemSize]);return this.normalized&&(t=er(t,this.array)),t}setX(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize]=Br(t),this}getY(e){let t=lm(this.array[e*this.itemSize+1]);return this.normalized&&(t=er(t,this.array)),t}setY(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize+1]=Br(t),this}getZ(e){let t=lm(this.array[e*this.itemSize+2]);return this.normalized&&(t=er(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize+2]=Br(t),this}getW(e){let t=lm(this.array[e*this.itemSize+3]);return this.normalized&&(t=er(t,this.array)),t}setW(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize+3]=Br(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array)),this.array[e+0]=Br(t),this.array[e+1]=Br(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),r=Pt(r,this.array)),this.array[e+0]=Br(t),this.array[e+1]=Br(n),this.array[e+2]=Br(r),this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),r=Pt(r,this.array),s=Pt(s,this.array)),this.array[e+0]=Br(t),this.array[e+1]=Br(n),this.array[e+2]=Br(r),this.array[e+3]=Br(s),this}}class Kn extends Fi{constructor(e,t,n){super(new Float32Array(e),t,n)}}let j3=0;const es=new qt,Jy=new li,ju=new H,Fr=new eu,sf=new eu,Ai=new H;class rr extends Ya{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:j3++}),this.uuid=za(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Yb(e)?eS:Jb)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Mt().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return es.makeRotationFromQuaternion(e),this.applyMatrix4(es),this}rotateX(e){return es.makeRotationX(e),this.applyMatrix4(es),this}rotateY(e){return es.makeRotationY(e),this.applyMatrix4(es),this}rotateZ(e){return es.makeRotationZ(e),this.applyMatrix4(es),this}translate(e,t,n){return es.makeTranslation(e,t,n),this.applyMatrix4(es),this}scale(e,t,n){return es.makeScale(e,t,n),this.applyMatrix4(es),this}lookAt(e){return Jy.lookAt(e),Jy.updateMatrix(),this.applyMatrix4(Jy.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ju).negate(),this.translate(ju.x,ju.y,ju.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Kn(n,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new eu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new H(-1/0,-1/0,-1/0),new H(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];Fr.setFromBufferAttribute(s),this.morphTargetsRelative?(Ai.addVectors(this.boundingBox.min,Fr.min),this.boundingBox.expandByPoint(Ai),Ai.addVectors(this.boundingBox.max,Fr.max),this.boundingBox.expandByPoint(Ai)):(this.boundingBox.expandByPoint(Fr.min),this.boundingBox.expandByPoint(Fr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Nd);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new H,1/0);return}if(e){const n=this.boundingSphere.center;if(Fr.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const u=t[s];sf.setFromBufferAttribute(u),this.morphTargetsRelative?(Ai.addVectors(Fr.min,sf.min),Fr.expandByPoint(Ai),Ai.addVectors(Fr.max,sf.max),Fr.expandByPoint(Ai)):(Fr.expandByPoint(sf.min),Fr.expandByPoint(sf.max))}Fr.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)Ai.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Ai));if(t)for(let s=0,o=t.length;s<o;s++){const u=t[s],c=this.morphTargetsRelative;for(let f=0,d=u.count;f<d;f++)Ai.fromBufferAttribute(u,f),c&&(ju.fromBufferAttribute(e,f),Ai.add(ju)),r=Math.max(r,n.distanceToSquared(Ai))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Fi(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),u=[],c=[];for(let L=0;L<n.count;L++)u[L]=new H,c[L]=new H;const f=new H,d=new H,m=new H,g=new Oe,_=new Oe,v=new Oe,S=new H,b=new H;function x(L,P,D){f.fromBufferAttribute(n,L),d.fromBufferAttribute(n,P),m.fromBufferAttribute(n,D),g.fromBufferAttribute(s,L),_.fromBufferAttribute(s,P),v.fromBufferAttribute(s,D),d.sub(f),m.sub(f),_.sub(g),v.sub(g);const I=1/(_.x*v.y-v.x*_.y);isFinite(I)&&(S.copy(d).multiplyScalar(v.y).addScaledVector(m,-_.y).multiplyScalar(I),b.copy(m).multiplyScalar(_.x).addScaledVector(d,-v.x).multiplyScalar(I),u[L].add(S),u[P].add(S),u[D].add(S),c[L].add(b),c[P].add(b),c[D].add(b))}let E=this.groups;E.length===0&&(E=[{start:0,count:e.count}]);for(let L=0,P=E.length;L<P;++L){const D=E[L],I=D.start,j=D.count;for(let J=I,ue=I+j;J<ue;J+=3)x(e.getX(J+0),e.getX(J+1),e.getX(J+2))}const M=new H,A=new H,C=new H,w=new H;function N(L){C.fromBufferAttribute(r,L),w.copy(C);const P=u[L];M.copy(P),M.sub(C.multiplyScalar(C.dot(P))).normalize(),A.crossVectors(w,P);const I=A.dot(c[L])<0?-1:1;o.setXYZW(L,M.x,M.y,M.z,I)}for(let L=0,P=E.length;L<P;++L){const D=E[L],I=D.start,j=D.count;for(let J=I,ue=I+j;J<ue;J+=3)N(e.getX(J+0)),N(e.getX(J+1)),N(e.getX(J+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Fi(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let g=0,_=n.count;g<_;g++)n.setXYZ(g,0,0,0);const r=new H,s=new H,o=new H,u=new H,c=new H,f=new H,d=new H,m=new H;if(e)for(let g=0,_=e.count;g<_;g+=3){const v=e.getX(g+0),S=e.getX(g+1),b=e.getX(g+2);r.fromBufferAttribute(t,v),s.fromBufferAttribute(t,S),o.fromBufferAttribute(t,b),d.subVectors(o,s),m.subVectors(r,s),d.cross(m),u.fromBufferAttribute(n,v),c.fromBufferAttribute(n,S),f.fromBufferAttribute(n,b),u.add(d),c.add(d),f.add(d),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(S,c.x,c.y,c.z),n.setXYZ(b,f.x,f.y,f.z)}else for(let g=0,_=t.count;g<_;g+=3)r.fromBufferAttribute(t,g+0),s.fromBufferAttribute(t,g+1),o.fromBufferAttribute(t,g+2),d.subVectors(o,s),m.subVectors(r,s),d.cross(m),n.setXYZ(g+0,d.x,d.y,d.z),n.setXYZ(g+1,d.x,d.y,d.z),n.setXYZ(g+2,d.x,d.y,d.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ai.fromBufferAttribute(e,t),Ai.normalize(),e.setXYZ(t,Ai.x,Ai.y,Ai.z)}toNonIndexed(){function e(u,c){const f=u.array,d=u.itemSize,m=u.normalized,g=new f.constructor(c.length*d);let _=0,v=0;for(let S=0,b=c.length;S<b;S++){u.isInterleavedBufferAttribute?_=c[S]*u.data.stride+u.offset:_=c[S]*d;for(let x=0;x<d;x++)g[v++]=f[_++]}return new Fi(g,d,m)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new rr,n=this.index.array,r=this.attributes;for(const u in r){const c=r[u],f=e(c,n);t.setAttribute(u,f)}const s=this.morphAttributes;for(const u in s){const c=[],f=s[u];for(let d=0,m=f.length;d<m;d++){const g=f[d],_=e(g,n);c.push(_)}t.morphAttributes[u]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let u=0,c=o.length;u<c;u++){const f=o[u];t.addGroup(f.start,f.count,f.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const f in c)c[f]!==void 0&&(e[f]=c[f]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const f=n[c];e.data.attributes[c]=f.toJSON(e.data)}const r={};let s=!1;for(const c in this.morphAttributes){const f=this.morphAttributes[c],d=[];for(let m=0,g=f.length;m<g;m++){const _=f[m];d.push(_.toJSON(e.data))}d.length>0&&(r[c]=d,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const r=e.attributes;for(const f in r){const d=r[f];this.setAttribute(f,d.clone(t))}const s=e.morphAttributes;for(const f in s){const d=[],m=s[f];for(let g=0,_=m.length;g<_;g++)d.push(m[g].clone(t));this.morphAttributes[f]=d}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let f=0,d=o.length;f<d;f++){const m=o[f];this.addGroup(m.start,m.count,m.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const sw=new qt,bl=new Xg,cm=new Nd,aw=new H,hm=new H,fm=new H,dm=new H,e0=new H,pm=new H,ow=new H,mm=new H;class oi extends li{constructor(e=new rr,t=new Gs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const u=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const u=this.morphTargetInfluences;if(s&&u){pm.set(0,0,0);for(let c=0,f=s.length;c<f;c++){const d=u[c],m=s[c];d!==0&&(e0.fromBufferAttribute(m,e),o?pm.addScaledVector(e0,d):pm.addScaledVector(e0.sub(t),d))}t.add(pm)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),cm.copy(n.boundingSphere),cm.applyMatrix4(s),bl.copy(e.ray).recast(e.near),!(cm.containsPoint(bl.origin)===!1&&(bl.intersectSphere(cm,aw)===null||bl.origin.distanceToSquared(aw)>(e.far-e.near)**2))&&(sw.copy(s).invert(),bl.copy(e.ray).applyMatrix4(sw),!(n.boundingBox!==null&&bl.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,bl)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,u=s.index,c=s.attributes.position,f=s.attributes.uv,d=s.attributes.uv1,m=s.attributes.normal,g=s.groups,_=s.drawRange;if(u!==null)if(Array.isArray(o))for(let v=0,S=g.length;v<S;v++){const b=g[v],x=o[b.materialIndex],E=Math.max(b.start,_.start),M=Math.min(u.count,Math.min(b.start+b.count,_.start+_.count));for(let A=E,C=M;A<C;A+=3){const w=u.getX(A),N=u.getX(A+1),L=u.getX(A+2);r=gm(this,x,e,n,f,d,m,w,N,L),r&&(r.faceIndex=Math.floor(A/3),r.face.materialIndex=b.materialIndex,t.push(r))}}else{const v=Math.max(0,_.start),S=Math.min(u.count,_.start+_.count);for(let b=v,x=S;b<x;b+=3){const E=u.getX(b),M=u.getX(b+1),A=u.getX(b+2);r=gm(this,o,e,n,f,d,m,E,M,A),r&&(r.faceIndex=Math.floor(b/3),t.push(r))}}else if(c!==void 0)if(Array.isArray(o))for(let v=0,S=g.length;v<S;v++){const b=g[v],x=o[b.materialIndex],E=Math.max(b.start,_.start),M=Math.min(c.count,Math.min(b.start+b.count,_.start+_.count));for(let A=E,C=M;A<C;A+=3){const w=A,N=A+1,L=A+2;r=gm(this,x,e,n,f,d,m,w,N,L),r&&(r.faceIndex=Math.floor(A/3),r.face.materialIndex=b.materialIndex,t.push(r))}}else{const v=Math.max(0,_.start),S=Math.min(c.count,_.start+_.count);for(let b=v,x=S;b<x;b+=3){const E=b,M=b+1,A=b+2;r=gm(this,o,e,n,f,d,m,E,M,A),r&&(r.faceIndex=Math.floor(b/3),t.push(r))}}}}function W3(i,e,t,n,r,s,o,u){let c;if(e.side===Tn?c=n.intersectTriangle(o,s,r,!0,u):c=n.intersectTriangle(r,s,o,e.side===xr,u),c===null)return null;mm.copy(u),mm.applyMatrix4(i.matrixWorld);const f=t.ray.origin.distanceTo(mm);return f<t.near||f>t.far?null:{distance:f,point:mm.clone(),object:i}}function gm(i,e,t,n,r,s,o,u,c,f){i.getVertexPosition(u,hm),i.getVertexPosition(c,fm),i.getVertexPosition(f,dm);const d=W3(i,e,t,n,hm,fm,dm,ow);if(d){const m=new H;Ts.getBarycoord(ow,hm,fm,dm,m),r&&(d.uv=Ts.getInterpolatedAttribute(r,u,c,f,m,new Oe)),s&&(d.uv1=Ts.getInterpolatedAttribute(s,u,c,f,m,new Oe)),o&&(d.normal=Ts.getInterpolatedAttribute(o,u,c,f,m,new H),d.normal.dot(n.direction)>0&&d.normal.multiplyScalar(-1));const g={a:u,b:c,c:f,normal:new H,materialIndex:0};Ts.getNormal(hm,fm,dm,g.normal),d.face=g,d.barycoord=m}return d}class tu extends rr{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const u=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const c=[],f=[],d=[],m=[];let g=0,_=0;v("z","y","x",-1,-1,n,t,e,o,s,0),v("z","y","x",1,-1,n,t,-e,o,s,1),v("x","z","y",1,1,e,n,t,r,o,2),v("x","z","y",1,-1,e,n,-t,r,o,3),v("x","y","z",1,-1,e,t,n,r,s,4),v("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(c),this.setAttribute("position",new Kn(f,3)),this.setAttribute("normal",new Kn(d,3)),this.setAttribute("uv",new Kn(m,2));function v(S,b,x,E,M,A,C,w,N,L,P){const D=A/N,I=C/L,j=A/2,J=C/2,ue=w/2,$=N+1,k=L+1;let G=0,W=0;const ce=new H;for(let z=0;z<k;z++){const le=z*I-J;for(let Ee=0;Ee<$;Ee++){const De=Ee*D-j;ce[S]=De*E,ce[b]=le*M,ce[x]=ue,f.push(ce.x,ce.y,ce.z),ce[S]=0,ce[b]=0,ce[x]=w>0?1:-1,d.push(ce.x,ce.y,ce.z),m.push(Ee/N),m.push(1-z/L),G+=1}}for(let z=0;z<L;z++)for(let le=0;le<N;le++){const Ee=g+le+$*z,De=g+le+$*(z+1),q=g+(le+1)+$*(z+1),Z=g+(le+1)+$*z;c.push(Ee,De,Z),c.push(De,q,Z),W+=6}u.addGroup(_,W,P),_+=W,g+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tu(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function kc(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function Zi(i){const e={};for(let t=0;t<i.length;t++){const n=kc(i[t]);for(const r in n)e[r]=n[r]}return e}function q3(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function oN(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Ft.workingColorSpace}const lN={clone:kc,merge:Zi};var $3=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,X3=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Xs extends Yi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=$3,this.fragmentShader=X3,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=kc(e.uniforms),this.uniformsGroups=q3(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class tS extends li{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new qt,this.projectionMatrix=new qt,this.projectionMatrixInverse=new qt,this.coordinateSystem=gr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Do=new H,lw=new Oe,uw=new Oe;class Ci extends tS{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Yl*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Of*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Yl*2*Math.atan(Math.tan(Of*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Do.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Do.x,Do.y).multiplyScalar(-e/Do.z),Do.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Do.x,Do.y).multiplyScalar(-e/Do.z)}getViewSize(e,t){return this.getViewBounds(e,lw,uw),t.subVectors(uw,lw)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Of*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,f=o.fullHeight;s+=o.offsetX*r/c,t-=o.offsetY*n/f,r*=o.width/c,n*=o.height/f}const u=this.filmOffset;u!==0&&(s+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Wu=-90,qu=1;class uN extends li{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ci(Wu,qu,e,t);r.layers=this.layers,this.add(r);const s=new Ci(Wu,qu,e,t);s.layers=this.layers,this.add(s);const o=new Ci(Wu,qu,e,t);o.layers=this.layers,this.add(o);const u=new Ci(Wu,qu,e,t);u.layers=this.layers,this.add(u);const c=new Ci(Wu,qu,e,t);c.layers=this.layers,this.add(c);const f=new Ci(Wu,qu,e,t);f.layers=this.layers,this.add(f)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,u,c]=t;for(const f of t)this.remove(f);if(e===gr)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===qo)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const f of t)this.add(f),f.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,u,c,f,d]=this.children,m=e.getRenderTarget(),g=e.getActiveCubeFace(),_=e.getActiveMipmapLevel(),v=e.xr.enabled;e.xr.enabled=!1;const S=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,u),e.setRenderTarget(n,3,r),e.render(t,c),e.setRenderTarget(n,4,r),e.render(t,f),n.texture.generateMipmaps=S,e.setRenderTarget(n,5,r),e.render(t,d),e.setRenderTarget(m,g,_),e.xr.enabled=v,n.texture.needsPMREMUpdate=!0}}class Yg extends _i{constructor(e=[],t=os,n,r,s,o,u,c,f,d){super(e,t,n,r,s,o,u,c,f,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class cN extends $o{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new Yg(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:gi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new tu(5,5,5),s=new Xs({name:"CubemapFromEquirect",uniforms:kc(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Tn,blending:br});s.uniforms.tEquirect.value=t;const o=new oi(r,s),u=t.minFilter;return t.minFilter===mr&&(t.minFilter=gi),new uN(1,10,this).update(e,o),t.minFilter=u,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}}let lc=class extends li{constructor(){super(),this.isGroup=!0,this.type="Group"}};const Y3={type:"move"};class ig{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new lc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new lc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new H,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new H),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new lc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new H,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new H),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const u=this._targetRay,c=this._grip,f=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(f&&e.hand){o=!0;for(const S of e.hand.values()){const b=t.getJointPose(S,n),x=this._getHandJoint(f,S);b!==null&&(x.matrix.fromArray(b.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.matrixWorldNeedsUpdate=!0,x.jointRadius=b.radius),x.visible=b!==null}const d=f.joints["index-finger-tip"],m=f.joints["thumb-tip"],g=d.position.distanceTo(m.position),_=.02,v=.005;f.inputState.pinching&&g>_+v?(f.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!f.inputState.pinching&&g<=_-v&&(f.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));u!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(u.matrix.fromArray(r.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,r.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(r.linearVelocity)):u.hasLinearVelocity=!1,r.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(r.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(Y3)))}return u!==null&&(u.visible=r!==null),c!==null&&(c.visible=s!==null),f!==null&&(f.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new lc;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Kg extends li{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Tr,this.environmentIntensity=1,this.environmentRotation=new Tr,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class hN{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=vg,this.updateRanges=[],this.version=0,this.uuid=za()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=za()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=za()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Qi=new H;class nS{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Qi.fromBufferAttribute(this,t),Qi.applyMatrix4(e),this.setXYZ(t,Qi.x,Qi.y,Qi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Qi.fromBufferAttribute(this,t),Qi.applyNormalMatrix(e),this.setXYZ(t,Qi.x,Qi.y,Qi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Qi.fromBufferAttribute(this,t),Qi.transformDirection(e),this.setXYZ(t,Qi.x,Qi.y,Qi.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=er(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Pt(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Pt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Pt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Pt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Pt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=er(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=er(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=er(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=er(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),r=Pt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),r=Pt(r,this.array),s=Pt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Fi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new nS(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class K3 extends Yi{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new it(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class Q3 extends _i{constructor(e=null,t=1,n=1,r,s,o,u,c,f=Rn,d=Rn,m,g){super(null,o,u,c,f,d,r,s,m,g),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Z3 extends Fi{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const t0=new H,J3=new H,eF=new Mt;class bs{constructor(e=new H(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=t0.subVectors(n,t).cross(J3.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(t0),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||eF.getNormalMatrix(e),r=this.coplanarPoint(t0).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Sl=new Nd,_m=new H;class Qg{constructor(e=new bs,t=new bs,n=new bs,r=new bs,s=new bs,o=new bs){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const u=this.planes;return u[0].copy(e),u[1].copy(t),u[2].copy(n),u[3].copy(r),u[4].copy(s),u[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=gr){const n=this.planes,r=e.elements,s=r[0],o=r[1],u=r[2],c=r[3],f=r[4],d=r[5],m=r[6],g=r[7],_=r[8],v=r[9],S=r[10],b=r[11],x=r[12],E=r[13],M=r[14],A=r[15];if(n[0].setComponents(c-s,g-f,b-_,A-x).normalize(),n[1].setComponents(c+s,g+f,b+_,A+x).normalize(),n[2].setComponents(c+o,g+d,b+v,A+E).normalize(),n[3].setComponents(c-o,g-d,b-v,A-E).normalize(),n[4].setComponents(c-u,g-m,b-S,A-M).normalize(),t===gr)n[5].setComponents(c+u,g+m,b+S,A+M).normalize();else if(t===qo)n[5].setComponents(u,m,S,M).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Sl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Sl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Sl)}intersectsSprite(e){return Sl.center.set(0,0,0),Sl.radius=.7071067811865476,Sl.applyMatrix4(e.matrixWorld),this.intersectsSphere(Sl)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(_m.x=r.normal.x>0?e.max.x:e.min.x,_m.y=r.normal.y>0?e.max.y:e.min.y,_m.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(_m)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Zg extends Yi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new it(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const xg=new H,bg=new H,cw=new qt,af=new Xg,vm=new Nd,n0=new H,hw=new H;class tF extends li{constructor(e=new rr,t=new Zg){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)xg.fromBufferAttribute(t,r-1),bg.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=xg.distanceTo(bg);e.setAttribute("lineDistance",new Kn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),vm.copy(n.boundingSphere),vm.applyMatrix4(r),vm.radius+=s,e.ray.intersectsSphere(vm)===!1)return;cw.copy(r).invert(),af.copy(e.ray).applyMatrix4(cw);const u=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,f=this.isLineSegments?2:1,d=n.index,g=n.attributes.position;if(d!==null){const _=Math.max(0,o.start),v=Math.min(d.count,o.start+o.count);for(let S=_,b=v-1;S<b;S+=f){const x=d.getX(S),E=d.getX(S+1),M=ym(this,e,af,c,x,E,S);M&&t.push(M)}if(this.isLineLoop){const S=d.getX(v-1),b=d.getX(_),x=ym(this,e,af,c,S,b,v-1);x&&t.push(x)}}else{const _=Math.max(0,o.start),v=Math.min(g.count,o.start+o.count);for(let S=_,b=v-1;S<b;S+=f){const x=ym(this,e,af,c,S,S+1,S);x&&t.push(x)}if(this.isLineLoop){const S=ym(this,e,af,c,v-1,_,v-1);S&&t.push(S)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const u=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=s}}}}}function ym(i,e,t,n,r,s,o){const u=i.geometry.attributes.position;if(xg.fromBufferAttribute(u,r),bg.fromBufferAttribute(u,s),t.distanceSqToSegment(xg,bg,n0,hw)>n)return;n0.applyMatrix4(i.matrixWorld);const f=e.ray.origin.distanceTo(n0);if(!(f<e.near||f>e.far))return{distance:f,point:hw.clone().applyMatrix4(i.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:i}}class nF extends Yi{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new it(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class iF extends _i{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Rn,this.minFilter=Rn,this.generateMipmaps=!1,this.needsUpdate=!0}}class ss extends _i{constructor(e,t,n=Sn,r,s,o,u=Rn,c=Rn,f,d=jr){if(d!==jr&&d!==Wr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,r,s,o,u,c,d,n,f),this.isDepthTexture=!0,this.image={width:e,height:t},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Kb(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class Ka{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let r=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let u=0,c=s-1,f;for(;u<=c;)if(r=Math.floor(u+(c-u)/2),f=n[r]-o,f<0)u=r+1;else if(f>0)c=r-1;else{c=r;break}if(r=c,n[r]===o)return r/(s-1);const d=n[r],g=n[r+1]-d,_=(o-d)/g;return(r+_)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),u=this.getPoint(s),c=t||(o.isVector2?new Oe:new H);return c.copy(u).sub(o).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new H,r=[],s=[],o=[],u=new H,c=new qt;for(let _=0;_<=e;_++){const v=_/e;r[_]=this.getTangentAt(v,new H)}s[0]=new H,o[0]=new H;let f=Number.MAX_VALUE;const d=Math.abs(r[0].x),m=Math.abs(r[0].y),g=Math.abs(r[0].z);d<=f&&(f=d,n.set(1,0,0)),m<=f&&(f=m,n.set(0,1,0)),g<=f&&n.set(0,0,1),u.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],u),o[0].crossVectors(r[0],s[0]);for(let _=1;_<=e;_++){if(s[_]=s[_-1].clone(),o[_]=o[_-1].clone(),u.crossVectors(r[_-1],r[_]),u.length()>Number.EPSILON){u.normalize();const v=Math.acos(Lt(r[_-1].dot(r[_]),-1,1));s[_].applyMatrix4(c.makeRotationAxis(u,v))}o[_].crossVectors(r[_],s[_])}if(t===!0){let _=Math.acos(Lt(s[0].dot(s[e]),-1,1));_/=e,r[0].dot(u.crossVectors(s[0],s[e]))>0&&(_=-_);for(let v=1;v<=e;v++)s[v].applyMatrix4(c.makeRotationAxis(r[v],_*v)),o[v].crossVectors(r[v],s[v])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class fN extends Ka{constructor(e=0,t=0,n=1,r=1,s=0,o=Math.PI*2,u=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=u,this.aRotation=c}getPoint(e,t=new Oe){const n=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const u=this.aStartAngle+e*s;let c=this.aX+this.xRadius*Math.cos(u),f=this.aY+this.yRadius*Math.sin(u);if(this.aRotation!==0){const d=Math.cos(this.aRotation),m=Math.sin(this.aRotation),g=c-this.aX,_=f-this.aY;c=g*d-_*m+this.aX,f=g*m+_*d+this.aY}return n.set(c,f)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class rF extends fN{constructor(e,t,n,r,s,o){super(e,t,n,n,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function iS(){let i=0,e=0,t=0,n=0;function r(s,o,u,c){i=s,e=u,t=-3*s+3*o-2*u-c,n=2*s-2*o+u+c}return{initCatmullRom:function(s,o,u,c,f){r(o,u,f*(u-s),f*(c-o))},initNonuniformCatmullRom:function(s,o,u,c,f,d,m){let g=(o-s)/f-(u-s)/(f+d)+(u-o)/d,_=(u-o)/d-(c-o)/(d+m)+(c-u)/m;g*=d,_*=d,r(o,u,g,_)},calc:function(s){const o=s*s,u=o*s;return i+e*s+t*o+n*u}}}const xm=new H,i0=new iS,r0=new iS,s0=new iS;class sF extends Ka{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new H){const n=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let u=Math.floor(o),c=o-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/s)+1)*s:c===0&&u===s-1&&(u=s-2,c=1);let f,d;this.closed||u>0?f=r[(u-1)%s]:(xm.subVectors(r[0],r[1]).add(r[0]),f=xm);const m=r[u%s],g=r[(u+1)%s];if(this.closed||u+2<s?d=r[(u+2)%s]:(xm.subVectors(r[s-1],r[s-2]).add(r[s-1]),d=xm),this.curveType==="centripetal"||this.curveType==="chordal"){const _=this.curveType==="chordal"?.5:.25;let v=Math.pow(f.distanceToSquared(m),_),S=Math.pow(m.distanceToSquared(g),_),b=Math.pow(g.distanceToSquared(d),_);S<1e-4&&(S=1),v<1e-4&&(v=S),b<1e-4&&(b=S),i0.initNonuniformCatmullRom(f.x,m.x,g.x,d.x,v,S,b),r0.initNonuniformCatmullRom(f.y,m.y,g.y,d.y,v,S,b),s0.initNonuniformCatmullRom(f.z,m.z,g.z,d.z,v,S,b)}else this.curveType==="catmullrom"&&(i0.initCatmullRom(f.x,m.x,g.x,d.x,this.tension),r0.initCatmullRom(f.y,m.y,g.y,d.y,this.tension),s0.initCatmullRom(f.z,m.z,g.z,d.z,this.tension));return n.set(i0.calc(c),r0.calc(c),s0.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new H().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function fw(i,e,t,n,r){const s=(n-e)*.5,o=(r-t)*.5,u=i*i,c=i*u;return(2*t-2*n+s+o)*c+(-3*t+3*n-2*s-o)*u+s*i+t}function aF(i,e){const t=1-i;return t*t*e}function oF(i,e){return 2*(1-i)*i*e}function lF(i,e){return i*i*e}function Ff(i,e,t,n){return aF(i,e)+oF(i,t)+lF(i,n)}function uF(i,e){const t=1-i;return t*t*t*e}function cF(i,e){const t=1-i;return 3*t*t*i*e}function hF(i,e){return 3*(1-i)*i*i*e}function fF(i,e){return i*i*i*e}function If(i,e,t,n,r){return uF(i,e)+cF(i,t)+hF(i,n)+fF(i,r)}class dF extends Ka{constructor(e=new Oe,t=new Oe,n=new Oe,r=new Oe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Oe){const n=t,r=this.v0,s=this.v1,o=this.v2,u=this.v3;return n.set(If(e,r.x,s.x,o.x,u.x),If(e,r.y,s.y,o.y,u.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class dN extends Ka{constructor(e=new H,t=new H,n=new H,r=new H){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new H){const n=t,r=this.v0,s=this.v1,o=this.v2,u=this.v3;return n.set(If(e,r.x,s.x,o.x,u.x),If(e,r.y,s.y,o.y,u.y),If(e,r.z,s.z,o.z,u.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class pF extends Ka{constructor(e=new Oe,t=new Oe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Oe){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Oe){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class mF extends Ka{constructor(e=new H,t=new H){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new H){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new H){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class gF extends Ka{constructor(e=new Oe,t=new Oe,n=new Oe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Oe){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(Ff(e,r.x,s.x,o.x),Ff(e,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class rS extends Ka{constructor(e=new H,t=new H,n=new H){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new H){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(Ff(e,r.x,s.x,o.x),Ff(e,r.y,s.y,o.y),Ff(e,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class _F extends Ka{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Oe){const n=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),u=s-o,c=r[o===0?o:o-1],f=r[o],d=r[o>r.length-2?r.length-1:o+1],m=r[o>r.length-3?r.length-1:o+2];return n.set(fw(u,c.x,f.x,d.x,m.x),fw(u,c.y,f.y,d.y,m.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new Oe().fromArray(r))}return this}}var vF=Object.freeze({__proto__:null,ArcCurve:rF,CatmullRomCurve3:sF,CubicBezierCurve:dF,CubicBezierCurve3:dN,EllipseCurve:fN,LineCurve:pF,LineCurve3:mF,QuadraticBezierCurve:gF,QuadraticBezierCurve3:rS,SplineCurve:_F});class Dd extends rr{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,u=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:u,thetaLength:c};const f=this;r=Math.floor(r),s=Math.floor(s);const d=[],m=[],g=[],_=[];let v=0;const S=[],b=n/2;let x=0;E(),o===!1&&(e>0&&M(!0),t>0&&M(!1)),this.setIndex(d),this.setAttribute("position",new Kn(m,3)),this.setAttribute("normal",new Kn(g,3)),this.setAttribute("uv",new Kn(_,2));function E(){const A=new H,C=new H;let w=0;const N=(t-e)/n;for(let L=0;L<=s;L++){const P=[],D=L/s,I=D*(t-e)+e;for(let j=0;j<=r;j++){const J=j/r,ue=J*c+u,$=Math.sin(ue),k=Math.cos(ue);C.x=I*$,C.y=-D*n+b,C.z=I*k,m.push(C.x,C.y,C.z),A.set($,N,k).normalize(),g.push(A.x,A.y,A.z),_.push(J,1-D),P.push(v++)}S.push(P)}for(let L=0;L<r;L++)for(let P=0;P<s;P++){const D=S[P][L],I=S[P+1][L],j=S[P+1][L+1],J=S[P][L+1];(e>0||P!==0)&&(d.push(D,I,J),w+=3),(t>0||P!==s-1)&&(d.push(I,j,J),w+=3)}f.addGroup(x,w,0),x+=w}function M(A){const C=v,w=new Oe,N=new H;let L=0;const P=A===!0?e:t,D=A===!0?1:-1;for(let j=1;j<=r;j++)m.push(0,b*D,0),g.push(0,D,0),_.push(.5,.5),v++;const I=v;for(let j=0;j<=r;j++){const ue=j/r*c+u,$=Math.cos(ue),k=Math.sin(ue);N.x=P*k,N.y=b*D,N.z=P*$,m.push(N.x,N.y,N.z),g.push(0,D,0),w.x=$*.5+.5,w.y=k*.5*D+.5,_.push(w.x,w.y),v++}for(let j=0;j<r;j++){const J=C+j,ue=I+j;A===!0?d.push(ue,ue+1,J):d.push(ue+1,ue,J),L+=3}f.addGroup(x,L,A===!0?1:2),x+=L}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dd(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class sS extends Dd{constructor(e=1,t=1,n=32,r=1,s=!1,o=0,u=Math.PI*2){super(0,e,t,n,r,s,o,u),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:u}}static fromJSON(e){return new sS(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Pd extends rr{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,u=Math.floor(n),c=Math.floor(r),f=u+1,d=c+1,m=e/u,g=t/c,_=[],v=[],S=[],b=[];for(let x=0;x<d;x++){const E=x*g-o;for(let M=0;M<f;M++){const A=M*m-s;v.push(A,-E,0),S.push(0,0,1),b.push(M/u),b.push(1-x/c)}}for(let x=0;x<c;x++)for(let E=0;E<u;E++){const M=E+f*x,A=E+f*(x+1),C=E+1+f*(x+1),w=E+1+f*x;_.push(M,A,w),_.push(A,C,w)}this.setIndex(_),this.setAttribute("position",new Kn(v,3)),this.setAttribute("normal",new Kn(S,3)),this.setAttribute("uv",new Kn(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pd(e.width,e.height,e.widthSegments,e.heightSegments)}}class Ld extends rr{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,o=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:u},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(o+u,Math.PI);let f=0;const d=[],m=new H,g=new H,_=[],v=[],S=[],b=[];for(let x=0;x<=n;x++){const E=[],M=x/n;let A=0;x===0&&o===0?A=.5/t:x===n&&c===Math.PI&&(A=-.5/t);for(let C=0;C<=t;C++){const w=C/t;m.x=-e*Math.cos(r+w*s)*Math.sin(o+M*u),m.y=e*Math.cos(o+M*u),m.z=e*Math.sin(r+w*s)*Math.sin(o+M*u),v.push(m.x,m.y,m.z),g.copy(m).normalize(),S.push(g.x,g.y,g.z),b.push(w+A,1-M),E.push(f++)}d.push(E)}for(let x=0;x<n;x++)for(let E=0;E<t;E++){const M=d[x][E+1],A=d[x][E],C=d[x+1][E],w=d[x+1][E+1];(x!==0||o>0)&&_.push(M,A,w),(x!==n-1||c<Math.PI)&&_.push(A,C,w)}this.setIndex(_),this.setAttribute("position",new Kn(v,3)),this.setAttribute("normal",new Kn(S,3)),this.setAttribute("uv",new Kn(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ld(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class aS extends rr{constructor(e=new rS(new H(-1,-1,0),new H(-1,1,0),new H(1,1,0)),t=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const u=new H,c=new H,f=new Oe;let d=new H;const m=[],g=[],_=[],v=[];S(),this.setIndex(v),this.setAttribute("position",new Kn(m,3)),this.setAttribute("normal",new Kn(g,3)),this.setAttribute("uv",new Kn(_,2));function S(){for(let M=0;M<t;M++)b(M);b(s===!1?t:0),E(),x()}function b(M){d=e.getPointAt(M/t,d);const A=o.normals[M],C=o.binormals[M];for(let w=0;w<=r;w++){const N=w/r*Math.PI*2,L=Math.sin(N),P=-Math.cos(N);c.x=P*A.x+L*C.x,c.y=P*A.y+L*C.y,c.z=P*A.z+L*C.z,c.normalize(),g.push(c.x,c.y,c.z),u.x=d.x+n*c.x,u.y=d.y+n*c.y,u.z=d.z+n*c.z,m.push(u.x,u.y,u.z)}}function x(){for(let M=1;M<=t;M++)for(let A=1;A<=r;A++){const C=(r+1)*(M-1)+(A-1),w=(r+1)*M+(A-1),N=(r+1)*M+A,L=(r+1)*(M-1)+A;v.push(C,w,L),v.push(w,N,L)}}function E(){for(let M=0;M<=t;M++)for(let A=0;A<=r;A++)f.x=M/t,f.y=A/r,_.push(f.x,f.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new aS(new vF[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class yF extends Yi{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new it(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class pN extends Yi{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new it(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ja,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tr,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class xF extends pN{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Oe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Lt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new it(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new it(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new it(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class bF extends Yi{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new it(16777215),this.specular=new it(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ja,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tr,this.combine=wd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class SF extends Yi{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new it(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ja,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class TF extends Yi{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ja,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class mN extends Yi{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new it(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ja,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tr,this.combine=wd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class EF extends Yi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=XB,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class MF extends Yi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class AF extends Yi{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new it(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ja,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class wF extends Zg{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const dw={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class RF{constructor(e,t,n){const r=this;let s=!1,o=0,u=0,c;const f=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(d){u++,s===!1&&r.onStart!==void 0&&r.onStart(d,o,u),s=!0},this.itemEnd=function(d){o++,r.onProgress!==void 0&&r.onProgress(d,o,u),o===u&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(d){r.onError!==void 0&&r.onError(d)},this.resolveURL=function(d){return c?c(d):d},this.setURLModifier=function(d){return c=d,this},this.addHandler=function(d,m){return f.push(d,m),this},this.removeHandler=function(d){const m=f.indexOf(d);return m!==-1&&f.splice(m,2),this},this.getHandler=function(d){for(let m=0,g=f.length;m<g;m+=2){const _=f[m],v=f[m+1];if(_.global&&(_.lastIndex=0),_.test(d))return v}return null}}}const CF=new RF;class oS{constructor(e){this.manager=e!==void 0?e:CF,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}oS.DEFAULT_MATERIAL_NAME="__DEFAULT";class NF extends oS{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=dw.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const u=cd("img");function c(){d(),dw.add(e,this),t&&t(this),s.manager.itemEnd(e)}function f(m){d(),r&&r(m),s.manager.itemError(e),s.manager.itemEnd(e)}function d(){u.removeEventListener("load",c,!1),u.removeEventListener("error",f,!1)}return u.addEventListener("load",c,!1),u.addEventListener("error",f,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(u.crossOrigin=this.crossOrigin),s.manager.itemStart(e),u.src=e,u}}class DF extends oS{constructor(e){super(e)}load(e,t,n,r){const s=new _i,o=new NF(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(u){s.image=u,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}class nu extends li{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new it(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class PF extends nu{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(li.DEFAULT_UP),this.updateMatrix(),this.groundColor=new it(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const a0=new qt,pw=new H,mw=new H;class lS{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Oe(512,512),this.map=null,this.mapPass=null,this.matrix=new qt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Qg,this._frameExtents=new Oe(1,1),this._viewportCount=1,this._viewports=[new xt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;pw.setFromMatrixPosition(e.matrixWorld),t.position.copy(pw),mw.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(mw),t.updateMatrixWorld(),a0.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a0),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(a0)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class LF extends lS{constructor(){super(new Ci(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=Yl*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class gN extends nu{constructor(e,t,n=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(li.DEFAULT_UP),this.updateMatrix(),this.target=new li,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new LF}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const gw=new qt,of=new H,o0=new H;class UF extends lS{constructor(){super(new Ci(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Oe(4,2),this._viewportCount=6,this._viewports=[new xt(2,1,1,1),new xt(0,1,1,1),new xt(3,1,1,1),new xt(1,1,1,1),new xt(3,0,1,1),new xt(1,0,1,1)],this._cubeDirections=[new H(1,0,0),new H(-1,0,0),new H(0,0,1),new H(0,0,-1),new H(0,1,0),new H(0,-1,0)],this._cubeUps=[new H(0,1,0),new H(0,1,0),new H(0,1,0),new H(0,1,0),new H(0,0,1),new H(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),of.setFromMatrixPosition(e.matrixWorld),n.position.copy(of),o0.copy(n.position),o0.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o0),n.updateMatrixWorld(),r.makeTranslation(-of.x,-of.y,-of.z),gw.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gw)}}class OF extends nu{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new UF}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Ud extends tS{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,u=r+t,c=r-t;if(this.view!==null&&this.view.enabled){const f=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=f*this.view.offsetX,o=s+f*this.view.width,u-=d*this.view.offsetY,c=u-d*this.view.height}this.projectionMatrix.makeOrthographic(s,o,u,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class BF extends lS{constructor(){super(new Ud(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class _N extends nu{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(li.DEFAULT_UP),this.updateMatrix(),this.target=new li,this.shadow=new BF}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class vN extends nu{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class FF extends nu{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class IF{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new H)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}class zF extends nu{constructor(e=new IF,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class yN extends Ci{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class xN{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=_w(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=_w();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function _w(){return performance.now()}class kF extends hN{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const vw=new qt;class bN{constructor(e,t,n=0,r=1/0){this.ray=new Xg(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Zb,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return vw.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(vw),this}intersectObject(e,t=!0,n=[]){return Ox(e,this,n,t),n.sort(yw),n}intersectObjects(e,t=!0,n=[]){for(let r=0,s=e.length;r<s;r++)Ox(e[r],this,n,t);return n.sort(yw),n}}function yw(i,e){return i.distance-e.distance}function Ox(i,e,t,n){let r=!0;if(i.layers.test(e.layers)&&i.raycast(e,t)===!1&&(r=!1),r===!0&&n===!0){const s=i.children;for(let o=0,u=s.length;o<u;o++)Ox(s[o],e,t,!0)}}class xw{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Lt(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Lt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Jg{constructor(e,t,n,r){Jg.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=r,this}}class e_ extends Ya{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function bw(i,e,t,n){const r=GF(n);switch(t){case Ib:return i*e;case zb:return i*e;case kb:return i*e*2;case Cd:return i*e/r.components*r.byteLength;case Qc:return i*e/r.components*r.byteLength;case Xl:return i*e*2/r.components*r.byteLength;case Zc:return i*e*2/r.components*r.byteLength;case Rd:return i*e*3/r.components*r.byteLength;case qn:return i*e*4/r.components*r.byteLength;case Jc:return i*e*4/r.components*r.byteLength;case Gl:case Io:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case zo:case ko:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case id:case sd:return Math.max(i,16)*Math.max(e,8)/4;case nd:case rd:return Math.max(i,8)*Math.max(e,8)/2;case ad:case Ec:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case Mc:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case Ac:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case wc:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case Rc:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case Cc:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case Nc:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case Dc:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case Pc:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case Lc:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case Uc:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case Oc:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case Bc:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case Fc:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case Ic:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case zc:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case Vl:case Px:case Lx:return Math.ceil(i/4)*Math.ceil(e/4)*16;case Gb:case od:return Math.ceil(i/4)*Math.ceil(e/4)*8;case ld:case ud:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function GF(i){switch(i){case Wn:case zl:return{byteLength:1,components:1};case Ms:case kl:case Xi:return{byteLength:2,components:1};case Hg:case jg:return{byteLength:2,components:4};case Sn:case Ri:case Yn:return{byteLength:4,components:1};case Wg:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Kc}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Kc);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function SN(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function VF(i){const e=new WeakMap;function t(u,c){const f=u.array,d=u.usage,m=f.byteLength,g=i.createBuffer();i.bindBuffer(c,g),i.bufferData(c,f,d),u.onUploadCallback();let _;if(f instanceof Float32Array)_=i.FLOAT;else if(f instanceof Uint16Array)u.isFloat16BufferAttribute?_=i.HALF_FLOAT:_=i.UNSIGNED_SHORT;else if(f instanceof Int16Array)_=i.SHORT;else if(f instanceof Uint32Array)_=i.UNSIGNED_INT;else if(f instanceof Int32Array)_=i.INT;else if(f instanceof Int8Array)_=i.BYTE;else if(f instanceof Uint8Array)_=i.UNSIGNED_BYTE;else if(f instanceof Uint8ClampedArray)_=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);return{buffer:g,type:_,bytesPerElement:f.BYTES_PER_ELEMENT,version:u.version,size:m}}function n(u,c,f){const d=c.array,m=c.updateRanges;if(i.bindBuffer(f,u),m.length===0)i.bufferSubData(f,0,d);else{m.sort((_,v)=>_.start-v.start);let g=0;for(let _=1;_<m.length;_++){const v=m[g],S=m[_];S.start<=v.start+v.count+1?v.count=Math.max(v.count,S.start+S.count-v.start):(++g,m[g]=S)}m.length=g+1;for(let _=0,v=m.length;_<v;_++){const S=m[_];i.bufferSubData(f,S.start*d.BYTES_PER_ELEMENT,d,S.start,S.count)}c.clearUpdateRanges()}c.onUploadCallback()}function r(u){return u.isInterleavedBufferAttribute&&(u=u.data),e.get(u)}function s(u){u.isInterleavedBufferAttribute&&(u=u.data);const c=e.get(u);c&&(i.deleteBuffer(c.buffer),e.delete(u))}function o(u,c){if(u.isInterleavedBufferAttribute&&(u=u.data),u.isGLBufferAttribute){const d=e.get(u);(!d||d.version<u.version)&&e.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}const f=e.get(u);if(f===void 0)e.set(u,t(u,c));else if(f.version<u.version){if(f.size!==u.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(f.buffer,u,c),f.version=u.version}}return{get:r,remove:s,update:o}}var HF=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,jF=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,WF=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,qF=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,$F=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,XF=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,YF=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,KF=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,QF=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,ZF=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,JF=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,eI=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,tI=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,nI=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,iI=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,rI=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,sI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,aI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,oI=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,lI=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,uI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,cI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,hI=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,fI=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,dI=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,pI=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,mI=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,gI=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,_I=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,vI=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,yI="gl_FragColor = linearToOutputTexel( gl_FragColor );",xI=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,bI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,SI=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,TI=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,EI=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,MI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,AI=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,wI=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,RI=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,CI=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,NI=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,DI=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,PI=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,LI=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,UI=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,OI=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,BI=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,FI=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,II=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,zI=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,kI=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,GI=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,VI=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,HI=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,jI=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,WI=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,qI=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,$I=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,XI=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,YI=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,KI=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,QI=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,ZI=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,JI=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,ez=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,tz=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,nz=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,iz=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,rz=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,sz=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,az=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,oz=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,lz=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,uz=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,cz=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,hz=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,fz=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,dz=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,pz=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,mz=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,gz=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,_z=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,vz=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,yz=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,xz=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,bz=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Sz=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Tz=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Ez=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Mz=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Az=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,wz=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Rz=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Cz=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Nz=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Dz=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Pz=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Lz=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Uz=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Oz=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Bz=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Fz=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Iz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,zz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,kz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Gz=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Vz=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Hz=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,jz=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Wz=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,qz=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$z=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Xz=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Yz=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Kz=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Qz=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Zz=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Jz=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ek=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,tk=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,nk=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,ik=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rk=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sk=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ak=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ok=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lk=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,uk=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,ck=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hk=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fk=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,dk=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pk=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,mk=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,gk=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,_k=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vk=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yk=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,xk=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,bk=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Bt={alphahash_fragment:HF,alphahash_pars_fragment:jF,alphamap_fragment:WF,alphamap_pars_fragment:qF,alphatest_fragment:$F,alphatest_pars_fragment:XF,aomap_fragment:YF,aomap_pars_fragment:KF,batching_pars_vertex:QF,batching_vertex:ZF,begin_vertex:JF,beginnormal_vertex:eI,bsdfs:tI,iridescence_fragment:nI,bumpmap_pars_fragment:iI,clipping_planes_fragment:rI,clipping_planes_pars_fragment:sI,clipping_planes_pars_vertex:aI,clipping_planes_vertex:oI,color_fragment:lI,color_pars_fragment:uI,color_pars_vertex:cI,color_vertex:hI,common:fI,cube_uv_reflection_fragment:dI,defaultnormal_vertex:pI,displacementmap_pars_vertex:mI,displacementmap_vertex:gI,emissivemap_fragment:_I,emissivemap_pars_fragment:vI,colorspace_fragment:yI,colorspace_pars_fragment:xI,envmap_fragment:bI,envmap_common_pars_fragment:SI,envmap_pars_fragment:TI,envmap_pars_vertex:EI,envmap_physical_pars_fragment:OI,envmap_vertex:MI,fog_vertex:AI,fog_pars_vertex:wI,fog_fragment:RI,fog_pars_fragment:CI,gradientmap_pars_fragment:NI,lightmap_pars_fragment:DI,lights_lambert_fragment:PI,lights_lambert_pars_fragment:LI,lights_pars_begin:UI,lights_toon_fragment:BI,lights_toon_pars_fragment:FI,lights_phong_fragment:II,lights_phong_pars_fragment:zI,lights_physical_fragment:kI,lights_physical_pars_fragment:GI,lights_fragment_begin:VI,lights_fragment_maps:HI,lights_fragment_end:jI,logdepthbuf_fragment:WI,logdepthbuf_pars_fragment:qI,logdepthbuf_pars_vertex:$I,logdepthbuf_vertex:XI,map_fragment:YI,map_pars_fragment:KI,map_particle_fragment:QI,map_particle_pars_fragment:ZI,metalnessmap_fragment:JI,metalnessmap_pars_fragment:ez,morphinstance_vertex:tz,morphcolor_vertex:nz,morphnormal_vertex:iz,morphtarget_pars_vertex:rz,morphtarget_vertex:sz,normal_fragment_begin:az,normal_fragment_maps:oz,normal_pars_fragment:lz,normal_pars_vertex:uz,normal_vertex:cz,normalmap_pars_fragment:hz,clearcoat_normal_fragment_begin:fz,clearcoat_normal_fragment_maps:dz,clearcoat_pars_fragment:pz,iridescence_pars_fragment:mz,opaque_fragment:gz,packing:_z,premultiplied_alpha_fragment:vz,project_vertex:yz,dithering_fragment:xz,dithering_pars_fragment:bz,roughnessmap_fragment:Sz,roughnessmap_pars_fragment:Tz,shadowmap_pars_fragment:Ez,shadowmap_pars_vertex:Mz,shadowmap_vertex:Az,shadowmask_pars_fragment:wz,skinbase_vertex:Rz,skinning_pars_vertex:Cz,skinning_vertex:Nz,skinnormal_vertex:Dz,specularmap_fragment:Pz,specularmap_pars_fragment:Lz,tonemapping_fragment:Uz,tonemapping_pars_fragment:Oz,transmission_fragment:Bz,transmission_pars_fragment:Fz,uv_pars_fragment:Iz,uv_pars_vertex:zz,uv_vertex:kz,worldpos_vertex:Gz,background_vert:Vz,background_frag:Hz,backgroundCube_vert:jz,backgroundCube_frag:Wz,cube_vert:qz,cube_frag:$z,depth_vert:Xz,depth_frag:Yz,distanceRGBA_vert:Kz,distanceRGBA_frag:Qz,equirect_vert:Zz,equirect_frag:Jz,linedashed_vert:ek,linedashed_frag:tk,meshbasic_vert:nk,meshbasic_frag:ik,meshlambert_vert:rk,meshlambert_frag:sk,meshmatcap_vert:ak,meshmatcap_frag:ok,meshnormal_vert:lk,meshnormal_frag:uk,meshphong_vert:ck,meshphong_frag:hk,meshphysical_vert:fk,meshphysical_frag:dk,meshtoon_vert:pk,meshtoon_frag:mk,points_vert:gk,points_frag:_k,shadow_vert:vk,shadow_frag:yk,sprite_vert:xk,sprite_frag:bk},Xe={common:{diffuse:{value:new it(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Mt},alphaMap:{value:null},alphaMapTransform:{value:new Mt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Mt}},envmap:{envMap:{value:null},envMapRotation:{value:new Mt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Mt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Mt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Mt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Mt},normalScale:{value:new Oe(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Mt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Mt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Mt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Mt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new it(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new it(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Mt},alphaTest:{value:0},uvTransform:{value:new Mt}},sprite:{diffuse:{value:new it(16777215)},opacity:{value:1},center:{value:new Oe(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Mt},alphaMap:{value:null},alphaMapTransform:{value:new Mt},alphaTest:{value:0}}},ks={basic:{uniforms:Zi([Xe.common,Xe.specularmap,Xe.envmap,Xe.aomap,Xe.lightmap,Xe.fog]),vertexShader:Bt.meshbasic_vert,fragmentShader:Bt.meshbasic_frag},lambert:{uniforms:Zi([Xe.common,Xe.specularmap,Xe.envmap,Xe.aomap,Xe.lightmap,Xe.emissivemap,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.fog,Xe.lights,{emissive:{value:new it(0)}}]),vertexShader:Bt.meshlambert_vert,fragmentShader:Bt.meshlambert_frag},phong:{uniforms:Zi([Xe.common,Xe.specularmap,Xe.envmap,Xe.aomap,Xe.lightmap,Xe.emissivemap,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.fog,Xe.lights,{emissive:{value:new it(0)},specular:{value:new it(1118481)},shininess:{value:30}}]),vertexShader:Bt.meshphong_vert,fragmentShader:Bt.meshphong_frag},standard:{uniforms:Zi([Xe.common,Xe.envmap,Xe.aomap,Xe.lightmap,Xe.emissivemap,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.roughnessmap,Xe.metalnessmap,Xe.fog,Xe.lights,{emissive:{value:new it(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Bt.meshphysical_vert,fragmentShader:Bt.meshphysical_frag},toon:{uniforms:Zi([Xe.common,Xe.aomap,Xe.lightmap,Xe.emissivemap,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.gradientmap,Xe.fog,Xe.lights,{emissive:{value:new it(0)}}]),vertexShader:Bt.meshtoon_vert,fragmentShader:Bt.meshtoon_frag},matcap:{uniforms:Zi([Xe.common,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,Xe.fog,{matcap:{value:null}}]),vertexShader:Bt.meshmatcap_vert,fragmentShader:Bt.meshmatcap_frag},points:{uniforms:Zi([Xe.points,Xe.fog]),vertexShader:Bt.points_vert,fragmentShader:Bt.points_frag},dashed:{uniforms:Zi([Xe.common,Xe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Bt.linedashed_vert,fragmentShader:Bt.linedashed_frag},depth:{uniforms:Zi([Xe.common,Xe.displacementmap]),vertexShader:Bt.depth_vert,fragmentShader:Bt.depth_frag},normal:{uniforms:Zi([Xe.common,Xe.bumpmap,Xe.normalmap,Xe.displacementmap,{opacity:{value:1}}]),vertexShader:Bt.meshnormal_vert,fragmentShader:Bt.meshnormal_frag},sprite:{uniforms:Zi([Xe.sprite,Xe.fog]),vertexShader:Bt.sprite_vert,fragmentShader:Bt.sprite_frag},background:{uniforms:{uvTransform:{value:new Mt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Bt.background_vert,fragmentShader:Bt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Mt}},vertexShader:Bt.backgroundCube_vert,fragmentShader:Bt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Bt.cube_vert,fragmentShader:Bt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Bt.equirect_vert,fragmentShader:Bt.equirect_frag},distanceRGBA:{uniforms:Zi([Xe.common,Xe.displacementmap,{referencePosition:{value:new H},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Bt.distanceRGBA_vert,fragmentShader:Bt.distanceRGBA_frag},shadow:{uniforms:Zi([Xe.lights,Xe.fog,{color:{value:new it(0)},opacity:{value:1}}]),vertexShader:Bt.shadow_vert,fragmentShader:Bt.shadow_frag}};ks.physical={uniforms:Zi([ks.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Mt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Mt},clearcoatNormalScale:{value:new Oe(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Mt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Mt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Mt},sheen:{value:0},sheenColor:{value:new it(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Mt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Mt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Mt},transmissionSamplerSize:{value:new Oe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Mt},attenuationDistance:{value:0},attenuationColor:{value:new it(0)},specularColor:{value:new it(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Mt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Mt},anisotropyVector:{value:new Oe},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Mt}}]),vertexShader:Bt.meshphysical_vert,fragmentShader:Bt.meshphysical_frag};const bm={r:0,b:0,g:0},Tl=new Tr,Sk=new qt;function Tk(i,e,t,n,r,s,o){const u=new it(0);let c=s===!0?0:1,f,d,m=null,g=0,_=null;function v(M){let A=M.isScene===!0?M.background:null;return A&&A.isTexture&&(A=(M.backgroundBlurriness>0?t:e).get(A)),A}function S(M){let A=!1;const C=v(M);C===null?x(u,c):C&&C.isColor&&(x(C,1),A=!0);const w=i.xr.getEnvironmentBlendMode();w==="additive"?n.buffers.color.setClear(0,0,0,1,o):w==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||A)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function b(M,A){const C=v(A);C&&(C.isCubeTexture||C.mapping===Wl)?(d===void 0&&(d=new oi(new tu(1,1,1),new Xs({name:"BackgroundCubeMaterial",uniforms:kc(ks.backgroundCube.uniforms),vertexShader:ks.backgroundCube.vertexShader,fragmentShader:ks.backgroundCube.fragmentShader,side:Tn,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(w,N,L){this.matrixWorld.copyPosition(L.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(d)),Tl.copy(A.backgroundRotation),Tl.x*=-1,Tl.y*=-1,Tl.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(Tl.y*=-1,Tl.z*=-1),d.material.uniforms.envMap.value=C,d.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=A.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,d.material.uniforms.backgroundRotation.value.setFromMatrix4(Sk.makeRotationFromEuler(Tl)),d.material.toneMapped=Ft.getTransfer(C.colorSpace)!==on,(m!==C||g!==C.version||_!==i.toneMapping)&&(d.material.needsUpdate=!0,m=C,g=C.version,_=i.toneMapping),d.layers.enableAll(),M.unshift(d,d.geometry,d.material,0,0,null)):C&&C.isTexture&&(f===void 0&&(f=new oi(new Pd(2,2),new Xs({name:"BackgroundMaterial",uniforms:kc(ks.background.uniforms),vertexShader:ks.background.vertexShader,fragmentShader:ks.background.fragmentShader,side:xr,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),f.geometry.deleteAttribute("normal"),Object.defineProperty(f.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(f)),f.material.uniforms.t2D.value=C,f.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,f.material.toneMapped=Ft.getTransfer(C.colorSpace)!==on,C.matrixAutoUpdate===!0&&C.updateMatrix(),f.material.uniforms.uvTransform.value.copy(C.matrix),(m!==C||g!==C.version||_!==i.toneMapping)&&(f.material.needsUpdate=!0,m=C,g=C.version,_=i.toneMapping),f.layers.enableAll(),M.unshift(f,f.geometry,f.material,0,0,null))}function x(M,A){M.getRGB(bm,oN(i)),n.buffers.color.setClear(bm.r,bm.g,bm.b,A,o)}function E(){d!==void 0&&(d.geometry.dispose(),d.material.dispose(),d=void 0),f!==void 0&&(f.geometry.dispose(),f.material.dispose(),f=void 0)}return{getClearColor:function(){return u},setClearColor:function(M,A=1){u.set(M),c=A,x(u,c)},getClearAlpha:function(){return c},setClearAlpha:function(M){c=M,x(u,c)},render:S,addToRenderList:b,dispose:E}}function Ek(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),n={},r=g(null);let s=r,o=!1;function u(D,I,j,J,ue){let $=!1;const k=m(J,j,I);s!==k&&(s=k,f(s.object)),$=_(D,J,j,ue),$&&v(D,J,j,ue),ue!==null&&e.update(ue,i.ELEMENT_ARRAY_BUFFER),($||o)&&(o=!1,A(D,I,j,J),ue!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(ue).buffer))}function c(){return i.createVertexArray()}function f(D){return i.bindVertexArray(D)}function d(D){return i.deleteVertexArray(D)}function m(D,I,j){const J=j.wireframe===!0;let ue=n[D.id];ue===void 0&&(ue={},n[D.id]=ue);let $=ue[I.id];$===void 0&&($={},ue[I.id]=$);let k=$[J];return k===void 0&&(k=g(c()),$[J]=k),k}function g(D){const I=[],j=[],J=[];for(let ue=0;ue<t;ue++)I[ue]=0,j[ue]=0,J[ue]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:I,enabledAttributes:j,attributeDivisors:J,object:D,attributes:{},index:null}}function _(D,I,j,J){const ue=s.attributes,$=I.attributes;let k=0;const G=j.getAttributes();for(const W in G)if(G[W].location>=0){const z=ue[W];let le=$[W];if(le===void 0&&(W==="instanceMatrix"&&D.instanceMatrix&&(le=D.instanceMatrix),W==="instanceColor"&&D.instanceColor&&(le=D.instanceColor)),z===void 0||z.attribute!==le||le&&z.data!==le.data)return!0;k++}return s.attributesNum!==k||s.index!==J}function v(D,I,j,J){const ue={},$=I.attributes;let k=0;const G=j.getAttributes();for(const W in G)if(G[W].location>=0){let z=$[W];z===void 0&&(W==="instanceMatrix"&&D.instanceMatrix&&(z=D.instanceMatrix),W==="instanceColor"&&D.instanceColor&&(z=D.instanceColor));const le={};le.attribute=z,z&&z.data&&(le.data=z.data),ue[W]=le,k++}s.attributes=ue,s.attributesNum=k,s.index=J}function S(){const D=s.newAttributes;for(let I=0,j=D.length;I<j;I++)D[I]=0}function b(D){x(D,0)}function x(D,I){const j=s.newAttributes,J=s.enabledAttributes,ue=s.attributeDivisors;j[D]=1,J[D]===0&&(i.enableVertexAttribArray(D),J[D]=1),ue[D]!==I&&(i.vertexAttribDivisor(D,I),ue[D]=I)}function E(){const D=s.newAttributes,I=s.enabledAttributes;for(let j=0,J=I.length;j<J;j++)I[j]!==D[j]&&(i.disableVertexAttribArray(j),I[j]=0)}function M(D,I,j,J,ue,$,k){k===!0?i.vertexAttribIPointer(D,I,j,ue,$):i.vertexAttribPointer(D,I,j,J,ue,$)}function A(D,I,j,J){S();const ue=J.attributes,$=j.getAttributes(),k=I.defaultAttributeValues;for(const G in $){const W=$[G];if(W.location>=0){let ce=ue[G];if(ce===void 0&&(G==="instanceMatrix"&&D.instanceMatrix&&(ce=D.instanceMatrix),G==="instanceColor"&&D.instanceColor&&(ce=D.instanceColor)),ce!==void 0){const z=ce.normalized,le=ce.itemSize,Ee=e.get(ce);if(Ee===void 0)continue;const De=Ee.buffer,q=Ee.type,Z=Ee.bytesPerElement,Y=q===i.INT||q===i.UNSIGNED_INT||ce.gpuType===Ri;if(ce.isInterleavedBufferAttribute){const ie=ce.data,xe=ie.stride,Ve=ce.offset;if(ie.isInstancedInterleavedBuffer){for(let ke=0;ke<W.locationSize;ke++)x(W.location+ke,ie.meshPerAttribute);D.isInstancedMesh!==!0&&J._maxInstanceCount===void 0&&(J._maxInstanceCount=ie.meshPerAttribute*ie.count)}else for(let ke=0;ke<W.locationSize;ke++)b(W.location+ke);i.bindBuffer(i.ARRAY_BUFFER,De);for(let ke=0;ke<W.locationSize;ke++)M(W.location+ke,le/W.locationSize,q,z,xe*Z,(Ve+le/W.locationSize*ke)*Z,Y)}else{if(ce.isInstancedBufferAttribute){for(let ie=0;ie<W.locationSize;ie++)x(W.location+ie,ce.meshPerAttribute);D.isInstancedMesh!==!0&&J._maxInstanceCount===void 0&&(J._maxInstanceCount=ce.meshPerAttribute*ce.count)}else for(let ie=0;ie<W.locationSize;ie++)b(W.location+ie);i.bindBuffer(i.ARRAY_BUFFER,De);for(let ie=0;ie<W.locationSize;ie++)M(W.location+ie,le/W.locationSize,q,z,le*Z,le/W.locationSize*ie*Z,Y)}}else if(k!==void 0){const z=k[G];if(z!==void 0)switch(z.length){case 2:i.vertexAttrib2fv(W.location,z);break;case 3:i.vertexAttrib3fv(W.location,z);break;case 4:i.vertexAttrib4fv(W.location,z);break;default:i.vertexAttrib1fv(W.location,z)}}}}E()}function C(){L();for(const D in n){const I=n[D];for(const j in I){const J=I[j];for(const ue in J)d(J[ue].object),delete J[ue];delete I[j]}delete n[D]}}function w(D){if(n[D.id]===void 0)return;const I=n[D.id];for(const j in I){const J=I[j];for(const ue in J)d(J[ue].object),delete J[ue];delete I[j]}delete n[D.id]}function N(D){for(const I in n){const j=n[I];if(j[D.id]===void 0)continue;const J=j[D.id];for(const ue in J)d(J[ue].object),delete J[ue];delete j[D.id]}}function L(){P(),o=!0,s!==r&&(s=r,f(s.object))}function P(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:u,reset:L,resetDefaultState:P,dispose:C,releaseStatesOfGeometry:w,releaseStatesOfProgram:N,initAttributes:S,enableAttribute:b,disableUnusedAttributes:E}}function Mk(i,e,t){let n;function r(f){n=f}function s(f,d){i.drawArrays(n,f,d),t.update(d,n,1)}function o(f,d,m){m!==0&&(i.drawArraysInstanced(n,f,d,m),t.update(d,n,m))}function u(f,d,m){if(m===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,f,0,d,0,m);let _=0;for(let v=0;v<m;v++)_+=d[v];t.update(_,n,1)}function c(f,d,m,g){if(m===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let v=0;v<f.length;v++)o(f[v],d[v],g[v]);else{_.multiDrawArraysInstancedWEBGL(n,f,0,d,0,g,0,m);let v=0;for(let S=0;S<m;S++)v+=d[S]*g[S];t.update(v,n,1)}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=u,this.renderMultiDrawInstances=c}function Ak(i,e,t,n){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const N=e.get("EXT_texture_filter_anisotropic");r=i.getParameter(N.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(N){return!(N!==qn&&n.convert(N)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function u(N){const L=N===Xi&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(N!==Wn&&n.convert(N)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&N!==Yn&&!L)}function c(N){if(N==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";N="mediump"}return N==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let f=t.precision!==void 0?t.precision:"highp";const d=c(f);d!==f&&(console.warn("THREE.WebGLRenderer:",f,"not supported, using",d,"instead."),f=d);const m=t.logarithmicDepthBuffer===!0,g=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),_=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),v=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),S=i.getParameter(i.MAX_TEXTURE_SIZE),b=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),x=i.getParameter(i.MAX_VERTEX_ATTRIBS),E=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),M=i.getParameter(i.MAX_VARYING_VECTORS),A=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),C=v>0,w=i.getParameter(i.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:u,precision:f,logarithmicDepthBuffer:m,reverseDepthBuffer:g,maxTextures:_,maxVertexTextures:v,maxTextureSize:S,maxCubemapSize:b,maxAttributes:x,maxVertexUniforms:E,maxVaryings:M,maxFragmentUniforms:A,vertexTextures:C,maxSamples:w}}function wk(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new bs,u=new Mt,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(m,g){const _=m.length!==0||g||n!==0||r;return r=g,n=m.length,_},this.beginShadows=function(){s=!0,d(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(m,g){t=d(m,g,0)},this.setState=function(m,g,_){const v=m.clippingPlanes,S=m.clipIntersection,b=m.clipShadows,x=i.get(m);if(!r||v===null||v.length===0||s&&!b)s?d(null):f();else{const E=s?0:n,M=E*4;let A=x.clippingState||null;c.value=A,A=d(v,g,M,_);for(let C=0;C!==M;++C)A[C]=t[C];x.clippingState=A,this.numIntersection=S?this.numPlanes:0,this.numPlanes+=E}};function f(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function d(m,g,_,v){const S=m!==null?m.length:0;let b=null;if(S!==0){if(b=c.value,v!==!0||b===null){const x=_+S*4,E=g.matrixWorldInverse;u.getNormalMatrix(E),(b===null||b.length<x)&&(b=new Float32Array(x));for(let M=0,A=_;M!==S;++M,A+=4)o.copy(m[M]).applyMatrix4(E,u),o.normal.toArray(b,A),b[A+3]=o.constant}c.value=b,c.needsUpdate=!0}return e.numPlanes=S,e.numIntersection=0,b}}function Rk(i){let e=new WeakMap;function t(o,u){return u===jo?o.mapping=os:u===Wo&&(o.mapping=ls),o}function n(o){if(o&&o.isTexture){const u=o.mapping;if(u===jo||u===Wo)if(e.has(o)){const c=e.get(o).texture;return t(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const f=new cN(c.height);return f.fromEquirectangularTexture(i,o),e.set(o,f),o.addEventListener("dispose",r),t(f.texture,o.mapping)}else return null}}return o}function r(o){const u=o.target;u.removeEventListener("dispose",r);const c=e.get(u);c!==void 0&&(e.delete(u),c.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const uc=4,Sw=[.125,.215,.35,.446,.526,.582],Ll=20,l0=new Ud,Tw=new it;let u0=null,c0=0,h0=0,f0=!1;const Cl=(1+Math.sqrt(5))/2,$u=1/Cl,Ew=[new H(-Cl,$u,0),new H(Cl,$u,0),new H(-$u,0,Cl),new H($u,0,Cl),new H(0,Cl,-$u),new H(0,Cl,$u),new H(-1,1,-1),new H(1,1,-1),new H(-1,1,1),new H(1,1,1)],Ck=new H;let Mw=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100,s={}){const{size:o=256,position:u=Ck}=s;u0=this._renderer.getRenderTarget(),c0=this._renderer.getActiveCubeFace(),h0=this._renderer.getActiveMipmapLevel(),f0=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,n,r,c,u),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Rw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=ww(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(u0,c0,h0),this._renderer.xr.enabled=f0,e.scissorTest=!1,Sm(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===os||e.mapping===ls?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),u0=this._renderer.getRenderTarget(),c0=this._renderer.getActiveCubeFace(),h0=this._renderer.getActiveMipmapLevel(),f0=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:gi,minFilter:gi,generateMipmaps:!1,type:Xi,format:qn,colorSpace:qs,depthBuffer:!1},r=Aw(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Aw(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Nk(s)),this._blurMaterial=Dk(s,e,t)}return r}_compileMaterial(e){const t=new oi(this._lodPlanes[0],e);this._renderer.compile(t,l0)}_sceneToCubeUV(e,t,n,r,s){const c=new Ci(90,1,t,n),f=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],m=this._renderer,g=m.autoClear,_=m.toneMapping;m.getClearColor(Tw),m.toneMapping=Sr,m.autoClear=!1;const v=new Gs({name:"PMREM.Background",side:Tn,depthWrite:!1,depthTest:!1}),S=new oi(new tu,v);let b=!1;const x=e.background;x?x.isColor&&(v.color.copy(x),e.background=null,b=!0):(v.color.copy(Tw),b=!0);for(let E=0;E<6;E++){const M=E%3;M===0?(c.up.set(0,f[E],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+d[E],s.y,s.z)):M===1?(c.up.set(0,0,f[E]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+d[E],s.z)):(c.up.set(0,f[E],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+d[E]));const A=this._cubeSize;Sm(r,M*A,E>2?A:0,A,A),m.setRenderTarget(r),b&&m.render(S,c),m.render(e,c)}S.geometry.dispose(),S.material.dispose(),m.toneMapping=_,m.autoClear=g,e.background=x}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===os||e.mapping===ls;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Rw()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=ww());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new oi(this._lodPlanes[0],s),u=s.uniforms;u.envMap.value=e;const c=this._cubeSize;Sm(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(o,l0)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),u=Ew[(r-s-1)%Ew.length];this._blur(e,s-1,s,o,u)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,u){const c=this._renderer,f=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,m=new oi(this._lodPlanes[r],f),g=f.uniforms,_=this._sizeLods[n]-1,v=isFinite(s)?Math.PI/(2*_):2*Math.PI/(2*Ll-1),S=s/v,b=isFinite(s)?1+Math.floor(d*S):Ll;b>Ll&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${Ll}`);const x=[];let E=0;for(let N=0;N<Ll;++N){const L=N/S,P=Math.exp(-L*L/2);x.push(P),N===0?E+=P:N<b&&(E+=2*P)}for(let N=0;N<x.length;N++)x[N]=x[N]/E;g.envMap.value=e.texture,g.samples.value=b,g.weights.value=x,g.latitudinal.value=o==="latitudinal",u&&(g.poleAxis.value=u);const{_lodMax:M}=this;g.dTheta.value=v,g.mipInt.value=M-n;const A=this._sizeLods[r],C=3*A*(r>M-uc?r-M+uc:0),w=4*(this._cubeSize-A);Sm(t,C,w,3*A,2*A),c.setRenderTarget(t),c.render(m,l0)}};function Nk(i){const e=[],t=[],n=[];let r=i;const s=i-uc+1+Sw.length;for(let o=0;o<s;o++){const u=Math.pow(2,r);t.push(u);let c=1/u;o>i-uc?c=Sw[o-i+uc-1]:o===0&&(c=0),n.push(c);const f=1/(u-2),d=-f,m=1+f,g=[d,d,m,d,m,m,d,d,m,m,d,m],_=6,v=6,S=3,b=2,x=1,E=new Float32Array(S*v*_),M=new Float32Array(b*v*_),A=new Float32Array(x*v*_);for(let w=0;w<_;w++){const N=w%3*2/3-1,L=w>2?0:-1,P=[N,L,0,N+2/3,L,0,N+2/3,L+1,0,N,L,0,N+2/3,L+1,0,N,L+1,0];E.set(P,S*v*w),M.set(g,b*v*w);const D=[w,w,w,w,w,w];A.set(D,x*v*w)}const C=new rr;C.setAttribute("position",new Fi(E,S)),C.setAttribute("uv",new Fi(M,b)),C.setAttribute("faceIndex",new Fi(A,x)),e.push(C),r>uc&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function Aw(i,e,t){const n=new $o(i,e,t);return n.texture.mapping=Wl,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Sm(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function Dk(i,e,t){const n=new Float32Array(Ll),r=new H(0,1,0);return new Xs({name:"SphericalGaussianBlur",defines:{n:Ll,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:uS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:br,depthTest:!1,depthWrite:!1})}function ww(){return new Xs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:uS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:br,depthTest:!1,depthWrite:!1})}function Rw(){return new Xs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:uS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:br,depthTest:!1,depthWrite:!1})}function uS(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Pk(i){let e=new WeakMap,t=null;function n(u){if(u&&u.isTexture){const c=u.mapping,f=c===jo||c===Wo,d=c===os||c===ls;if(f||d){let m=e.get(u);const g=m!==void 0?m.texture.pmremVersion:0;if(u.isRenderTargetTexture&&u.pmremVersion!==g)return t===null&&(t=new Mw(i)),m=f?t.fromEquirectangular(u,m):t.fromCubemap(u,m),m.texture.pmremVersion=u.pmremVersion,e.set(u,m),m.texture;if(m!==void 0)return m.texture;{const _=u.image;return f&&_&&_.height>0||d&&_&&r(_)?(t===null&&(t=new Mw(i)),m=f?t.fromEquirectangular(u):t.fromCubemap(u),m.texture.pmremVersion=u.pmremVersion,e.set(u,m),u.addEventListener("dispose",s),m.texture):null}}}return u}function r(u){let c=0;const f=6;for(let d=0;d<f;d++)u[d]!==void 0&&c++;return c===f}function s(u){const c=u.target;c.removeEventListener("dispose",s);const f=e.get(c);f!==void 0&&(e.delete(c),f.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function Lk(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const r=t(n);return r===null&&ws("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function Uk(i,e,t,n){const r={},s=new WeakMap;function o(m){const g=m.target;g.index!==null&&e.remove(g.index);for(const v in g.attributes)e.remove(g.attributes[v]);g.removeEventListener("dispose",o),delete r[g.id];const _=s.get(g);_&&(e.remove(_),s.delete(g)),n.releaseStatesOfGeometry(g),g.isInstancedBufferGeometry===!0&&delete g._maxInstanceCount,t.memory.geometries--}function u(m,g){return r[g.id]===!0||(g.addEventListener("dispose",o),r[g.id]=!0,t.memory.geometries++),g}function c(m){const g=m.attributes;for(const _ in g)e.update(g[_],i.ARRAY_BUFFER)}function f(m){const g=[],_=m.index,v=m.attributes.position;let S=0;if(_!==null){const E=_.array;S=_.version;for(let M=0,A=E.length;M<A;M+=3){const C=E[M+0],w=E[M+1],N=E[M+2];g.push(C,w,w,N,N,C)}}else if(v!==void 0){const E=v.array;S=v.version;for(let M=0,A=E.length/3-1;M<A;M+=3){const C=M+0,w=M+1,N=M+2;g.push(C,w,w,N,N,C)}}else return;const b=new(Yb(g)?eS:Jb)(g,1);b.version=S;const x=s.get(m);x&&e.remove(x),s.set(m,b)}function d(m){const g=s.get(m);if(g){const _=m.index;_!==null&&g.version<_.version&&f(m)}else f(m);return s.get(m)}return{get:u,update:c,getWireframeAttribute:d}}function Ok(i,e,t){let n;function r(g){n=g}let s,o;function u(g){s=g.type,o=g.bytesPerElement}function c(g,_){i.drawElements(n,_,s,g*o),t.update(_,n,1)}function f(g,_,v){v!==0&&(i.drawElementsInstanced(n,_,s,g*o,v),t.update(_,n,v))}function d(g,_,v){if(v===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,_,0,s,g,0,v);let b=0;for(let x=0;x<v;x++)b+=_[x];t.update(b,n,1)}function m(g,_,v,S){if(v===0)return;const b=e.get("WEBGL_multi_draw");if(b===null)for(let x=0;x<g.length;x++)f(g[x]/o,_[x],S[x]);else{b.multiDrawElementsInstancedWEBGL(n,_,0,s,g,0,S,0,v);let x=0;for(let E=0;E<v;E++)x+=_[E]*S[E];t.update(x,n,1)}}this.setMode=r,this.setIndex=u,this.render=c,this.renderInstances=f,this.renderMultiDraw=d,this.renderMultiDrawInstances=m}function Bk(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,u){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=u*(s/3);break;case i.LINES:t.lines+=u*(s/2);break;case i.LINE_STRIP:t.lines+=u*(s-1);break;case i.LINE_LOOP:t.lines+=u*s;break;case i.POINTS:t.points+=u*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function Fk(i,e,t){const n=new WeakMap,r=new xt;function s(o,u,c){const f=o.morphTargetInfluences,d=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,m=d!==void 0?d.length:0;let g=n.get(u);if(g===void 0||g.count!==m){let D=function(){L.dispose(),n.delete(u),u.removeEventListener("dispose",D)};var _=D;g!==void 0&&g.texture.dispose();const v=u.morphAttributes.position!==void 0,S=u.morphAttributes.normal!==void 0,b=u.morphAttributes.color!==void 0,x=u.morphAttributes.position||[],E=u.morphAttributes.normal||[],M=u.morphAttributes.color||[];let A=0;v===!0&&(A=1),S===!0&&(A=2),b===!0&&(A=3);let C=u.attributes.position.count*A,w=1;C>e.maxTextureSize&&(w=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const N=new Float32Array(C*w*4*m),L=new Qb(N,C,w,m);L.type=Yn,L.needsUpdate=!0;const P=A*4;for(let I=0;I<m;I++){const j=x[I],J=E[I],ue=M[I],$=C*w*4*I;for(let k=0;k<j.count;k++){const G=k*P;v===!0&&(r.fromBufferAttribute(j,k),N[$+G+0]=r.x,N[$+G+1]=r.y,N[$+G+2]=r.z,N[$+G+3]=0),S===!0&&(r.fromBufferAttribute(J,k),N[$+G+4]=r.x,N[$+G+5]=r.y,N[$+G+6]=r.z,N[$+G+7]=0),b===!0&&(r.fromBufferAttribute(ue,k),N[$+G+8]=r.x,N[$+G+9]=r.y,N[$+G+10]=r.z,N[$+G+11]=ue.itemSize===4?r.w:1)}}g={count:m,texture:L,size:new Oe(C,w)},n.set(u,g),u.addEventListener("dispose",D)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(i,"morphTexture",o.morphTexture,t);else{let v=0;for(let b=0;b<f.length;b++)v+=f[b];const S=u.morphTargetsRelative?1:1-v;c.getUniforms().setValue(i,"morphTargetBaseInfluence",S),c.getUniforms().setValue(i,"morphTargetInfluences",f)}c.getUniforms().setValue(i,"morphTargetsTexture",g.texture,t),c.getUniforms().setValue(i,"morphTargetsTextureSize",g.size)}return{update:s}}function Ik(i,e,t,n){let r=new WeakMap;function s(c){const f=n.render.frame,d=c.geometry,m=e.get(c,d);if(r.get(m)!==f&&(e.update(m),r.set(m,f)),c.isInstancedMesh&&(c.hasEventListener("dispose",u)===!1&&c.addEventListener("dispose",u),r.get(c)!==f&&(t.update(c.instanceMatrix,i.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,i.ARRAY_BUFFER),r.set(c,f))),c.isSkinnedMesh){const g=c.skeleton;r.get(g)!==f&&(g.update(),r.set(g,f))}return m}function o(){r=new WeakMap}function u(c){const f=c.target;f.removeEventListener("dispose",u),t.remove(f.instanceMatrix),f.instanceColor!==null&&t.remove(f.instanceColor)}return{update:s,dispose:o}}const TN=new _i,Cw=new ss(1,1),EN=new Qb,MN=new L3,AN=new Yg,Nw=[],Dw=[],Pw=new Float32Array(16),Lw=new Float32Array(9),Uw=new Float32Array(4);function eh(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=Nw[r];if(s===void 0&&(s=new Float32Array(r),Nw[r]=s),e!==0){n.toArray(s,0);for(let o=1,u=0;o!==e;++o)u+=t,i[o].toArray(s,u)}return s}function vi(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function yi(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function t_(i,e){let t=Dw[e];t===void 0&&(t=new Int32Array(e),Dw[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function zk(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function kk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(vi(t,e))return;i.uniform2fv(this.addr,e),yi(t,e)}}function Gk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(vi(t,e))return;i.uniform3fv(this.addr,e),yi(t,e)}}function Vk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(vi(t,e))return;i.uniform4fv(this.addr,e),yi(t,e)}}function Hk(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(vi(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),yi(t,e)}else{if(vi(t,n))return;Uw.set(n),i.uniformMatrix2fv(this.addr,!1,Uw),yi(t,n)}}function jk(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(vi(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),yi(t,e)}else{if(vi(t,n))return;Lw.set(n),i.uniformMatrix3fv(this.addr,!1,Lw),yi(t,n)}}function Wk(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(vi(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),yi(t,e)}else{if(vi(t,n))return;Pw.set(n),i.uniformMatrix4fv(this.addr,!1,Pw),yi(t,n)}}function qk(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function $k(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(vi(t,e))return;i.uniform2iv(this.addr,e),yi(t,e)}}function Xk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(vi(t,e))return;i.uniform3iv(this.addr,e),yi(t,e)}}function Yk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(vi(t,e))return;i.uniform4iv(this.addr,e),yi(t,e)}}function Kk(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function Qk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(vi(t,e))return;i.uniform2uiv(this.addr,e),yi(t,e)}}function Zk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(vi(t,e))return;i.uniform3uiv(this.addr,e),yi(t,e)}}function Jk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(vi(t,e))return;i.uniform4uiv(this.addr,e),yi(t,e)}}function eG(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r);let s;this.type===i.SAMPLER_2D_SHADOW?(Cw.compareFunction=$g,s=Cw):s=TN,t.setTexture2D(e||s,r)}function tG(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||MN,r)}function nG(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||AN,r)}function iG(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||EN,r)}function rG(i){switch(i){case 5126:return zk;case 35664:return kk;case 35665:return Gk;case 35666:return Vk;case 35674:return Hk;case 35675:return jk;case 35676:return Wk;case 5124:case 35670:return qk;case 35667:case 35671:return $k;case 35668:case 35672:return Xk;case 35669:case 35673:return Yk;case 5125:return Kk;case 36294:return Qk;case 36295:return Zk;case 36296:return Jk;case 35678:case 36198:case 36298:case 36306:case 35682:return eG;case 35679:case 36299:case 36307:return tG;case 35680:case 36300:case 36308:case 36293:return nG;case 36289:case 36303:case 36311:case 36292:return iG}}function sG(i,e){i.uniform1fv(this.addr,e)}function aG(i,e){const t=eh(e,this.size,2);i.uniform2fv(this.addr,t)}function oG(i,e){const t=eh(e,this.size,3);i.uniform3fv(this.addr,t)}function lG(i,e){const t=eh(e,this.size,4);i.uniform4fv(this.addr,t)}function uG(i,e){const t=eh(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function cG(i,e){const t=eh(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function hG(i,e){const t=eh(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function fG(i,e){i.uniform1iv(this.addr,e)}function dG(i,e){i.uniform2iv(this.addr,e)}function pG(i,e){i.uniform3iv(this.addr,e)}function mG(i,e){i.uniform4iv(this.addr,e)}function gG(i,e){i.uniform1uiv(this.addr,e)}function _G(i,e){i.uniform2uiv(this.addr,e)}function vG(i,e){i.uniform3uiv(this.addr,e)}function yG(i,e){i.uniform4uiv(this.addr,e)}function xG(i,e,t){const n=this.cache,r=e.length,s=t_(t,r);vi(n,s)||(i.uniform1iv(this.addr,s),yi(n,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||TN,s[o])}function bG(i,e,t){const n=this.cache,r=e.length,s=t_(t,r);vi(n,s)||(i.uniform1iv(this.addr,s),yi(n,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||MN,s[o])}function SG(i,e,t){const n=this.cache,r=e.length,s=t_(t,r);vi(n,s)||(i.uniform1iv(this.addr,s),yi(n,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||AN,s[o])}function TG(i,e,t){const n=this.cache,r=e.length,s=t_(t,r);vi(n,s)||(i.uniform1iv(this.addr,s),yi(n,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||EN,s[o])}function EG(i){switch(i){case 5126:return sG;case 35664:return aG;case 35665:return oG;case 35666:return lG;case 35674:return uG;case 35675:return cG;case 35676:return hG;case 5124:case 35670:return fG;case 35667:case 35671:return dG;case 35668:case 35672:return pG;case 35669:case 35673:return mG;case 5125:return gG;case 36294:return _G;case 36295:return vG;case 36296:return yG;case 35678:case 36198:case 36298:case 36306:case 35682:return xG;case 35679:case 36299:case 36307:return bG;case 35680:case 36300:case 36308:case 36293:return SG;case 36289:case 36303:case 36311:case 36292:return TG}}class MG{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=rG(t.type)}}class AG{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=EG(t.type)}}class wG{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const u=r[s];u.setValue(e,t[u.id],n)}}}const d0=/(\w+)(\])?(\[|\.)?/g;function Ow(i,e){i.seq.push(e),i.map[e.id]=e}function RG(i,e,t){const n=i.name,r=n.length;for(d0.lastIndex=0;;){const s=d0.exec(n),o=d0.lastIndex;let u=s[1];const c=s[2]==="]",f=s[3];if(c&&(u=u|0),f===void 0||f==="["&&o+2===r){Ow(t,f===void 0?new MG(u,i,e):new AG(u,i,e));break}else{let m=t.map[u];m===void 0&&(m=new wG(u),Ow(t,m)),t=m}}}class rg{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);RG(s,o,this)}}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,o=t.length;s!==o;++s){const u=t[s],c=n[u.id];c.needsUpdate!==!1&&u.setValue(e,c.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&n.push(o)}return n}}function Bw(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const CG=37297;let NG=0;function DG(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const u=o+1;n.push(`${u===e?">":" "} ${u}: ${t[o]}`)}return n.join(`
`)}const Fw=new Mt;function PG(i){Ft._getMatrix(Fw,Ft.workingColorSpace,i);const e=`mat3( ${Fw.elements.map(t=>t.toFixed(4))} )`;switch(Ft.getTransfer(i)){case _g:return[e,"LinearTransferOETF"];case on:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",i),[e,"LinearTransferOETF"]}}function Iw(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+DG(i.getShaderSource(e),o)}else return r}function LG(i,e){const t=PG(e);return[`vec4 ${i}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function UG(i,e){let t;switch(e){case QC:t="Linear";break;case ZC:t="Reinhard";break;case JC:t="Cineon";break;case eN:t="ACESFilmic";break;case tN:t="AgX";break;case nN:t="Neutral";break;case qB:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Tm=new H;function OG(){Ft.getLuminanceCoefficients(Tm);const i=Tm.x.toFixed(4),e=Tm.y.toFixed(4),t=Tm.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${i}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function BG(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Af).join(`
`)}function FG(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function IG(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let u=1;s.type===i.FLOAT_MAT2&&(u=2),s.type===i.FLOAT_MAT3&&(u=3),s.type===i.FLOAT_MAT4&&(u=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:u}}return t}function Af(i){return i!==""}function zw(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function kw(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const zG=/^[ \t]*#include +<([\w\d./]+)>/gm;function Bx(i){return i.replace(zG,GG)}const kG=new Map;function GG(i,e){let t=Bt[e];if(t===void 0){const n=kG.get(e);if(n!==void 0)t=Bt[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Bx(t)}const VG=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Gw(i){return i.replace(VG,HG)}function HG(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Vw(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function jG(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===Mb?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===GB?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Gr&&(e="SHADOWMAP_TYPE_VSM"),e}function WG(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case os:case ls:e="ENVMAP_TYPE_CUBE";break;case Wl:e="ENVMAP_TYPE_CUBE_UV";break}return e}function qG(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case ls:e="ENVMAP_MODE_REFRACTION";break}return e}function $G(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case wd:e="ENVMAP_BLENDING_MULTIPLY";break;case YC:e="ENVMAP_BLENDING_MIX";break;case KC:e="ENVMAP_BLENDING_ADD";break}return e}function XG(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function YG(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,u=t.fragmentShader;const c=jG(t),f=WG(t),d=qG(t),m=$G(t),g=XG(t),_=BG(t),v=FG(s),S=r.createProgram();let b,x,E=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(Af).join(`
`),b.length>0&&(b+=`
`),x=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(Af).join(`
`),x.length>0&&(x+=`
`)):(b=[Vw(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Af).join(`
`),x=[Vw(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.envMap?"#define "+d:"",t.envMap?"#define "+m:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Sr?"#define TONE_MAPPING":"",t.toneMapping!==Sr?Bt.tonemapping_pars_fragment:"",t.toneMapping!==Sr?UG("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Bt.colorspace_pars_fragment,LG("linearToOutputTexel",t.outputColorSpace),OG(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Af).join(`
`)),o=Bx(o),o=zw(o,t),o=kw(o,t),u=Bx(u),u=zw(u,t),u=kw(u,t),o=Gw(o),u=Gw(u),t.isRawShaderMaterial!==!0&&(E=`#version 300 es
`,b=[_,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,x=["#define varying in",t.glslVersion===WA?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===WA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);const M=E+b+o,A=E+x+u,C=Bw(r,r.VERTEX_SHADER,M),w=Bw(r,r.FRAGMENT_SHADER,A);r.attachShader(S,C),r.attachShader(S,w),t.index0AttributeName!==void 0?r.bindAttribLocation(S,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(S,0,"position"),r.linkProgram(S);function N(I){if(i.debug.checkShaderErrors){const j=r.getProgramInfoLog(S).trim(),J=r.getShaderInfoLog(C).trim(),ue=r.getShaderInfoLog(w).trim();let $=!0,k=!0;if(r.getProgramParameter(S,r.LINK_STATUS)===!1)if($=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,S,C,w);else{const G=Iw(r,C,"vertex"),W=Iw(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(S,r.VALIDATE_STATUS)+`

Material Name: `+I.name+`
Material Type: `+I.type+`

Program Info Log: `+j+`
`+G+`
`+W)}else j!==""?console.warn("THREE.WebGLProgram: Program Info Log:",j):(J===""||ue==="")&&(k=!1);k&&(I.diagnostics={runnable:$,programLog:j,vertexShader:{log:J,prefix:b},fragmentShader:{log:ue,prefix:x}})}r.deleteShader(C),r.deleteShader(w),L=new rg(r,S),P=IG(r,S)}let L;this.getUniforms=function(){return L===void 0&&N(this),L};let P;this.getAttributes=function(){return P===void 0&&N(this),P};let D=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return D===!1&&(D=r.getProgramParameter(S,CG)),D},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(S),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=NG++,this.cacheKey=e,this.usedTimes=1,this.program=S,this.vertexShader=C,this.fragmentShader=w,this}let KG=0;class QG{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new ZG(e),t.set(e,n)),n}}class ZG{constructor(e){this.id=KG++,this.code=e,this.usedTimes=0}}function JG(i,e,t,n,r,s,o){const u=new Zb,c=new QG,f=new Set,d=[],m=r.logarithmicDepthBuffer,g=r.vertexTextures;let _=r.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function S(P){return f.add(P),P===0?"uv":`uv${P}`}function b(P,D,I,j,J){const ue=j.fog,$=J.geometry,k=P.isMeshStandardMaterial?j.environment:null,G=(P.isMeshStandardMaterial?t:e).get(P.envMap||k),W=G&&G.mapping===Wl?G.image.height:null,ce=v[P.type];P.precision!==null&&(_=r.getMaxPrecision(P.precision),_!==P.precision&&console.warn("THREE.WebGLProgram.getParameters:",P.precision,"not supported, using",_,"instead."));const z=$.morphAttributes.position||$.morphAttributes.normal||$.morphAttributes.color,le=z!==void 0?z.length:0;let Ee=0;$.morphAttributes.position!==void 0&&(Ee=1),$.morphAttributes.normal!==void 0&&(Ee=2),$.morphAttributes.color!==void 0&&(Ee=3);let De,q,Z,Y;if(ce){const en=ks[ce];De=en.vertexShader,q=en.fragmentShader}else De=P.vertexShader,q=P.fragmentShader,c.update(P),Z=c.getVertexShaderID(P),Y=c.getFragmentShaderID(P);const ie=i.getRenderTarget(),xe=i.state.buffers.depth.getReversed(),Ve=J.isInstancedMesh===!0,ke=J.isBatchedMesh===!0,st=!!P.map,Ct=!!P.matcap,vt=!!G,K=!!P.aoMap,Cn=!!P.lightMap,Ot=!!P.bumpMap,yt=!!P.normalMap,ct=!!P.displacementMap,hn=!!P.emissiveMap,at=!!P.metalnessMap,V=!!P.roughnessMap,B=P.anisotropy>0,pe=P.clearcoat>0,Pe=P.dispersion>0,Ue=P.iridescence>0,we=P.sheen>0,Je=P.transmission>0,je=B&&!!P.anisotropyMap,We=pe&&!!P.clearcoatMap,$t=pe&&!!P.clearcoatNormalMap,ze=pe&&!!P.clearcoatRoughnessMap,tt=Ue&&!!P.iridescenceMap,dt=Ue&&!!P.iridescenceThicknessMap,mt=we&&!!P.sheenColorMap,Qe=we&&!!P.sheenRoughnessMap,zt=!!P.specularMap,Et=!!P.specularColorMap,fn=!!P.specularIntensityMap,te=Je&&!!P.transmissionMap,Ye=Je&&!!P.thicknessMap,Se=!!P.gradientMap,Ce=!!P.alphaMap,Ze=P.alphaTest>0,Ke=!!P.alphaHash,Nt=!!P.extensions;let En=Sr;P.toneMapped&&(ie===null||ie.isXRRenderTarget===!0)&&(En=i.toneMapping);const Jn={shaderID:ce,shaderType:P.type,shaderName:P.name,vertexShader:De,fragmentShader:q,defines:P.defines,customVertexShaderID:Z,customFragmentShaderID:Y,isRawShaderMaterial:P.isRawShaderMaterial===!0,glslVersion:P.glslVersion,precision:_,batching:ke,batchingColor:ke&&J._colorsTexture!==null,instancing:Ve,instancingColor:Ve&&J.instanceColor!==null,instancingMorph:Ve&&J.morphTexture!==null,supportsVertexTextures:g,outputColorSpace:ie===null?i.outputColorSpace:ie.isXRRenderTarget===!0?ie.texture.colorSpace:qs,alphaToCoverage:!!P.alphaToCoverage,map:st,matcap:Ct,envMap:vt,envMapMode:vt&&G.mapping,envMapCubeUVHeight:W,aoMap:K,lightMap:Cn,bumpMap:Ot,normalMap:yt,displacementMap:g&&ct,emissiveMap:hn,normalMapObjectSpace:yt&&P.normalMapType===iN,normalMapTangentSpace:yt&&P.normalMapType===ja,metalnessMap:at,roughnessMap:V,anisotropy:B,anisotropyMap:je,clearcoat:pe,clearcoatMap:We,clearcoatNormalMap:$t,clearcoatRoughnessMap:ze,dispersion:Pe,iridescence:Ue,iridescenceMap:tt,iridescenceThicknessMap:dt,sheen:we,sheenColorMap:mt,sheenRoughnessMap:Qe,specularMap:zt,specularColorMap:Et,specularIntensityMap:fn,transmission:Je,transmissionMap:te,thicknessMap:Ye,gradientMap:Se,opaque:P.transparent===!1&&P.blending===rs&&P.alphaToCoverage===!1,alphaMap:Ce,alphaTest:Ze,alphaHash:Ke,combine:P.combine,mapUv:st&&S(P.map.channel),aoMapUv:K&&S(P.aoMap.channel),lightMapUv:Cn&&S(P.lightMap.channel),bumpMapUv:Ot&&S(P.bumpMap.channel),normalMapUv:yt&&S(P.normalMap.channel),displacementMapUv:ct&&S(P.displacementMap.channel),emissiveMapUv:hn&&S(P.emissiveMap.channel),metalnessMapUv:at&&S(P.metalnessMap.channel),roughnessMapUv:V&&S(P.roughnessMap.channel),anisotropyMapUv:je&&S(P.anisotropyMap.channel),clearcoatMapUv:We&&S(P.clearcoatMap.channel),clearcoatNormalMapUv:$t&&S(P.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ze&&S(P.clearcoatRoughnessMap.channel),iridescenceMapUv:tt&&S(P.iridescenceMap.channel),iridescenceThicknessMapUv:dt&&S(P.iridescenceThicknessMap.channel),sheenColorMapUv:mt&&S(P.sheenColorMap.channel),sheenRoughnessMapUv:Qe&&S(P.sheenRoughnessMap.channel),specularMapUv:zt&&S(P.specularMap.channel),specularColorMapUv:Et&&S(P.specularColorMap.channel),specularIntensityMapUv:fn&&S(P.specularIntensityMap.channel),transmissionMapUv:te&&S(P.transmissionMap.channel),thicknessMapUv:Ye&&S(P.thicknessMap.channel),alphaMapUv:Ce&&S(P.alphaMap.channel),vertexTangents:!!$.attributes.tangent&&(yt||B),vertexColors:P.vertexColors,vertexAlphas:P.vertexColors===!0&&!!$.attributes.color&&$.attributes.color.itemSize===4,pointsUvs:J.isPoints===!0&&!!$.attributes.uv&&(st||Ce),fog:!!ue,useFog:P.fog===!0,fogExp2:!!ue&&ue.isFogExp2,flatShading:P.flatShading===!0,sizeAttenuation:P.sizeAttenuation===!0,logarithmicDepthBuffer:m,reverseDepthBuffer:xe,skinning:J.isSkinnedMesh===!0,morphTargets:$.morphAttributes.position!==void 0,morphNormals:$.morphAttributes.normal!==void 0,morphColors:$.morphAttributes.color!==void 0,morphTargetsCount:le,morphTextureStride:Ee,numDirLights:D.directional.length,numPointLights:D.point.length,numSpotLights:D.spot.length,numSpotLightMaps:D.spotLightMap.length,numRectAreaLights:D.rectArea.length,numHemiLights:D.hemi.length,numDirLightShadows:D.directionalShadowMap.length,numPointLightShadows:D.pointShadowMap.length,numSpotLightShadows:D.spotShadowMap.length,numSpotLightShadowsWithMaps:D.numSpotLightShadowsWithMaps,numLightProbes:D.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:P.dithering,shadowMapEnabled:i.shadowMap.enabled&&I.length>0,shadowMapType:i.shadowMap.type,toneMapping:En,decodeVideoTexture:st&&P.map.isVideoTexture===!0&&Ft.getTransfer(P.map.colorSpace)===on,decodeVideoTextureEmissive:hn&&P.emissiveMap.isVideoTexture===!0&&Ft.getTransfer(P.emissiveMap.colorSpace)===on,premultipliedAlpha:P.premultipliedAlpha,doubleSided:P.side===Ji,flipSided:P.side===Tn,useDepthPacking:P.depthPacking>=0,depthPacking:P.depthPacking||0,index0AttributeName:P.index0AttributeName,extensionClipCullDistance:Nt&&P.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Nt&&P.extensions.multiDraw===!0||ke)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:P.customProgramCacheKey()};return Jn.vertexUv1s=f.has(1),Jn.vertexUv2s=f.has(2),Jn.vertexUv3s=f.has(3),f.clear(),Jn}function x(P){const D=[];if(P.shaderID?D.push(P.shaderID):(D.push(P.customVertexShaderID),D.push(P.customFragmentShaderID)),P.defines!==void 0)for(const I in P.defines)D.push(I),D.push(P.defines[I]);return P.isRawShaderMaterial===!1&&(E(D,P),M(D,P),D.push(i.outputColorSpace)),D.push(P.customProgramCacheKey),D.join()}function E(P,D){P.push(D.precision),P.push(D.outputColorSpace),P.push(D.envMapMode),P.push(D.envMapCubeUVHeight),P.push(D.mapUv),P.push(D.alphaMapUv),P.push(D.lightMapUv),P.push(D.aoMapUv),P.push(D.bumpMapUv),P.push(D.normalMapUv),P.push(D.displacementMapUv),P.push(D.emissiveMapUv),P.push(D.metalnessMapUv),P.push(D.roughnessMapUv),P.push(D.anisotropyMapUv),P.push(D.clearcoatMapUv),P.push(D.clearcoatNormalMapUv),P.push(D.clearcoatRoughnessMapUv),P.push(D.iridescenceMapUv),P.push(D.iridescenceThicknessMapUv),P.push(D.sheenColorMapUv),P.push(D.sheenRoughnessMapUv),P.push(D.specularMapUv),P.push(D.specularColorMapUv),P.push(D.specularIntensityMapUv),P.push(D.transmissionMapUv),P.push(D.thicknessMapUv),P.push(D.combine),P.push(D.fogExp2),P.push(D.sizeAttenuation),P.push(D.morphTargetsCount),P.push(D.morphAttributeCount),P.push(D.numDirLights),P.push(D.numPointLights),P.push(D.numSpotLights),P.push(D.numSpotLightMaps),P.push(D.numHemiLights),P.push(D.numRectAreaLights),P.push(D.numDirLightShadows),P.push(D.numPointLightShadows),P.push(D.numSpotLightShadows),P.push(D.numSpotLightShadowsWithMaps),P.push(D.numLightProbes),P.push(D.shadowMapType),P.push(D.toneMapping),P.push(D.numClippingPlanes),P.push(D.numClipIntersection),P.push(D.depthPacking)}function M(P,D){u.disableAll(),D.supportsVertexTextures&&u.enable(0),D.instancing&&u.enable(1),D.instancingColor&&u.enable(2),D.instancingMorph&&u.enable(3),D.matcap&&u.enable(4),D.envMap&&u.enable(5),D.normalMapObjectSpace&&u.enable(6),D.normalMapTangentSpace&&u.enable(7),D.clearcoat&&u.enable(8),D.iridescence&&u.enable(9),D.alphaTest&&u.enable(10),D.vertexColors&&u.enable(11),D.vertexAlphas&&u.enable(12),D.vertexUv1s&&u.enable(13),D.vertexUv2s&&u.enable(14),D.vertexUv3s&&u.enable(15),D.vertexTangents&&u.enable(16),D.anisotropy&&u.enable(17),D.alphaHash&&u.enable(18),D.batching&&u.enable(19),D.dispersion&&u.enable(20),D.batchingColor&&u.enable(21),P.push(u.mask),u.disableAll(),D.fog&&u.enable(0),D.useFog&&u.enable(1),D.flatShading&&u.enable(2),D.logarithmicDepthBuffer&&u.enable(3),D.reverseDepthBuffer&&u.enable(4),D.skinning&&u.enable(5),D.morphTargets&&u.enable(6),D.morphNormals&&u.enable(7),D.morphColors&&u.enable(8),D.premultipliedAlpha&&u.enable(9),D.shadowMapEnabled&&u.enable(10),D.doubleSided&&u.enable(11),D.flipSided&&u.enable(12),D.useDepthPacking&&u.enable(13),D.dithering&&u.enable(14),D.transmission&&u.enable(15),D.sheen&&u.enable(16),D.opaque&&u.enable(17),D.pointsUvs&&u.enable(18),D.decodeVideoTexture&&u.enable(19),D.decodeVideoTextureEmissive&&u.enable(20),D.alphaToCoverage&&u.enable(21),P.push(u.mask)}function A(P){const D=v[P.type];let I;if(D){const j=ks[D];I=lN.clone(j.uniforms)}else I=P.uniforms;return I}function C(P,D){let I;for(let j=0,J=d.length;j<J;j++){const ue=d[j];if(ue.cacheKey===D){I=ue,++I.usedTimes;break}}return I===void 0&&(I=new YG(i,D,P,s),d.push(I)),I}function w(P){if(--P.usedTimes===0){const D=d.indexOf(P);d[D]=d[d.length-1],d.pop(),P.destroy()}}function N(P){c.remove(P)}function L(){c.dispose()}return{getParameters:b,getProgramCacheKey:x,getUniforms:A,acquireProgram:C,releaseProgram:w,releaseShaderCache:N,programs:d,dispose:L}}function e4(){let i=new WeakMap;function e(o){return i.has(o)}function t(o){let u=i.get(o);return u===void 0&&(u={},i.set(o,u)),u}function n(o){i.delete(o)}function r(o,u,c){i.get(o)[u]=c}function s(){i=new WeakMap}return{has:e,get:t,remove:n,update:r,dispose:s}}function t4(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function Hw(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function jw(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(m,g,_,v,S,b){let x=i[e];return x===void 0?(x={id:m.id,object:m,geometry:g,material:_,groupOrder:v,renderOrder:m.renderOrder,z:S,group:b},i[e]=x):(x.id=m.id,x.object=m,x.geometry=g,x.material=_,x.groupOrder=v,x.renderOrder=m.renderOrder,x.z=S,x.group=b),e++,x}function u(m,g,_,v,S,b){const x=o(m,g,_,v,S,b);_.transmission>0?n.push(x):_.transparent===!0?r.push(x):t.push(x)}function c(m,g,_,v,S,b){const x=o(m,g,_,v,S,b);_.transmission>0?n.unshift(x):_.transparent===!0?r.unshift(x):t.unshift(x)}function f(m,g){t.length>1&&t.sort(m||t4),n.length>1&&n.sort(g||Hw),r.length>1&&r.sort(g||Hw)}function d(){for(let m=e,g=i.length;m<g;m++){const _=i[m];if(_.id===null)break;_.id=null,_.object=null,_.geometry=null,_.material=null,_.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:u,unshift:c,finish:d,sort:f}}function n4(){let i=new WeakMap;function e(n,r){const s=i.get(n);let o;return s===void 0?(o=new jw,i.set(n,[o])):r>=s.length?(o=new jw,s.push(o)):o=s[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function i4(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new H,color:new it};break;case"SpotLight":t={position:new H,direction:new H,color:new it,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new H,color:new it,distance:0,decay:0};break;case"HemisphereLight":t={direction:new H,skyColor:new it,groundColor:new it};break;case"RectAreaLight":t={color:new it,position:new H,halfWidth:new H,halfHeight:new H};break}return i[e.id]=t,t}}}function r4(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let s4=0;function a4(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function o4(i){const e=new i4,t=r4(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let f=0;f<9;f++)n.probe.push(new H);const r=new H,s=new qt,o=new qt;function u(f){let d=0,m=0,g=0;for(let P=0;P<9;P++)n.probe[P].set(0,0,0);let _=0,v=0,S=0,b=0,x=0,E=0,M=0,A=0,C=0,w=0,N=0;f.sort(a4);for(let P=0,D=f.length;P<D;P++){const I=f[P],j=I.color,J=I.intensity,ue=I.distance,$=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)d+=j.r*J,m+=j.g*J,g+=j.b*J;else if(I.isLightProbe){for(let k=0;k<9;k++)n.probe[k].addScaledVector(I.sh.coefficients[k],J);N++}else if(I.isDirectionalLight){const k=e.get(I);if(k.color.copy(I.color).multiplyScalar(I.intensity),I.castShadow){const G=I.shadow,W=t.get(I);W.shadowIntensity=G.intensity,W.shadowBias=G.bias,W.shadowNormalBias=G.normalBias,W.shadowRadius=G.radius,W.shadowMapSize=G.mapSize,n.directionalShadow[_]=W,n.directionalShadowMap[_]=$,n.directionalShadowMatrix[_]=I.shadow.matrix,E++}n.directional[_]=k,_++}else if(I.isSpotLight){const k=e.get(I);k.position.setFromMatrixPosition(I.matrixWorld),k.color.copy(j).multiplyScalar(J),k.distance=ue,k.coneCos=Math.cos(I.angle),k.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),k.decay=I.decay,n.spot[S]=k;const G=I.shadow;if(I.map&&(n.spotLightMap[C]=I.map,C++,G.updateMatrices(I),I.castShadow&&w++),n.spotLightMatrix[S]=G.matrix,I.castShadow){const W=t.get(I);W.shadowIntensity=G.intensity,W.shadowBias=G.bias,W.shadowNormalBias=G.normalBias,W.shadowRadius=G.radius,W.shadowMapSize=G.mapSize,n.spotShadow[S]=W,n.spotShadowMap[S]=$,A++}S++}else if(I.isRectAreaLight){const k=e.get(I);k.color.copy(j).multiplyScalar(J),k.halfWidth.set(I.width*.5,0,0),k.halfHeight.set(0,I.height*.5,0),n.rectArea[b]=k,b++}else if(I.isPointLight){const k=e.get(I);if(k.color.copy(I.color).multiplyScalar(I.intensity),k.distance=I.distance,k.decay=I.decay,I.castShadow){const G=I.shadow,W=t.get(I);W.shadowIntensity=G.intensity,W.shadowBias=G.bias,W.shadowNormalBias=G.normalBias,W.shadowRadius=G.radius,W.shadowMapSize=G.mapSize,W.shadowCameraNear=G.camera.near,W.shadowCameraFar=G.camera.far,n.pointShadow[v]=W,n.pointShadowMap[v]=$,n.pointShadowMatrix[v]=I.shadow.matrix,M++}n.point[v]=k,v++}else if(I.isHemisphereLight){const k=e.get(I);k.skyColor.copy(I.color).multiplyScalar(J),k.groundColor.copy(I.groundColor).multiplyScalar(J),n.hemi[x]=k,x++}}b>0&&(i.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Xe.LTC_FLOAT_1,n.rectAreaLTC2=Xe.LTC_FLOAT_2):(n.rectAreaLTC1=Xe.LTC_HALF_1,n.rectAreaLTC2=Xe.LTC_HALF_2)),n.ambient[0]=d,n.ambient[1]=m,n.ambient[2]=g;const L=n.hash;(L.directionalLength!==_||L.pointLength!==v||L.spotLength!==S||L.rectAreaLength!==b||L.hemiLength!==x||L.numDirectionalShadows!==E||L.numPointShadows!==M||L.numSpotShadows!==A||L.numSpotMaps!==C||L.numLightProbes!==N)&&(n.directional.length=_,n.spot.length=S,n.rectArea.length=b,n.point.length=v,n.hemi.length=x,n.directionalShadow.length=E,n.directionalShadowMap.length=E,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=A,n.spotShadowMap.length=A,n.directionalShadowMatrix.length=E,n.pointShadowMatrix.length=M,n.spotLightMatrix.length=A+C-w,n.spotLightMap.length=C,n.numSpotLightShadowsWithMaps=w,n.numLightProbes=N,L.directionalLength=_,L.pointLength=v,L.spotLength=S,L.rectAreaLength=b,L.hemiLength=x,L.numDirectionalShadows=E,L.numPointShadows=M,L.numSpotShadows=A,L.numSpotMaps=C,L.numLightProbes=N,n.version=s4++)}function c(f,d){let m=0,g=0,_=0,v=0,S=0;const b=d.matrixWorldInverse;for(let x=0,E=f.length;x<E;x++){const M=f[x];if(M.isDirectionalLight){const A=n.directional[m];A.direction.setFromMatrixPosition(M.matrixWorld),r.setFromMatrixPosition(M.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(b),m++}else if(M.isSpotLight){const A=n.spot[_];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(b),A.direction.setFromMatrixPosition(M.matrixWorld),r.setFromMatrixPosition(M.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(b),_++}else if(M.isRectAreaLight){const A=n.rectArea[v];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(b),o.identity(),s.copy(M.matrixWorld),s.premultiply(b),o.extractRotation(s),A.halfWidth.set(M.width*.5,0,0),A.halfHeight.set(0,M.height*.5,0),A.halfWidth.applyMatrix4(o),A.halfHeight.applyMatrix4(o),v++}else if(M.isPointLight){const A=n.point[g];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(b),g++}else if(M.isHemisphereLight){const A=n.hemi[S];A.direction.setFromMatrixPosition(M.matrixWorld),A.direction.transformDirection(b),S++}}}return{setup:u,setupView:c,state:n}}function Ww(i){const e=new o4(i),t=[],n=[];function r(d){f.camera=d,t.length=0,n.length=0}function s(d){t.push(d)}function o(d){n.push(d)}function u(){e.setup(t)}function c(d){e.setupView(t,d)}const f={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:f,setupLights:u,setupLightsView:c,pushLight:s,pushShadow:o}}function l4(i){let e=new WeakMap;function t(r,s=0){const o=e.get(r);let u;return o===void 0?(u=new Ww(i),e.set(r,[u])):s>=o.length?(u=new Ww(i),o.push(u)):u=o[s],u}function n(){e=new WeakMap}return{get:t,dispose:n}}const u4=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,c4=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function h4(i,e,t){let n=new Qg;const r=new Oe,s=new Oe,o=new xt,u=new EF({depthPacking:YB}),c=new MF,f={},d=t.maxTextureSize,m={[xr]:Tn,[Tn]:xr,[Ji]:Ji},g=new Xs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Oe},radius:{value:4}},vertexShader:u4,fragmentShader:c4}),_=g.clone();_.defines.HORIZONTAL_PASS=1;const v=new rr;v.setAttribute("position",new Fi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const S=new oi(v,g),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Mb;let x=this.type;this.render=function(w,N,L){if(b.enabled===!1||b.autoUpdate===!1&&b.needsUpdate===!1||w.length===0)return;const P=i.getRenderTarget(),D=i.getActiveCubeFace(),I=i.getActiveMipmapLevel(),j=i.state;j.setBlending(br),j.buffers.color.setClear(1,1,1,1),j.buffers.depth.setTest(!0),j.setScissorTest(!1);const J=x!==Gr&&this.type===Gr,ue=x===Gr&&this.type!==Gr;for(let $=0,k=w.length;$<k;$++){const G=w[$],W=G.shadow;if(W===void 0){console.warn("THREE.WebGLShadowMap:",G,"has no shadow.");continue}if(W.autoUpdate===!1&&W.needsUpdate===!1)continue;r.copy(W.mapSize);const ce=W.getFrameExtents();if(r.multiply(ce),s.copy(W.mapSize),(r.x>d||r.y>d)&&(r.x>d&&(s.x=Math.floor(d/ce.x),r.x=s.x*ce.x,W.mapSize.x=s.x),r.y>d&&(s.y=Math.floor(d/ce.y),r.y=s.y*ce.y,W.mapSize.y=s.y)),W.map===null||J===!0||ue===!0){const le=this.type!==Gr?{minFilter:Rn,magFilter:Rn}:{};W.map!==null&&W.map.dispose(),W.map=new $o(r.x,r.y,le),W.map.texture.name=G.name+".shadowMap",W.camera.updateProjectionMatrix()}i.setRenderTarget(W.map),i.clear();const z=W.getViewportCount();for(let le=0;le<z;le++){const Ee=W.getViewport(le);o.set(s.x*Ee.x,s.y*Ee.y,s.x*Ee.z,s.y*Ee.w),j.viewport(o),W.updateMatrices(G,le),n=W.getFrustum(),A(N,L,W.camera,G,this.type)}W.isPointLightShadow!==!0&&this.type===Gr&&E(W,L),W.needsUpdate=!1}x=this.type,b.needsUpdate=!1,i.setRenderTarget(P,D,I)};function E(w,N){const L=e.update(S);g.defines.VSM_SAMPLES!==w.blurSamples&&(g.defines.VSM_SAMPLES=w.blurSamples,_.defines.VSM_SAMPLES=w.blurSamples,g.needsUpdate=!0,_.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new $o(r.x,r.y)),g.uniforms.shadow_pass.value=w.map.texture,g.uniforms.resolution.value=w.mapSize,g.uniforms.radius.value=w.radius,i.setRenderTarget(w.mapPass),i.clear(),i.renderBufferDirect(N,null,L,g,S,null),_.uniforms.shadow_pass.value=w.mapPass.texture,_.uniforms.resolution.value=w.mapSize,_.uniforms.radius.value=w.radius,i.setRenderTarget(w.map),i.clear(),i.renderBufferDirect(N,null,L,_,S,null)}function M(w,N,L,P){let D=null;const I=L.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(I!==void 0)D=I;else if(D=L.isPointLight===!0?c:u,i.localClippingEnabled&&N.clipShadows===!0&&Array.isArray(N.clippingPlanes)&&N.clippingPlanes.length!==0||N.displacementMap&&N.displacementScale!==0||N.alphaMap&&N.alphaTest>0||N.map&&N.alphaTest>0){const j=D.uuid,J=N.uuid;let ue=f[j];ue===void 0&&(ue={},f[j]=ue);let $=ue[J];$===void 0&&($=D.clone(),ue[J]=$,N.addEventListener("dispose",C)),D=$}if(D.visible=N.visible,D.wireframe=N.wireframe,P===Gr?D.side=N.shadowSide!==null?N.shadowSide:N.side:D.side=N.shadowSide!==null?N.shadowSide:m[N.side],D.alphaMap=N.alphaMap,D.alphaTest=N.alphaTest,D.map=N.map,D.clipShadows=N.clipShadows,D.clippingPlanes=N.clippingPlanes,D.clipIntersection=N.clipIntersection,D.displacementMap=N.displacementMap,D.displacementScale=N.displacementScale,D.displacementBias=N.displacementBias,D.wireframeLinewidth=N.wireframeLinewidth,D.linewidth=N.linewidth,L.isPointLight===!0&&D.isMeshDistanceMaterial===!0){const j=i.properties.get(D);j.light=L}return D}function A(w,N,L,P,D){if(w.visible===!1)return;if(w.layers.test(N.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&D===Gr)&&(!w.frustumCulled||n.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(L.matrixWorldInverse,w.matrixWorld);const J=e.update(w),ue=w.material;if(Array.isArray(ue)){const $=J.groups;for(let k=0,G=$.length;k<G;k++){const W=$[k],ce=ue[W.materialIndex];if(ce&&ce.visible){const z=M(w,ce,P,D);w.onBeforeShadow(i,w,N,L,J,z,W),i.renderBufferDirect(L,null,J,z,w,W),w.onAfterShadow(i,w,N,L,J,z,W)}}}else if(ue.visible){const $=M(w,ue,P,D);w.onBeforeShadow(i,w,N,L,J,$,null),i.renderBufferDirect(L,null,J,$,w,null),w.onAfterShadow(i,w,N,L,J,$,null)}}const j=w.children;for(let J=0,ue=j.length;J<ue;J++)A(j[J],N,L,P,D)}function C(w){w.target.removeEventListener("dispose",C);for(const L in f){const P=f[L],D=w.target.uuid;D in P&&(P[D].dispose(),delete P[D])}}}const f4={[Yf]:Kf,[Qf]:ed,[Zf]:td,[Ho]:Jf,[Kf]:Yf,[ed]:Qf,[td]:Zf,[Jf]:Ho};function d4(i,e){function t(){let te=!1;const Ye=new xt;let Se=null;const Ce=new xt(0,0,0,0);return{setMask:function(Ze){Se!==Ze&&!te&&(i.colorMask(Ze,Ze,Ze,Ze),Se=Ze)},setLocked:function(Ze){te=Ze},setClear:function(Ze,Ke,Nt,En,Jn){Jn===!0&&(Ze*=En,Ke*=En,Nt*=En),Ye.set(Ze,Ke,Nt,En),Ce.equals(Ye)===!1&&(i.clearColor(Ze,Ke,Nt,En),Ce.copy(Ye))},reset:function(){te=!1,Se=null,Ce.set(-1,0,0,0)}}}function n(){let te=!1,Ye=!1,Se=null,Ce=null,Ze=null;return{setReversed:function(Ke){if(Ye!==Ke){const Nt=e.get("EXT_clip_control");Ke?Nt.clipControlEXT(Nt.LOWER_LEFT_EXT,Nt.ZERO_TO_ONE_EXT):Nt.clipControlEXT(Nt.LOWER_LEFT_EXT,Nt.NEGATIVE_ONE_TO_ONE_EXT),Ye=Ke;const En=Ze;Ze=null,this.setClear(En)}},getReversed:function(){return Ye},setTest:function(Ke){Ke?ie(i.DEPTH_TEST):xe(i.DEPTH_TEST)},setMask:function(Ke){Se!==Ke&&!te&&(i.depthMask(Ke),Se=Ke)},setFunc:function(Ke){if(Ye&&(Ke=f4[Ke]),Ce!==Ke){switch(Ke){case Yf:i.depthFunc(i.NEVER);break;case Kf:i.depthFunc(i.ALWAYS);break;case Qf:i.depthFunc(i.LESS);break;case Ho:i.depthFunc(i.LEQUAL);break;case Zf:i.depthFunc(i.EQUAL);break;case Jf:i.depthFunc(i.GEQUAL);break;case ed:i.depthFunc(i.GREATER);break;case td:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Ce=Ke}},setLocked:function(Ke){te=Ke},setClear:function(Ke){Ze!==Ke&&(Ye&&(Ke=1-Ke),i.clearDepth(Ke),Ze=Ke)},reset:function(){te=!1,Se=null,Ce=null,Ze=null,Ye=!1}}}function r(){let te=!1,Ye=null,Se=null,Ce=null,Ze=null,Ke=null,Nt=null,En=null,Jn=null;return{setTest:function(en){te||(en?ie(i.STENCIL_TEST):xe(i.STENCIL_TEST))},setMask:function(en){Ye!==en&&!te&&(i.stencilMask(en),Ye=en)},setFunc:function(en,wr,bi){(Se!==en||Ce!==wr||Ze!==bi)&&(i.stencilFunc(en,wr,bi),Se=en,Ce=wr,Ze=bi)},setOp:function(en,wr,bi){(Ke!==en||Nt!==wr||En!==bi)&&(i.stencilOp(en,wr,bi),Ke=en,Nt=wr,En=bi)},setLocked:function(en){te=en},setClear:function(en){Jn!==en&&(i.clearStencil(en),Jn=en)},reset:function(){te=!1,Ye=null,Se=null,Ce=null,Ze=null,Ke=null,Nt=null,En=null,Jn=null}}}const s=new t,o=new n,u=new r,c=new WeakMap,f=new WeakMap;let d={},m={},g=new WeakMap,_=[],v=null,S=!1,b=null,x=null,E=null,M=null,A=null,C=null,w=null,N=new it(0,0,0),L=0,P=!1,D=null,I=null,j=null,J=null,ue=null;const $=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,G=0;const W=i.getParameter(i.VERSION);W.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(W)[1]),k=G>=1):W.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(W)[1]),k=G>=2);let ce=null,z={};const le=i.getParameter(i.SCISSOR_BOX),Ee=i.getParameter(i.VIEWPORT),De=new xt().fromArray(le),q=new xt().fromArray(Ee);function Z(te,Ye,Se,Ce){const Ze=new Uint8Array(4),Ke=i.createTexture();i.bindTexture(te,Ke),i.texParameteri(te,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(te,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let Nt=0;Nt<Se;Nt++)te===i.TEXTURE_3D||te===i.TEXTURE_2D_ARRAY?i.texImage3D(Ye,0,i.RGBA,1,1,Ce,0,i.RGBA,i.UNSIGNED_BYTE,Ze):i.texImage2D(Ye+Nt,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Ze);return Ke}const Y={};Y[i.TEXTURE_2D]=Z(i.TEXTURE_2D,i.TEXTURE_2D,1),Y[i.TEXTURE_CUBE_MAP]=Z(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),Y[i.TEXTURE_2D_ARRAY]=Z(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),Y[i.TEXTURE_3D]=Z(i.TEXTURE_3D,i.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),u.setClear(0),ie(i.DEPTH_TEST),o.setFunc(Ho),Ot(!1),yt(Dx),ie(i.CULL_FACE),K(br);function ie(te){d[te]!==!0&&(i.enable(te),d[te]=!0)}function xe(te){d[te]!==!1&&(i.disable(te),d[te]=!1)}function Ve(te,Ye){return m[te]!==Ye?(i.bindFramebuffer(te,Ye),m[te]=Ye,te===i.DRAW_FRAMEBUFFER&&(m[i.FRAMEBUFFER]=Ye),te===i.FRAMEBUFFER&&(m[i.DRAW_FRAMEBUFFER]=Ye),!0):!1}function ke(te,Ye){let Se=_,Ce=!1;if(te){Se=g.get(Ye),Se===void 0&&(Se=[],g.set(Ye,Se));const Ze=te.textures;if(Se.length!==Ze.length||Se[0]!==i.COLOR_ATTACHMENT0){for(let Ke=0,Nt=Ze.length;Ke<Nt;Ke++)Se[Ke]=i.COLOR_ATTACHMENT0+Ke;Se.length=Ze.length,Ce=!0}}else Se[0]!==i.BACK&&(Se[0]=i.BACK,Ce=!0);Ce&&i.drawBuffers(Se)}function st(te){return v!==te?(i.useProgram(te),v=te,!0):!1}const Ct={[qi]:i.FUNC_ADD,[Ab]:i.FUNC_SUBTRACT,[wb]:i.FUNC_REVERSE_SUBTRACT};Ct[$C]=i.MIN,Ct[XC]=i.MAX;const vt={[wa]:i.ZERO,[Rb]:i.ONE,[Cb]:i.SRC_COLOR,[$f]:i.SRC_ALPHA,[Ob]:i.SRC_ALPHA_SATURATE,[Lb]:i.DST_COLOR,[Db]:i.DST_ALPHA,[Nb]:i.ONE_MINUS_SRC_COLOR,[Xf]:i.ONE_MINUS_SRC_ALPHA,[Ub]:i.ONE_MINUS_DST_COLOR,[Pb]:i.ONE_MINUS_DST_ALPHA,[VB]:i.CONSTANT_COLOR,[HB]:i.ONE_MINUS_CONSTANT_COLOR,[jB]:i.CONSTANT_ALPHA,[WB]:i.ONE_MINUS_CONSTANT_ALPHA};function K(te,Ye,Se,Ce,Ze,Ke,Nt,En,Jn,en){if(te===br){S===!0&&(xe(i.BLEND),S=!1);return}if(S===!1&&(ie(i.BLEND),S=!0),te!==pc){if(te!==b||en!==P){if((x!==qi||A!==qi)&&(i.blendEquation(i.FUNC_ADD),x=qi,A=qi),en)switch(te){case rs:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case bc:i.blendFunc(i.ONE,i.ONE);break;case Sc:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case Tc:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",te);break}else switch(te){case rs:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case bc:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case Sc:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case Tc:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",te);break}E=null,M=null,C=null,w=null,N.set(0,0,0),L=0,b=te,P=en}return}Ze=Ze||Ye,Ke=Ke||Se,Nt=Nt||Ce,(Ye!==x||Ze!==A)&&(i.blendEquationSeparate(Ct[Ye],Ct[Ze]),x=Ye,A=Ze),(Se!==E||Ce!==M||Ke!==C||Nt!==w)&&(i.blendFuncSeparate(vt[Se],vt[Ce],vt[Ke],vt[Nt]),E=Se,M=Ce,C=Ke,w=Nt),(En.equals(N)===!1||Jn!==L)&&(i.blendColor(En.r,En.g,En.b,Jn),N.copy(En),L=Jn),b=te,P=!1}function Cn(te,Ye){te.side===Ji?xe(i.CULL_FACE):ie(i.CULL_FACE);let Se=te.side===Tn;Ye&&(Se=!Se),Ot(Se),te.blending===rs&&te.transparent===!1?K(br):K(te.blending,te.blendEquation,te.blendSrc,te.blendDst,te.blendEquationAlpha,te.blendSrcAlpha,te.blendDstAlpha,te.blendColor,te.blendAlpha,te.premultipliedAlpha),o.setFunc(te.depthFunc),o.setTest(te.depthTest),o.setMask(te.depthWrite),s.setMask(te.colorWrite);const Ce=te.stencilWrite;u.setTest(Ce),Ce&&(u.setMask(te.stencilWriteMask),u.setFunc(te.stencilFunc,te.stencilRef,te.stencilFuncMask),u.setOp(te.stencilFail,te.stencilZFail,te.stencilZPass)),hn(te.polygonOffset,te.polygonOffsetFactor,te.polygonOffsetUnits),te.alphaToCoverage===!0?ie(i.SAMPLE_ALPHA_TO_COVERAGE):xe(i.SAMPLE_ALPHA_TO_COVERAGE)}function Ot(te){D!==te&&(te?i.frontFace(i.CW):i.frontFace(i.CCW),D=te)}function yt(te){te!==WC?(ie(i.CULL_FACE),te!==I&&(te===Dx?i.cullFace(i.BACK):te===qC?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):xe(i.CULL_FACE),I=te}function ct(te){te!==j&&(k&&i.lineWidth(te),j=te)}function hn(te,Ye,Se){te?(ie(i.POLYGON_OFFSET_FILL),(J!==Ye||ue!==Se)&&(i.polygonOffset(Ye,Se),J=Ye,ue=Se)):xe(i.POLYGON_OFFSET_FILL)}function at(te){te?ie(i.SCISSOR_TEST):xe(i.SCISSOR_TEST)}function V(te){te===void 0&&(te=i.TEXTURE0+$-1),ce!==te&&(i.activeTexture(te),ce=te)}function B(te,Ye,Se){Se===void 0&&(ce===null?Se=i.TEXTURE0+$-1:Se=ce);let Ce=z[Se];Ce===void 0&&(Ce={type:void 0,texture:void 0},z[Se]=Ce),(Ce.type!==te||Ce.texture!==Ye)&&(ce!==Se&&(i.activeTexture(Se),ce=Se),i.bindTexture(te,Ye||Y[te]),Ce.type=te,Ce.texture=Ye)}function pe(){const te=z[ce];te!==void 0&&te.type!==void 0&&(i.bindTexture(te.type,null),te.type=void 0,te.texture=void 0)}function Pe(){try{i.compressedTexImage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Ue(){try{i.compressedTexImage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function we(){try{i.texSubImage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Je(){try{i.texSubImage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function je(){try{i.compressedTexSubImage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function We(){try{i.compressedTexSubImage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function $t(){try{i.texStorage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function ze(){try{i.texStorage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function tt(){try{i.texImage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function dt(){try{i.texImage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function mt(te){De.equals(te)===!1&&(i.scissor(te.x,te.y,te.z,te.w),De.copy(te))}function Qe(te){q.equals(te)===!1&&(i.viewport(te.x,te.y,te.z,te.w),q.copy(te))}function zt(te,Ye){let Se=f.get(Ye);Se===void 0&&(Se=new WeakMap,f.set(Ye,Se));let Ce=Se.get(te);Ce===void 0&&(Ce=i.getUniformBlockIndex(Ye,te.name),Se.set(te,Ce))}function Et(te,Ye){const Ce=f.get(Ye).get(te);c.get(Ye)!==Ce&&(i.uniformBlockBinding(Ye,Ce,te.__bindingPointIndex),c.set(Ye,Ce))}function fn(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),o.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),d={},ce=null,z={},m={},g=new WeakMap,_=[],v=null,S=!1,b=null,x=null,E=null,M=null,A=null,C=null,w=null,N=new it(0,0,0),L=0,P=!1,D=null,I=null,j=null,J=null,ue=null,De.set(0,0,i.canvas.width,i.canvas.height),q.set(0,0,i.canvas.width,i.canvas.height),s.reset(),o.reset(),u.reset()}return{buffers:{color:s,depth:o,stencil:u},enable:ie,disable:xe,bindFramebuffer:Ve,drawBuffers:ke,useProgram:st,setBlending:K,setMaterial:Cn,setFlipSided:Ot,setCullFace:yt,setLineWidth:ct,setPolygonOffset:hn,setScissorTest:at,activeTexture:V,bindTexture:B,unbindTexture:pe,compressedTexImage2D:Pe,compressedTexImage3D:Ue,texImage2D:tt,texImage3D:dt,updateUBOMapping:zt,uniformBlockBinding:Et,texStorage2D:$t,texStorage3D:ze,texSubImage2D:we,texSubImage3D:Je,compressedTexSubImage2D:je,compressedTexSubImage3D:We,scissor:mt,viewport:Qe,reset:fn}}function p4(i,e,t,n,r,s,o){const u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new Oe,d=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(V,B){return _?new OffscreenCanvas(V,B):cd("canvas")}function S(V,B,pe){let Pe=1;const Ue=at(V);if((Ue.width>pe||Ue.height>pe)&&(Pe=pe/Math.max(Ue.width,Ue.height)),Pe<1)if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap||typeof VideoFrame<"u"&&V instanceof VideoFrame){const we=Math.floor(Pe*Ue.width),Je=Math.floor(Pe*Ue.height);m===void 0&&(m=v(we,Je));const je=B?v(we,Je):m;return je.width=we,je.height=Je,je.getContext("2d").drawImage(V,0,0,we,Je),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ue.width+"x"+Ue.height+") to ("+we+"x"+Je+")."),je}else return"data"in V&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ue.width+"x"+Ue.height+")."),V;return V}function b(V){return V.generateMipmaps}function x(V){i.generateMipmap(V)}function E(V){return V.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:V.isWebGL3DRenderTarget?i.TEXTURE_3D:V.isWebGLArrayRenderTarget||V.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function M(V,B,pe,Pe,Ue=!1){if(V!==null){if(i[V]!==void 0)return i[V];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let we=B;if(B===i.RED&&(pe===i.FLOAT&&(we=i.R32F),pe===i.HALF_FLOAT&&(we=i.R16F),pe===i.UNSIGNED_BYTE&&(we=i.R8)),B===i.RED_INTEGER&&(pe===i.UNSIGNED_BYTE&&(we=i.R8UI),pe===i.UNSIGNED_SHORT&&(we=i.R16UI),pe===i.UNSIGNED_INT&&(we=i.R32UI),pe===i.BYTE&&(we=i.R8I),pe===i.SHORT&&(we=i.R16I),pe===i.INT&&(we=i.R32I)),B===i.RG&&(pe===i.FLOAT&&(we=i.RG32F),pe===i.HALF_FLOAT&&(we=i.RG16F),pe===i.UNSIGNED_BYTE&&(we=i.RG8)),B===i.RG_INTEGER&&(pe===i.UNSIGNED_BYTE&&(we=i.RG8UI),pe===i.UNSIGNED_SHORT&&(we=i.RG16UI),pe===i.UNSIGNED_INT&&(we=i.RG32UI),pe===i.BYTE&&(we=i.RG8I),pe===i.SHORT&&(we=i.RG16I),pe===i.INT&&(we=i.RG32I)),B===i.RGB_INTEGER&&(pe===i.UNSIGNED_BYTE&&(we=i.RGB8UI),pe===i.UNSIGNED_SHORT&&(we=i.RGB16UI),pe===i.UNSIGNED_INT&&(we=i.RGB32UI),pe===i.BYTE&&(we=i.RGB8I),pe===i.SHORT&&(we=i.RGB16I),pe===i.INT&&(we=i.RGB32I)),B===i.RGBA_INTEGER&&(pe===i.UNSIGNED_BYTE&&(we=i.RGBA8UI),pe===i.UNSIGNED_SHORT&&(we=i.RGBA16UI),pe===i.UNSIGNED_INT&&(we=i.RGBA32UI),pe===i.BYTE&&(we=i.RGBA8I),pe===i.SHORT&&(we=i.RGBA16I),pe===i.INT&&(we=i.RGBA32I)),B===i.RGB&&pe===i.UNSIGNED_INT_5_9_9_9_REV&&(we=i.RGB9_E5),B===i.RGBA){const Je=Ue?_g:Ft.getTransfer(Pe);pe===i.FLOAT&&(we=i.RGBA32F),pe===i.HALF_FLOAT&&(we=i.RGBA16F),pe===i.UNSIGNED_BYTE&&(we=Je===on?i.SRGB8_ALPHA8:i.RGBA8),pe===i.UNSIGNED_SHORT_4_4_4_4&&(we=i.RGBA4),pe===i.UNSIGNED_SHORT_5_5_5_1&&(we=i.RGB5_A1)}return(we===i.R16F||we===i.R32F||we===i.RG16F||we===i.RG32F||we===i.RGBA16F||we===i.RGBA32F)&&e.get("EXT_color_buffer_float"),we}function A(V,B){let pe;return V?B===null||B===Sn||B===Hr?pe=i.DEPTH24_STENCIL8:B===Yn?pe=i.DEPTH32F_STENCIL8:B===Ms&&(pe=i.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):B===null||B===Sn||B===Hr?pe=i.DEPTH_COMPONENT24:B===Yn?pe=i.DEPTH_COMPONENT32F:B===Ms&&(pe=i.DEPTH_COMPONENT16),pe}function C(V,B){return b(V)===!0||V.isFramebufferTexture&&V.minFilter!==Rn&&V.minFilter!==gi?Math.log2(Math.max(B.width,B.height))+1:V.mipmaps!==void 0&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?B.mipmaps.length:1}function w(V){const B=V.target;B.removeEventListener("dispose",w),L(B),B.isVideoTexture&&d.delete(B)}function N(V){const B=V.target;B.removeEventListener("dispose",N),D(B)}function L(V){const B=n.get(V);if(B.__webglInit===void 0)return;const pe=V.source,Pe=g.get(pe);if(Pe){const Ue=Pe[B.__cacheKey];Ue.usedTimes--,Ue.usedTimes===0&&P(V),Object.keys(Pe).length===0&&g.delete(pe)}n.remove(V)}function P(V){const B=n.get(V);i.deleteTexture(B.__webglTexture);const pe=V.source,Pe=g.get(pe);delete Pe[B.__cacheKey],o.memory.textures--}function D(V){const B=n.get(V);if(V.depthTexture&&(V.depthTexture.dispose(),n.remove(V.depthTexture)),V.isWebGLCubeRenderTarget)for(let Pe=0;Pe<6;Pe++){if(Array.isArray(B.__webglFramebuffer[Pe]))for(let Ue=0;Ue<B.__webglFramebuffer[Pe].length;Ue++)i.deleteFramebuffer(B.__webglFramebuffer[Pe][Ue]);else i.deleteFramebuffer(B.__webglFramebuffer[Pe]);B.__webglDepthbuffer&&i.deleteRenderbuffer(B.__webglDepthbuffer[Pe])}else{if(Array.isArray(B.__webglFramebuffer))for(let Pe=0;Pe<B.__webglFramebuffer.length;Pe++)i.deleteFramebuffer(B.__webglFramebuffer[Pe]);else i.deleteFramebuffer(B.__webglFramebuffer);if(B.__webglDepthbuffer&&i.deleteRenderbuffer(B.__webglDepthbuffer),B.__webglMultisampledFramebuffer&&i.deleteFramebuffer(B.__webglMultisampledFramebuffer),B.__webglColorRenderbuffer)for(let Pe=0;Pe<B.__webglColorRenderbuffer.length;Pe++)B.__webglColorRenderbuffer[Pe]&&i.deleteRenderbuffer(B.__webglColorRenderbuffer[Pe]);B.__webglDepthRenderbuffer&&i.deleteRenderbuffer(B.__webglDepthRenderbuffer)}const pe=V.textures;for(let Pe=0,Ue=pe.length;Pe<Ue;Pe++){const we=n.get(pe[Pe]);we.__webglTexture&&(i.deleteTexture(we.__webglTexture),o.memory.textures--),n.remove(pe[Pe])}n.remove(V)}let I=0;function j(){I=0}function J(){const V=I;return V>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+r.maxTextures),I+=1,V}function ue(V){const B=[];return B.push(V.wrapS),B.push(V.wrapT),B.push(V.wrapR||0),B.push(V.magFilter),B.push(V.minFilter),B.push(V.anisotropy),B.push(V.internalFormat),B.push(V.format),B.push(V.type),B.push(V.generateMipmaps),B.push(V.premultiplyAlpha),B.push(V.flipY),B.push(V.unpackAlignment),B.push(V.colorSpace),B.join()}function $(V,B){const pe=n.get(V);if(V.isVideoTexture&&ct(V),V.isRenderTargetTexture===!1&&V.version>0&&pe.__version!==V.version){const Pe=V.image;if(Pe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Pe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{q(pe,V,B);return}}t.bindTexture(i.TEXTURE_2D,pe.__webglTexture,i.TEXTURE0+B)}function k(V,B){const pe=n.get(V);if(V.version>0&&pe.__version!==V.version){q(pe,V,B);return}t.bindTexture(i.TEXTURE_2D_ARRAY,pe.__webglTexture,i.TEXTURE0+B)}function G(V,B){const pe=n.get(V);if(V.version>0&&pe.__version!==V.version){q(pe,V,B);return}t.bindTexture(i.TEXTURE_3D,pe.__webglTexture,i.TEXTURE0+B)}function W(V,B){const pe=n.get(V);if(V.version>0&&pe.__version!==V.version){Z(pe,V,B);return}t.bindTexture(i.TEXTURE_CUBE_MAP,pe.__webglTexture,i.TEXTURE0+B)}const ce={[ql]:i.REPEAT,[Hs]:i.CLAMP_TO_EDGE,[$l]:i.MIRRORED_REPEAT},z={[Rn]:i.NEAREST,[Fb]:i.NEAREST_MIPMAP_NEAREST,[Oa]:i.NEAREST_MIPMAP_LINEAR,[gi]:i.LINEAR,[mc]:i.LINEAR_MIPMAP_NEAREST,[mr]:i.LINEAR_MIPMAP_LINEAR},le={[Vb]:i.NEVER,[$b]:i.ALWAYS,[qg]:i.LESS,[$g]:i.LEQUAL,[Hb]:i.EQUAL,[qb]:i.GEQUAL,[jb]:i.GREATER,[Wb]:i.NOTEQUAL};function Ee(V,B){if(B.type===Yn&&e.has("OES_texture_float_linear")===!1&&(B.magFilter===gi||B.magFilter===mc||B.magFilter===Oa||B.magFilter===mr||B.minFilter===gi||B.minFilter===mc||B.minFilter===Oa||B.minFilter===mr)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri(V,i.TEXTURE_WRAP_S,ce[B.wrapS]),i.texParameteri(V,i.TEXTURE_WRAP_T,ce[B.wrapT]),(V===i.TEXTURE_3D||V===i.TEXTURE_2D_ARRAY)&&i.texParameteri(V,i.TEXTURE_WRAP_R,ce[B.wrapR]),i.texParameteri(V,i.TEXTURE_MAG_FILTER,z[B.magFilter]),i.texParameteri(V,i.TEXTURE_MIN_FILTER,z[B.minFilter]),B.compareFunction&&(i.texParameteri(V,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(V,i.TEXTURE_COMPARE_FUNC,le[B.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(B.magFilter===Rn||B.minFilter!==Oa&&B.minFilter!==mr||B.type===Yn&&e.has("OES_texture_float_linear")===!1)return;if(B.anisotropy>1||n.get(B).__currentAnisotropy){const pe=e.get("EXT_texture_filter_anisotropic");i.texParameterf(V,pe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(B.anisotropy,r.getMaxAnisotropy())),n.get(B).__currentAnisotropy=B.anisotropy}}}function De(V,B){let pe=!1;V.__webglInit===void 0&&(V.__webglInit=!0,B.addEventListener("dispose",w));const Pe=B.source;let Ue=g.get(Pe);Ue===void 0&&(Ue={},g.set(Pe,Ue));const we=ue(B);if(we!==V.__cacheKey){Ue[we]===void 0&&(Ue[we]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,pe=!0),Ue[we].usedTimes++;const Je=Ue[V.__cacheKey];Je!==void 0&&(Ue[V.__cacheKey].usedTimes--,Je.usedTimes===0&&P(B)),V.__cacheKey=we,V.__webglTexture=Ue[we].texture}return pe}function q(V,B,pe){let Pe=i.TEXTURE_2D;(B.isDataArrayTexture||B.isCompressedArrayTexture)&&(Pe=i.TEXTURE_2D_ARRAY),B.isData3DTexture&&(Pe=i.TEXTURE_3D);const Ue=De(V,B),we=B.source;t.bindTexture(Pe,V.__webglTexture,i.TEXTURE0+pe);const Je=n.get(we);if(we.version!==Je.__version||Ue===!0){t.activeTexture(i.TEXTURE0+pe);const je=Ft.getPrimaries(Ft.workingColorSpace),We=B.colorSpace===Vr?null:Ft.getPrimaries(B.colorSpace),$t=B.colorSpace===Vr||je===We?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,B.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,B.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,$t);let ze=S(B.image,!1,r.maxTextureSize);ze=hn(B,ze);const tt=s.convert(B.format,B.colorSpace),dt=s.convert(B.type);let mt=M(B.internalFormat,tt,dt,B.colorSpace,B.isVideoTexture);Ee(Pe,B);let Qe;const zt=B.mipmaps,Et=B.isVideoTexture!==!0,fn=Je.__version===void 0||Ue===!0,te=we.dataReady,Ye=C(B,ze);if(B.isDepthTexture)mt=A(B.format===Wr,B.type),fn&&(Et?t.texStorage2D(i.TEXTURE_2D,1,mt,ze.width,ze.height):t.texImage2D(i.TEXTURE_2D,0,mt,ze.width,ze.height,0,tt,dt,null));else if(B.isDataTexture)if(zt.length>0){Et&&fn&&t.texStorage2D(i.TEXTURE_2D,Ye,mt,zt[0].width,zt[0].height);for(let Se=0,Ce=zt.length;Se<Ce;Se++)Qe=zt[Se],Et?te&&t.texSubImage2D(i.TEXTURE_2D,Se,0,0,Qe.width,Qe.height,tt,dt,Qe.data):t.texImage2D(i.TEXTURE_2D,Se,mt,Qe.width,Qe.height,0,tt,dt,Qe.data);B.generateMipmaps=!1}else Et?(fn&&t.texStorage2D(i.TEXTURE_2D,Ye,mt,ze.width,ze.height),te&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,ze.width,ze.height,tt,dt,ze.data)):t.texImage2D(i.TEXTURE_2D,0,mt,ze.width,ze.height,0,tt,dt,ze.data);else if(B.isCompressedTexture)if(B.isCompressedArrayTexture){Et&&fn&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Ye,mt,zt[0].width,zt[0].height,ze.depth);for(let Se=0,Ce=zt.length;Se<Ce;Se++)if(Qe=zt[Se],B.format!==qn)if(tt!==null)if(Et){if(te)if(B.layerUpdates.size>0){const Ze=bw(Qe.width,Qe.height,B.format,B.type);for(const Ke of B.layerUpdates){const Nt=Qe.data.subarray(Ke*Ze/Qe.data.BYTES_PER_ELEMENT,(Ke+1)*Ze/Qe.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Se,0,0,Ke,Qe.width,Qe.height,1,tt,Nt)}B.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Se,0,0,0,Qe.width,Qe.height,ze.depth,tt,Qe.data)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,Se,mt,Qe.width,Qe.height,ze.depth,0,Qe.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Et?te&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,Se,0,0,0,Qe.width,Qe.height,ze.depth,tt,dt,Qe.data):t.texImage3D(i.TEXTURE_2D_ARRAY,Se,mt,Qe.width,Qe.height,ze.depth,0,tt,dt,Qe.data)}else{Et&&fn&&t.texStorage2D(i.TEXTURE_2D,Ye,mt,zt[0].width,zt[0].height);for(let Se=0,Ce=zt.length;Se<Ce;Se++)Qe=zt[Se],B.format!==qn?tt!==null?Et?te&&t.compressedTexSubImage2D(i.TEXTURE_2D,Se,0,0,Qe.width,Qe.height,tt,Qe.data):t.compressedTexImage2D(i.TEXTURE_2D,Se,mt,Qe.width,Qe.height,0,Qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Et?te&&t.texSubImage2D(i.TEXTURE_2D,Se,0,0,Qe.width,Qe.height,tt,dt,Qe.data):t.texImage2D(i.TEXTURE_2D,Se,mt,Qe.width,Qe.height,0,tt,dt,Qe.data)}else if(B.isDataArrayTexture)if(Et){if(fn&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Ye,mt,ze.width,ze.height,ze.depth),te)if(B.layerUpdates.size>0){const Se=bw(ze.width,ze.height,B.format,B.type);for(const Ce of B.layerUpdates){const Ze=ze.data.subarray(Ce*Se/ze.data.BYTES_PER_ELEMENT,(Ce+1)*Se/ze.data.BYTES_PER_ELEMENT);t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,Ce,ze.width,ze.height,1,tt,dt,Ze)}B.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,ze.width,ze.height,ze.depth,tt,dt,ze.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,mt,ze.width,ze.height,ze.depth,0,tt,dt,ze.data);else if(B.isData3DTexture)Et?(fn&&t.texStorage3D(i.TEXTURE_3D,Ye,mt,ze.width,ze.height,ze.depth),te&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,ze.width,ze.height,ze.depth,tt,dt,ze.data)):t.texImage3D(i.TEXTURE_3D,0,mt,ze.width,ze.height,ze.depth,0,tt,dt,ze.data);else if(B.isFramebufferTexture){if(fn)if(Et)t.texStorage2D(i.TEXTURE_2D,Ye,mt,ze.width,ze.height);else{let Se=ze.width,Ce=ze.height;for(let Ze=0;Ze<Ye;Ze++)t.texImage2D(i.TEXTURE_2D,Ze,mt,Se,Ce,0,tt,dt,null),Se>>=1,Ce>>=1}}else if(zt.length>0){if(Et&&fn){const Se=at(zt[0]);t.texStorage2D(i.TEXTURE_2D,Ye,mt,Se.width,Se.height)}for(let Se=0,Ce=zt.length;Se<Ce;Se++)Qe=zt[Se],Et?te&&t.texSubImage2D(i.TEXTURE_2D,Se,0,0,tt,dt,Qe):t.texImage2D(i.TEXTURE_2D,Se,mt,tt,dt,Qe);B.generateMipmaps=!1}else if(Et){if(fn){const Se=at(ze);t.texStorage2D(i.TEXTURE_2D,Ye,mt,Se.width,Se.height)}te&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,tt,dt,ze)}else t.texImage2D(i.TEXTURE_2D,0,mt,tt,dt,ze);b(B)&&x(Pe),Je.__version=we.version,B.onUpdate&&B.onUpdate(B)}V.__version=B.version}function Z(V,B,pe){if(B.image.length!==6)return;const Pe=De(V,B),Ue=B.source;t.bindTexture(i.TEXTURE_CUBE_MAP,V.__webglTexture,i.TEXTURE0+pe);const we=n.get(Ue);if(Ue.version!==we.__version||Pe===!0){t.activeTexture(i.TEXTURE0+pe);const Je=Ft.getPrimaries(Ft.workingColorSpace),je=B.colorSpace===Vr?null:Ft.getPrimaries(B.colorSpace),We=B.colorSpace===Vr||Je===je?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,B.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,B.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,We);const $t=B.isCompressedTexture||B.image[0].isCompressedTexture,ze=B.image[0]&&B.image[0].isDataTexture,tt=[];for(let Ce=0;Ce<6;Ce++)!$t&&!ze?tt[Ce]=S(B.image[Ce],!0,r.maxCubemapSize):tt[Ce]=ze?B.image[Ce].image:B.image[Ce],tt[Ce]=hn(B,tt[Ce]);const dt=tt[0],mt=s.convert(B.format,B.colorSpace),Qe=s.convert(B.type),zt=M(B.internalFormat,mt,Qe,B.colorSpace),Et=B.isVideoTexture!==!0,fn=we.__version===void 0||Pe===!0,te=Ue.dataReady;let Ye=C(B,dt);Ee(i.TEXTURE_CUBE_MAP,B);let Se;if($t){Et&&fn&&t.texStorage2D(i.TEXTURE_CUBE_MAP,Ye,zt,dt.width,dt.height);for(let Ce=0;Ce<6;Ce++){Se=tt[Ce].mipmaps;for(let Ze=0;Ze<Se.length;Ze++){const Ke=Se[Ze];B.format!==qn?mt!==null?Et?te&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Ze,0,0,Ke.width,Ke.height,mt,Ke.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Ze,zt,Ke.width,Ke.height,0,Ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Et?te&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Ze,0,0,Ke.width,Ke.height,mt,Qe,Ke.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Ze,zt,Ke.width,Ke.height,0,mt,Qe,Ke.data)}}}else{if(Se=B.mipmaps,Et&&fn){Se.length>0&&Ye++;const Ce=at(tt[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,Ye,zt,Ce.width,Ce.height)}for(let Ce=0;Ce<6;Ce++)if(ze){Et?te&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,0,0,tt[Ce].width,tt[Ce].height,mt,Qe,tt[Ce].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,zt,tt[Ce].width,tt[Ce].height,0,mt,Qe,tt[Ce].data);for(let Ze=0;Ze<Se.length;Ze++){const Nt=Se[Ze].image[Ce].image;Et?te&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Ze+1,0,0,Nt.width,Nt.height,mt,Qe,Nt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Ze+1,zt,Nt.width,Nt.height,0,mt,Qe,Nt.data)}}else{Et?te&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,0,0,mt,Qe,tt[Ce]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,zt,mt,Qe,tt[Ce]);for(let Ze=0;Ze<Se.length;Ze++){const Ke=Se[Ze];Et?te&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Ze+1,0,0,mt,Qe,Ke.image[Ce]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Ze+1,zt,mt,Qe,Ke.image[Ce])}}}b(B)&&x(i.TEXTURE_CUBE_MAP),we.__version=Ue.version,B.onUpdate&&B.onUpdate(B)}V.__version=B.version}function Y(V,B,pe,Pe,Ue,we){const Je=s.convert(pe.format,pe.colorSpace),je=s.convert(pe.type),We=M(pe.internalFormat,Je,je,pe.colorSpace),$t=n.get(B),ze=n.get(pe);if(ze.__renderTarget=B,!$t.__hasExternalTextures){const tt=Math.max(1,B.width>>we),dt=Math.max(1,B.height>>we);Ue===i.TEXTURE_3D||Ue===i.TEXTURE_2D_ARRAY?t.texImage3D(Ue,we,We,tt,dt,B.depth,0,Je,je,null):t.texImage2D(Ue,we,We,tt,dt,0,Je,je,null)}t.bindFramebuffer(i.FRAMEBUFFER,V),yt(B)?u.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Pe,Ue,ze.__webglTexture,0,Ot(B)):(Ue===i.TEXTURE_2D||Ue>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&Ue<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Pe,Ue,ze.__webglTexture,we),t.bindFramebuffer(i.FRAMEBUFFER,null)}function ie(V,B,pe){if(i.bindRenderbuffer(i.RENDERBUFFER,V),B.depthBuffer){const Pe=B.depthTexture,Ue=Pe&&Pe.isDepthTexture?Pe.type:null,we=A(B.stencilBuffer,Ue),Je=B.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,je=Ot(B);yt(B)?u.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,je,we,B.width,B.height):pe?i.renderbufferStorageMultisample(i.RENDERBUFFER,je,we,B.width,B.height):i.renderbufferStorage(i.RENDERBUFFER,we,B.width,B.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,Je,i.RENDERBUFFER,V)}else{const Pe=B.textures;for(let Ue=0;Ue<Pe.length;Ue++){const we=Pe[Ue],Je=s.convert(we.format,we.colorSpace),je=s.convert(we.type),We=M(we.internalFormat,Je,je,we.colorSpace),$t=Ot(B);pe&&yt(B)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,$t,We,B.width,B.height):yt(B)?u.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,$t,We,B.width,B.height):i.renderbufferStorage(i.RENDERBUFFER,We,B.width,B.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function xe(V,B){if(B&&B.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,V),!(B.depthTexture&&B.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Pe=n.get(B.depthTexture);Pe.__renderTarget=B,(!Pe.__webglTexture||B.depthTexture.image.width!==B.width||B.depthTexture.image.height!==B.height)&&(B.depthTexture.image.width=B.width,B.depthTexture.image.height=B.height,B.depthTexture.needsUpdate=!0),$(B.depthTexture,0);const Ue=Pe.__webglTexture,we=Ot(B);if(B.depthTexture.format===jr)yt(B)?u.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Ue,0,we):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Ue,0);else if(B.depthTexture.format===Wr)yt(B)?u.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Ue,0,we):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Ue,0);else throw new Error("Unknown depthTexture format")}function Ve(V){const B=n.get(V),pe=V.isWebGLCubeRenderTarget===!0;if(B.__boundDepthTexture!==V.depthTexture){const Pe=V.depthTexture;if(B.__depthDisposeCallback&&B.__depthDisposeCallback(),Pe){const Ue=()=>{delete B.__boundDepthTexture,delete B.__depthDisposeCallback,Pe.removeEventListener("dispose",Ue)};Pe.addEventListener("dispose",Ue),B.__depthDisposeCallback=Ue}B.__boundDepthTexture=Pe}if(V.depthTexture&&!B.__autoAllocateDepthBuffer){if(pe)throw new Error("target.depthTexture not supported in Cube render targets");xe(B.__webglFramebuffer,V)}else if(pe){B.__webglDepthbuffer=[];for(let Pe=0;Pe<6;Pe++)if(t.bindFramebuffer(i.FRAMEBUFFER,B.__webglFramebuffer[Pe]),B.__webglDepthbuffer[Pe]===void 0)B.__webglDepthbuffer[Pe]=i.createRenderbuffer(),ie(B.__webglDepthbuffer[Pe],V,!1);else{const Ue=V.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,we=B.__webglDepthbuffer[Pe];i.bindRenderbuffer(i.RENDERBUFFER,we),i.framebufferRenderbuffer(i.FRAMEBUFFER,Ue,i.RENDERBUFFER,we)}}else if(t.bindFramebuffer(i.FRAMEBUFFER,B.__webglFramebuffer),B.__webglDepthbuffer===void 0)B.__webglDepthbuffer=i.createRenderbuffer(),ie(B.__webglDepthbuffer,V,!1);else{const Pe=V.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Ue=B.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,Ue),i.framebufferRenderbuffer(i.FRAMEBUFFER,Pe,i.RENDERBUFFER,Ue)}t.bindFramebuffer(i.FRAMEBUFFER,null)}function ke(V,B,pe){const Pe=n.get(V);B!==void 0&&Y(Pe.__webglFramebuffer,V,V.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),pe!==void 0&&Ve(V)}function st(V){const B=V.texture,pe=n.get(V),Pe=n.get(B);V.addEventListener("dispose",N);const Ue=V.textures,we=V.isWebGLCubeRenderTarget===!0,Je=Ue.length>1;if(Je||(Pe.__webglTexture===void 0&&(Pe.__webglTexture=i.createTexture()),Pe.__version=B.version,o.memory.textures++),we){pe.__webglFramebuffer=[];for(let je=0;je<6;je++)if(B.mipmaps&&B.mipmaps.length>0){pe.__webglFramebuffer[je]=[];for(let We=0;We<B.mipmaps.length;We++)pe.__webglFramebuffer[je][We]=i.createFramebuffer()}else pe.__webglFramebuffer[je]=i.createFramebuffer()}else{if(B.mipmaps&&B.mipmaps.length>0){pe.__webglFramebuffer=[];for(let je=0;je<B.mipmaps.length;je++)pe.__webglFramebuffer[je]=i.createFramebuffer()}else pe.__webglFramebuffer=i.createFramebuffer();if(Je)for(let je=0,We=Ue.length;je<We;je++){const $t=n.get(Ue[je]);$t.__webglTexture===void 0&&($t.__webglTexture=i.createTexture(),o.memory.textures++)}if(V.samples>0&&yt(V)===!1){pe.__webglMultisampledFramebuffer=i.createFramebuffer(),pe.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,pe.__webglMultisampledFramebuffer);for(let je=0;je<Ue.length;je++){const We=Ue[je];pe.__webglColorRenderbuffer[je]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,pe.__webglColorRenderbuffer[je]);const $t=s.convert(We.format,We.colorSpace),ze=s.convert(We.type),tt=M(We.internalFormat,$t,ze,We.colorSpace,V.isXRRenderTarget===!0),dt=Ot(V);i.renderbufferStorageMultisample(i.RENDERBUFFER,dt,tt,V.width,V.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+je,i.RENDERBUFFER,pe.__webglColorRenderbuffer[je])}i.bindRenderbuffer(i.RENDERBUFFER,null),V.depthBuffer&&(pe.__webglDepthRenderbuffer=i.createRenderbuffer(),ie(pe.__webglDepthRenderbuffer,V,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(we){t.bindTexture(i.TEXTURE_CUBE_MAP,Pe.__webglTexture),Ee(i.TEXTURE_CUBE_MAP,B);for(let je=0;je<6;je++)if(B.mipmaps&&B.mipmaps.length>0)for(let We=0;We<B.mipmaps.length;We++)Y(pe.__webglFramebuffer[je][We],V,B,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+je,We);else Y(pe.__webglFramebuffer[je],V,B,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+je,0);b(B)&&x(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Je){for(let je=0,We=Ue.length;je<We;je++){const $t=Ue[je],ze=n.get($t);t.bindTexture(i.TEXTURE_2D,ze.__webglTexture),Ee(i.TEXTURE_2D,$t),Y(pe.__webglFramebuffer,V,$t,i.COLOR_ATTACHMENT0+je,i.TEXTURE_2D,0),b($t)&&x(i.TEXTURE_2D)}t.unbindTexture()}else{let je=i.TEXTURE_2D;if((V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(je=V.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(je,Pe.__webglTexture),Ee(je,B),B.mipmaps&&B.mipmaps.length>0)for(let We=0;We<B.mipmaps.length;We++)Y(pe.__webglFramebuffer[We],V,B,i.COLOR_ATTACHMENT0,je,We);else Y(pe.__webglFramebuffer,V,B,i.COLOR_ATTACHMENT0,je,0);b(B)&&x(je),t.unbindTexture()}V.depthBuffer&&Ve(V)}function Ct(V){const B=V.textures;for(let pe=0,Pe=B.length;pe<Pe;pe++){const Ue=B[pe];if(b(Ue)){const we=E(V),Je=n.get(Ue).__webglTexture;t.bindTexture(we,Je),x(we),t.unbindTexture()}}}const vt=[],K=[];function Cn(V){if(V.samples>0){if(yt(V)===!1){const B=V.textures,pe=V.width,Pe=V.height;let Ue=i.COLOR_BUFFER_BIT;const we=V.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Je=n.get(V),je=B.length>1;if(je)for(let We=0;We<B.length;We++)t.bindFramebuffer(i.FRAMEBUFFER,Je.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+We,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Je.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+We,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Je.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Je.__webglFramebuffer);for(let We=0;We<B.length;We++){if(V.resolveDepthBuffer&&(V.depthBuffer&&(Ue|=i.DEPTH_BUFFER_BIT),V.stencilBuffer&&V.resolveStencilBuffer&&(Ue|=i.STENCIL_BUFFER_BIT)),je){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Je.__webglColorRenderbuffer[We]);const $t=n.get(B[We]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,$t,0)}i.blitFramebuffer(0,0,pe,Pe,0,0,pe,Pe,Ue,i.NEAREST),c===!0&&(vt.length=0,K.length=0,vt.push(i.COLOR_ATTACHMENT0+We),V.depthBuffer&&V.resolveDepthBuffer===!1&&(vt.push(we),K.push(we),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,K)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,vt))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),je)for(let We=0;We<B.length;We++){t.bindFramebuffer(i.FRAMEBUFFER,Je.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+We,i.RENDERBUFFER,Je.__webglColorRenderbuffer[We]);const $t=n.get(B[We]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Je.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+We,i.TEXTURE_2D,$t,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Je.__webglMultisampledFramebuffer)}else if(V.depthBuffer&&V.resolveDepthBuffer===!1&&c){const B=V.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[B])}}}function Ot(V){return Math.min(r.maxSamples,V.samples)}function yt(V){const B=n.get(V);return V.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&B.__useRenderToTexture!==!1}function ct(V){const B=o.render.frame;d.get(V)!==B&&(d.set(V,B),V.update())}function hn(V,B){const pe=V.colorSpace,Pe=V.format,Ue=V.type;return V.isCompressedTexture===!0||V.isVideoTexture===!0||pe!==qs&&pe!==Vr&&(Ft.getTransfer(pe)===on?(Pe!==qn||Ue!==Wn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",pe)),B}function at(V){return typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement?(f.width=V.naturalWidth||V.width,f.height=V.naturalHeight||V.height):typeof VideoFrame<"u"&&V instanceof VideoFrame?(f.width=V.displayWidth,f.height=V.displayHeight):(f.width=V.width,f.height=V.height),f}this.allocateTextureUnit=J,this.resetTextureUnits=j,this.setTexture2D=$,this.setTexture2DArray=k,this.setTexture3D=G,this.setTextureCube=W,this.rebindTextures=ke,this.setupRenderTarget=st,this.updateRenderTargetMipmap=Ct,this.updateMultisampleRenderTarget=Cn,this.setupDepthRenderbuffer=Ve,this.setupFrameBufferTexture=Y,this.useMultisampledRTT=yt}function m4(i,e){function t(n,r=Vr){let s;const o=Ft.getTransfer(r);if(n===Wn)return i.UNSIGNED_BYTE;if(n===Hg)return i.UNSIGNED_SHORT_4_4_4_4;if(n===jg)return i.UNSIGNED_SHORT_5_5_5_1;if(n===Wg)return i.UNSIGNED_INT_5_9_9_9_REV;if(n===zl)return i.BYTE;if(n===kl)return i.SHORT;if(n===Ms)return i.UNSIGNED_SHORT;if(n===Ri)return i.INT;if(n===Sn)return i.UNSIGNED_INT;if(n===Yn)return i.FLOAT;if(n===Xi)return i.HALF_FLOAT;if(n===Ib)return i.ALPHA;if(n===Rd)return i.RGB;if(n===qn)return i.RGBA;if(n===zb)return i.LUMINANCE;if(n===kb)return i.LUMINANCE_ALPHA;if(n===jr)return i.DEPTH_COMPONENT;if(n===Wr)return i.DEPTH_STENCIL;if(n===Cd)return i.RED;if(n===Qc)return i.RED_INTEGER;if(n===Xl)return i.RG;if(n===Zc)return i.RG_INTEGER;if(n===Jc)return i.RGBA_INTEGER;if(n===Gl||n===Io||n===zo||n===ko)if(o===on)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===Gl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Io)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===zo)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ko)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===Gl)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Io)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===zo)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ko)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===nd||n===id||n===rd||n===sd)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===nd)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===id)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===rd)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===sd)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===ad||n===Ec||n===Mc)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===ad||n===Ec)return o===on?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===Mc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===Ac||n===wc||n===Rc||n===Cc||n===Nc||n===Dc||n===Pc||n===Lc||n===Uc||n===Oc||n===Bc||n===Fc||n===Ic||n===zc)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===Ac)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===wc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Rc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Cc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Nc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Dc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Pc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Lc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Uc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Oc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Bc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Fc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Ic)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===zc)return o===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Vl||n===Px||n===Lx)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===Vl)return o===on?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Px)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Lx)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Gb||n===od||n===ld||n===ud)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===Vl)return s.COMPRESSED_RED_RGTC1_EXT;if(n===od)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===ld)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===ud)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Hr?i.UNSIGNED_INT_24_8:i[n]!==void 0?i[n]:null}return{convert:t}}const g4=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,_4=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class v4{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const r=new _i,s=e.properties.get(r);s.__webglTexture=t.texture,(t.depthNear!==n.depthNear||t.depthFar!==n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new Xs({vertexShader:g4,fragmentShader:_4,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new oi(new Pd(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class y4 extends Ya{constructor(e,t){super();const n=this;let r=null,s=1,o=null,u="local-floor",c=1,f=null,d=null,m=null,g=null,_=null,v=null;const S=new v4,b=t.getContextAttributes();let x=null,E=null;const M=[],A=[],C=new Oe;let w=null;const N=new Ci;N.viewport=new xt;const L=new Ci;L.viewport=new xt;const P=[N,L],D=new yN;let I=null,j=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(q){let Z=M[q];return Z===void 0&&(Z=new ig,M[q]=Z),Z.getTargetRaySpace()},this.getControllerGrip=function(q){let Z=M[q];return Z===void 0&&(Z=new ig,M[q]=Z),Z.getGripSpace()},this.getHand=function(q){let Z=M[q];return Z===void 0&&(Z=new ig,M[q]=Z),Z.getHandSpace()};function J(q){const Z=A.indexOf(q.inputSource);if(Z===-1)return;const Y=M[Z];Y!==void 0&&(Y.update(q.inputSource,q.frame,f||o),Y.dispatchEvent({type:q.type,data:q.inputSource}))}function ue(){r.removeEventListener("select",J),r.removeEventListener("selectstart",J),r.removeEventListener("selectend",J),r.removeEventListener("squeeze",J),r.removeEventListener("squeezestart",J),r.removeEventListener("squeezeend",J),r.removeEventListener("end",ue),r.removeEventListener("inputsourceschange",$);for(let q=0;q<M.length;q++){const Z=A[q];Z!==null&&(A[q]=null,M[q].disconnect(Z))}I=null,j=null,S.reset(),e.setRenderTarget(x),_=null,g=null,m=null,r=null,E=null,De.stop(),n.isPresenting=!1,e.setPixelRatio(w),e.setSize(C.width,C.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(q){s=q,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(q){u=q,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return f||o},this.setReferenceSpace=function(q){f=q},this.getBaseLayer=function(){return g!==null?g:_},this.getBinding=function(){return m},this.getFrame=function(){return v},this.getSession=function(){return r},this.setSession=async function(q){if(r=q,r!==null){if(x=e.getRenderTarget(),r.addEventListener("select",J),r.addEventListener("selectstart",J),r.addEventListener("selectend",J),r.addEventListener("squeeze",J),r.addEventListener("squeezestart",J),r.addEventListener("squeezeend",J),r.addEventListener("end",ue),r.addEventListener("inputsourceschange",$),b.xrCompatible!==!0&&await t.makeXRCompatible(),w=e.getPixelRatio(),e.getSize(C),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Y=null,ie=null,xe=null;b.depth&&(xe=b.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Y=b.stencil?Wr:jr,ie=b.stencil?Hr:Sn);const Ve={colorFormat:t.RGBA8,depthFormat:xe,scaleFactor:s};m=new XRWebGLBinding(r,t),g=m.createProjectionLayer(Ve),r.updateRenderState({layers:[g]}),e.setPixelRatio(1),e.setSize(g.textureWidth,g.textureHeight,!1),E=new $o(g.textureWidth,g.textureHeight,{format:qn,type:Wn,depthTexture:new ss(g.textureWidth,g.textureHeight,ie,void 0,void 0,void 0,void 0,void 0,void 0,Y),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0,resolveDepthBuffer:g.ignoreDepthValues===!1,resolveStencilBuffer:g.ignoreDepthValues===!1})}else{const Y={antialias:b.antialias,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:s};_=new XRWebGLLayer(r,t,Y),r.updateRenderState({baseLayer:_}),e.setPixelRatio(1),e.setSize(_.framebufferWidth,_.framebufferHeight,!1),E=new $o(_.framebufferWidth,_.framebufferHeight,{format:qn,type:Wn,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil,resolveDepthBuffer:_.ignoreDepthValues===!1,resolveStencilBuffer:_.ignoreDepthValues===!1})}E.isXRRenderTarget=!0,this.setFoveation(c),f=null,o=await r.requestReferenceSpace(u),De.setContext(r),De.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return S.getDepthTexture()};function $(q){for(let Z=0;Z<q.removed.length;Z++){const Y=q.removed[Z],ie=A.indexOf(Y);ie>=0&&(A[ie]=null,M[ie].disconnect(Y))}for(let Z=0;Z<q.added.length;Z++){const Y=q.added[Z];let ie=A.indexOf(Y);if(ie===-1){for(let Ve=0;Ve<M.length;Ve++)if(Ve>=A.length){A.push(Y),ie=Ve;break}else if(A[Ve]===null){A[Ve]=Y,ie=Ve;break}if(ie===-1)break}const xe=M[ie];xe&&xe.connect(Y)}}const k=new H,G=new H;function W(q,Z,Y){k.setFromMatrixPosition(Z.matrixWorld),G.setFromMatrixPosition(Y.matrixWorld);const ie=k.distanceTo(G),xe=Z.projectionMatrix.elements,Ve=Y.projectionMatrix.elements,ke=xe[14]/(xe[10]-1),st=xe[14]/(xe[10]+1),Ct=(xe[9]+1)/xe[5],vt=(xe[9]-1)/xe[5],K=(xe[8]-1)/xe[0],Cn=(Ve[8]+1)/Ve[0],Ot=ke*K,yt=ke*Cn,ct=ie/(-K+Cn),hn=ct*-K;if(Z.matrixWorld.decompose(q.position,q.quaternion,q.scale),q.translateX(hn),q.translateZ(ct),q.matrixWorld.compose(q.position,q.quaternion,q.scale),q.matrixWorldInverse.copy(q.matrixWorld).invert(),xe[10]===-1)q.projectionMatrix.copy(Z.projectionMatrix),q.projectionMatrixInverse.copy(Z.projectionMatrixInverse);else{const at=ke+ct,V=st+ct,B=Ot-hn,pe=yt+(ie-hn),Pe=Ct*st/V*at,Ue=vt*st/V*at;q.projectionMatrix.makePerspective(B,pe,Pe,Ue,at,V),q.projectionMatrixInverse.copy(q.projectionMatrix).invert()}}function ce(q,Z){Z===null?q.matrixWorld.copy(q.matrix):q.matrixWorld.multiplyMatrices(Z.matrixWorld,q.matrix),q.matrixWorldInverse.copy(q.matrixWorld).invert()}this.updateCamera=function(q){if(r===null)return;let Z=q.near,Y=q.far;S.texture!==null&&(S.depthNear>0&&(Z=S.depthNear),S.depthFar>0&&(Y=S.depthFar)),D.near=L.near=N.near=Z,D.far=L.far=N.far=Y,(I!==D.near||j!==D.far)&&(r.updateRenderState({depthNear:D.near,depthFar:D.far}),I=D.near,j=D.far),N.layers.mask=q.layers.mask|2,L.layers.mask=q.layers.mask|4,D.layers.mask=N.layers.mask|L.layers.mask;const ie=q.parent,xe=D.cameras;ce(D,ie);for(let Ve=0;Ve<xe.length;Ve++)ce(xe[Ve],ie);xe.length===2?W(D,N,L):D.projectionMatrix.copy(N.projectionMatrix),z(q,D,ie)};function z(q,Z,Y){Y===null?q.matrix.copy(Z.matrixWorld):(q.matrix.copy(Y.matrixWorld),q.matrix.invert(),q.matrix.multiply(Z.matrixWorld)),q.matrix.decompose(q.position,q.quaternion,q.scale),q.updateMatrixWorld(!0),q.projectionMatrix.copy(Z.projectionMatrix),q.projectionMatrixInverse.copy(Z.projectionMatrixInverse),q.isPerspectiveCamera&&(q.fov=Yl*2*Math.atan(1/q.projectionMatrix.elements[5]),q.zoom=1)}this.getCamera=function(){return D},this.getFoveation=function(){if(!(g===null&&_===null))return c},this.setFoveation=function(q){c=q,g!==null&&(g.fixedFoveation=q),_!==null&&_.fixedFoveation!==void 0&&(_.fixedFoveation=q)},this.hasDepthSensing=function(){return S.texture!==null},this.getDepthSensingMesh=function(){return S.getMesh(D)};let le=null;function Ee(q,Z){if(d=Z.getViewerPose(f||o),v=Z,d!==null){const Y=d.views;_!==null&&(e.setRenderTargetFramebuffer(E,_.framebuffer),e.setRenderTarget(E));let ie=!1;Y.length!==D.cameras.length&&(D.cameras.length=0,ie=!0);for(let ke=0;ke<Y.length;ke++){const st=Y[ke];let Ct=null;if(_!==null)Ct=_.getViewport(st);else{const K=m.getViewSubImage(g,st);Ct=K.viewport,ke===0&&(e.setRenderTargetTextures(E,K.colorTexture,K.depthStencilTexture),e.setRenderTarget(E))}let vt=P[ke];vt===void 0&&(vt=new Ci,vt.layers.enable(ke),vt.viewport=new xt,P[ke]=vt),vt.matrix.fromArray(st.transform.matrix),vt.matrix.decompose(vt.position,vt.quaternion,vt.scale),vt.projectionMatrix.fromArray(st.projectionMatrix),vt.projectionMatrixInverse.copy(vt.projectionMatrix).invert(),vt.viewport.set(Ct.x,Ct.y,Ct.width,Ct.height),ke===0&&(D.matrix.copy(vt.matrix),D.matrix.decompose(D.position,D.quaternion,D.scale)),ie===!0&&D.cameras.push(vt)}const xe=r.enabledFeatures;if(xe&&xe.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&m){const ke=m.getDepthInformation(Y[0]);ke&&ke.isValid&&ke.texture&&S.init(e,ke,r.renderState)}}for(let Y=0;Y<M.length;Y++){const ie=A[Y],xe=M[Y];ie!==null&&xe!==void 0&&xe.update(ie,Z,f||o)}le&&le(q,Z),Z.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Z}),v=null}const De=new SN;De.setAnimationLoop(Ee),this.setAnimationLoop=function(q){le=q},this.dispose=function(){}}}const El=new Tr,x4=new qt;function b4(i,e){function t(b,x){b.matrixAutoUpdate===!0&&b.updateMatrix(),x.value.copy(b.matrix)}function n(b,x){x.color.getRGB(b.fogColor.value,oN(i)),x.isFog?(b.fogNear.value=x.near,b.fogFar.value=x.far):x.isFogExp2&&(b.fogDensity.value=x.density)}function r(b,x,E,M,A){x.isMeshBasicMaterial||x.isMeshLambertMaterial?s(b,x):x.isMeshToonMaterial?(s(b,x),m(b,x)):x.isMeshPhongMaterial?(s(b,x),d(b,x)):x.isMeshStandardMaterial?(s(b,x),g(b,x),x.isMeshPhysicalMaterial&&_(b,x,A)):x.isMeshMatcapMaterial?(s(b,x),v(b,x)):x.isMeshDepthMaterial?s(b,x):x.isMeshDistanceMaterial?(s(b,x),S(b,x)):x.isMeshNormalMaterial?s(b,x):x.isLineBasicMaterial?(o(b,x),x.isLineDashedMaterial&&u(b,x)):x.isPointsMaterial?c(b,x,E,M):x.isSpriteMaterial?f(b,x):x.isShadowMaterial?(b.color.value.copy(x.color),b.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function s(b,x){b.opacity.value=x.opacity,x.color&&b.diffuse.value.copy(x.color),x.emissive&&b.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(b.map.value=x.map,t(x.map,b.mapTransform)),x.alphaMap&&(b.alphaMap.value=x.alphaMap,t(x.alphaMap,b.alphaMapTransform)),x.bumpMap&&(b.bumpMap.value=x.bumpMap,t(x.bumpMap,b.bumpMapTransform),b.bumpScale.value=x.bumpScale,x.side===Tn&&(b.bumpScale.value*=-1)),x.normalMap&&(b.normalMap.value=x.normalMap,t(x.normalMap,b.normalMapTransform),b.normalScale.value.copy(x.normalScale),x.side===Tn&&b.normalScale.value.negate()),x.displacementMap&&(b.displacementMap.value=x.displacementMap,t(x.displacementMap,b.displacementMapTransform),b.displacementScale.value=x.displacementScale,b.displacementBias.value=x.displacementBias),x.emissiveMap&&(b.emissiveMap.value=x.emissiveMap,t(x.emissiveMap,b.emissiveMapTransform)),x.specularMap&&(b.specularMap.value=x.specularMap,t(x.specularMap,b.specularMapTransform)),x.alphaTest>0&&(b.alphaTest.value=x.alphaTest);const E=e.get(x),M=E.envMap,A=E.envMapRotation;M&&(b.envMap.value=M,El.copy(A),El.x*=-1,El.y*=-1,El.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(El.y*=-1,El.z*=-1),b.envMapRotation.value.setFromMatrix4(x4.makeRotationFromEuler(El)),b.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,b.reflectivity.value=x.reflectivity,b.ior.value=x.ior,b.refractionRatio.value=x.refractionRatio),x.lightMap&&(b.lightMap.value=x.lightMap,b.lightMapIntensity.value=x.lightMapIntensity,t(x.lightMap,b.lightMapTransform)),x.aoMap&&(b.aoMap.value=x.aoMap,b.aoMapIntensity.value=x.aoMapIntensity,t(x.aoMap,b.aoMapTransform))}function o(b,x){b.diffuse.value.copy(x.color),b.opacity.value=x.opacity,x.map&&(b.map.value=x.map,t(x.map,b.mapTransform))}function u(b,x){b.dashSize.value=x.dashSize,b.totalSize.value=x.dashSize+x.gapSize,b.scale.value=x.scale}function c(b,x,E,M){b.diffuse.value.copy(x.color),b.opacity.value=x.opacity,b.size.value=x.size*E,b.scale.value=M*.5,x.map&&(b.map.value=x.map,t(x.map,b.uvTransform)),x.alphaMap&&(b.alphaMap.value=x.alphaMap,t(x.alphaMap,b.alphaMapTransform)),x.alphaTest>0&&(b.alphaTest.value=x.alphaTest)}function f(b,x){b.diffuse.value.copy(x.color),b.opacity.value=x.opacity,b.rotation.value=x.rotation,x.map&&(b.map.value=x.map,t(x.map,b.mapTransform)),x.alphaMap&&(b.alphaMap.value=x.alphaMap,t(x.alphaMap,b.alphaMapTransform)),x.alphaTest>0&&(b.alphaTest.value=x.alphaTest)}function d(b,x){b.specular.value.copy(x.specular),b.shininess.value=Math.max(x.shininess,1e-4)}function m(b,x){x.gradientMap&&(b.gradientMap.value=x.gradientMap)}function g(b,x){b.metalness.value=x.metalness,x.metalnessMap&&(b.metalnessMap.value=x.metalnessMap,t(x.metalnessMap,b.metalnessMapTransform)),b.roughness.value=x.roughness,x.roughnessMap&&(b.roughnessMap.value=x.roughnessMap,t(x.roughnessMap,b.roughnessMapTransform)),x.envMap&&(b.envMapIntensity.value=x.envMapIntensity)}function _(b,x,E){b.ior.value=x.ior,x.sheen>0&&(b.sheenColor.value.copy(x.sheenColor).multiplyScalar(x.sheen),b.sheenRoughness.value=x.sheenRoughness,x.sheenColorMap&&(b.sheenColorMap.value=x.sheenColorMap,t(x.sheenColorMap,b.sheenColorMapTransform)),x.sheenRoughnessMap&&(b.sheenRoughnessMap.value=x.sheenRoughnessMap,t(x.sheenRoughnessMap,b.sheenRoughnessMapTransform))),x.clearcoat>0&&(b.clearcoat.value=x.clearcoat,b.clearcoatRoughness.value=x.clearcoatRoughness,x.clearcoatMap&&(b.clearcoatMap.value=x.clearcoatMap,t(x.clearcoatMap,b.clearcoatMapTransform)),x.clearcoatRoughnessMap&&(b.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap,t(x.clearcoatRoughnessMap,b.clearcoatRoughnessMapTransform)),x.clearcoatNormalMap&&(b.clearcoatNormalMap.value=x.clearcoatNormalMap,t(x.clearcoatNormalMap,b.clearcoatNormalMapTransform),b.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),x.side===Tn&&b.clearcoatNormalScale.value.negate())),x.dispersion>0&&(b.dispersion.value=x.dispersion),x.iridescence>0&&(b.iridescence.value=x.iridescence,b.iridescenceIOR.value=x.iridescenceIOR,b.iridescenceThicknessMinimum.value=x.iridescenceThicknessRange[0],b.iridescenceThicknessMaximum.value=x.iridescenceThicknessRange[1],x.iridescenceMap&&(b.iridescenceMap.value=x.iridescenceMap,t(x.iridescenceMap,b.iridescenceMapTransform)),x.iridescenceThicknessMap&&(b.iridescenceThicknessMap.value=x.iridescenceThicknessMap,t(x.iridescenceThicknessMap,b.iridescenceThicknessMapTransform))),x.transmission>0&&(b.transmission.value=x.transmission,b.transmissionSamplerMap.value=E.texture,b.transmissionSamplerSize.value.set(E.width,E.height),x.transmissionMap&&(b.transmissionMap.value=x.transmissionMap,t(x.transmissionMap,b.transmissionMapTransform)),b.thickness.value=x.thickness,x.thicknessMap&&(b.thicknessMap.value=x.thicknessMap,t(x.thicknessMap,b.thicknessMapTransform)),b.attenuationDistance.value=x.attenuationDistance,b.attenuationColor.value.copy(x.attenuationColor)),x.anisotropy>0&&(b.anisotropyVector.value.set(x.anisotropy*Math.cos(x.anisotropyRotation),x.anisotropy*Math.sin(x.anisotropyRotation)),x.anisotropyMap&&(b.anisotropyMap.value=x.anisotropyMap,t(x.anisotropyMap,b.anisotropyMapTransform))),b.specularIntensity.value=x.specularIntensity,b.specularColor.value.copy(x.specularColor),x.specularColorMap&&(b.specularColorMap.value=x.specularColorMap,t(x.specularColorMap,b.specularColorMapTransform)),x.specularIntensityMap&&(b.specularIntensityMap.value=x.specularIntensityMap,t(x.specularIntensityMap,b.specularIntensityMapTransform))}function v(b,x){x.matcap&&(b.matcap.value=x.matcap)}function S(b,x){const E=e.get(x).light;b.referencePosition.value.setFromMatrixPosition(E.matrixWorld),b.nearDistance.value=E.shadow.camera.near,b.farDistance.value=E.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function S4(i,e,t,n){let r={},s={},o=[];const u=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function c(E,M){const A=M.program;n.uniformBlockBinding(E,A)}function f(E,M){let A=r[E.id];A===void 0&&(v(E),A=d(E),r[E.id]=A,E.addEventListener("dispose",b));const C=M.program;n.updateUBOMapping(E,C);const w=e.render.frame;s[E.id]!==w&&(g(E),s[E.id]=w)}function d(E){const M=m();E.__bindingPointIndex=M;const A=i.createBuffer(),C=E.__size,w=E.usage;return i.bindBuffer(i.UNIFORM_BUFFER,A),i.bufferData(i.UNIFORM_BUFFER,C,w),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,M,A),A}function m(){for(let E=0;E<u;E++)if(o.indexOf(E)===-1)return o.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function g(E){const M=r[E.id],A=E.uniforms,C=E.__cache;i.bindBuffer(i.UNIFORM_BUFFER,M);for(let w=0,N=A.length;w<N;w++){const L=Array.isArray(A[w])?A[w]:[A[w]];for(let P=0,D=L.length;P<D;P++){const I=L[P];if(_(I,w,P,C)===!0){const j=I.__offset,J=Array.isArray(I.value)?I.value:[I.value];let ue=0;for(let $=0;$<J.length;$++){const k=J[$],G=S(k);typeof k=="number"||typeof k=="boolean"?(I.__data[0]=k,i.bufferSubData(i.UNIFORM_BUFFER,j+ue,I.__data)):k.isMatrix3?(I.__data[0]=k.elements[0],I.__data[1]=k.elements[1],I.__data[2]=k.elements[2],I.__data[3]=0,I.__data[4]=k.elements[3],I.__data[5]=k.elements[4],I.__data[6]=k.elements[5],I.__data[7]=0,I.__data[8]=k.elements[6],I.__data[9]=k.elements[7],I.__data[10]=k.elements[8],I.__data[11]=0):(k.toArray(I.__data,ue),ue+=G.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,j,I.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function _(E,M,A,C){const w=E.value,N=M+"_"+A;if(C[N]===void 0)return typeof w=="number"||typeof w=="boolean"?C[N]=w:C[N]=w.clone(),!0;{const L=C[N];if(typeof w=="number"||typeof w=="boolean"){if(L!==w)return C[N]=w,!0}else if(L.equals(w)===!1)return L.copy(w),!0}return!1}function v(E){const M=E.uniforms;let A=0;const C=16;for(let N=0,L=M.length;N<L;N++){const P=Array.isArray(M[N])?M[N]:[M[N]];for(let D=0,I=P.length;D<I;D++){const j=P[D],J=Array.isArray(j.value)?j.value:[j.value];for(let ue=0,$=J.length;ue<$;ue++){const k=J[ue],G=S(k),W=A%C,ce=W%G.boundary,z=W+ce;A+=ce,z!==0&&C-z<G.storage&&(A+=C-z),j.__data=new Float32Array(G.storage/Float32Array.BYTES_PER_ELEMENT),j.__offset=A,A+=G.storage}}}const w=A%C;return w>0&&(A+=C-w),E.__size=A,E.__cache={},this}function S(E){const M={boundary:0,storage:0};return typeof E=="number"||typeof E=="boolean"?(M.boundary=4,M.storage=4):E.isVector2?(M.boundary=8,M.storage=8):E.isVector3||E.isColor?(M.boundary=16,M.storage=12):E.isVector4?(M.boundary=16,M.storage=16):E.isMatrix3?(M.boundary=48,M.storage=48):E.isMatrix4?(M.boundary=64,M.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),M}function b(E){const M=E.target;M.removeEventListener("dispose",b);const A=o.indexOf(M.__bindingPointIndex);o.splice(A,1),i.deleteBuffer(r[M.id]),delete r[M.id],delete s[M.id]}function x(){for(const E in r)i.deleteBuffer(r[E]);o=[],r={},s={}}return{bind:c,update:f,dispose:x}}class T4{constructor(e={}){const{canvas:t=rN(),context:n=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:u=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:f=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:m=!1,reverseDepthBuffer:g=!1}=e;this.isWebGLRenderer=!0;let _;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");_=n.getContextAttributes().alpha}else _=o;const v=new Uint32Array(4),S=new Int32Array(4);let b=null,x=null;const E=[],M=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Sr,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const A=this;let C=!1;this._outputColorSpace=ut;let w=0,N=0,L=null,P=-1,D=null;const I=new xt,j=new xt;let J=null;const ue=new it(0);let $=0,k=t.width,G=t.height,W=1,ce=null,z=null;const le=new xt(0,0,k,G),Ee=new xt(0,0,k,G);let De=!1;const q=new Qg;let Z=!1,Y=!1;const ie=new qt,xe=new qt,Ve=new H,ke=new xt,st={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ct=!1;function vt(){return L===null?W:1}let K=n;function Cn(F,se){return t.getContext(F,se)}try{const F={alpha:!0,depth:r,stencil:s,antialias:u,premultipliedAlpha:c,preserveDrawingBuffer:f,powerPreference:d,failIfMajorPerformanceCaveat:m};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Kc}`),t.addEventListener("webglcontextlost",Ce,!1),t.addEventListener("webglcontextrestored",Ze,!1),t.addEventListener("webglcontextcreationerror",Ke,!1),K===null){const se="webgl2";if(K=Cn(se,F),K===null)throw Cn(se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(F){throw console.error("THREE.WebGLRenderer: "+F.message),F}let Ot,yt,ct,hn,at,V,B,pe,Pe,Ue,we,Je,je,We,$t,ze,tt,dt,mt,Qe,zt,Et,fn,te;function Ye(){Ot=new Lk(K),Ot.init(),Et=new m4(K,Ot),yt=new Ak(K,Ot,e,Et),ct=new d4(K,Ot),yt.reverseDepthBuffer&&g&&ct.buffers.depth.setReversed(!0),hn=new Bk(K),at=new e4,V=new p4(K,Ot,ct,at,yt,Et,hn),B=new Rk(A),pe=new Pk(A),Pe=new VF(K),fn=new Ek(K,Pe),Ue=new Uk(K,Pe,hn,fn),we=new Ik(K,Ue,Pe,hn),mt=new Fk(K,yt,V),ze=new wk(at),Je=new JG(A,B,pe,Ot,yt,fn,ze),je=new b4(A,at),We=new n4,$t=new l4(Ot),dt=new Tk(A,B,pe,ct,we,_,c),tt=new h4(A,we,yt),te=new S4(K,hn,yt,ct),Qe=new Mk(K,Ot,hn),zt=new Ok(K,Ot,hn),hn.programs=Je.programs,A.capabilities=yt,A.extensions=Ot,A.properties=at,A.renderLists=We,A.shadowMap=tt,A.state=ct,A.info=hn}Ye();const Se=new y4(A,K);this.xr=Se,this.getContext=function(){return K},this.getContextAttributes=function(){return K.getContextAttributes()},this.forceContextLoss=function(){const F=Ot.get("WEBGL_lose_context");F&&F.loseContext()},this.forceContextRestore=function(){const F=Ot.get("WEBGL_lose_context");F&&F.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(F){F!==void 0&&(W=F,this.setSize(k,G,!1))},this.getSize=function(F){return F.set(k,G)},this.setSize=function(F,se,_e=!0){if(Se.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}k=F,G=se,t.width=Math.floor(F*W),t.height=Math.floor(se*W),_e===!0&&(t.style.width=F+"px",t.style.height=se+"px"),this.setViewport(0,0,F,se)},this.getDrawingBufferSize=function(F){return F.set(k*W,G*W).floor()},this.setDrawingBufferSize=function(F,se,_e){k=F,G=se,W=_e,t.width=Math.floor(F*_e),t.height=Math.floor(se*_e),this.setViewport(0,0,F,se)},this.getCurrentViewport=function(F){return F.copy(I)},this.getViewport=function(F){return F.copy(le)},this.setViewport=function(F,se,_e,ve){F.isVector4?le.set(F.x,F.y,F.z,F.w):le.set(F,se,_e,ve),ct.viewport(I.copy(le).multiplyScalar(W).round())},this.getScissor=function(F){return F.copy(Ee)},this.setScissor=function(F,se,_e,ve){F.isVector4?Ee.set(F.x,F.y,F.z,F.w):Ee.set(F,se,_e,ve),ct.scissor(j.copy(Ee).multiplyScalar(W).round())},this.getScissorTest=function(){return De},this.setScissorTest=function(F){ct.setScissorTest(De=F)},this.setOpaqueSort=function(F){ce=F},this.setTransparentSort=function(F){z=F},this.getClearColor=function(F){return F.copy(dt.getClearColor())},this.setClearColor=function(){dt.setClearColor(...arguments)},this.getClearAlpha=function(){return dt.getClearAlpha()},this.setClearAlpha=function(){dt.setClearAlpha(...arguments)},this.clear=function(F=!0,se=!0,_e=!0){let ve=0;if(F){let ae=!1;if(L!==null){const Be=L.texture.format;ae=Be===Jc||Be===Zc||Be===Qc}if(ae){const Be=L.texture.type,qe=Be===Wn||Be===Sn||Be===Ms||Be===Hr||Be===Hg||Be===jg,$e=dt.getClearColor(),et=dt.getClearAlpha(),bt=$e.r,ht=$e.g,lt=$e.b;qe?(v[0]=bt,v[1]=ht,v[2]=lt,v[3]=et,K.clearBufferuiv(K.COLOR,0,v)):(S[0]=bt,S[1]=ht,S[2]=lt,S[3]=et,K.clearBufferiv(K.COLOR,0,S))}else ve|=K.COLOR_BUFFER_BIT}se&&(ve|=K.DEPTH_BUFFER_BIT),_e&&(ve|=K.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),K.clear(ve)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ce,!1),t.removeEventListener("webglcontextrestored",Ze,!1),t.removeEventListener("webglcontextcreationerror",Ke,!1),dt.dispose(),We.dispose(),$t.dispose(),at.dispose(),B.dispose(),pe.dispose(),we.dispose(),fn.dispose(),te.dispose(),Je.dispose(),Se.dispose(),Se.removeEventListener("sessionstart",ci),Se.removeEventListener("sessionend",Ni),ar.stop()};function Ce(F){F.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function Ze(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const F=hn.autoReset,se=tt.enabled,_e=tt.autoUpdate,ve=tt.needsUpdate,ae=tt.type;Ye(),hn.autoReset=F,tt.enabled=se,tt.autoUpdate=_e,tt.needsUpdate=ve,tt.type=ae}function Ke(F){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",F.statusMessage)}function Nt(F){const se=F.target;se.removeEventListener("dispose",Nt),En(se)}function En(F){Jn(F),at.remove(F)}function Jn(F){const se=at.get(F).programs;se!==void 0&&(se.forEach(function(_e){Je.releaseProgram(_e)}),F.isShaderMaterial&&Je.releaseShaderCache(F))}this.renderBufferDirect=function(F,se,_e,ve,ae,Be){se===null&&(se=st);const qe=ae.isMesh&&ae.matrixWorld.determinant()<0,$e=nl(F,se,_e,ve,ae);ct.setMaterial(ve,qe);let et=_e.index,bt=1;if(ve.wireframe===!0){if(et=Ue.getWireframeAttribute(_e),et===void 0)return;bt=2}const ht=_e.drawRange,lt=_e.attributes.position;let Ht=ht.start*bt,tn=(ht.start+ht.count)*bt;Be!==null&&(Ht=Math.max(Ht,Be.start*bt),tn=Math.min(tn,(Be.start+Be.count)*bt)),et!==null?(Ht=Math.max(Ht,0),tn=Math.min(tn,et.count)):lt!=null&&(Ht=Math.max(Ht,0),tn=Math.min(tn,lt.count));const Fn=tn-Ht;if(Fn<0||Fn===1/0)return;fn.setup(ae,ve,$e,_e,et);let Xt,Yt=Qe;if(et!==null&&(Xt=Pe.get(et),Yt=zt,Yt.setIndex(Xt)),ae.isMesh)ve.wireframe===!0?(ct.setLineWidth(ve.wireframeLinewidth*vt()),Yt.setMode(K.LINES)):Yt.setMode(K.TRIANGLES);else if(ae.isLine){let ft=ve.linewidth;ft===void 0&&(ft=1),ct.setLineWidth(ft*vt()),ae.isLineSegments?Yt.setMode(K.LINES):ae.isLineLoop?Yt.setMode(K.LINE_LOOP):Yt.setMode(K.LINE_STRIP)}else ae.isPoints?Yt.setMode(K.POINTS):ae.isSprite&&Yt.setMode(K.TRIANGLES);if(ae.isBatchedMesh)if(ae._multiDrawInstances!==null)ws("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Yt.renderMultiDrawInstances(ae._multiDrawStarts,ae._multiDrawCounts,ae._multiDrawCount,ae._multiDrawInstances);else if(Ot.get("WEBGL_multi_draw"))Yt.renderMultiDraw(ae._multiDrawStarts,ae._multiDrawCounts,ae._multiDrawCount);else{const ft=ae._multiDrawStarts,Vn=ae._multiDrawCounts,Qt=ae._multiDrawCount,zi=et?Pe.get(et).bytesPerElement:1,no=at.get(ve).currentProgram.getUniforms();for(let Mn=0;Mn<Qt;Mn++)no.setValue(K,"_gl_DrawID",Mn),Yt.render(ft[Mn]/zi,Vn[Mn])}else if(ae.isInstancedMesh)Yt.renderInstances(Ht,Fn,ae.count);else if(_e.isInstancedBufferGeometry){const ft=_e._maxInstanceCount!==void 0?_e._maxInstanceCount:1/0,Vn=Math.min(_e.instanceCount,ft);Yt.renderInstances(Ht,Fn,Vn)}else Yt.render(Ht,Fn)};function en(F,se,_e){F.transparent===!0&&F.side===Ji&&F.forceSinglePass===!1?(F.side=Tn,F.needsUpdate=!0,eo(F,se,_e),F.side=xr,F.needsUpdate=!0,eo(F,se,_e),F.side=Ji):eo(F,se,_e)}this.compile=function(F,se,_e=null){_e===null&&(_e=F),x=$t.get(_e),x.init(se),M.push(x),_e.traverseVisible(function(ae){ae.isLight&&ae.layers.test(se.layers)&&(x.pushLight(ae),ae.castShadow&&x.pushShadow(ae))}),F!==_e&&F.traverseVisible(function(ae){ae.isLight&&ae.layers.test(se.layers)&&(x.pushLight(ae),ae.castShadow&&x.pushShadow(ae))}),x.setupLights();const ve=new Set;return F.traverse(function(ae){if(!(ae.isMesh||ae.isPoints||ae.isLine||ae.isSprite))return;const Be=ae.material;if(Be)if(Array.isArray(Be))for(let qe=0;qe<Be.length;qe++){const $e=Be[qe];en($e,_e,ae),ve.add($e)}else en(Be,_e,ae),ve.add(Be)}),x=M.pop(),ve},this.compileAsync=function(F,se,_e=null){const ve=this.compile(F,se,_e);return new Promise(ae=>{function Be(){if(ve.forEach(function(qe){at.get(qe).currentProgram.isReady()&&ve.delete(qe)}),ve.size===0){ae(F);return}setTimeout(Be,10)}Ot.get("KHR_parallel_shader_compile")!==null?Be():setTimeout(Be,10)})};let wr=null;function bi(F){wr&&wr(F)}function ci(){ar.stop()}function Ni(){ar.start()}const ar=new SN;ar.setAnimationLoop(bi),typeof self<"u"&&ar.setContext(self),this.setAnimationLoop=function(F){wr=F,Se.setAnimationLoop(F),F===null?ar.stop():ar.start()},Se.addEventListener("sessionstart",ci),Se.addEventListener("sessionend",Ni),this.render=function(F,se){if(se!==void 0&&se.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(C===!0)return;if(F.matrixWorldAutoUpdate===!0&&F.updateMatrixWorld(),se.parent===null&&se.matrixWorldAutoUpdate===!0&&se.updateMatrixWorld(),Se.enabled===!0&&Se.isPresenting===!0&&(Se.cameraAutoUpdate===!0&&Se.updateCamera(se),se=Se.getCamera()),F.isScene===!0&&F.onBeforeRender(A,F,se,L),x=$t.get(F,M.length),x.init(se),M.push(x),xe.multiplyMatrices(se.projectionMatrix,se.matrixWorldInverse),q.setFromProjectionMatrix(xe),Y=this.localClippingEnabled,Z=ze.init(this.clippingPlanes,Y),b=We.get(F,E.length),b.init(),E.push(b),Se.enabled===!0&&Se.isPresenting===!0){const Be=A.xr.getDepthSensingMesh();Be!==null&&el(Be,se,-1/0,A.sortObjects)}el(F,se,0,A.sortObjects),b.finish(),A.sortObjects===!0&&b.sort(ce,z),Ct=Se.enabled===!1||Se.isPresenting===!1||Se.hasDepthSensing()===!1,Ct&&dt.addToRenderList(b,F),this.info.render.frame++,Z===!0&&ze.beginShadows();const _e=x.state.shadowsArray;tt.render(_e,F,se),Z===!0&&ze.endShadows(),this.info.autoReset===!0&&this.info.reset();const ve=b.opaque,ae=b.transmissive;if(x.setupLights(),se.isArrayCamera){const Be=se.cameras;if(ae.length>0)for(let qe=0,$e=Be.length;qe<$e;qe++){const et=Be[qe];jd(ve,ae,F,et)}Ct&&dt.render(F);for(let qe=0,$e=Be.length;qe<$e;qe++){const et=Be[qe];Hd(b,F,et,et.viewport)}}else ae.length>0&&jd(ve,ae,F,se),Ct&&dt.render(F),Hd(b,F,se);L!==null&&N===0&&(V.updateMultisampleRenderTarget(L),V.updateRenderTargetMipmap(L)),F.isScene===!0&&F.onAfterRender(A,F,se),fn.resetDefaultState(),P=-1,D=null,M.pop(),M.length>0?(x=M[M.length-1],Z===!0&&ze.setGlobalState(A.clippingPlanes,x.state.camera)):x=null,E.pop(),E.length>0?b=E[E.length-1]:b=null};function el(F,se,_e,ve){if(F.visible===!1)return;if(F.layers.test(se.layers)){if(F.isGroup)_e=F.renderOrder;else if(F.isLOD)F.autoUpdate===!0&&F.update(se);else if(F.isLight)x.pushLight(F),F.castShadow&&x.pushShadow(F);else if(F.isSprite){if(!F.frustumCulled||q.intersectsSprite(F)){ve&&ke.setFromMatrixPosition(F.matrixWorld).applyMatrix4(xe);const qe=we.update(F),$e=F.material;$e.visible&&b.push(F,qe,$e,_e,ke.z,null)}}else if((F.isMesh||F.isLine||F.isPoints)&&(!F.frustumCulled||q.intersectsObject(F))){const qe=we.update(F),$e=F.material;if(ve&&(F.boundingSphere!==void 0?(F.boundingSphere===null&&F.computeBoundingSphere(),ke.copy(F.boundingSphere.center)):(qe.boundingSphere===null&&qe.computeBoundingSphere(),ke.copy(qe.boundingSphere.center)),ke.applyMatrix4(F.matrixWorld).applyMatrix4(xe)),Array.isArray($e)){const et=qe.groups;for(let bt=0,ht=et.length;bt<ht;bt++){const lt=et[bt],Ht=$e[lt.materialIndex];Ht&&Ht.visible&&b.push(F,qe,Ht,_e,ke.z,lt)}}else $e.visible&&b.push(F,qe,$e,_e,ke.z,null)}}const Be=F.children;for(let qe=0,$e=Be.length;qe<$e;qe++)el(Be[qe],se,_e,ve)}function Hd(F,se,_e,ve){const ae=F.opaque,Be=F.transmissive,qe=F.transparent;x.setupLightsView(_e),Z===!0&&ze.setGlobalState(A.clippingPlanes,_e),ve&&ct.viewport(I.copy(ve)),ae.length>0&&tl(ae,se,_e),Be.length>0&&tl(Be,se,_e),qe.length>0&&tl(qe,se,_e),ct.buffers.depth.setTest(!0),ct.buffers.depth.setMask(!0),ct.buffers.color.setMask(!0),ct.setPolygonOffset(!1)}function jd(F,se,_e,ve){if((_e.isScene===!0?_e.overrideMaterial:null)!==null)return;x.state.transmissionRenderTarget[ve.id]===void 0&&(x.state.transmissionRenderTarget[ve.id]=new $o(1,1,{generateMipmaps:!0,type:Ot.has("EXT_color_buffer_half_float")||Ot.has("EXT_color_buffer_float")?Xi:Wn,minFilter:mr,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Ft.workingColorSpace}));const Be=x.state.transmissionRenderTarget[ve.id],qe=ve.viewport||I;Be.setSize(qe.z*A.transmissionResolutionScale,qe.w*A.transmissionResolutionScale);const $e=A.getRenderTarget();A.setRenderTarget(Be),A.getClearColor(ue),$=A.getClearAlpha(),$<1&&A.setClearColor(16777215,.5),A.clear(),Ct&&dt.render(_e);const et=A.toneMapping;A.toneMapping=Sr;const bt=ve.viewport;if(ve.viewport!==void 0&&(ve.viewport=void 0),x.setupLightsView(ve),Z===!0&&ze.setGlobalState(A.clippingPlanes,ve),tl(F,_e,ve),V.updateMultisampleRenderTarget(Be),V.updateRenderTargetMipmap(Be),Ot.has("WEBGL_multisampled_render_to_texture")===!1){let ht=!1;for(let lt=0,Ht=se.length;lt<Ht;lt++){const tn=se[lt],Fn=tn.object,Xt=tn.geometry,Yt=tn.material,ft=tn.group;if(Yt.side===Ji&&Fn.layers.test(ve.layers)){const Vn=Yt.side;Yt.side=Tn,Yt.needsUpdate=!0,Ja(Fn,_e,ve,Xt,Yt,ft),Yt.side=Vn,Yt.needsUpdate=!0,ht=!0}}ht===!0&&(V.updateMultisampleRenderTarget(Be),V.updateRenderTargetMipmap(Be))}A.setRenderTarget($e),A.setClearColor(ue,$),bt!==void 0&&(ve.viewport=bt),A.toneMapping=et}function tl(F,se,_e){const ve=se.isScene===!0?se.overrideMaterial:null;for(let ae=0,Be=F.length;ae<Be;ae++){const qe=F[ae],$e=qe.object,et=qe.geometry,bt=qe.group;let ht=qe.material;ht.allowOverride===!0&&ve!==null&&(ht=ve),$e.layers.test(_e.layers)&&Ja($e,se,_e,et,ht,bt)}}function Ja(F,se,_e,ve,ae,Be){F.onBeforeRender(A,se,_e,ve,ae,Be),F.modelViewMatrix.multiplyMatrices(_e.matrixWorldInverse,F.matrixWorld),F.normalMatrix.getNormalMatrix(F.modelViewMatrix),ae.onBeforeRender(A,se,_e,ve,F,Be),ae.transparent===!0&&ae.side===Ji&&ae.forceSinglePass===!1?(ae.side=Tn,ae.needsUpdate=!0,A.renderBufferDirect(_e,se,ve,ae,F,Be),ae.side=xr,ae.needsUpdate=!0,A.renderBufferDirect(_e,se,ve,ae,F,Be),ae.side=Ji):A.renderBufferDirect(_e,se,ve,ae,F,Be),F.onAfterRender(A,se,_e,ve,ae,Be)}function eo(F,se,_e){se.isScene!==!0&&(se=st);const ve=at.get(F),ae=x.state.lights,Be=x.state.shadowsArray,qe=ae.state.version,$e=Je.getParameters(F,ae.state,Be,se,_e),et=Je.getProgramCacheKey($e);let bt=ve.programs;ve.environment=F.isMeshStandardMaterial?se.environment:null,ve.fog=se.fog,ve.envMap=(F.isMeshStandardMaterial?pe:B).get(F.envMap||ve.environment),ve.envMapRotation=ve.environment!==null&&F.envMap===null?se.environmentRotation:F.envMapRotation,bt===void 0&&(F.addEventListener("dispose",Nt),bt=new Map,ve.programs=bt);let ht=bt.get(et);if(ht!==void 0){if(ve.currentProgram===ht&&ve.lightsStateVersion===qe)return ta(F,$e),ht}else $e.uniforms=Je.getUniforms(F),F.onBeforeCompile($e,A),ht=Je.acquireProgram($e,et),bt.set(et,ht),ve.uniforms=$e.uniforms;const lt=ve.uniforms;return(!F.isShaderMaterial&&!F.isRawShaderMaterial||F.clipping===!0)&&(lt.clippingPlanes=ze.uniform),ta(F,$e),ve.needsLights=ei(F),ve.lightsStateVersion=qe,ve.needsLights&&(lt.ambientLightColor.value=ae.state.ambient,lt.lightProbe.value=ae.state.probe,lt.directionalLights.value=ae.state.directional,lt.directionalLightShadows.value=ae.state.directionalShadow,lt.spotLights.value=ae.state.spot,lt.spotLightShadows.value=ae.state.spotShadow,lt.rectAreaLights.value=ae.state.rectArea,lt.ltc_1.value=ae.state.rectAreaLTC1,lt.ltc_2.value=ae.state.rectAreaLTC2,lt.pointLights.value=ae.state.point,lt.pointLightShadows.value=ae.state.pointShadow,lt.hemisphereLights.value=ae.state.hemi,lt.directionalShadowMap.value=ae.state.directionalShadowMap,lt.directionalShadowMatrix.value=ae.state.directionalShadowMatrix,lt.spotShadowMap.value=ae.state.spotShadowMap,lt.spotLightMatrix.value=ae.state.spotLightMatrix,lt.spotLightMap.value=ae.state.spotLightMap,lt.pointShadowMap.value=ae.state.pointShadowMap,lt.pointShadowMatrix.value=ae.state.pointShadowMatrix),ve.currentProgram=ht,ve.uniformsList=null,ht}function ea(F){if(F.uniformsList===null){const se=F.currentProgram.getUniforms();F.uniformsList=rg.seqWithValue(se.seq,F.uniforms)}return F.uniformsList}function ta(F,se){const _e=at.get(F);_e.outputColorSpace=se.outputColorSpace,_e.batching=se.batching,_e.batchingColor=se.batchingColor,_e.instancing=se.instancing,_e.instancingColor=se.instancingColor,_e.instancingMorph=se.instancingMorph,_e.skinning=se.skinning,_e.morphTargets=se.morphTargets,_e.morphNormals=se.morphNormals,_e.morphColors=se.morphColors,_e.morphTargetsCount=se.morphTargetsCount,_e.numClippingPlanes=se.numClippingPlanes,_e.numIntersection=se.numClipIntersection,_e.vertexAlphas=se.vertexAlphas,_e.vertexTangents=se.vertexTangents,_e.toneMapping=se.toneMapping}function nl(F,se,_e,ve,ae){se.isScene!==!0&&(se=st),V.resetTextureUnits();const Be=se.fog,qe=ve.isMeshStandardMaterial?se.environment:null,$e=L===null?A.outputColorSpace:L.isXRRenderTarget===!0?L.texture.colorSpace:qs,et=(ve.isMeshStandardMaterial?pe:B).get(ve.envMap||qe),bt=ve.vertexColors===!0&&!!_e.attributes.color&&_e.attributes.color.itemSize===4,ht=!!_e.attributes.tangent&&(!!ve.normalMap||ve.anisotropy>0),lt=!!_e.morphAttributes.position,Ht=!!_e.morphAttributes.normal,tn=!!_e.morphAttributes.color;let Fn=Sr;ve.toneMapped&&(L===null||L.isXRRenderTarget===!0)&&(Fn=A.toneMapping);const Xt=_e.morphAttributes.position||_e.morphAttributes.normal||_e.morphAttributes.color,Yt=Xt!==void 0?Xt.length:0,ft=at.get(ve),Vn=x.state.lights;if(Z===!0&&(Y===!0||F!==D)){const Si=F===D&&ve.id===P;ze.setState(ve,F,Si)}let Qt=!1;ve.version===ft.__version?(ft.needsLights&&ft.lightsStateVersion!==Vn.state.version||ft.outputColorSpace!==$e||ae.isBatchedMesh&&ft.batching===!1||!ae.isBatchedMesh&&ft.batching===!0||ae.isBatchedMesh&&ft.batchingColor===!0&&ae.colorTexture===null||ae.isBatchedMesh&&ft.batchingColor===!1&&ae.colorTexture!==null||ae.isInstancedMesh&&ft.instancing===!1||!ae.isInstancedMesh&&ft.instancing===!0||ae.isSkinnedMesh&&ft.skinning===!1||!ae.isSkinnedMesh&&ft.skinning===!0||ae.isInstancedMesh&&ft.instancingColor===!0&&ae.instanceColor===null||ae.isInstancedMesh&&ft.instancingColor===!1&&ae.instanceColor!==null||ae.isInstancedMesh&&ft.instancingMorph===!0&&ae.morphTexture===null||ae.isInstancedMesh&&ft.instancingMorph===!1&&ae.morphTexture!==null||ft.envMap!==et||ve.fog===!0&&ft.fog!==Be||ft.numClippingPlanes!==void 0&&(ft.numClippingPlanes!==ze.numPlanes||ft.numIntersection!==ze.numIntersection)||ft.vertexAlphas!==bt||ft.vertexTangents!==ht||ft.morphTargets!==lt||ft.morphNormals!==Ht||ft.morphColors!==tn||ft.toneMapping!==Fn||ft.morphTargetsCount!==Yt)&&(Qt=!0):(Qt=!0,ft.__version=ve.version);let zi=ft.currentProgram;Qt===!0&&(zi=eo(ve,se,ae));let no=!1,Mn=!1,ia=!1;const vn=zi.getUniforms(),ki=ft.uniforms;if(ct.useProgram(zi.program)&&(no=!0,Mn=!0,ia=!0),ve.id!==P&&(P=ve.id,Mn=!0),no||D!==F){ct.buffers.depth.getReversed()?(ie.copy(F.projectionMatrix),w3(ie),R3(ie),vn.setValue(K,"projectionMatrix",ie)):vn.setValue(K,"projectionMatrix",F.projectionMatrix),vn.setValue(K,"viewMatrix",F.matrixWorldInverse);const Di=vn.map.cameraPosition;Di!==void 0&&Di.setValue(K,Ve.setFromMatrixPosition(F.matrixWorld)),yt.logarithmicDepthBuffer&&vn.setValue(K,"logDepthBufFC",2/(Math.log(F.far+1)/Math.LN2)),(ve.isMeshPhongMaterial||ve.isMeshToonMaterial||ve.isMeshLambertMaterial||ve.isMeshBasicMaterial||ve.isMeshStandardMaterial||ve.isShaderMaterial)&&vn.setValue(K,"isOrthographic",F.isOrthographicCamera===!0),D!==F&&(D=F,Mn=!0,ia=!0)}if(ae.isSkinnedMesh){vn.setOptional(K,ae,"bindMatrix"),vn.setOptional(K,ae,"bindMatrixInverse");const Si=ae.skeleton;Si&&(Si.boneTexture===null&&Si.computeBoneTexture(),vn.setValue(K,"boneTexture",Si.boneTexture,V))}ae.isBatchedMesh&&(vn.setOptional(K,ae,"batchingTexture"),vn.setValue(K,"batchingTexture",ae._matricesTexture,V),vn.setOptional(K,ae,"batchingIdTexture"),vn.setValue(K,"batchingIdTexture",ae._indirectTexture,V),vn.setOptional(K,ae,"batchingColorTexture"),ae._colorsTexture!==null&&vn.setValue(K,"batchingColorTexture",ae._colorsTexture,V));const hi=_e.morphAttributes;if((hi.position!==void 0||hi.normal!==void 0||hi.color!==void 0)&&mt.update(ae,_e,zi),(Mn||ft.receiveShadow!==ae.receiveShadow)&&(ft.receiveShadow=ae.receiveShadow,vn.setValue(K,"receiveShadow",ae.receiveShadow)),ve.isMeshGouraudMaterial&&ve.envMap!==null&&(ki.envMap.value=et,ki.flipEnvMap.value=et.isCubeTexture&&et.isRenderTargetTexture===!1?-1:1),ve.isMeshStandardMaterial&&ve.envMap===null&&se.environment!==null&&(ki.envMapIntensity.value=se.environmentIntensity),Mn&&(vn.setValue(K,"toneMappingExposure",A.toneMappingExposure),ft.needsLights&&to(ki,ia),Be&&ve.fog===!0&&je.refreshFogUniforms(ki,Be),je.refreshMaterialUniforms(ki,ve,W,G,x.state.transmissionRenderTarget[F.id]),rg.upload(K,ea(ft),ki,V)),ve.isShaderMaterial&&ve.uniformsNeedUpdate===!0&&(rg.upload(K,ea(ft),ki,V),ve.uniformsNeedUpdate=!1),ve.isSpriteMaterial&&vn.setValue(K,"center",ae.center),vn.setValue(K,"modelViewMatrix",ae.modelViewMatrix),vn.setValue(K,"normalMatrix",ae.normalMatrix),vn.setValue(K,"modelMatrix",ae.matrixWorld),ve.isShaderMaterial||ve.isRawShaderMaterial){const Si=ve.uniformsGroups;for(let Di=0,Ds=Si.length;Di<Ds;Di++){const ra=Si[Di];te.update(ra,zi),te.bind(ra,zi)}}return zi}function to(F,se){F.ambientLightColor.needsUpdate=se,F.lightProbe.needsUpdate=se,F.directionalLights.needsUpdate=se,F.directionalLightShadows.needsUpdate=se,F.pointLights.needsUpdate=se,F.pointLightShadows.needsUpdate=se,F.spotLights.needsUpdate=se,F.spotLightShadows.needsUpdate=se,F.rectAreaLights.needsUpdate=se,F.hemisphereLights.needsUpdate=se}function ei(F){return F.isMeshLambertMaterial||F.isMeshToonMaterial||F.isMeshPhongMaterial||F.isMeshStandardMaterial||F.isShadowMaterial||F.isShaderMaterial&&F.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return N},this.getRenderTarget=function(){return L},this.setRenderTargetTextures=function(F,se,_e){const ve=at.get(F);ve.__autoAllocateDepthBuffer=F.resolveDepthBuffer===!1,ve.__autoAllocateDepthBuffer===!1&&(ve.__useRenderToTexture=!1),at.get(F.texture).__webglTexture=se,at.get(F.depthTexture).__webglTexture=ve.__autoAllocateDepthBuffer?void 0:_e,ve.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(F,se){const _e=at.get(F);_e.__webglFramebuffer=se,_e.__useDefaultFramebuffer=se===void 0};const Wd=K.createFramebuffer();this.setRenderTarget=function(F,se=0,_e=0){L=F,w=se,N=_e;let ve=!0,ae=null,Be=!1,qe=!1;if(F){const et=at.get(F);if(et.__useDefaultFramebuffer!==void 0)ct.bindFramebuffer(K.FRAMEBUFFER,null),ve=!1;else if(et.__webglFramebuffer===void 0)V.setupRenderTarget(F);else if(et.__hasExternalTextures)V.rebindTextures(F,at.get(F.texture).__webglTexture,at.get(F.depthTexture).__webglTexture);else if(F.depthBuffer){const lt=F.depthTexture;if(et.__boundDepthTexture!==lt){if(lt!==null&&at.has(lt)&&(F.width!==lt.image.width||F.height!==lt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");V.setupDepthRenderbuffer(F)}}const bt=F.texture;(bt.isData3DTexture||bt.isDataArrayTexture||bt.isCompressedArrayTexture)&&(qe=!0);const ht=at.get(F).__webglFramebuffer;F.isWebGLCubeRenderTarget?(Array.isArray(ht[se])?ae=ht[se][_e]:ae=ht[se],Be=!0):F.samples>0&&V.useMultisampledRTT(F)===!1?ae=at.get(F).__webglMultisampledFramebuffer:Array.isArray(ht)?ae=ht[_e]:ae=ht,I.copy(F.viewport),j.copy(F.scissor),J=F.scissorTest}else I.copy(le).multiplyScalar(W).floor(),j.copy(Ee).multiplyScalar(W).floor(),J=De;if(_e!==0&&(ae=Wd),ct.bindFramebuffer(K.FRAMEBUFFER,ae)&&ve&&ct.drawBuffers(F,ae),ct.viewport(I),ct.scissor(j),ct.setScissorTest(J),Be){const et=at.get(F.texture);K.framebufferTexture2D(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_CUBE_MAP_POSITIVE_X+se,et.__webglTexture,_e)}else if(qe){const et=at.get(F.texture),bt=se;K.framebufferTextureLayer(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,et.__webglTexture,_e,bt)}else if(F!==null&&_e!==0){const et=at.get(F.texture);K.framebufferTexture2D(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_2D,et.__webglTexture,_e)}P=-1},this.readRenderTargetPixels=function(F,se,_e,ve,ae,Be,qe){if(!(F&&F.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let $e=at.get(F).__webglFramebuffer;if(F.isWebGLCubeRenderTarget&&qe!==void 0&&($e=$e[qe]),$e){ct.bindFramebuffer(K.FRAMEBUFFER,$e);try{const et=F.texture,bt=et.format,ht=et.type;if(!yt.textureFormatReadable(bt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!yt.textureTypeReadable(ht)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}se>=0&&se<=F.width-ve&&_e>=0&&_e<=F.height-ae&&K.readPixels(se,_e,ve,ae,Et.convert(bt),Et.convert(ht),Be)}finally{const et=L!==null?at.get(L).__webglFramebuffer:null;ct.bindFramebuffer(K.FRAMEBUFFER,et)}}},this.readRenderTargetPixelsAsync=async function(F,se,_e,ve,ae,Be,qe){if(!(F&&F.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let $e=at.get(F).__webglFramebuffer;if(F.isWebGLCubeRenderTarget&&qe!==void 0&&($e=$e[qe]),$e)if(se>=0&&se<=F.width-ve&&_e>=0&&_e<=F.height-ae){ct.bindFramebuffer(K.FRAMEBUFFER,$e);const et=F.texture,bt=et.format,ht=et.type;if(!yt.textureFormatReadable(bt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!yt.textureTypeReadable(ht))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const lt=K.createBuffer();K.bindBuffer(K.PIXEL_PACK_BUFFER,lt),K.bufferData(K.PIXEL_PACK_BUFFER,Be.byteLength,K.STREAM_READ),K.readPixels(se,_e,ve,ae,Et.convert(bt),Et.convert(ht),0);const Ht=L!==null?at.get(L).__webglFramebuffer:null;ct.bindFramebuffer(K.FRAMEBUFFER,Ht);const tn=K.fenceSync(K.SYNC_GPU_COMMANDS_COMPLETE,0);return K.flush(),await A3(K,tn,4),K.bindBuffer(K.PIXEL_PACK_BUFFER,lt),K.getBufferSubData(K.PIXEL_PACK_BUFFER,0,Be),K.deleteBuffer(lt),K.deleteSync(tn),Be}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(F,se=null,_e=0){const ve=Math.pow(2,-_e),ae=Math.floor(F.image.width*ve),Be=Math.floor(F.image.height*ve),qe=se!==null?se.x:0,$e=se!==null?se.y:0;V.setTexture2D(F,0),K.copyTexSubImage2D(K.TEXTURE_2D,_e,0,0,qe,$e,ae,Be),ct.unbindTexture()};const qd=K.createFramebuffer(),na=K.createFramebuffer();this.copyTextureToTexture=function(F,se,_e=null,ve=null,ae=0,Be=null){Be===null&&(ae!==0?(ws("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Be=ae,ae=0):Be=0);let qe,$e,et,bt,ht,lt,Ht,tn,Fn;const Xt=F.isCompressedTexture?F.mipmaps[Be]:F.image;if(_e!==null)qe=_e.max.x-_e.min.x,$e=_e.max.y-_e.min.y,et=_e.isBox3?_e.max.z-_e.min.z:1,bt=_e.min.x,ht=_e.min.y,lt=_e.isBox3?_e.min.z:0;else{const hi=Math.pow(2,-ae);qe=Math.floor(Xt.width*hi),$e=Math.floor(Xt.height*hi),F.isDataArrayTexture?et=Xt.depth:F.isData3DTexture?et=Math.floor(Xt.depth*hi):et=1,bt=0,ht=0,lt=0}ve!==null?(Ht=ve.x,tn=ve.y,Fn=ve.z):(Ht=0,tn=0,Fn=0);const Yt=Et.convert(se.format),ft=Et.convert(se.type);let Vn;se.isData3DTexture?(V.setTexture3D(se,0),Vn=K.TEXTURE_3D):se.isDataArrayTexture||se.isCompressedArrayTexture?(V.setTexture2DArray(se,0),Vn=K.TEXTURE_2D_ARRAY):(V.setTexture2D(se,0),Vn=K.TEXTURE_2D),K.pixelStorei(K.UNPACK_FLIP_Y_WEBGL,se.flipY),K.pixelStorei(K.UNPACK_PREMULTIPLY_ALPHA_WEBGL,se.premultiplyAlpha),K.pixelStorei(K.UNPACK_ALIGNMENT,se.unpackAlignment);const Qt=K.getParameter(K.UNPACK_ROW_LENGTH),zi=K.getParameter(K.UNPACK_IMAGE_HEIGHT),no=K.getParameter(K.UNPACK_SKIP_PIXELS),Mn=K.getParameter(K.UNPACK_SKIP_ROWS),ia=K.getParameter(K.UNPACK_SKIP_IMAGES);K.pixelStorei(K.UNPACK_ROW_LENGTH,Xt.width),K.pixelStorei(K.UNPACK_IMAGE_HEIGHT,Xt.height),K.pixelStorei(K.UNPACK_SKIP_PIXELS,bt),K.pixelStorei(K.UNPACK_SKIP_ROWS,ht),K.pixelStorei(K.UNPACK_SKIP_IMAGES,lt);const vn=F.isDataArrayTexture||F.isData3DTexture,ki=se.isDataArrayTexture||se.isData3DTexture;if(F.isDepthTexture){const hi=at.get(F),Si=at.get(se),Di=at.get(hi.__renderTarget),Ds=at.get(Si.__renderTarget);ct.bindFramebuffer(K.READ_FRAMEBUFFER,Di.__webglFramebuffer),ct.bindFramebuffer(K.DRAW_FRAMEBUFFER,Ds.__webglFramebuffer);for(let ra=0;ra<et;ra++)vn&&(K.framebufferTextureLayer(K.READ_FRAMEBUFFER,K.COLOR_ATTACHMENT0,at.get(F).__webglTexture,ae,lt+ra),K.framebufferTextureLayer(K.DRAW_FRAMEBUFFER,K.COLOR_ATTACHMENT0,at.get(se).__webglTexture,Be,Fn+ra)),K.blitFramebuffer(bt,ht,qe,$e,Ht,tn,qe,$e,K.DEPTH_BUFFER_BIT,K.NEAREST);ct.bindFramebuffer(K.READ_FRAMEBUFFER,null),ct.bindFramebuffer(K.DRAW_FRAMEBUFFER,null)}else if(ae!==0||F.isRenderTargetTexture||at.has(F)){const hi=at.get(F),Si=at.get(se);ct.bindFramebuffer(K.READ_FRAMEBUFFER,qd),ct.bindFramebuffer(K.DRAW_FRAMEBUFFER,na);for(let Di=0;Di<et;Di++)vn?K.framebufferTextureLayer(K.READ_FRAMEBUFFER,K.COLOR_ATTACHMENT0,hi.__webglTexture,ae,lt+Di):K.framebufferTexture2D(K.READ_FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_2D,hi.__webglTexture,ae),ki?K.framebufferTextureLayer(K.DRAW_FRAMEBUFFER,K.COLOR_ATTACHMENT0,Si.__webglTexture,Be,Fn+Di):K.framebufferTexture2D(K.DRAW_FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_2D,Si.__webglTexture,Be),ae!==0?K.blitFramebuffer(bt,ht,qe,$e,Ht,tn,qe,$e,K.COLOR_BUFFER_BIT,K.NEAREST):ki?K.copyTexSubImage3D(Vn,Be,Ht,tn,Fn+Di,bt,ht,qe,$e):K.copyTexSubImage2D(Vn,Be,Ht,tn,bt,ht,qe,$e);ct.bindFramebuffer(K.READ_FRAMEBUFFER,null),ct.bindFramebuffer(K.DRAW_FRAMEBUFFER,null)}else ki?F.isDataTexture||F.isData3DTexture?K.texSubImage3D(Vn,Be,Ht,tn,Fn,qe,$e,et,Yt,ft,Xt.data):se.isCompressedArrayTexture?K.compressedTexSubImage3D(Vn,Be,Ht,tn,Fn,qe,$e,et,Yt,Xt.data):K.texSubImage3D(Vn,Be,Ht,tn,Fn,qe,$e,et,Yt,ft,Xt):F.isDataTexture?K.texSubImage2D(K.TEXTURE_2D,Be,Ht,tn,qe,$e,Yt,ft,Xt.data):F.isCompressedTexture?K.compressedTexSubImage2D(K.TEXTURE_2D,Be,Ht,tn,Xt.width,Xt.height,Yt,Xt.data):K.texSubImage2D(K.TEXTURE_2D,Be,Ht,tn,qe,$e,Yt,ft,Xt);K.pixelStorei(K.UNPACK_ROW_LENGTH,Qt),K.pixelStorei(K.UNPACK_IMAGE_HEIGHT,zi),K.pixelStorei(K.UNPACK_SKIP_PIXELS,no),K.pixelStorei(K.UNPACK_SKIP_ROWS,Mn),K.pixelStorei(K.UNPACK_SKIP_IMAGES,ia),Be===0&&se.generateMipmaps&&K.generateMipmap(Vn),ct.unbindTexture()},this.copyTextureToTexture3D=function(F,se,_e=null,ve=null,ae=0){return ws('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(F,se,_e,ve,ae)},this.initRenderTarget=function(F){at.get(F).__webglFramebuffer===void 0&&V.setupRenderTarget(F)},this.initTexture=function(F){F.isCubeTexture?V.setTextureCube(F,0):F.isData3DTexture?V.setTexture3D(F,0):F.isDataArrayTexture||F.isCompressedArrayTexture?V.setTexture2DArray(F,0):V.setTexture2D(F,0),ct.unbindTexture()},this.resetState=function(){w=0,N=0,L=null,ct.reset(),fn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return gr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Ft._getDrawingBufferColorSpace(e),t.unpackColorSpace=Ft._getUnpackColorSpace()}}const _c=new bs,Da=new Oe,wN=new H,p0=new Oe,sg=new Oe,Sg=new H,Fx=new H,RN=new qt,CN=new H,NN=new H;let dr=null,Is=null;const Pa=[],Go={NONE:-1,PAN:0,ROTATE:1};class E4 extends e_{constructor(e,t,n=null){super(t,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new bN,this.mouseButtons={LEFT:Bi.PAN,MIDDLE:Bi.PAN,RIGHT:Bi.ROTATE},this.touches={ONE:Ua.PAN},this._onPointerMove=M4.bind(this),this._onPointerDown=A4.bind(this),this._onPointerCancel=w4.bind(this),this._onContextMenu=R4.bind(this),n!==null&&this.connect(n)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();Da.x=(e.clientX-t.left)/t.width*2-1,Da.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case Bi.PAN:case Ua.PAN:this.state=Go.PAN;break;case Bi.ROTATE:case Ua.ROTATE:this.state=Go.ROTATE;break;default:this.state=Go.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function M4(i){const e=this.object,t=this.domElement,n=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(i),n.setFromCamera(Da,e),dr)this.state===Go.PAN?n.ray.intersectPlane(_c,Sg)&&dr.position.copy(Sg.sub(wN).applyMatrix4(RN)):this.state===Go.ROTATE&&(p0.subVectors(Da,sg).multiplyScalar(this.rotateSpeed),dr.rotateOnWorldAxis(CN,p0.x),dr.rotateOnWorldAxis(NN.normalize(),-p0.y)),this.dispatchEvent({type:"drag",object:dr}),sg.copy(Da);else if(i.pointerType==="mouse"||i.pointerType==="pen")if(Pa.length=0,n.setFromCamera(Da,e),n.intersectObjects(this.objects,this.recursive,Pa),Pa.length>0){const r=Pa[0].object;_c.setFromNormalAndCoplanarPoint(e.getWorldDirection(_c.normal),Fx.setFromMatrixPosition(r.matrixWorld)),Is!==r&&Is!==null&&(this.dispatchEvent({type:"hoveroff",object:Is}),t.style.cursor="auto",Is=null),Is!==r&&(this.dispatchEvent({type:"hoveron",object:r}),t.style.cursor="pointer",Is=r)}else Is!==null&&(this.dispatchEvent({type:"hoveroff",object:Is}),t.style.cursor="auto",Is=null);sg.copy(Da)}}function A4(i){const e=this.object,t=this.domElement,n=this.raycaster;this.enabled!==!1&&(this._updatePointer(i),this._updateState(i),Pa.length=0,n.setFromCamera(Da,e),n.intersectObjects(this.objects,this.recursive,Pa),Pa.length>0&&(this.transformGroup===!0?dr=DN(Pa[0].object):dr=Pa[0].object,_c.setFromNormalAndCoplanarPoint(e.getWorldDirection(_c.normal),Fx.setFromMatrixPosition(dr.matrixWorld)),n.ray.intersectPlane(_c,Sg)&&(this.state===Go.PAN?(RN.copy(dr.parent.matrixWorld).invert(),wN.copy(Sg).sub(Fx.setFromMatrixPosition(dr.matrixWorld))):this.state===Go.ROTATE&&(CN.set(0,1,0).applyQuaternion(e.quaternion).normalize(),NN.set(1,0,0).applyQuaternion(e.quaternion).normalize())),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:dr})),sg.copy(Da))}function w4(){this.enabled!==!1&&(dr&&(this.dispatchEvent({type:"dragend",object:dr}),dr=null),this.domElement.style.cursor=Is?"pointer":"auto",this.state=Go.NONE)}function R4(i){this.enabled!==!1&&i.preventDefault()}function DN(i,e=null){return i.isGroup&&(e=i),i.parent===null?e:DN(i.parent,e)}function C4(i,e,t){var n,r=1;i==null&&(i=0),e==null&&(e=0),t==null&&(t=0);function s(){var o,u=n.length,c,f=0,d=0,m=0;for(o=0;o<u;++o)c=n[o],f+=c.x||0,d+=c.y||0,m+=c.z||0;for(f=(f/u-i)*r,d=(d/u-e)*r,m=(m/u-t)*r,o=0;o<u;++o)c=n[o],f&&(c.x-=f),d&&(c.y-=d),m&&(c.z-=m)}return s.initialize=function(o){n=o},s.x=function(o){return arguments.length?(i=+o,s):i},s.y=function(o){return arguments.length?(e=+o,s):e},s.z=function(o){return arguments.length?(t=+o,s):t},s.strength=function(o){return arguments.length?(r=+o,s):r},s}function N4(i){const e=+this._x.call(null,i);return PN(this.cover(e),e,i)}function PN(i,e,t){if(isNaN(e))return i;var n,r=i._root,s={data:t},o=i._x0,u=i._x1,c,f,d,m,g;if(!r)return i._root=s,i;for(;r.length;)if((d=e>=(c=(o+u)/2))?o=c:u=c,n=r,!(r=r[m=+d]))return n[m]=s,i;if(f=+i._x.call(null,r.data),e===f)return s.next=r,n?n[m]=s:i._root=s,i;do n=n?n[m]=new Array(2):i._root=new Array(2),(d=e>=(c=(o+u)/2))?o=c:u=c;while((m=+d)==(g=+(f>=c)));return n[g]=r,n[m]=s,i}function D4(i){Array.isArray(i)||(i=Array.from(i));const e=i.length,t=new Float64Array(e);let n=1/0,r=-1/0;for(let s=0,o;s<e;++s)isNaN(o=+this._x.call(null,i[s]))||(t[s]=o,o<n&&(n=o),o>r&&(r=o));if(n>r)return this;this.cover(n).cover(r);for(let s=0;s<e;++s)PN(this,t[s],i[s]);return this}function P4(i){if(isNaN(i=+i))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(i))+1;else{for(var n=t-e||1,r=this._root,s,o;e>i||i>=t;)switch(o=+(i<e),s=new Array(2),s[o]=r,r=s,n*=2,o){case 0:t=e+n;break;case 1:e=t-n;break}this._root&&this._root.length&&(this._root=r)}return this._x0=e,this._x1=t,this}function L4(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function U4(i){return arguments.length?this.cover(+i[0][0]).cover(+i[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Ga(i,e,t){this.node=i,this.x0=e,this.x1=t}function O4(i,e){var t,n=this._x0,r,s,o=this._x1,u=[],c=this._root,f,d;for(c&&u.push(new Ga(c,n,o)),e==null?e=1/0:(n=i-e,o=i+e);f=u.pop();)if(!(!(c=f.node)||(r=f.x0)>o||(s=f.x1)<n))if(c.length){var m=(r+s)/2;u.push(new Ga(c[1],m,s),new Ga(c[0],r,m)),(d=+(i>=m))&&(f=u[u.length-1],u[u.length-1]=u[u.length-1-d],u[u.length-1-d]=f)}else{var g=Math.abs(i-+this._x.call(null,c.data));g<e&&(e=g,n=i-g,o=i+g,t=c.data)}return t}function B4(i){if(isNaN(c=+this._x.call(null,i)))return this;var e,t=this._root,n,r,s,o=this._x0,u=this._x1,c,f,d,m,g;if(!t)return this;if(t.length)for(;;){if((d=c>=(f=(o+u)/2))?o=f:u=f,e=t,!(t=t[m=+d]))return this;if(!t.length)break;e[m+1&1]&&(n=e,g=m)}for(;t.data!==i;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[m]=s:delete e[m],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(n?n[g]=t:this._root=t),this):(this._root=s,this)}function F4(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function I4(){return this._root}function z4(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function k4(i){var e=[],t,n=this._root,r,s,o;for(n&&e.push(new Ga(n,this._x0,this._x1));t=e.pop();)if(!i(n=t.node,s=t.x0,o=t.x1)&&n.length){var u=(s+o)/2;(r=n[1])&&e.push(new Ga(r,u,o)),(r=n[0])&&e.push(new Ga(r,s,u))}return this}function G4(i){var e=[],t=[],n;for(this._root&&e.push(new Ga(this._root,this._x0,this._x1));n=e.pop();){var r=n.node;if(r.length){var s,o=n.x0,u=n.x1,c=(o+u)/2;(s=r[0])&&e.push(new Ga(s,o,c)),(s=r[1])&&e.push(new Ga(s,c,u))}t.push(n)}for(;n=t.pop();)i(n.node,n.x0,n.x1);return this}function V4(i){return i[0]}function H4(i){return arguments.length?(this._x=i,this):this._x}function LN(i,e){var t=new cS(e??V4,NaN,NaN);return i==null?t:t.addAll(i)}function cS(i,e,t){this._x=i,this._x0=e,this._x1=t,this._root=void 0}function qw(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var Ar=LN.prototype=cS.prototype;Ar.copy=function(){var i=new cS(this._x,this._x0,this._x1),e=this._root,t,n;if(!e)return i;if(!e.length)return i._root=qw(e),i;for(t=[{source:e,target:i._root=new Array(2)}];e=t.pop();)for(var r=0;r<2;++r)(n=e.source[r])&&(n.length?t.push({source:n,target:e.target[r]=new Array(2)}):e.target[r]=qw(n));return i};Ar.add=N4;Ar.addAll=D4;Ar.cover=P4;Ar.data=L4;Ar.extent=U4;Ar.find=O4;Ar.remove=B4;Ar.removeAll=F4;Ar.root=I4;Ar.size=z4;Ar.visit=k4;Ar.visitAfter=G4;Ar.x=H4;function j4(i){const e=+this._x.call(null,i),t=+this._y.call(null,i);return UN(this.cover(e,t),e,t,i)}function UN(i,e,t,n){if(isNaN(e)||isNaN(t))return i;var r,s=i._root,o={data:n},u=i._x0,c=i._y0,f=i._x1,d=i._y1,m,g,_,v,S,b,x,E;if(!s)return i._root=o,i;for(;s.length;)if((S=e>=(m=(u+f)/2))?u=m:f=m,(b=t>=(g=(c+d)/2))?c=g:d=g,r=s,!(s=s[x=b<<1|S]))return r[x]=o,i;if(_=+i._x.call(null,s.data),v=+i._y.call(null,s.data),e===_&&t===v)return o.next=s,r?r[x]=o:i._root=o,i;do r=r?r[x]=new Array(4):i._root=new Array(4),(S=e>=(m=(u+f)/2))?u=m:f=m,(b=t>=(g=(c+d)/2))?c=g:d=g;while((x=b<<1|S)===(E=(v>=g)<<1|_>=m));return r[E]=s,r[x]=o,i}function W4(i){var e,t,n=i.length,r,s,o=new Array(n),u=new Array(n),c=1/0,f=1/0,d=-1/0,m=-1/0;for(t=0;t<n;++t)isNaN(r=+this._x.call(null,e=i[t]))||isNaN(s=+this._y.call(null,e))||(o[t]=r,u[t]=s,r<c&&(c=r),r>d&&(d=r),s<f&&(f=s),s>m&&(m=s));if(c>d||f>m)return this;for(this.cover(c,f).cover(d,m),t=0;t<n;++t)UN(this,o[t],u[t],i[t]);return this}function q4(i,e){if(isNaN(i=+i)||isNaN(e=+e))return this;var t=this._x0,n=this._y0,r=this._x1,s=this._y1;if(isNaN(t))r=(t=Math.floor(i))+1,s=(n=Math.floor(e))+1;else{for(var o=r-t||1,u=this._root,c,f;t>i||i>=r||n>e||e>=s;)switch(f=(e<n)<<1|i<t,c=new Array(4),c[f]=u,u=c,o*=2,f){case 0:r=t+o,s=n+o;break;case 1:t=r-o,s=n+o;break;case 2:r=t+o,n=s-o;break;case 3:t=r-o,n=s-o;break}this._root&&this._root.length&&(this._root=u)}return this._x0=t,this._y0=n,this._x1=r,this._y1=s,this}function $4(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function X4(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function tr(i,e,t,n,r){this.node=i,this.x0=e,this.y0=t,this.x1=n,this.y1=r}function Y4(i,e,t){var n,r=this._x0,s=this._y0,o,u,c,f,d=this._x1,m=this._y1,g=[],_=this._root,v,S;for(_&&g.push(new tr(_,r,s,d,m)),t==null?t=1/0:(r=i-t,s=e-t,d=i+t,m=e+t,t*=t);v=g.pop();)if(!(!(_=v.node)||(o=v.x0)>d||(u=v.y0)>m||(c=v.x1)<r||(f=v.y1)<s))if(_.length){var b=(o+c)/2,x=(u+f)/2;g.push(new tr(_[3],b,x,c,f),new tr(_[2],o,x,b,f),new tr(_[1],b,u,c,x),new tr(_[0],o,u,b,x)),(S=(e>=x)<<1|i>=b)&&(v=g[g.length-1],g[g.length-1]=g[g.length-1-S],g[g.length-1-S]=v)}else{var E=i-+this._x.call(null,_.data),M=e-+this._y.call(null,_.data),A=E*E+M*M;if(A<t){var C=Math.sqrt(t=A);r=i-C,s=e-C,d=i+C,m=e+C,n=_.data}}return n}function K4(i){if(isNaN(d=+this._x.call(null,i))||isNaN(m=+this._y.call(null,i)))return this;var e,t=this._root,n,r,s,o=this._x0,u=this._y0,c=this._x1,f=this._y1,d,m,g,_,v,S,b,x;if(!t)return this;if(t.length)for(;;){if((v=d>=(g=(o+c)/2))?o=g:c=g,(S=m>=(_=(u+f)/2))?u=_:f=_,e=t,!(t=t[b=S<<1|v]))return this;if(!t.length)break;(e[b+1&3]||e[b+2&3]||e[b+3&3])&&(n=e,x=b)}for(;t.data!==i;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[b]=s:delete e[b],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(n?n[x]=t:this._root=t),this):(this._root=s,this)}function Q4(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function Z4(){return this._root}function J4(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function eV(i){var e=[],t,n=this._root,r,s,o,u,c;for(n&&e.push(new tr(n,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!i(n=t.node,s=t.x0,o=t.y0,u=t.x1,c=t.y1)&&n.length){var f=(s+u)/2,d=(o+c)/2;(r=n[3])&&e.push(new tr(r,f,d,u,c)),(r=n[2])&&e.push(new tr(r,s,d,f,c)),(r=n[1])&&e.push(new tr(r,f,o,u,d)),(r=n[0])&&e.push(new tr(r,s,o,f,d))}return this}function tV(i){var e=[],t=[],n;for(this._root&&e.push(new tr(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var r=n.node;if(r.length){var s,o=n.x0,u=n.y0,c=n.x1,f=n.y1,d=(o+c)/2,m=(u+f)/2;(s=r[0])&&e.push(new tr(s,o,u,d,m)),(s=r[1])&&e.push(new tr(s,d,u,c,m)),(s=r[2])&&e.push(new tr(s,o,m,d,f)),(s=r[3])&&e.push(new tr(s,d,m,c,f))}t.push(n)}for(;n=t.pop();)i(n.node,n.x0,n.y0,n.x1,n.y1);return this}function nV(i){return i[0]}function iV(i){return arguments.length?(this._x=i,this):this._x}function rV(i){return i[1]}function sV(i){return arguments.length?(this._y=i,this):this._y}function ON(i,e,t){var n=new hS(e??nV,t??rV,NaN,NaN,NaN,NaN);return i==null?n:n.addAll(i)}function hS(i,e,t,n,r,s){this._x=i,this._y=e,this._x0=t,this._y0=n,this._x1=r,this._y1=s,this._root=void 0}function $w(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var sr=ON.prototype=hS.prototype;sr.copy=function(){var i=new hS(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,n;if(!e)return i;if(!e.length)return i._root=$w(e),i;for(t=[{source:e,target:i._root=new Array(4)}];e=t.pop();)for(var r=0;r<4;++r)(n=e.source[r])&&(n.length?t.push({source:n,target:e.target[r]=new Array(4)}):e.target[r]=$w(n));return i};sr.add=j4;sr.addAll=W4;sr.cover=q4;sr.data=$4;sr.extent=X4;sr.find=Y4;sr.remove=K4;sr.removeAll=Q4;sr.root=Z4;sr.size=J4;sr.visit=eV;sr.visitAfter=tV;sr.x=iV;sr.y=sV;function aV(i){const e=+this._x.call(null,i),t=+this._y.call(null,i),n=+this._z.call(null,i);return BN(this.cover(e,t,n),e,t,n,i)}function BN(i,e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n))return i;var s,o=i._root,u={data:r},c=i._x0,f=i._y0,d=i._z0,m=i._x1,g=i._y1,_=i._z1,v,S,b,x,E,M,A,C,w,N,L;if(!o)return i._root=u,i;for(;o.length;)if((A=e>=(v=(c+m)/2))?c=v:m=v,(C=t>=(S=(f+g)/2))?f=S:g=S,(w=n>=(b=(d+_)/2))?d=b:_=b,s=o,!(o=o[N=w<<2|C<<1|A]))return s[N]=u,i;if(x=+i._x.call(null,o.data),E=+i._y.call(null,o.data),M=+i._z.call(null,o.data),e===x&&t===E&&n===M)return u.next=o,s?s[N]=u:i._root=u,i;do s=s?s[N]=new Array(8):i._root=new Array(8),(A=e>=(v=(c+m)/2))?c=v:m=v,(C=t>=(S=(f+g)/2))?f=S:g=S,(w=n>=(b=(d+_)/2))?d=b:_=b;while((N=w<<2|C<<1|A)===(L=(M>=b)<<2|(E>=S)<<1|x>=v));return s[L]=o,s[N]=u,i}function oV(i){Array.isArray(i)||(i=Array.from(i));const e=i.length,t=new Float64Array(e),n=new Float64Array(e),r=new Float64Array(e);let s=1/0,o=1/0,u=1/0,c=-1/0,f=-1/0,d=-1/0;for(let m=0,g,_,v,S;m<e;++m)isNaN(_=+this._x.call(null,g=i[m]))||isNaN(v=+this._y.call(null,g))||isNaN(S=+this._z.call(null,g))||(t[m]=_,n[m]=v,r[m]=S,_<s&&(s=_),_>c&&(c=_),v<o&&(o=v),v>f&&(f=v),S<u&&(u=S),S>d&&(d=S));if(s>c||o>f||u>d)return this;this.cover(s,o,u).cover(c,f,d);for(let m=0;m<e;++m)BN(this,t[m],n[m],r[m],i[m]);return this}function lV(i,e,t){if(isNaN(i=+i)||isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,s=this._z0,o=this._x1,u=this._y1,c=this._z1;if(isNaN(n))o=(n=Math.floor(i))+1,u=(r=Math.floor(e))+1,c=(s=Math.floor(t))+1;else{for(var f=o-n||1,d=this._root,m,g;n>i||i>=o||r>e||e>=u||s>t||t>=c;)switch(g=(t<s)<<2|(e<r)<<1|i<n,m=new Array(8),m[g]=d,d=m,f*=2,g){case 0:o=n+f,u=r+f,c=s+f;break;case 1:n=o-f,u=r+f,c=s+f;break;case 2:o=n+f,r=u-f,c=s+f;break;case 3:n=o-f,r=u-f,c=s+f;break;case 4:o=n+f,u=r+f,s=c-f;break;case 5:n=o-f,u=r+f,s=c-f;break;case 6:o=n+f,r=u-f,s=c-f;break;case 7:n=o-f,r=u-f,s=c-f;break}this._root&&this._root.length&&(this._root=d)}return this._x0=n,this._y0=r,this._z0=s,this._x1=o,this._y1=u,this._z1=c,this}function uV(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function cV(i){return arguments.length?this.cover(+i[0][0],+i[0][1],+i[0][2]).cover(+i[1][0],+i[1][1],+i[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function xn(i,e,t,n,r,s,o){this.node=i,this.x0=e,this.y0=t,this.z0=n,this.x1=r,this.y1=s,this.z1=o}function hV(i,e,t,n){var r,s=this._x0,o=this._y0,u=this._z0,c,f,d,m,g,_,v=this._x1,S=this._y1,b=this._z1,x=[],E=this._root,M,A;for(E&&x.push(new xn(E,s,o,u,v,S,b)),n==null?n=1/0:(s=i-n,o=e-n,u=t-n,v=i+n,S=e+n,b=t+n,n*=n);M=x.pop();)if(!(!(E=M.node)||(c=M.x0)>v||(f=M.y0)>S||(d=M.z0)>b||(m=M.x1)<s||(g=M.y1)<o||(_=M.z1)<u))if(E.length){var C=(c+m)/2,w=(f+g)/2,N=(d+_)/2;x.push(new xn(E[7],C,w,N,m,g,_),new xn(E[6],c,w,N,C,g,_),new xn(E[5],C,f,N,m,w,_),new xn(E[4],c,f,N,C,w,_),new xn(E[3],C,w,d,m,g,N),new xn(E[2],c,w,d,C,g,N),new xn(E[1],C,f,d,m,w,N),new xn(E[0],c,f,d,C,w,N)),(A=(t>=N)<<2|(e>=w)<<1|i>=C)&&(M=x[x.length-1],x[x.length-1]=x[x.length-1-A],x[x.length-1-A]=M)}else{var L=i-+this._x.call(null,E.data),P=e-+this._y.call(null,E.data),D=t-+this._z.call(null,E.data),I=L*L+P*P+D*D;if(I<n){var j=Math.sqrt(n=I);s=i-j,o=e-j,u=t-j,v=i+j,S=e+j,b=t+j,r=E.data}}return r}const fV=(i,e,t,n,r,s)=>Math.sqrt((i-n)**2+(e-r)**2+(t-s)**2);function dV(i,e,t,n){const r=[],s=i-n,o=e-n,u=t-n,c=i+n,f=e+n,d=t+n;return this.visit((m,g,_,v,S,b,x)=>{if(!m.length)do{const E=m.data;fV(i,e,t,this._x(E),this._y(E),this._z(E))<=n&&r.push(E)}while(m=m.next);return g>c||_>f||v>d||S<s||b<o||x<u}),r}function pV(i){if(isNaN(g=+this._x.call(null,i))||isNaN(_=+this._y.call(null,i))||isNaN(v=+this._z.call(null,i)))return this;var e,t=this._root,n,r,s,o=this._x0,u=this._y0,c=this._z0,f=this._x1,d=this._y1,m=this._z1,g,_,v,S,b,x,E,M,A,C,w;if(!t)return this;if(t.length)for(;;){if((E=g>=(S=(o+f)/2))?o=S:f=S,(M=_>=(b=(u+d)/2))?u=b:d=b,(A=v>=(x=(c+m)/2))?c=x:m=x,e=t,!(t=t[C=A<<2|M<<1|E]))return this;if(!t.length)break;(e[C+1&7]||e[C+2&7]||e[C+3&7]||e[C+4&7]||e[C+5&7]||e[C+6&7]||e[C+7&7])&&(n=e,w=C)}for(;t.data!==i;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[C]=s:delete e[C],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(n?n[w]=t:this._root=t),this):(this._root=s,this)}function mV(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function gV(){return this._root}function _V(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function vV(i){var e=[],t,n=this._root,r,s,o,u,c,f,d;for(n&&e.push(new xn(n,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!i(n=t.node,s=t.x0,o=t.y0,u=t.z0,c=t.x1,f=t.y1,d=t.z1)&&n.length){var m=(s+c)/2,g=(o+f)/2,_=(u+d)/2;(r=n[7])&&e.push(new xn(r,m,g,_,c,f,d)),(r=n[6])&&e.push(new xn(r,s,g,_,m,f,d)),(r=n[5])&&e.push(new xn(r,m,o,_,c,g,d)),(r=n[4])&&e.push(new xn(r,s,o,_,m,g,d)),(r=n[3])&&e.push(new xn(r,m,g,u,c,f,_)),(r=n[2])&&e.push(new xn(r,s,g,u,m,f,_)),(r=n[1])&&e.push(new xn(r,m,o,u,c,g,_)),(r=n[0])&&e.push(new xn(r,s,o,u,m,g,_))}return this}function yV(i){var e=[],t=[],n;for(this._root&&e.push(new xn(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=e.pop();){var r=n.node;if(r.length){var s,o=n.x0,u=n.y0,c=n.z0,f=n.x1,d=n.y1,m=n.z1,g=(o+f)/2,_=(u+d)/2,v=(c+m)/2;(s=r[0])&&e.push(new xn(s,o,u,c,g,_,v)),(s=r[1])&&e.push(new xn(s,g,u,c,f,_,v)),(s=r[2])&&e.push(new xn(s,o,_,c,g,d,v)),(s=r[3])&&e.push(new xn(s,g,_,c,f,d,v)),(s=r[4])&&e.push(new xn(s,o,u,v,g,_,m)),(s=r[5])&&e.push(new xn(s,g,u,v,f,_,m)),(s=r[6])&&e.push(new xn(s,o,_,v,g,d,m)),(s=r[7])&&e.push(new xn(s,g,_,v,f,d,m))}t.push(n)}for(;n=t.pop();)i(n.node,n.x0,n.y0,n.z0,n.x1,n.y1,n.z1);return this}function xV(i){return i[0]}function bV(i){return arguments.length?(this._x=i,this):this._x}function SV(i){return i[1]}function TV(i){return arguments.length?(this._y=i,this):this._y}function EV(i){return i[2]}function MV(i){return arguments.length?(this._z=i,this):this._z}function FN(i,e,t,n){var r=new fS(e??xV,t??SV,n??EV,NaN,NaN,NaN,NaN,NaN,NaN);return i==null?r:r.addAll(i)}function fS(i,e,t,n,r,s,o,u,c){this._x=i,this._y=e,this._z=t,this._x0=n,this._y0=r,this._z0=s,this._x1=o,this._y1=u,this._z1=c,this._root=void 0}function Xw(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var Ii=FN.prototype=fS.prototype;Ii.copy=function(){var i=new fS(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,n;if(!e)return i;if(!e.length)return i._root=Xw(e),i;for(t=[{source:e,target:i._root=new Array(8)}];e=t.pop();)for(var r=0;r<8;++r)(n=e.source[r])&&(n.length?t.push({source:n,target:e.target[r]=new Array(8)}):e.target[r]=Xw(n));return i};Ii.add=aV;Ii.addAll=oV;Ii.cover=lV;Ii.data=uV;Ii.extent=cV;Ii.find=hV;Ii.findAllWithinRadius=dV;Ii.remove=pV;Ii.removeAll=mV;Ii.root=gV;Ii.size=_V;Ii.visit=vV;Ii.visitAfter=yV;Ii.x=bV;Ii.y=TV;Ii.z=MV;function Ba(i){return function(){return i}}function Ra(i){return(i()-.5)*1e-6}function AV(i){return i.index}function Yw(i,e){var t=i.get(e);if(!t)throw new Error("node not found: "+e);return t}function wV(i){var e=AV,t=g,n,r=Ba(30),s,o,u,c,f,d,m=1;i==null&&(i=[]);function g(x){return 1/Math.min(c[x.source.index],c[x.target.index])}function _(x){for(var E=0,M=i.length;E<m;++E)for(var A=0,C,w,N,L=0,P=0,D=0,I,j;A<M;++A)C=i[A],w=C.source,N=C.target,L=N.x+N.vx-w.x-w.vx||Ra(d),u>1&&(P=N.y+N.vy-w.y-w.vy||Ra(d)),u>2&&(D=N.z+N.vz-w.z-w.vz||Ra(d)),I=Math.sqrt(L*L+P*P+D*D),I=(I-s[A])/I*x*n[A],L*=I,P*=I,D*=I,N.vx-=L*(j=f[A]),u>1&&(N.vy-=P*j),u>2&&(N.vz-=D*j),w.vx+=L*(j=1-j),u>1&&(w.vy+=P*j),u>2&&(w.vz+=D*j)}function v(){if(o){var x,E=o.length,M=i.length,A=new Map(o.map((w,N)=>[e(w,N,o),w])),C;for(x=0,c=new Array(E);x<M;++x)C=i[x],C.index=x,typeof C.source!="object"&&(C.source=Yw(A,C.source)),typeof C.target!="object"&&(C.target=Yw(A,C.target)),c[C.source.index]=(c[C.source.index]||0)+1,c[C.target.index]=(c[C.target.index]||0)+1;for(x=0,f=new Array(M);x<M;++x)C=i[x],f[x]=c[C.source.index]/(c[C.source.index]+c[C.target.index]);n=new Array(M),S(),s=new Array(M),b()}}function S(){if(o)for(var x=0,E=i.length;x<E;++x)n[x]=+t(i[x],x,i)}function b(){if(o)for(var x=0,E=i.length;x<E;++x)s[x]=+r(i[x],x,i)}return _.initialize=function(x,...E){o=x,d=E.find(M=>typeof M=="function")||Math.random,u=E.find(M=>[1,2,3].includes(M))||2,v()},_.links=function(x){return arguments.length?(i=x,v(),_):i},_.id=function(x){return arguments.length?(e=x,_):e},_.iterations=function(x){return arguments.length?(m=+x,_):m},_.strength=function(x){return arguments.length?(t=typeof x=="function"?x:Ba(+x),S(),_):t},_.distance=function(x){return arguments.length?(r=typeof x=="function"?x:Ba(+x),b(),_):r},_}var RV={value:()=>{}};function IN(){for(var i=0,e=arguments.length,t={},n;i<e;++i){if(!(n=arguments[i]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new ag(t)}function ag(i){this._=i}function CV(i,e){return i.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}ag.prototype=IN.prototype={constructor:ag,on:function(i,e){var t=this._,n=CV(i+"",t),r,s=-1,o=n.length;if(arguments.length<2){for(;++s<o;)if((r=(i=n[s]).type)&&(r=NV(t[r],i.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(i=n[s]).type)t[r]=Kw(t[r],i.name,e);else if(e==null)for(r in t)t[r]=Kw(t[r],i.name,null);return this},copy:function(){var i={},e=this._;for(var t in e)i[t]=e[t].slice();return new ag(i)},call:function(i,e){if((r=arguments.length-2)>0)for(var t=new Array(r),n=0,r,s;n<r;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(s=this._[i],n=0,r=s.length;n<r;++n)s[n].value.apply(e,t)},apply:function(i,e,t){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var n=this._[i],r=0,s=n.length;r<s;++r)n[r].value.apply(e,t)}};function NV(i,e){for(var t=0,n=i.length,r;t<n;++t)if((r=i[t]).name===e)return r.value}function Kw(i,e,t){for(var n=0,r=i.length;n<r;++n)if(i[n].name===e){i[n]=RV,i=i.slice(0,n).concat(i.slice(n+1));break}return t!=null&&i.push({name:e,value:t}),i}var Gc=0,wf=0,lf=0,zN=1e3,Tg,Rf,Eg=0,Kl=0,n_=0,hd=typeof performance=="object"&&performance.now?performance:Date,kN=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function GN(){return Kl||(kN(DV),Kl=hd.now()+n_)}function DV(){Kl=0}function Ix(){this._call=this._time=this._next=null}Ix.prototype=VN.prototype={constructor:Ix,restart:function(i,e,t){if(typeof i!="function")throw new TypeError("callback is not a function");t=(t==null?GN():+t)+(e==null?0:+e),!this._next&&Rf!==this&&(Rf?Rf._next=this:Tg=this,Rf=this),this._call=i,this._time=t,zx()},stop:function(){this._call&&(this._call=null,this._time=1/0,zx())}};function VN(i,e,t){var n=new Ix;return n.restart(i,e,t),n}function PV(){GN(),++Gc;for(var i=Tg,e;i;)(e=Kl-i._time)>=0&&i._call.call(void 0,e),i=i._next;--Gc}function Qw(){Kl=(Eg=hd.now())+n_,Gc=wf=0;try{PV()}finally{Gc=0,UV(),Kl=0}}function LV(){var i=hd.now(),e=i-Eg;e>zN&&(n_-=e,Eg=i)}function UV(){for(var i,e=Tg,t,n=1/0;e;)e._call?(n>e._time&&(n=e._time),i=e,e=e._next):(t=e._next,e._next=null,e=i?i._next=t:Tg=t);Rf=i,zx(n)}function zx(i){if(!Gc){wf&&(wf=clearTimeout(wf));var e=i-Kl;e>24?(i<1/0&&(wf=setTimeout(Qw,i-hd.now()-n_)),lf&&(lf=clearInterval(lf))):(lf||(Eg=hd.now(),lf=setInterval(LV,zN)),Gc=1,kN(Qw))}}const OV=1664525,BV=1013904223,Zw=4294967296;function FV(){let i=1;return()=>(i=(OV*i+BV)%Zw)/Zw}var Jw=3;function m0(i){return i.x}function e1(i){return i.y}function IV(i){return i.z}var zV=10,kV=Math.PI*(3-Math.sqrt(5)),GV=Math.PI*20/(9+Math.sqrt(221));function VV(i,e){e=e||2;var t=Math.min(Jw,Math.max(1,Math.round(e))),n,r=1,s=.001,o=1-Math.pow(s,1/300),u=0,c=.6,f=new Map,d=VN(_),m=IN("tick","end"),g=FV();i==null&&(i=[]);function _(){v(),m.call("tick",n),r<s&&(d.stop(),m.call("end",n))}function v(x){var E,M=i.length,A;x===void 0&&(x=1);for(var C=0;C<x;++C)for(r+=(u-r)*o,f.forEach(function(w){w(r)}),E=0;E<M;++E)A=i[E],A.fx==null?A.x+=A.vx*=c:(A.x=A.fx,A.vx=0),t>1&&(A.fy==null?A.y+=A.vy*=c:(A.y=A.fy,A.vy=0)),t>2&&(A.fz==null?A.z+=A.vz*=c:(A.z=A.fz,A.vz=0));return n}function S(){for(var x=0,E=i.length,M;x<E;++x){if(M=i[x],M.index=x,M.fx!=null&&(M.x=M.fx),M.fy!=null&&(M.y=M.fy),M.fz!=null&&(M.z=M.fz),isNaN(M.x)||t>1&&isNaN(M.y)||t>2&&isNaN(M.z)){var A=zV*(t>2?Math.cbrt(.5+x):t>1?Math.sqrt(.5+x):x),C=x*kV,w=x*GV;t===1?M.x=A:t===2?(M.x=A*Math.cos(C),M.y=A*Math.sin(C)):(M.x=A*Math.sin(C)*Math.cos(w),M.y=A*Math.cos(C),M.z=A*Math.sin(C)*Math.sin(w))}(isNaN(M.vx)||t>1&&isNaN(M.vy)||t>2&&isNaN(M.vz))&&(M.vx=0,t>1&&(M.vy=0),t>2&&(M.vz=0))}}function b(x){return x.initialize&&x.initialize(i,g,t),x}return S(),n={tick:v,restart:function(){return d.restart(_),n},stop:function(){return d.stop(),n},numDimensions:function(x){return arguments.length?(t=Math.min(Jw,Math.max(1,Math.round(x))),f.forEach(b),n):t},nodes:function(x){return arguments.length?(i=x,S(),f.forEach(b),n):i},alpha:function(x){return arguments.length?(r=+x,n):r},alphaMin:function(x){return arguments.length?(s=+x,n):s},alphaDecay:function(x){return arguments.length?(o=+x,n):+o},alphaTarget:function(x){return arguments.length?(u=+x,n):u},velocityDecay:function(x){return arguments.length?(c=1-x,n):1-c},randomSource:function(x){return arguments.length?(g=x,f.forEach(b),n):g},force:function(x,E){return arguments.length>1?(E==null?f.delete(x):f.set(x,b(E)),n):f.get(x)},find:function(){var x=Array.prototype.slice.call(arguments),E=x.shift()||0,M=(t>1?x.shift():null)||0,A=(t>2?x.shift():null)||0,C=x.shift()||1/0,w=0,N=i.length,L,P,D,I,j,J;for(C*=C,w=0;w<N;++w)j=i[w],L=E-j.x,P=M-(j.y||0),D=A-(j.z||0),I=L*L+P*P+D*D,I<C&&(J=j,C=I);return J},on:function(x,E){return arguments.length>1?(m.on(x,E),n):m.on(x)}}}function HV(){var i,e,t,n,r,s=Ba(-30),o,u=1,c=1/0,f=.81;function d(v){var S,b=i.length,x=(e===1?LN(i,m0):e===2?ON(i,m0,e1):e===3?FN(i,m0,e1,IV):null).visitAfter(g);for(r=v,S=0;S<b;++S)t=i[S],x.visit(_)}function m(){if(i){var v,S=i.length,b;for(o=new Array(S),v=0;v<S;++v)b=i[v],o[b.index]=+s(b,v,i)}}function g(v){var S=0,b,x,E=0,M,A,C,w,N=v.length;if(N){for(M=A=C=w=0;w<N;++w)(b=v[w])&&(x=Math.abs(b.value))&&(S+=b.value,E+=x,M+=x*(b.x||0),A+=x*(b.y||0),C+=x*(b.z||0));S*=Math.sqrt(4/N),v.x=M/E,e>1&&(v.y=A/E),e>2&&(v.z=C/E)}else{b=v,b.x=b.data.x,e>1&&(b.y=b.data.y),e>2&&(b.z=b.data.z);do S+=o[b.data.index];while(b=b.next)}v.value=S}function _(v,S,b,x,E){if(!v.value)return!0;var M=[b,x,E][e-1],A=v.x-t.x,C=e>1?v.y-t.y:0,w=e>2?v.z-t.z:0,N=M-S,L=A*A+C*C+w*w;if(N*N/f<L)return L<c&&(A===0&&(A=Ra(n),L+=A*A),e>1&&C===0&&(C=Ra(n),L+=C*C),e>2&&w===0&&(w=Ra(n),L+=w*w),L<u&&(L=Math.sqrt(u*L)),t.vx+=A*v.value*r/L,e>1&&(t.vy+=C*v.value*r/L),e>2&&(t.vz+=w*v.value*r/L)),!0;if(v.length||L>=c)return;(v.data!==t||v.next)&&(A===0&&(A=Ra(n),L+=A*A),e>1&&C===0&&(C=Ra(n),L+=C*C),e>2&&w===0&&(w=Ra(n),L+=w*w),L<u&&(L=Math.sqrt(u*L)));do v.data!==t&&(N=o[v.data.index]*r/L,t.vx+=A*N,e>1&&(t.vy+=C*N),e>2&&(t.vz+=w*N));while(v=v.next)}return d.initialize=function(v,...S){i=v,n=S.find(b=>typeof b=="function")||Math.random,e=S.find(b=>[1,2,3].includes(b))||2,m()},d.strength=function(v){return arguments.length?(s=typeof v=="function"?v:Ba(+v),m(),d):s},d.distanceMin=function(v){return arguments.length?(u=v*v,d):Math.sqrt(u)},d.distanceMax=function(v){return arguments.length?(c=v*v,d):Math.sqrt(c)},d.theta=function(v){return arguments.length?(f=v*v,d):Math.sqrt(f)},d}function jV(i,e,t,n){var r,s,o=Ba(.1),u,c;typeof i!="function"&&(i=Ba(+i)),e==null&&(e=0),t==null&&(t=0),n==null&&(n=0);function f(m){for(var g=0,_=r.length;g<_;++g){var v=r[g],S=v.x-e||1e-6,b=(v.y||0)-t||1e-6,x=(v.z||0)-n||1e-6,E=Math.sqrt(S*S+b*b+x*x),M=(c[g]-E)*u[g]*m/E;v.vx+=S*M,s>1&&(v.vy+=b*M),s>2&&(v.vz+=x*M)}}function d(){if(r){var m,g=r.length;for(u=new Array(g),c=new Array(g),m=0;m<g;++m)c[m]=+i(r[m],m,r),u[m]=isNaN(c[m])?0:+o(r[m],m,r)}}return f.initialize=function(m,...g){r=m,s=g.find(_=>[1,2,3].includes(_))||2,d()},f.strength=function(m){return arguments.length?(o=typeof m=="function"?m:Ba(+m),d(),f):o},f.radius=function(m){return arguments.length?(i=typeof m=="function"?m:Ba(+m),d(),f):i},f.x=function(m){return arguments.length?(e=+m,f):e},f.y=function(m){return arguments.length?(t=+m,f):t},f.z=function(m){return arguments.length?(n=+m,f):n},f}var g0,t1;function dS(){if(t1)return g0;t1=1,g0=function(n){e(n);var r=i(n);return n.on=r.on,n.off=r.off,n.fire=r.fire,n};function i(t){var n=Object.create(null);return{on:function(r,s,o){if(typeof s!="function")throw new Error("callback is expected to be a function");var u=n[r];return u||(u=n[r]=[]),u.push({callback:s,ctx:o}),t},off:function(r,s){var o=typeof r>"u";if(o)return n=Object.create(null),t;if(n[r]){var u=typeof s!="function";if(u)delete n[r];else for(var c=n[r],f=0;f<c.length;++f)c[f].callback===s&&c.splice(f,1)}return t},fire:function(r){var s=n[r];if(!s)return t;var o;arguments.length>1&&(o=Array.prototype.splice.call(arguments,1));for(var u=0;u<s.length;++u){var c=s[u];c.callback.apply(c.ctx,o)}return t}}}function e(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var n=["on","fire","off"],r=0;r<n.length;++r)if(t.hasOwnProperty(n[r]))throw new Error("Subject cannot be eventified, since it already has property '"+n[r]+"'")}return g0}var _0,n1;function WV(){if(n1)return _0;n1=1,_0=e;var i=dS();function e(o){if(o=o||{},"uniqueLinkId"in o&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),o.multigraph=o.uniqueLinkId),o.multigraph===void 0&&(o.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var u=new Map,c=new Map,f={},d=0,m=o.multigraph?D:P,g=[],_=Ee,v=Ee,S=Ee,b=Ee,x={version:20,addNode:C,addLink:L,removeLink:ue,removeNode:N,getNode:w,getNodeCount:I,getLinkCount:j,getEdgeCount:j,getLinksCount:j,getNodesCount:I,getLinks:J,forEachNode:Z,forEachLinkedNode:ce,forEachLink:W,beginUpdate:S,endUpdate:b,clear:G,hasLink:k,hasNode:w,getLink:k};return i(x),E(),x;function E(){var Y=x.on;x.on=ie;function ie(){return x.beginUpdate=S=De,x.endUpdate=b=q,_=M,v=A,x.on=Y,Y.apply(x,arguments)}}function M(Y,ie){g.push({link:Y,changeType:ie})}function A(Y,ie){g.push({node:Y,changeType:ie})}function C(Y,ie){if(Y===void 0)throw new Error("Invalid node identifier");S();var xe=w(Y);return xe?(xe.data=ie,v(xe,"update")):(xe=new t(Y,ie),v(xe,"add")),u.set(Y,xe),b(),xe}function w(Y){return u.get(Y)}function N(Y){var ie=w(Y);if(!ie)return!1;S();var xe=ie.links;return xe&&(xe.forEach($),ie.links=null),u.delete(Y),v(ie,"remove"),b(),!0}function L(Y,ie,xe){S();var Ve=w(Y)||C(Y),ke=w(ie)||C(ie),st=m(Y,ie,xe),Ct=c.has(st.id);return c.set(st.id,st),n(Ve,st),Y!==ie&&n(ke,st),_(st,Ct?"update":"add"),b(),st}function P(Y,ie,xe){var Ve=s(Y,ie),ke=c.get(Ve);return ke?(ke.data=xe,ke):new r(Y,ie,xe,Ve)}function D(Y,ie,xe){var Ve=s(Y,ie),ke=f.hasOwnProperty(Ve);if(ke||k(Y,ie)){ke||(f[Ve]=0);var st="@"+ ++f[Ve];Ve=s(Y+st,ie+st)}return new r(Y,ie,xe,Ve)}function I(){return u.size}function j(){return c.size}function J(Y){var ie=w(Y);return ie?ie.links:null}function ue(Y,ie){return ie!==void 0&&(Y=k(Y,ie)),$(Y)}function $(Y){if(!Y||!c.get(Y.id))return!1;S(),c.delete(Y.id);var ie=w(Y.fromId),xe=w(Y.toId);return ie&&ie.links.delete(Y),xe&&xe.links.delete(Y),_(Y,"remove"),b(),!0}function k(Y,ie){if(!(Y===void 0||ie===void 0))return c.get(s(Y,ie))}function G(){S(),Z(function(Y){N(Y.id)}),b()}function W(Y){if(typeof Y=="function")for(var ie=c.values(),xe=ie.next();!xe.done;){if(Y(xe.value))return!0;xe=ie.next()}}function ce(Y,ie,xe){var Ve=w(Y);if(Ve&&Ve.links&&typeof ie=="function")return xe?le(Ve.links,Y,ie):z(Ve.links,Y,ie)}function z(Y,ie,xe){for(var Ve,ke=Y.values(),st=ke.next();!st.done;){var Ct=st.value,vt=Ct.fromId===ie?Ct.toId:Ct.fromId;if(Ve=xe(u.get(vt),Ct),Ve)return!0;st=ke.next()}}function le(Y,ie,xe){for(var Ve,ke=Y.values(),st=ke.next();!st.done;){var Ct=st.value;if(Ct.fromId===ie&&(Ve=xe(u.get(Ct.toId),Ct),Ve))return!0;st=ke.next()}}function Ee(){}function De(){d+=1}function q(){d-=1,d===0&&g.length>0&&(x.fire("changed",g),g.length=0)}function Z(Y){if(typeof Y!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+Y);for(var ie=u.values(),xe=ie.next();!xe.done;){if(Y(xe.value))return!0;xe=ie.next()}}}function t(o,u){this.id=o,this.links=null,this.data=u}function n(o,u){o.links?o.links.add(u):o.links=new Set([u])}function r(o,u,c,f){this.fromId=o,this.toId=u,this.data=c,this.id=f}function s(o,u){return o.toString()+"👉 "+u.toString()}return _0}var qV=WV();const $V=kg(qV);var Em={exports:{}},Xu={exports:{}},v0,i1;function HN(){return i1||(i1=1,v0=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)}),v0}var y0,r1;function th(){if(r1)return y0;r1=1;const i=HN();return y0=function(t){return n;function n(r,s){let o=s&&s.indent||0,u=s&&s.join!==void 0?s.join:`
`,c=Array(o+1).join(" "),f=[];for(let d=0;d<t;++d){let m=i(d),g=d===0?"":c;f.push(g+r.replace(/{var}/g,m))}return f.join(u)}},y0}var s1;function XV(){if(s1)return Xu.exports;s1=1;const i=th();Xu.exports=e,Xu.exports.generateCreateBodyFunctionBody=t,Xu.exports.getVectorCode=r,Xu.exports.getBodyCode=n;function e(s,o){let u=t(s,o),{Body:c}=new Function(u)();return c}function t(s,o){return`
${r(s,o)}
${n(s)}
return {Body: Body, Vector: Vector};
`}function n(s){let o=i(s),u=o("{var}",{join:", "});return`
function Body(${u}) {
  this.isPinned = false;
  this.pos = new Vector(${u});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${u}) {
  ${o("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function r(s,o){let u=i(s),c="";return o&&(c=`${u(`
	   var v{var};
	Object.defineProperty(this, '{var}', {
	  set: function(v) { 
	    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
	    v{var} = v; 
	  },
	  get: function() { return v{var}; }
	});`)}`),`function Vector(${u("{var}",{join:", "})}) {
  ${c}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${u('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${u("this.{var} = v.{var};",{indent:4})}
    } else {
      ${u('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${u("this.{var} = ",{join:""})}0;
  };`}return Xu.exports}var Ea={exports:{}},a1;function YV(){if(a1)return Ea.exports;a1=1;const i=th(),e=HN();Ea.exports=t,Ea.exports.generateQuadTreeFunctionBody=n,Ea.exports.getInsertStackCode=c,Ea.exports.getQuadNodeCode=u,Ea.exports.isSamePosition=r,Ea.exports.getChildBodyCode=o,Ea.exports.setChildBodyCode=s;function t(f){let d=n(f);return new Function(d)()}function n(f){let d=i(f),m=Math.pow(2,f);return`
${c()}
${u(f)}
${r(f)}
${o(f)}
${s(f)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${S("      node.")}
      node.body = null;
      node.mass = ${d("node.mass_{var} = ",{join:""})}0;
      ${d("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${d("var d{var};",{indent:4})}
    var r; 
    ${d("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${d("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${d("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${d("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${d("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${d("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < θ, treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${d("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${v()}
        }
      }
    }

    ${d("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${d("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${d("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${d("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${d("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${d("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${d("root.min_{var} = {var}min;",{indent:4})}
    ${d("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${d("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${d("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${d("var min_{var} = node.min_{var};",{indent:8})}
        ${d("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${_(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${d("child.min_{var} = min_{var};",{indent:10})}
          ${d("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${d("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${d("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function _(b){let x=[],E=Array(b+1).join(" ");for(let M=0;M<f;++M)x.push(E+`if (${e(M)} > max_${e(M)}) {`),x.push(E+`  quadIdx = quadIdx + ${Math.pow(2,M)};`),x.push(E+`  min_${e(M)} = max_${e(M)};`),x.push(E+`  max_${e(M)} = node.max_${e(M)};`),x.push(E+"}");return x.join(`
`)}function v(){let b=Array(11).join(" "),x=[];for(let E=0;E<m;++E)x.push(b+`if (node.quad${E}) {`),x.push(b+`  queue[pushIdx] = node.quad${E};`),x.push(b+"  queueLength += 1;"),x.push(b+"  pushIdx += 1;"),x.push(b+"}");return x.join(`
`)}function S(b){let x=[];for(let E=0;E<m;++E)x.push(`${b}quad${E} = null;`);return x.join(`
`)}}function r(f){let d=i(f);return`
  function isSamePosition(point1, point2) {
    ${d("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${d("d{var} < 1e-8",{join:" && "})};
  }  
`}function s(f){var d=Math.pow(2,f);return`
function setChild(node, idx, child) {
  ${m()}
}`;function m(){let g=[];for(let _=0;_<d;++_){let v=_===0?"  ":"  else ";g.push(`${v}if (idx === ${_}) node.quad${_} = child;`)}return g.join(`
`)}}function o(f){return`function getChild(node, idx) {
${d()}
  return null;
}`;function d(){let m=[],g=Math.pow(2,f);for(let _=0;_<g;++_)m.push(`  if (idx === ${_}) return node.quad${_};`);return m.join(`
`)}}function u(f){let d=i(f),m=Math.pow(2,f);var g=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${_("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${d("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${d("this.min_{var} = 0;",{indent:2})}
  ${d("this.max_{var} = 0;",{indent:2})}
}
`;return g;function _(v){let S=[];for(let b=0;b<m;++b)S.push(`${v}quad${b} = null;`);return S.join(`
`)}}function c(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}return Ea.exports}var Mm={exports:{}},o1;function KV(){if(o1)return Mm.exports;o1=1,Mm.exports=e,Mm.exports.generateFunctionBody=t;const i=th();function e(n){let r=t(n);return new Function("bodies","settings","random",r)}function t(n){let r=i(n);return`
  var boundingBox = {
    ${r("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${r("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${r("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${r("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${r("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${r("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${r("var max_{var} = -Infinity;",{indent:4})}
    ${r("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${r("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${r("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${r("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${r("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${r("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}return Mm.exports}var Am={exports:{}},l1;function QV(){if(l1)return Am.exports;l1=1;const i=th();Am.exports=e,Am.exports.generateCreateDragForceFunctionBody=t;function e(n){let r=t(n);return new Function("options",r)}function t(n){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${i(n)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}return Am.exports}var wm={exports:{}},u1;function ZV(){if(u1)return wm.exports;u1=1;const i=th();wm.exports=e,wm.exports.generateCreateSpringForceFunctionBody=t;function e(n){let r=t(n);return new Function("options","random",r)}function t(n){let r=i(n);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${r("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${r("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${r("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${r("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${r("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${r("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}return wm.exports}var Rm={exports:{}},c1;function JV(){if(c1)return Rm.exports;c1=1;const i=th();Rm.exports=e,Rm.exports.generateIntegratorFunctionBody=t;function e(n){let r=t(n);return new Function("bodies","timeStep","adaptiveTimeStepWeight",r)}function t(n){let r=i(n);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${r("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${r("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${r("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${r("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${r("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${r("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${r("body.pos.{var} += d{var};",{indent:4})}

    ${r("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${r("t{var} * t{var}",{join:" + "})})/length;
`}return Rm.exports}var x0,h1;function eH(){if(h1)return x0;h1=1,x0=i;function i(e,t,n,r){this.from=e,this.to=t,this.length=n,this.coefficient=r}return x0}var b0,f1;function tH(){if(f1)return b0;f1=1,b0=i;function i(e,t){var n;if(e||(e={}),t){for(n in t)if(t.hasOwnProperty(n)){var r=e.hasOwnProperty(n),s=typeof t[n],o=!r||typeof e[n]!==s;o?e[n]=t[n]:s==="object"&&(e[n]=i(e[n],t[n]))}}return e}return b0}var uf={exports:{}},d1;function nH(){if(d1)return uf.exports;d1=1,uf.exports=i,uf.exports.random=i,uf.exports.randomIterator=u;function i(c){var f=typeof c=="number"?c:+new Date;return new e(f)}function e(c){this.seed=c}e.prototype.next=o,e.prototype.nextDouble=s,e.prototype.uniform=s,e.prototype.gaussian=t,e.prototype.random=s;function t(){var c,f,d;do f=this.nextDouble()*2-1,d=this.nextDouble()*2-1,c=f*f+d*d;while(c>=1||c===0);return f*Math.sqrt(-2*Math.log(c)/c)}e.prototype.levy=n;function n(){var c=1.5,f=Math.pow(r(1+c)*Math.sin(Math.PI*c/2)/(r((1+c)/2)*c*Math.pow(2,(c-1)/2)),1/c);return this.gaussian()*f/Math.pow(Math.abs(this.gaussian()),1/c)}function r(c){return Math.sqrt(2*Math.PI/c)*Math.pow(1/Math.E*(c+1/(12*c-1/(10*c))),c)}function s(){var c=this.seed;return c=c+2127912214+(c<<12)&4294967295,c=(c^3345072700^c>>>19)&4294967295,c=c+374761393+(c<<5)&4294967295,c=(c+3550635116^c<<9)&4294967295,c=c+4251993797+(c<<3)&4294967295,c=(c^3042594569^c>>>16)&4294967295,this.seed=c,(c&268435455)/268435456}function o(c){return Math.floor(this.nextDouble()*c)}function u(c,f){var d=f||i();if(typeof d.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:g,shuffle:m};function m(){var _,v,S;for(_=c.length-1;_>0;--_)v=d.next(_+1),S=c[v],c[v]=c[_],c[_]=S;return c}function g(_){var v,S,b;for(v=c.length-1;v>0;--v)S=d.next(v+1),b=c[S],c[S]=c[v],c[v]=b,_(b);c.length&&_(c[0])}}return uf.exports}var S0,p1;function m1(){if(p1)return S0;p1=1,S0=u;var i=XV(),e=YV(),t=KV(),n=QV(),r=ZV(),s=JV(),o={};function u(d){var m=eH(),g=tH(),_=dS();if(d){if(d.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(d.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}d=g(d,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var v=o[d.dimensions];if(!v){var S=d.dimensions;v={Body:i(S,d.debug),createQuadTree:e(S),createBounds:t(S),createDragForce:n(S),createSpringForce:r(S),integrate:s(S)},o[S]=v}var b=v.Body,x=v.createQuadTree,E=v.createBounds,M=v.createDragForce,A=v.createSpringForce,C=v.integrate,w=Z=>new b(Z),N=nH().random(42),L=[],P=[],D=x(d,N),I=E(L,d,N),j=A(d,N),J=M(d),ue=0,$=[],k=new Map,G=0;z("nbody",De),z("spring",q);var W={bodies:L,quadTree:D,springs:P,settings:d,addForce:z,removeForce:le,getForces:Ee,step:function(){for(var Z=0;Z<$.length;++Z)$[Z](G);var Y=C(L,d.timeStep,d.adaptiveTimeStepWeight);return G+=1,Y},addBody:function(Z){if(!Z)throw new Error("Body is required");return L.push(Z),Z},addBodyAt:function(Z){if(!Z)throw new Error("Body position is required");var Y=w(Z);return L.push(Y),Y},removeBody:function(Z){if(Z){var Y=L.indexOf(Z);if(!(Y<0))return L.splice(Y,1),L.length===0&&I.reset(),!0}},addSpring:function(Z,Y,ie,xe){if(!Z||!Y)throw new Error("Cannot add null spring to force simulator");typeof ie!="number"&&(ie=-1);var Ve=new m(Z,Y,ie,xe>=0?xe:-1);return P.push(Ve),Ve},getTotalMovement:function(){return ue},removeSpring:function(Z){if(Z){var Y=P.indexOf(Z);if(Y>-1)return P.splice(Y,1),!0}},getBestNewBodyPosition:function(Z){return I.getBestNewPosition(Z)},getBBox:ce,getBoundingBox:ce,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(Z){return Z!==void 0?(d.gravity=Z,D.options({gravity:Z}),this):d.gravity},theta:function(Z){return Z!==void 0?(d.theta=Z,D.options({theta:Z}),this):d.theta},random:N};return c(d,W),_(W),W;function ce(){return I.update(),I.box}function z(Z,Y){if(k.has(Z))throw new Error("Force "+Z+" is already added");k.set(Z,Y),$.push(Y)}function le(Z){var Y=$.indexOf(k.get(Z));Y<0||($.splice(Y,1),k.delete(Z))}function Ee(){return k}function De(){if(L.length!==0){D.insertBodies(L);for(var Z=L.length;Z--;){var Y=L[Z];Y.isPinned||(Y.reset(),D.updateBodyForce(Y),J.update(Y))}}}function q(){for(var Z=P.length;Z--;)j.update(P[Z])}}function c(d,m){for(var g in d)f(d,m,g)}function f(d,m,g){if(d.hasOwnProperty(g)&&typeof m[g]!="function"){var _=Number.isFinite(d[g]);_?m[g]=function(v){if(v!==void 0){if(!Number.isFinite(v))throw new Error("Value of "+g+" should be a valid number.");return d[g]=v,m}return d[g]}:m[g]=function(v){return v!==void 0?(d[g]=v,m):d[g]}}}return S0}var g1;function iH(){if(g1)return Em.exports;g1=1,Em.exports=e,Em.exports.simulator=m1();var i=dS();function e(n,r){if(!n)throw new Error("Graph structure cannot be undefined");var s=r&&r.createSimulator||m1(),o=s(r);if(Array.isArray(r))throw new Error("Physics settings is expected to be an object");var u=n.version>19?k:$;r&&typeof r.nodeMass=="function"&&(u=r.nodeMass);var c=new Map,f={},d=0,m=o.settings.springTransform||t;w(),M();var g=!1,_={step:function(){if(d===0)return v(!0),!0;var G=o.step();_.lastMove=G,_.fire("step");var W=G/d,ce=W<=.01;return v(ce),ce},getNodePosition:function(G){return ue(G).pos},setNodePosition:function(G){var W=ue(G);W.setPosition.apply(W,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(G){var W=f[G];if(W)return{from:W.from.pos,to:W.to.pos}},getGraphRect:function(){return o.getBBox()},forEachBody:S,pinNode:function(G,W){var ce=ue(G.id);ce.isPinned=!!W},isNodePinned:function(G){return ue(G.id).isPinned},dispose:function(){n.off("changed",C),_.fire("disposed")},getBody:E,getSpring:x,getForceVectorLength:b,simulator:o,graph:n,lastMove:0};return i(_),_;function v(G){g!==G&&(g=G,A(G))}function S(G){c.forEach(G)}function b(){var G=0,W=0;return S(function(ce){G+=Math.abs(ce.force.x),W+=Math.abs(ce.force.y)}),Math.sqrt(G*G+W*W)}function x(G,W){var ce;if(W===void 0)typeof G!="object"?ce=G:ce=G.id;else{var z=n.hasLink(G,W);if(!z)return;ce=z.id}return f[ce]}function E(G){return c.get(G)}function M(){n.on("changed",C)}function A(G){_.fire("stable",G)}function C(G){for(var W=0;W<G.length;++W){var ce=G[W];ce.changeType==="add"?(ce.node&&N(ce.node.id),ce.link&&P(ce.link)):ce.changeType==="remove"&&(ce.node&&L(ce.node),ce.link&&D(ce.link))}d=n.getNodesCount()}function w(){d=0,n.forEachNode(function(G){N(G.id),d+=1}),n.forEachLink(P)}function N(G){var W=c.get(G);if(!W){var ce=n.getNode(G);if(!ce)throw new Error("initBody() was called with unknown node id");var z=ce.position;if(!z){var le=I(ce);z=o.getBestNewBodyPosition(le)}W=o.addBodyAt(z),W.id=G,c.set(G,W),j(G),J(ce)&&(W.isPinned=!0)}}function L(G){var W=G.id,ce=c.get(W);ce&&(c.delete(W),o.removeBody(ce))}function P(G){j(G.fromId),j(G.toId);var W=c.get(G.fromId),ce=c.get(G.toId),z=o.addSpring(W,ce,G.length);m(G,z),f[G.id]=z}function D(G){var W=f[G.id];if(W){var ce=n.getNode(G.fromId),z=n.getNode(G.toId);ce&&j(ce.id),z&&j(z.id),delete f[G.id],o.removeSpring(W)}}function I(G){var W=[];if(!G.links)return W;for(var ce=Math.min(G.links.length,2),z=0;z<ce;++z){var le=G.links[z],Ee=le.fromId!==G.id?c.get(le.fromId):c.get(le.toId);Ee&&Ee.pos&&W.push(Ee)}return W}function j(G){var W=c.get(G);if(W.mass=u(G),Number.isNaN(W.mass))throw new Error("Node mass should be a number")}function J(G){return G&&(G.isPinned||G.data&&G.data.isPinned)}function ue(G){var W=c.get(G);return W||(N(G),W=c.get(G)),W}function $(G){var W=n.getLinks(G);return W?1+W.length/3:1}function k(G){var W=n.getLinks(G);return W?1+W.size/3:1}}function t(){}return Em.exports}var rH=iH();const sH=kg(rH);function kx(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}var aH=typeof global=="object"&&global&&global.Object===Object&&global,oH=typeof self=="object"&&self&&self.Object===Object&&self,jN=aH||oH||Function("return this")(),T0=function(){return jN.Date.now()},lH=/\s/;function uH(i){for(var e=i.length;e--&&lH.test(i.charAt(e)););return e}var cH=/^\s+/;function hH(i){return i&&i.slice(0,uH(i)+1).replace(cH,"")}var Mg=jN.Symbol,WN=Object.prototype,fH=WN.hasOwnProperty,dH=WN.toString,cf=Mg?Mg.toStringTag:void 0;function pH(i){var e=fH.call(i,cf),t=i[cf];try{i[cf]=void 0;var n=!0}catch{}var r=dH.call(i);return n&&(e?i[cf]=t:delete i[cf]),r}var mH=Object.prototype,gH=mH.toString;function _H(i){return gH.call(i)}var vH="[object Null]",yH="[object Undefined]",_1=Mg?Mg.toStringTag:void 0;function xH(i){return i==null?i===void 0?yH:vH:_1&&_1 in Object(i)?pH(i):_H(i)}function bH(i){return i!=null&&typeof i=="object"}var SH="[object Symbol]";function TH(i){return typeof i=="symbol"||bH(i)&&xH(i)==SH}var v1=NaN,EH=/^[-+]0x[0-9a-f]+$/i,MH=/^0b[01]+$/i,AH=/^0o[0-7]+$/i,wH=parseInt;function y1(i){if(typeof i=="number")return i;if(TH(i))return v1;if(kx(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=kx(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=hH(i);var t=MH.test(i);return t||AH.test(i)?wH(i.slice(2),t?2:8):EH.test(i)?v1:+i}var RH="Expected a function",CH=Math.max,NH=Math.min;function DH(i,e,t){var n,r,s,o,u,c,f=0,d=!1,m=!1,g=!0;if(typeof i!="function")throw new TypeError(RH);e=y1(e)||0,kx(t)&&(d=!!t.leading,m="maxWait"in t,s=m?CH(y1(t.maxWait)||0,e):s,g="trailing"in t?!!t.trailing:g);function _(w){var N=n,L=r;return n=r=void 0,f=w,o=i.apply(L,N),o}function v(w){return f=w,u=setTimeout(x,e),d?_(w):o}function S(w){var N=w-c,L=w-f,P=e-N;return m?NH(P,s-L):P}function b(w){var N=w-c,L=w-f;return c===void 0||N>=e||N<0||m&&L>=s}function x(){var w=T0();if(b(w))return E(w);u=setTimeout(x,S(w))}function E(w){return u=void 0,g&&n?_(w):(n=r=void 0,o)}function M(){u!==void 0&&clearTimeout(u),f=0,n=c=r=u=void 0}function A(){return u===void 0?o:E(T0())}function C(){var w=T0(),N=b(w);if(n=arguments,r=this,c=w,N){if(u===void 0)return v(c);if(m)return clearTimeout(u),u=setTimeout(x,e),_(c)}return u===void 0&&(u=setTimeout(x,e)),o}return C.cancel=M,C.flush=A,C}function x1(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function PH(i){if(Array.isArray(i))return i}function LH(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function UH(i,e,t){return Object.defineProperty(i,"prototype",{writable:!1}),i}function OH(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,f=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){f=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw r}}return u}}function BH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FH(i,e){return PH(i)||OH(i,e)||IH(i,e)||BH()}function IH(i,e){if(i){if(typeof i=="string")return x1(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?x1(i,e):void 0}}var zH=UH(function i(e,t){var n=t.default,r=n===void 0?null:n,s=t.triggerUpdate,o=s===void 0?!0:s,u=t.onChange,c=u===void 0?function(f,d){}:u;LH(this,i),this.name=e,this.defaultVal=r,this.triggerUpdate=o,this.onChange=c});function i_(i){var e=i.stateInit,t=e===void 0?function(){return{}}:e,n=i.props,r=n===void 0?{}:n,s=i.methods,o=s===void 0?{}:s,u=i.aliases,c=u===void 0?{}:u,f=i.init,d=f===void 0?function(){}:f,m=i.update,g=m===void 0?function(){}:m,_=Object.keys(r).map(function(v){return new zH(v,r[v])});return function v(){for(var S=arguments.length,b=new Array(S),x=0;x<S;x++)b[x]=arguments[x];var E=!!(this instanceof v&&this.constructor),M=E?b.shift():void 0,A=b[0],C=A===void 0?{}:A,w=Object.assign({},t instanceof Function?t(C):t,{initialised:!1}),N={};function L(I){return P(I,C),D(),L}var P=function(j,J){d.call(L,j,w,J),w.initialised=!0},D=DH(function(){w.initialised&&(g.call(L,w,N),N={})},1);return _.forEach(function(I){L[I.name]=j(I);function j(J){var ue=J.name,$=J.triggerUpdate,k=$===void 0?!1:$,G=J.onChange,W=G===void 0?function(le,Ee){}:G,ce=J.defaultVal,z=ce===void 0?null:ce;return function(le){var Ee=w[ue];if(!arguments.length)return Ee;var De=le===void 0?z:le;return w[ue]=De,W.call(L,De,w,Ee),!N.hasOwnProperty(ue)&&(N[ue]=Ee),k&&D(),L}}}),Object.keys(o).forEach(function(I){L[I]=function(){for(var j,J=arguments.length,ue=new Array(J),$=0;$<J;$++)ue[$]=arguments[$];return(j=o[I]).call.apply(j,[L,w].concat(ue))}}),Object.entries(c).forEach(function(I){var j=FH(I,2),J=j[0],ue=j[1];return L[J]=L[ue]}),L.resetProps=function(){return _.forEach(function(I){L[I.name](I.defaultVal)}),L},L.resetProps(),w._rerender=D,E&&M&&L(M),L}}var Zt=function(i){return typeof i=="function"?i:typeof i=="string"?function(e){return e[i]}:function(e){return i}};class b1 extends Map{constructor(e,t=VH){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[n,r]of e)this.set(n,r)}get(e){return super.get(S1(this,e))}has(e){return super.has(S1(this,e))}set(e,t){return super.set(kH(this,e),t)}delete(e){return super.delete(GH(this,e))}}function S1({_intern:i,_key:e},t){const n=e(t);return i.has(n)?i.get(n):t}function kH({_intern:i,_key:e},t){const n=e(t);return i.has(n)?i.get(n):(i.set(n,t),t)}function GH({_intern:i,_key:e},t){const n=e(t);return i.has(n)&&(t=i.get(n),i.delete(n)),t}function VH(i){return i!==null&&typeof i=="object"?i.valueOf():i}function HH(i,e){let t;if(e===void 0)for(const n of i)n!=null&&(t<n||t===void 0&&n>=n)&&(t=n);else{let n=-1;for(let r of i)(r=e(r,++n,i))!=null&&(t<r||t===void 0&&r>=r)&&(t=r)}return t}function jH(i,e){let t;if(e===void 0)for(const n of i)n!=null&&(t>n||t===void 0&&n>=n)&&(t=n);else{let n=-1;for(let r of i)(r=e(r,++n,i))!=null&&(t>r||t===void 0&&r>=r)&&(t=r)}return t}function Gx(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function WH(i){if(Array.isArray(i))return i}function qH(i){if(Array.isArray(i))return Gx(i)}function qN(i,e,t){if(typeof i=="function"?i===e:i.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function $H(i,e){if(e.has(i))throw new TypeError("Cannot initialize the same private elements twice on an object")}function XH(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Wi(i,e){return i.get(qN(i,e))}function Yu(i,e,t){$H(i,e),e.set(i,t)}function Cm(i,e,t){return i.set(qN(i,e),t),t}function YH(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,r5(n.key),n)}}function KH(i,e,t){return e&&YH(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function QH(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function ZH(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,f=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){f=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw r}}return u}}function JH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e5(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t5(i,e){return WH(i)||ZH(i,e)||$N(i,e)||JH()}function n5(i){return qH(i)||QH(i)||$N(i)||e5()}function i5(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function r5(i){var e=i5(i,"string");return typeof e=="symbol"?e:e+""}function $N(i,e){if(i){if(typeof i=="string")return Gx(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Gx(i,e):void 0}}var Ku=new WeakMap,hf=new WeakMap,Qu=new WeakMap,E0=new WeakMap,M0=new WeakMap,A0=new WeakMap,s5=function(){function i(){XH(this,i),Yu(this,Ku,new Map),Yu(this,hf,new Map),Yu(this,Qu,function(e){return e}),Yu(this,E0,function(){return{}}),Yu(this,M0,function(){}),Yu(this,A0,function(){})}return KH(i,[{key:"getObj",value:function(t){return Wi(Ku,this).get(Wi(Qu,this).call(this,t))}},{key:"getData",value:function(t){return Wi(hf,this).get(t)}},{key:"entries",value:function(){return n5(Wi(hf,this).entries()).map(function(t){var n=t5(t,2),r=n[0],s=n[1];return[s,r]})}},{key:"id",value:function(t){return Cm(Qu,this,Zt(t)),this}},{key:"onCreateObj",value:function(t){return Cm(E0,this,t),this}},{key:"onUpdateObj",value:function(t){return Cm(M0,this,t),this}},{key:"onRemoveObj",value:function(t){return Cm(A0,this,t),this}},{key:"digest",value:function(t){var n=this;t.filter(function(s){return!Wi(Ku,n).has(Wi(Qu,n).call(n,s))}).forEach(function(s){var o=Wi(E0,n).call(n,s);Wi(Ku,n).set(Wi(Qu,n).call(n,s),o),Wi(hf,n).set(o,s)});var r=new Map(t.map(function(s){return[Wi(Qu,n).call(n,s),s]}));return Wi(Ku,this).forEach(function(s,o){r.has(o)?Wi(M0,n).call(n,s,r.get(o)):(Wi(A0,n).call(n,s,o),Wi(Ku,n).delete(o),Wi(hf,n).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();function a5(i,e){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(e).domain(i);break}return this}const T1=Symbol("implicit");function XN(){var i=new b1,e=[],t=[],n=T1;function r(s){let o=i.get(s);if(o===void 0){if(n!==T1)return n;i.set(s,o=e.push(s)-1)}return t[o%t.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],i=new b1;for(const o of s)i.has(o)||i.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(t=Array.from(s),r):t.slice()},r.unknown=function(s){return arguments.length?(n=s,r):n},r.copy=function(){return XN(e,t).unknown(n)},a5.apply(r,arguments),r}function o5(i){for(var e=i.length/6|0,t=new Array(e),n=0;n<e;)t[n]="#"+i.slice(n*6,++n*6);return t}const l5=o5("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Ag(i){"@babel/helpers - typeof";return Ag=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ag(i)}var u5=/^\s+/,c5=/\s+$/;function rt(i,e){if(i=i||"",e=e||{},i instanceof rt)return i;if(!(this instanceof rt))return new rt(i,e);var t=h5(i);this._originalInput=i,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}rt.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,n,r,s,o,u;return t=e.r/255,n=e.g/255,r=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),n<=.03928?o=n/12.92:o=Math.pow((n+.055)/1.055,2.4),r<=.03928?u=r/12.92:u=Math.pow((r+.055)/1.055,2.4),.2126*s+.7152*o+.0722*u},setAlpha:function(e){return this._a=YN(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=M1(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=M1(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),r=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=E1(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=E1(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),r=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return A1(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return m5(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Un(this._r,255)*100)+"%",g:Math.round(Un(this._g,255)*100)+"%",b:Math.round(Un(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Un(this._r,255)*100)+"%, "+Math.round(Un(this._g,255)*100)+"%, "+Math.round(Un(this._b,255)*100)+"%)":"rgba("+Math.round(Un(this._r,255)*100)+"%, "+Math.round(Un(this._g,255)*100)+"%, "+Math.round(Un(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:w5[A1(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+w1(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var s=rt(e);n="#"+w1(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0,s=!t&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(n=this.toRgbString()),e==="prgb"&&(n=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(n=this.toHexString()),e==="hex3"&&(n=this.toHexString(!0)),e==="hex4"&&(n=this.toHex8String(!0)),e==="hex8"&&(n=this.toHex8String()),e==="name"&&(n=this.toName()),e==="hsl"&&(n=this.toHslString()),e==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return rt(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(y5,arguments)},brighten:function(){return this._applyModification(x5,arguments)},darken:function(){return this._applyModification(b5,arguments)},desaturate:function(){return this._applyModification(g5,arguments)},saturate:function(){return this._applyModification(_5,arguments)},greyscale:function(){return this._applyModification(v5,arguments)},spin:function(){return this._applyModification(S5,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(M5,arguments)},complement:function(){return this._applyCombination(T5,arguments)},monochromatic:function(){return this._applyCombination(A5,arguments)},splitcomplement:function(){return this._applyCombination(E5,arguments)},triad:function(){return this._applyCombination(R1,[3])},tetrad:function(){return this._applyCombination(R1,[4])}};rt.fromRatio=function(i,e){if(Ag(i)=="object"){var t={};for(var n in i)i.hasOwnProperty(n)&&(n==="a"?t[n]=i[n]:t[n]=Cf(i[n]));i=t}return rt(i,e)};function h5(i){var e={r:0,g:0,b:0},t=1,n=null,r=null,s=null,o=!1,u=!1;return typeof i=="string"&&(i=D5(i)),Ag(i)=="object"&&(Ma(i.r)&&Ma(i.g)&&Ma(i.b)?(e=f5(i.r,i.g,i.b),o=!0,u=String(i.r).substr(-1)==="%"?"prgb":"rgb"):Ma(i.h)&&Ma(i.s)&&Ma(i.v)?(n=Cf(i.s),r=Cf(i.v),e=p5(i.h,n,r),o=!0,u="hsv"):Ma(i.h)&&Ma(i.s)&&Ma(i.l)&&(n=Cf(i.s),s=Cf(i.l),e=d5(i.h,n,s),o=!0,u="hsl"),i.hasOwnProperty("a")&&(t=i.a)),t=YN(t),{ok:o,format:i.format||u,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function f5(i,e,t){return{r:Un(i,255)*255,g:Un(e,255)*255,b:Un(t,255)*255}}function E1(i,e,t){i=Un(i,255),e=Un(e,255),t=Un(t,255);var n=Math.max(i,e,t),r=Math.min(i,e,t),s,o,u=(n+r)/2;if(n==r)s=o=0;else{var c=n-r;switch(o=u>.5?c/(2-n-r):c/(n+r),n){case i:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-i)/c+2;break;case t:s=(i-e)/c+4;break}s/=6}return{h:s,s:o,l:u}}function d5(i,e,t){var n,r,s;i=Un(i,360),e=Un(e,100),t=Un(t,100);function o(f,d,m){return m<0&&(m+=1),m>1&&(m-=1),m<1/6?f+(d-f)*6*m:m<1/2?d:m<2/3?f+(d-f)*(2/3-m)*6:f}if(e===0)n=r=s=t;else{var u=t<.5?t*(1+e):t+e-t*e,c=2*t-u;n=o(c,u,i+1/3),r=o(c,u,i),s=o(c,u,i-1/3)}return{r:n*255,g:r*255,b:s*255}}function M1(i,e,t){i=Un(i,255),e=Un(e,255),t=Un(t,255);var n=Math.max(i,e,t),r=Math.min(i,e,t),s,o,u=n,c=n-r;if(o=n===0?0:c/n,n==r)s=0;else{switch(n){case i:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-i)/c+2;break;case t:s=(i-e)/c+4;break}s/=6}return{h:s,s:o,v:u}}function p5(i,e,t){i=Un(i,360)*6,e=Un(e,100),t=Un(t,100);var n=Math.floor(i),r=i-n,s=t*(1-e),o=t*(1-r*e),u=t*(1-(1-r)*e),c=n%6,f=[t,o,s,s,u,t][c],d=[u,t,t,o,s,s][c],m=[s,s,u,t,t,o][c];return{r:f*255,g:d*255,b:m*255}}function A1(i,e,t,n){var r=[As(Math.round(i).toString(16)),As(Math.round(e).toString(16)),As(Math.round(t).toString(16))];return n&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function m5(i,e,t,n,r){var s=[As(Math.round(i).toString(16)),As(Math.round(e).toString(16)),As(Math.round(t).toString(16)),As(KN(n))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function w1(i,e,t,n){var r=[As(KN(n)),As(Math.round(i).toString(16)),As(Math.round(e).toString(16)),As(Math.round(t).toString(16))];return r.join("")}rt.equals=function(i,e){return!i||!e?!1:rt(i).toRgbString()==rt(e).toRgbString()};rt.random=function(){return rt.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function g5(i,e){e=e===0?0:e||10;var t=rt(i).toHsl();return t.s-=e/100,t.s=r_(t.s),rt(t)}function _5(i,e){e=e===0?0:e||10;var t=rt(i).toHsl();return t.s+=e/100,t.s=r_(t.s),rt(t)}function v5(i){return rt(i).desaturate(100)}function y5(i,e){e=e===0?0:e||10;var t=rt(i).toHsl();return t.l+=e/100,t.l=r_(t.l),rt(t)}function x5(i,e){e=e===0?0:e||10;var t=rt(i).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),rt(t)}function b5(i,e){e=e===0?0:e||10;var t=rt(i).toHsl();return t.l-=e/100,t.l=r_(t.l),rt(t)}function S5(i,e){var t=rt(i).toHsl(),n=(t.h+e)%360;return t.h=n<0?360+n:n,rt(t)}function T5(i){var e=rt(i).toHsl();return e.h=(e.h+180)%360,rt(e)}function R1(i,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=rt(i).toHsl(),n=[rt(i)],r=360/e,s=1;s<e;s++)n.push(rt({h:(t.h+s*r)%360,s:t.s,l:t.l}));return n}function E5(i){var e=rt(i).toHsl(),t=e.h;return[rt(i),rt({h:(t+72)%360,s:e.s,l:e.l}),rt({h:(t+216)%360,s:e.s,l:e.l})]}function M5(i,e,t){e=e||6,t=t||30;var n=rt(i).toHsl(),r=360/t,s=[rt(i)];for(n.h=(n.h-(r*e>>1)+720)%360;--e;)n.h=(n.h+r)%360,s.push(rt(n));return s}function A5(i,e){e=e||6;for(var t=rt(i).toHsv(),n=t.h,r=t.s,s=t.v,o=[],u=1/e;e--;)o.push(rt({h:n,s:r,v:s})),s=(s+u)%1;return o}rt.mix=function(i,e,t){t=t===0?0:t||50;var n=rt(i).toRgb(),r=rt(e).toRgb(),s=t/100,o={r:(r.r-n.r)*s+n.r,g:(r.g-n.g)*s+n.g,b:(r.b-n.b)*s+n.b,a:(r.a-n.a)*s+n.a};return rt(o)};rt.readability=function(i,e){var t=rt(i),n=rt(e);return(Math.max(t.getLuminance(),n.getLuminance())+.05)/(Math.min(t.getLuminance(),n.getLuminance())+.05)};rt.isReadable=function(i,e,t){var n=rt.readability(i,e),r,s;switch(s=!1,r=P5(t),r.level+r.size){case"AAsmall":case"AAAlarge":s=n>=4.5;break;case"AAlarge":s=n>=3;break;case"AAAsmall":s=n>=7;break}return s};rt.mostReadable=function(i,e,t){var n=null,r=0,s,o,u,c;t=t||{},o=t.includeFallbackColors,u=t.level,c=t.size;for(var f=0;f<e.length;f++)s=rt.readability(i,e[f]),s>r&&(r=s,n=rt(e[f]));return rt.isReadable(i,n,{level:u,size:c})||!o?n:(t.includeFallbackColors=!1,rt.mostReadable(i,["#fff","#000"],t))};var Vx=rt.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},w5=rt.hexNames=R5(Vx);function R5(i){var e={};for(var t in i)i.hasOwnProperty(t)&&(e[i[t]]=t);return e}function YN(i){return i=parseFloat(i),(isNaN(i)||i<0||i>1)&&(i=1),i}function Un(i,e){C5(i)&&(i="100%");var t=N5(i);return i=Math.min(e,Math.max(0,parseFloat(i))),t&&(i=parseInt(i*e,10)/100),Math.abs(i-e)<1e-6?1:i%e/parseFloat(e)}function r_(i){return Math.min(1,Math.max(0,i))}function zr(i){return parseInt(i,16)}function C5(i){return typeof i=="string"&&i.indexOf(".")!=-1&&parseFloat(i)===1}function N5(i){return typeof i=="string"&&i.indexOf("%")!=-1}function As(i){return i.length==1?"0"+i:""+i}function Cf(i){return i<=1&&(i=i*100+"%"),i}function KN(i){return Math.round(parseFloat(i)*255).toString(16)}function C1(i){return zr(i)/255}var vs=function(){var i="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+i+")",n="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+r),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Ma(i){return!!vs.CSS_UNIT.exec(i)}function D5(i){i=i.replace(u5,"").replace(c5,"").toLowerCase();var e=!1;if(Vx[i])i=Vx[i],e=!0;else if(i=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=vs.rgb.exec(i))?{r:t[1],g:t[2],b:t[3]}:(t=vs.rgba.exec(i))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=vs.hsl.exec(i))?{h:t[1],s:t[2],l:t[3]}:(t=vs.hsla.exec(i))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=vs.hsv.exec(i))?{h:t[1],s:t[2],v:t[3]}:(t=vs.hsva.exec(i))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=vs.hex8.exec(i))?{r:zr(t[1]),g:zr(t[2]),b:zr(t[3]),a:C1(t[4]),format:e?"name":"hex8"}:(t=vs.hex6.exec(i))?{r:zr(t[1]),g:zr(t[2]),b:zr(t[3]),format:e?"name":"hex"}:(t=vs.hex4.exec(i))?{r:zr(t[1]+""+t[1]),g:zr(t[2]+""+t[2]),b:zr(t[3]+""+t[3]),a:C1(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=vs.hex3.exec(i))?{r:zr(t[1]+""+t[1]),g:zr(t[2]+""+t[2]),b:zr(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function P5(i){var e,t;return i=i||{level:"AA",size:"small"},e=(i.level||"AA").toUpperCase(),t=(i.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function Hx(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function L5(i){if(Array.isArray(i))return i}function U5(i){if(Array.isArray(i))return Hx(i)}function QN(i,e,t){if(typeof i=="function"?i===e:i.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function O5(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function ZN(i,e,t){return e=Vc(e),H5(i,pS()?Reflect.construct(e,t||[],Vc(i).constructor):e.apply(i,t))}function B5(i,e){if(e.has(i))throw new TypeError("Cannot initialize the same private elements twice on an object")}function JN(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function w0(i,e){return i.get(QN(i,e))}function N1(i,e,t){B5(i,e),e.set(i,t)}function D1(i,e,t){return i.set(QN(i,e),t),t}function e2(i,e,t){if(pS())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var r=new(i.bind.apply(i,n));return r}function F5(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,i2(n.key),n)}}function t2(i,e,t){return e&&F5(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function s_(i,e,t){return(e=i2(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function jx(){return jx=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(i,e,t){var n=j5(i,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?i:t):r.value}},jx.apply(null,arguments)}function Vc(i){return Vc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Vc(i)}function n2(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&Wx(i,e)}function pS(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pS=function(){return!!i})()}function I5(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function z5(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,f=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){f=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw r}}return u}}function k5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function G5(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P1(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function V5(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?P1(Object(t),!0).forEach(function(n){s_(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):P1(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function H5(i,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return O5(i)}function Wx(i,e){return Wx=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Wx(i,e)}function zf(i,e){return L5(i)||z5(i,e)||r2(i,e)||k5()}function j5(i,e){for(;!{}.hasOwnProperty.call(i,e)&&(i=Vc(i))!==null;);return i}function R0(i,e,t,n){var r=jx(Vc(i.prototype),e,t);return typeof r=="function"?function(s){return r.apply(t,s)}:r}function xs(i){return U5(i)||I5(i)||r2(i)||G5()}function W5(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function i2(i){var e=W5(i,"string");return typeof e=="symbol"?e:e+""}function qx(i){"@babel/helpers - typeof";return qx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qx(i)}function r2(i,e){if(i){if(typeof i=="string")return Hx(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Hx(i,e):void 0}}var s2=function(e){e instanceof Array?e.forEach(s2):(e.map&&e.map.dispose(),e.dispose())},a2=function(e){e.geometry&&e.geometry.dispose(),e.material&&s2(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(a2)},$x=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),a2(t)}},C0=new WeakMap,Nm=new WeakMap,ff=function(i){function e(t){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.dataBindAttr,o=s===void 0?"__data":s,u=r.objBindAttr,c=u===void 0?"__threeObj":u;return JN(this,e),n=ZN(this,e),s_(n,"scene",void 0),N1(n,C0,void 0),N1(n,Nm,void 0),n.scene=t,D1(C0,n,o),D1(Nm,n,c),n.onRemoveObj(function(){}),n}return n2(e,i),t2(e,[{key:"onCreateObj",value:function(n){var r=this;return R0(e,"onCreateObj",this)([function(s){var o=n(s);return s[w0(Nm,r)]=o,o[w0(C0,r)]=s,r.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(n){var r=this;return R0(e,"onRemoveObj",this)([function(s,o){var u=R0(e,"getData",r)([s]);n(s,o),r.scene.remove(s),$x(s),delete u[w0(Nm,r)]}]),this}}])}(s5),df=function(e){return isNaN(e)?parseInt(rt(e).toHex(),16):e},N0=function(e){return isNaN(e)?rt(e).getAlpha():1},q5=XN(l5);function L1(i,e,t){!e||typeof t!="string"||i.filter(function(n){return!n[t]}).forEach(function(n){n[t]=q5(e(n))})}function $5(i,e){var t=i.nodes,n=i.links,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.nodeFilter,o=s===void 0?function(){return!0}:s,u=r.onLoopError,c=u===void 0?function(_){throw"Invalid DAG structure! Found cycle in node path: ".concat(_.join(" -> "),".")}:u,f={};t.forEach(function(_){return f[e(_)]={data:_,out:[],depth:-1,skip:!o(_)}}),n.forEach(function(_){var v=_.source,S=_.target,b=A(v),x=A(S);if(!f.hasOwnProperty(b))throw"Missing source node with id: ".concat(b);if(!f.hasOwnProperty(x))throw"Missing target node with id: ".concat(x);var E=f[b],M=f[x];E.out.push(M);function A(C){return qx(C)==="object"?e(C):C}});var d=[];g(Object.values(f));var m=Object.assign.apply(Object,[{}].concat(xs(Object.entries(f).filter(function(_){var v=zf(_,2),S=v[1];return!S.skip}).map(function(_){var v=zf(_,2),S=v[0],b=v[1];return s_({},S,b.depth)}))));return m;function g(_){for(var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,b=function(){var A=_[x];if(v.indexOf(A)!==-1){var C=[].concat(xs(v.slice(v.indexOf(A))),[A]).map(function(w){return e(w.data)});return d.some(function(w){return w.length===C.length&&w.every(function(N,L){return N===C[L]})})||(d.push(C),c(C)),1}S>A.depth&&(A.depth=S,g(A.out,[].concat(xs(v),[A]),S+(A.skip?0:1)))},x=0,E=_.length;x<E;x++)b()}}var _t=window.THREE?window.THREE:{Group:lc,Mesh:oi,MeshLambertMaterial:mN,Color:it,BufferGeometry:rr,BufferAttribute:Fi,Matrix4:qt,Vector3:H,SphereGeometry:Ld,CylinderGeometry:Dd,TubeGeometry:aS,ConeGeometry:sS,Line:tF,LineBasicMaterial:Zg,QuadraticBezierCurve3:rS,CubicBezierCurve3:dN,Box3:eu},U1={graph:$V,forcelayout:sH},X5=2,D0=new _t.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Dm=new _t.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",Y5=i_({props:{jsonUrl:{onChange:function(e,t){var n=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(r){return r.json()}).then(function(r){t.fetchingJson=!1,t.onFinishLoading(r),n.graphData(r)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var n=t.d3ForceLayout.force("charge");n&&n.strength(e>2?-60:-30),e<3&&r(t.graphData.nodes,"z"),e<2&&r(t.graphData.nodes,"y");function r(s,o){s.forEach(function(u){delete u[o],delete u["v".concat(o)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(n){return n.fx=n.fy=n.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,n){return n===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,n),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&n(),r(),s(),this;function n(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var o=Zt(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(g){var _=zf(g,2),v=_[0],S=_[1];if(S){var b=t?v:e.layout.getNodePosition(v[e.nodeId]),x=o(v);(!e.nodePositionUpdate||!e.nodePositionUpdate(x?S.children[0]:S,{x:b.x,y:b.y,z:b.z},v)||x)&&(S.position.x=b.x,S.position.y=b.y||0,S.position.z=b.z||0)}});var u=Zt(e.linkWidth),c=Zt(e.linkCurvature),f=Zt(e.linkCurveRotation),d=Zt(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(g){var _=zf(g,2),v=_[0],S=_[1];if(S){var b=t?v:e.layout.getLinkPosition(e.layout.graph.getLink(v.source,v.target).id),x=b[t?"source":"from"],E=b[t?"target":"to"];if(!(!x||!E||!x.hasOwnProperty("x")||!E.hasOwnProperty("x"))){m(v);var M=d(v);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(M?S.children[1]:S,{start:{x:x.x,y:x.y,z:x.z},end:{x:E.x,y:E.y,z:E.z}},v)&&!M)){var A=30,C=v.__curve,w=S.children.length?S.children[0]:S;if(w.type==="Line"){if(C){var L=C.getPoints(A);w.geometry.getAttribute("position").array.length!==L.length*3&&w.geometry[D0]("position",new _t.BufferAttribute(new Float32Array(L.length*3),3)),w.geometry.setFromPoints(L)}else{var N=w.geometry.getAttribute("position");(!N||!N.array||N.array.length!==6)&&w.geometry[D0]("position",N=new _t.BufferAttribute(new Float32Array(2*3),3)),N.array[0]=x.x,N.array[1]=x.y||0,N.array[2]=x.z||0,N.array[3]=E.x,N.array[4]=E.y||0,N.array[5]=E.z||0,N.needsUpdate=!0}w.geometry.computeBoundingSphere()}else if(w.type==="Mesh")if(C){w.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(w.position.set(0,0,0),w.rotation.set(0,0,0),w.scale.set(1,1,1));var $=Math.ceil(u(v)*10)/10,k=$/2,G=new _t.TubeGeometry(C,A,k,e.linkResolution,!1);w.geometry.dispose(),w.geometry=G}else{if(!w.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var P=Math.ceil(u(v)*10)/10,D=P/2,I=new _t.CylinderGeometry(D,D,1,e.linkResolution,1,!1);I[Dm](new _t.Matrix4().makeTranslation(0,1/2,0)),I[Dm](new _t.Matrix4().makeRotationX(Math.PI/2)),w.geometry.dispose(),w.geometry=I}var j=new _t.Vector3(x.x,x.y||0,x.z||0),J=new _t.Vector3(E.x,E.y||0,E.z||0),ue=j.distanceTo(J);w.position.x=j.x,w.position.y=j.y,w.position.z=j.z,w.scale.z=ue,w.parent.localToWorld(J),w.lookAt(J)}}}}});function m(g){var _=t?g:e.layout.getLinkPosition(e.layout.graph.getLink(g.source,g.target).id),v=_[t?"source":"from"],S=_[t?"target":"to"];if(!(!v||!S||!v.hasOwnProperty("x")||!S.hasOwnProperty("x"))){var b=c(g);if(!b)g.__curve=null;else{var x=new _t.Vector3(v.x,v.y||0,v.z||0),E=new _t.Vector3(S.x,S.y||0,S.z||0),M=x.distanceTo(E),A,C=f(g);if(M>0){var w=S.x-v.x,N=S.y-v.y||0,L=new _t.Vector3().subVectors(E,x),P=L.clone().multiplyScalar(b).cross(w!==0||N!==0?new _t.Vector3(0,0,1):new _t.Vector3(0,1,0)).applyAxisAngle(L.normalize(),C).add(new _t.Vector3().addVectors(x,E).divideScalar(2));A=new _t.QuadraticBezierCurve3(x,P,E)}else{var D=b*70,I=-C,j=I+Math.PI/2;A=new _t.CubicBezierCurve3(x,new _t.Vector3(D*Math.cos(j),D*Math.sin(j),0).add(x),new _t.Vector3(D*Math.cos(I),D*Math.sin(I),0).add(x),E)}g.__curve=A}}}}function r(){var o=Zt(e.linkDirectionalArrowRelPos),u=Zt(e.linkDirectionalArrowLength),c=Zt(e.nodeVal);e.arrowDataMapper.entries().forEach(function(f){var d=zf(f,2),m=d[0],g=d[1];if(g){var _=t?m:e.layout.getLinkPosition(e.layout.graph.getLink(m.source,m.target).id),v=_[t?"source":"from"],S=_[t?"target":"to"];if(!(!v||!S||!v.hasOwnProperty("x")||!S.hasOwnProperty("x"))){var b=Math.cbrt(Math.max(0,c(v)||1))*e.nodeRelSize,x=Math.cbrt(Math.max(0,c(S)||1))*e.nodeRelSize,E=u(m),M=o(m),A=m.__curve?function(D){return m.__curve.getPoint(D)}:function(D){var I=function(J,ue,$,k){return ue[J]+($[J]-ue[J])*k||0};return{x:I("x",v,S,D),y:I("y",v,S,D),z:I("z",v,S,D)}},C=m.__curve?m.__curve.getLength():Math.sqrt(["x","y","z"].map(function(D){return Math.pow((S[D]||0)-(v[D]||0),2)}).reduce(function(D,I){return D+I},0)),w=b+E+(C-b-x-E)*M,N=A(w/C),L=A((w-E)/C);["x","y","z"].forEach(function(D){return g.position[D]=L[D]});var P=e2(_t.Vector3,xs(["x","y","z"].map(function(D){return N[D]})));g.parent.localToWorld(P),g.lookAt(P)}}})}function s(){var o=Zt(e.linkDirectionalParticleSpeed);e.graphData.links.forEach(function(u){var c=e.particlesDataMapper.getObj(u),f=c&&c.children,d=u.__singleHopPhotonsObj&&u.__singleHopPhotonsObj.children;if(!((!d||!d.length)&&(!f||!f.length))){var m=t?u:e.layout.getLinkPosition(e.layout.graph.getLink(u.source,u.target).id),g=m[t?"source":"from"],_=m[t?"target":"to"];if(!(!g||!_||!g.hasOwnProperty("x")||!_.hasOwnProperty("x"))){var v=o(u),S=u.__curve?function(x){return u.__curve.getPoint(x)}:function(x){var E=function(A,C,w,N){return C[A]+(w[A]-C[A])*N||0};return{x:E("x",g,_,x),y:E("y",g,_,x),z:E("z",g,_,x)}},b=[].concat(xs(f||[]),xs(d||[]));b.forEach(function(x,E){var M=x.parent.__linkThreeObjType==="singleHopPhotons";if(x.hasOwnProperty("__progressRatio")||(x.__progressRatio=M?0:E/f.length),x.__progressRatio+=v,x.__progressRatio>=1)if(!M)x.__progressRatio=x.__progressRatio%1;else{x.parent.remove(x),$x(x);return}var A=x.__progressRatio,C=S(A);["x","y","z"].forEach(function(w){return x.position[w]=C[w]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var n=new _t.Group;n.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=n,e.graphScene.add(n)}var r=Zt(e.linkDirectionalParticleWidth),s=Math.ceil(r(t)*10)/10/2,o=e.linkDirectionalParticleResolution,u=new _t.SphereGeometry(s,o,o),c=Zt(e.linkColor),f=Zt(e.linkDirectionalParticleColor),d=f(t)||c(t)||"#f0f0f0",m=new _t.Color(df(d)),g=e.linkOpacity*3,_=new _t.MeshLambertMaterial({color:m,transparent:!0,opacity:g});t.__singleHopPhotonsObj.add(new _t.Mesh(u,_))}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var n=function r(s){var o=[];if(s.geometry){s.geometry.computeBoundingBox();var u=new _t.Box3;u.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),o.push(u)}return o.concat.apply(o,xs((s.children||[]).filter(function(c){return!c.hasOwnProperty("__graphObjType")||c.__graphObjType==="node"&&t(c.__data)}).map(r)))}(e.graphScene);return n.length?Object.assign.apply(Object,xs(["x","y","z"].map(function(r){return s_({},r,[jH(n,function(s){return s.min[r]}),HH(n,function(s){return s.max[r]})])}))):null}},stateInit:function(){return{d3ForceLayout:VV().force("link",wV()).force("charge",HV()).force("center",C4()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new ff(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new ff(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new ff(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new ff(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var n=function(Z){return Z.some(function(Y){return t.hasOwnProperty(Y)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&n(["nodeAutoColorBy","graphData","nodeColor"])&&L1(e.graphData.nodes,Zt(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&n(["linkAutoColorBy","graphData","linkColor"])&&L1(e.graphData.links,Zt(e.linkAutoColorBy),e.linkColor),e._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=Zt(e.nodeThreeObject),s=Zt(e.nodeThreeObjectExtend),o=Zt(e.nodeVal),u=Zt(e.nodeColor),c=Zt(e.nodeVisibility),f={},d={};(e._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(q){var Z=r(q),Y=s(q);Z&&e.nodeThreeObject===Z&&(Z=Z.clone());var ie;return Z&&!Y?ie=Z:(ie=new _t.Mesh,ie.__graphDefaultObj=!0,Z&&Y&&ie.add(Z)),ie.__graphObjType="node",ie}).onUpdateObj(function(q,Z){if(q.__graphDefaultObj){var Y=o(Z)||1,ie=Math.cbrt(Y)*e.nodeRelSize,xe=e.nodeResolution;(!q.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||q.geometry.parameters.radius!==ie||q.geometry.parameters.widthSegments!==xe)&&(f.hasOwnProperty(Y)||(f[Y]=new _t.SphereGeometry(ie,xe,xe)),q.geometry.dispose(),q.geometry=f[Y]);var Ve=u(Z),ke=new _t.Color(df(Ve||"#ffffaa")),st=e.nodeOpacity*N0(Ve);(q.material.type!=="MeshLambertMaterial"||!q.material.color.equals(ke)||q.material.opacity!==st)&&(d.hasOwnProperty(Ve)||(d[Ve]=new _t.MeshLambertMaterial({color:ke,transparent:!0,opacity:st})),q.material.dispose(),q.material=d[Ve])}}).digest(e.graphData.nodes.filter(c))}if(e._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var m=Zt(e.linkThreeObject),g=Zt(e.linkThreeObjectExtend),_=Zt(e.linkMaterial),v=Zt(e.linkVisibility),S=Zt(e.linkColor),b=Zt(e.linkWidth),x={},E={},M={},A=e.graphData.links.filter(v);if((e._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(q){var Z=q.__data&&q.__data.__singleHopPhotonsObj;Z&&(Z.parent.remove(Z),$x(Z),delete q.__data.__singleHopPhotonsObj)}).onCreateObj(function(q){var Z=m(q),Y=g(q);Z&&e.linkThreeObject===Z&&(Z=Z.clone());var ie;if(!Z||Y){var xe=!!b(q);if(xe)ie=new _t.Mesh;else{var Ve=new _t.BufferGeometry;Ve[D0]("position",new _t.BufferAttribute(new Float32Array(2*3),3)),ie=new _t.Line(Ve)}}var ke;return Z?Y?(ke=new _t.Group,ke.__graphDefaultObj=!0,ke.add(ie),ke.add(Z)):ke=Z:(ke=ie,ke.__graphDefaultObj=!0),ke.renderOrder=10,ke.__graphObjType="link",ke}).onUpdateObj(function(q,Z){if(q.__graphDefaultObj){var Y=q.children.length?q.children[0]:q,ie=Math.ceil(b(Z)*10)/10,xe=!!ie;if(xe){var Ve=ie/2,ke=e.linkResolution;if(!Y.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||Y.geometry.parameters.radiusTop!==Ve||Y.geometry.parameters.radialSegments!==ke){if(!x.hasOwnProperty(ie)){var st=new _t.CylinderGeometry(Ve,Ve,1,ke,1,!1);st[Dm](new _t.Matrix4().makeTranslation(0,1/2,0)),st[Dm](new _t.Matrix4().makeRotationX(Math.PI/2)),x[ie]=st}Y.geometry.dispose(),Y.geometry=x[ie]}}var Ct=_(Z);if(Ct)Y.material=Ct;else{var vt=S(Z),K=new _t.Color(df(vt||"#f0f0f0")),Cn=e.linkOpacity*N0(vt),Ot=xe?"MeshLambertMaterial":"LineBasicMaterial";if(Y.material.type!==Ot||!Y.material.color.equals(K)||Y.material.opacity!==Cn){var yt=xe?E:M;yt.hasOwnProperty(vt)||(yt[vt]=new _t[Ot]({color:K,transparent:Cn<1,opacity:Cn,depthWrite:Cn>=1})),Y.material.dispose(),Y.material=yt[vt]}}}}).digest(A),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var C=Zt(e.linkDirectionalArrowLength),w=Zt(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var q=new _t.Mesh(void 0,new _t.MeshLambertMaterial({transparent:!0}));return q.__linkThreeObjType="arrow",q}).onUpdateObj(function(q,Z){var Y=C(Z),ie=e.linkDirectionalArrowResolution;if(!q.geometry.type.match(/^Cone(Buffer)?Geometry$/)||q.geometry.parameters.height!==Y||q.geometry.parameters.radialSegments!==ie){var xe=new _t.ConeGeometry(Y*.25,Y,ie);xe.translate(0,Y/2,0),xe.rotateX(Math.PI/2),q.geometry.dispose(),q.geometry=xe}var Ve=w(Z)||S(Z)||"#f0f0f0";q.material.color=new _t.Color(df(Ve)),q.material.opacity=e.linkOpacity*3*N0(Ve)}).digest(A.filter(C))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var N=Zt(e.linkDirectionalParticles),L=Zt(e.linkDirectionalParticleWidth),P=Zt(e.linkDirectionalParticleColor),D={},I={};e.particlesDataMapper.onCreateObj(function(){var q=new _t.Group;return q.__linkThreeObjType="photons",q.__photonDataMapper=new ff(q),q}).onUpdateObj(function(q,Z){var Y=Math.round(Math.abs(N(Z))),ie=!!q.children.length&&q.children[0],xe=Math.ceil(L(Z)*10)/10/2,Ve=e.linkDirectionalParticleResolution,ke;ie&&ie.geometry.parameters.radius===xe&&ie.geometry.parameters.widthSegments===Ve?ke=ie.geometry:(I.hasOwnProperty(xe)||(I[xe]=new _t.SphereGeometry(xe,Ve,Ve)),ke=I[xe],ie&&ie.geometry.dispose());var st=P(Z)||S(Z)||"#f0f0f0",Ct=new _t.Color(df(st)),vt=e.linkOpacity*3,K;ie&&ie.material.color.equals(Ct)&&ie.material.opacity===vt?K=ie.material:(D.hasOwnProperty(st)||(D[st]=new _t.MeshLambertMaterial({color:Ct,transparent:!0,opacity:vt})),K=D[st],ie&&ie.material.dispose()),q.__photonDataMapper.id(function(Cn){return Cn.idx}).onCreateObj(function(){return new _t.Mesh(ke,K)}).onUpdateObj(function(Cn){Cn.geometry=ke,Cn.material=K}).digest(xs(new Array(Y)).map(function(Cn,Ot){return{idx:Ot}}))}).digest(A.filter(N))}}if(e._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(q){q.source=q[e.linkSource],q.target=q[e.linkTarget]});var j=e.forceEngine!=="ngraph",J;if(j){(J=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var ue=e.d3ForceLayout.force("link");ue&&ue.id(function(q){return q[e.nodeId]}).links(e.graphData.links);var $=e.dagMode&&$5(e.graphData,function(q){return q[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),k=Math.max.apply(Math,xs(Object.values($||[]))),G=e.dagLevelDistance||e.graphData.nodes.length/(k||1)*X5*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var W=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(q){return delete q[W]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var ce=["rl","td","zout"].includes(e.dagMode),z=function(Z){return($[Z[e.nodeId]]-k/2)*G*(ce?-1:1)},le=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(q){return q[le]=z(q)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?jV(function(q){var Z=$[q[e.nodeId]]||-1;return(e.dagMode==="radialin"?k-Z:Z)*G}).strength(function(q){return e.dagNodeFilter(q)?1:0}):null)}else{var Ee=U1.graph();e.graphData.nodes.forEach(function(q){Ee.addNode(q[e.nodeId])}),e.graphData.links.forEach(function(q){Ee.addLink(q.source,q.target)}),J=U1.forcelayout(Ee,V5({dimensions:e.numDimensions},e.ngraphPhysics)),J.graph=Ee}for(var De=0;De<e.warmupTicks&&!(j&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);De++)J[j?"tick":"step"]();e.layout=J,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function K5(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=function(r){function s(){var o;JN(this,s);for(var u=arguments.length,c=new Array(u),f=0;f<u;f++)c[f]=arguments[f];return o=ZN(this,s,[].concat(c)),o.__kapsuleInstance=e2(i,[].concat(xs(t?[o]:[]),c)),o}return n2(s,r),t2(s)}(e);return Object.keys(i()).forEach(function(r){return n.prototype[r]=function(){var s,o=(s=this.__kapsuleInstance)[r].apply(s,arguments);return o===this.__kapsuleInstance?this:o}}),n}var Q5=window.THREE?window.THREE:{Group:lc},o2=K5(Y5,Q5.Group,!0);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Z5=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class J5{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=Z5,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:r,object:s}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:u}=e.context;t.bufferWidth=o,t.bufferHeight=u}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={version:r.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e){const{object:t,material:n,geometry:r}=e,s=this.getRenderObjectData(e);if(s.worldMatrix.equals(t.matrixWorld)!==!0)return s.worldMatrix.copy(t.matrixWorld),!1;const o=s.material;for(const S in o){const b=o[S],x=n[S];if(b.equals!==void 0){if(b.equals(x)===!1)return b.copy(x),!1}else if(x.isTexture===!0){if(b.id!==x.id||b.version!==x.version)return b.id=x.id,b.version=x.version,!1}else if(b!==x)return o[S]=x,!1}if(o.transmission>0){const{width:S,height:b}=e.context;if(s.bufferWidth!==S||s.bufferHeight!==b)return s.bufferWidth=S,s.bufferHeight=b,!1}const u=s.geometry,c=r.attributes,f=u.attributes,d=Object.keys(f),m=Object.keys(c);if(u.id!==r.id)return u.id=r.id,!1;if(d.length!==m.length)return s.geometry.attributes=this.getAttributesData(c),!1;for(const S of d){const b=f[S],x=c[S];if(x===void 0)return delete f[S],!1;if(b.version!==x.version)return b.version=x.version,!1}const g=r.index,_=u.indexVersion,v=g?g.version:null;if(_!==v)return u.indexVersion=v,!1;if(u.drawRange.start!==r.drawRange.start||u.drawRange.count!==r.drawRange.count)return u.drawRange.start=r.drawRange.start,u.drawRange.count=r.drawRange.count,!1;if(s.morphTargetInfluences){let S=!1;for(let b=0;b<s.morphTargetInfluences.length;b++)s.morphTargetInfluences[b]!==t.morphTargetInfluences[b]&&(S=!0);if(S)return!0}return s.center&&s.center.equals(t.center)===!1?(s.center.copy(t.center),!0):(e.bundle!==null&&(s.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return r||s?!1:this.equals(e)!==!0}}function fd(i,e=0){let t=3735928559^e,n=1103547991^e;if(i instanceof Array)for(let r=0,s;r<i.length;r++)s=i[r],t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);else for(let r=0,s;r<i.length;r++)s=i.charCodeAt(r),t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const e6=i=>fd(i),mS=i=>fd(i),dd=(...i)=>fd(i);function l2(i,e=!1){const t=[];i.isNode===!0&&(t.push(i.id),i=i.getSelf());for(const{property:n,childNode:r}of wg(i))t.push(fd(n.slice(0,-4)),r.getCacheKey(e));return fd(t)}function*wg(i,e=!1){for(const t in i){if(t.startsWith("_")===!0)continue;const n=i[t];if(Array.isArray(n)===!0)for(let r=0;r<n.length;r++){const s=n[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}else if(n&&n.isNode===!0)yield{property:t,childNode:n};else if(typeof n=="object")for(const r in n){const s=n[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}}}const t6=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),O1=new WeakMap;function n6(i){return t6.get(i)}function Rg(i){if(i==null)return null;const e=typeof i;return i.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":i.isVector2===!0?"vec2":i.isVector3===!0?"vec3":i.isVector4===!0?"vec4":i.isMatrix2===!0?"mat2":i.isMatrix3===!0?"mat3":i.isMatrix4===!0?"mat4":i.isColor===!0?"color":i instanceof ArrayBuffer?"ArrayBuffer":null}function u2(i,...e){const t=i?i.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),i==="color"?new it(...e):t==="vec2"?new Oe(...e):t==="vec3"?new H(...e):t==="vec4"?new xt(...e):t==="mat2"?new Jg(...e):t==="mat3"?new Mt(...e):t==="mat4"?new qt(...e):i==="bool"?e[0]||!1:i==="float"||i==="int"||i==="uint"?e[0]||0:i==="string"?e[0]||"":i==="ArrayBuffer"?r6(e[0]):null}function c2(i){let e=O1.get(i);return e===void 0&&(e={},O1.set(i,e)),e}function i6(i){let e="";const t=new Uint8Array(i);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function r6(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0)).buffer}const B1={VERTEX:"vertex"},It={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Fa={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},s6=["fragment","vertex"],F1=["setup","analyze","generate"],I1=[...s6,"compute"],nh=["x","y","z","w"];let a6=0;class Dt extends Ya{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=It.NONE,this.updateBeforeType=It.NONE,this.updateAfterType=It.NONE,this.uuid=yg.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:a6++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,It.FRAME)}onRenderUpdate(e){return this.onUpdate(e,It.RENDER)}onObjectUpdate(e){return this.onUpdate(e,It.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of wg(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=dd(l2(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())t["node"+n++]=r;return t.outputNode||null}analyze(e){if(e.increaseUsage(this)===1){const n=e.getNodeProperties(this);for(const r of Object.values(n))r&&r.isNode===!0&&r.build(e)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);e.addNode(this),e.addChain(this);let r=null;const s=e.getBuildStage();if(s==="setup"){this.updateReference(e);const o=e.getNodeProperties(this);if(o.initialized!==!0){o.initialized=!0;const u=this.setup(e),c=u&&u.isNode===!0;for(const f of Object.values(o))f&&f.isNode===!0&&f.build(e);c&&u.build(e),o.outputNode=u}}else if(s==="analyze")this.analyze(e);else if(s==="generate")if(this.generate.length===1){const u=this.getNodeType(e),c=e.getDataFromNode(this);r=c.snippet,r===void 0?c.generated===void 0?(c.generated=!0,r=this.generate(e)||"",c.snippet=r):(console.warn("THREE.Node: Recursion detected.",this),r=""):c.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),r=e.format(r,u,t)}else r=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),r}getSerializeChildren(){return wg(this)}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:s,childNode:o}of t)s!==void 0?(n[r]===void 0&&(n[r]=Number.isInteger(s)?[]:{}),n[r][s]=o.toJSON(e.meta).uuid):n[r]=o.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const s of e.inputNodes[n])r.push(t[s]);this[n]=r}else if(typeof e.inputNodes[n]=="object"){const r={};for(const s in e.inputNodes[n]){const o=e.inputNodes[n][s];r[s]=t[o]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:n,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(u){const c=[];for(const f in u){const d=u[f];delete d.metadata,c.push(d)}return c}if(r){const u=o(e.textures),c=o(e.images),f=o(e.nodes);u.length>0&&(s.textures=u),c.length>0&&(s.images=c),f.length>0&&(s.nodes=f)}return s}}class Od extends Dt{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${r} ]`}}class h2 extends Dt{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(r))&&(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),s=n.build(e,r);return e.format(s,r,t)}}class Zn extends Dt{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,r),u=e.getVarFromNode(this,null,r),c=e.getPropertyName(u);return e.addLineFlowCode(`${c} = ${o}`,this),s.snippet=o,s.propertyName=c,e.format(s.propertyName,r,t)}}return super.build(e,t)}}class o6 extends Zn{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=e.getTypeLength(n),s=this.nodes,o=e.getComponentType(n),u=[];let c=0;for(const d of s){if(c>=r){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let m=d.getNodeType(e),g=e.getTypeLength(m),_;c+g>r&&(console.error(`THREE.TSL: Length of '${n}()' data exceeds maximum length of output type.`),g=r-c,m=e.getTypeFromLength(g)),c+=g,_=d.build(e,m);const v=e.getComponentType(m);v!==o&&(_=e.format(_,v,o)),u.push(_)}const f=`${e.getType(n)}( ${u.join(", ")} )`;return e.format(f,n,t)}}const l6=nh.join("");class z1 extends Dt{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(nh.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let s=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=n.build(e,o);this.components.length===r&&this.components===l6.slice(0,this.components.length)?s=e.format(c,o,t):s=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else s=n.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class u6 extends Zn{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,s=this.getNodeType(e),o=e.getComponentType(r.getNodeType(e)),u=e.getTypeFromLength(n.length,o),c=r.build(e,u),f=t.build(e,s),d=e.getTypeLength(s),m=[];for(let g=0;g<d;g++){const _=nh[g];_===n[0]?(m.push(c),g+=n.length-1):m.push(f+"."+_)}return`${e.getType(s)}( ${m.join(", ")} )`}}class c6 extends Zn{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),s=n.build(e),o=e.getVarFromNode(this),u=e.getPropertyName(o);e.addLineFlowCode(u+" = "+s,this);const c=e.getTypeLength(r),f=[];let d=0;for(let m=0;m<c;m++){const g=nh[m];g===t[d]?(f.push("1.0 - "+(u+"."+g)),d++):f.push(u+"."+g)}return`${e.getType(r)}( ${f.join(", ")} )`}}class gS extends Dt{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Rg(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Rg(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=i6(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?u2(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const k1=/float|u?int/;class Qa extends gS{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return k1.test(n)&&k1.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class h6 extends Dt{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let Hc=null;const cc=new Map;function be(i,e){if(cc.has(i)){console.warn(`THREE.TSL: Redefinition of method chaining '${i}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${i} is not a function`);cc.set(i,e)}const f2=i=>i.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),G1=i=>f2(i).split("").sort().join(""),d2={setup(i,e){const t=e.shift();return i(l_(t),...e)},get(i,e,t){if(typeof e=="string"&&i[e]===void 0){if(i.isStackNode!==!0&&e==="assign")return(...n)=>(Hc.assign(t,...n),t);if(cc.has(e)){const n=cc.get(e);return i.isStackNode?(...r)=>t.add(n(...r)):(...r)=>n(t,...r)}else{if(e==="self")return i;if(e.endsWith("Assign")&&cc.has(e.slice(0,e.length-6))){const n=cc.get(e.slice(0,e.length-6));return i.isStackNode?(...r)=>t.assign(r[0],n(...r)):(...r)=>t.assign(n(t,...r))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=f2(e),Fe(new z1(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=G1(e.slice(3).toLowerCase()),n=>Fe(new u6(i,e,n));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=G1(e.slice(4).toLowerCase()),()=>Fe(new c6(Fe(i),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),Fe(new z1(i,e));if(/^\d+$/.test(e)===!0)return Fe(new Od(t,new Qa(Number(e),"uint")));if(/^get$/.test(e)===!0)return n=>Fe(new h6(t,n))}}}return Reflect.get(i,e,t)},set(i,e,t,n){return typeof e=="string"&&i[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(n[e].assign(t),!0):Reflect.set(i,e,t,n)}},P0=new WeakMap,V1=new WeakMap,f6=function(i,e=null){const t=Rg(i);if(t==="node"){let n=P0.get(i);return n===void 0&&(n=new Proxy(i,d2),P0.set(i,n),P0.set(n,n)),n}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return Fe(Xx(i,e));if(t==="shader")return Ie(i)}return i},d6=function(i,e=null){for(const t in i)i[t]=Fe(i[t],e);return i},p6=function(i,e=null){const t=i.length;for(let n=0;n<t;n++)i[n]=Fe(i[n],e);return i},m6=function(i,e=null,t=null,n=null){const r=d=>Fe(n!==null?Object.assign(d,n):d);let s,o=e,u,c;function f(d){let m;return o?m=/[a-z]/i.test(o)?o+"()":o:m=i.type,u!==void 0&&d.length<u?(console.error(`THREE.TSL: "${m}" parameter length is less than minimum required.`),d.concat(new Array(u-d.length).fill(0))):c!==void 0&&d.length>c?(console.error(`THREE.TSL: "${m}" parameter length exceeds limit.`),d.slice(0,c)):d}return e===null?s=(...d)=>r(new i(...vc(f(d)))):t!==null?(t=Fe(t),s=(...d)=>r(new i(e,...vc(f(d)),t))):s=(...d)=>r(new i(e,...vc(f(d)))),s.setParameterLength=(...d)=>(d.length===1?u=c=d[0]:d.length===2&&([u,c]=d),s),s.setName=d=>(o=d,s),s},g6=function(i,...e){return Fe(new i(...vc(e)))};class _6 extends Dt{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:n}=this,r=e.getNodeProperties(t);if(r.onceOutput)return r.onceOutput;let s=null;if(t.layout){let o=V1.get(e.constructor);o===void 0&&(o=new WeakMap,V1.set(e.constructor,o));let u=o.get(t);u===void 0&&(u=Fe(e.buildFunctionNode(t)),o.set(t,u)),e.addInclude(u),s=Fe(u.call(n))}else{const o=t.jsFunc,u=n!==null||o.length>1?o(n||[],e):o(e);s=Fe(u)}return t.once&&(r.onceOutput=s),s}getOutputNode(e){const t=e.getNodeProperties(this);return t.outputNode===null&&(t.outputNode=this.setupOutput(e)),t.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){return this.getOutputNode(e).build(e,t)}}class v6 extends Dt{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return l_(e),Fe(new _6(this,e))}setup(){return this.call()}}const y6=[!1,!0],x6=[0,1,2,3],b6=[-1,-2],p2=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],_S=new Map;for(const i of y6)_S.set(i,new Qa(i));const vS=new Map;for(const i of x6)vS.set(i,new Qa(i,"uint"));const yS=new Map([...vS].map(i=>new Qa(i.value,"int")));for(const i of b6)yS.set(i,new Qa(i,"int"));const a_=new Map([...yS].map(i=>new Qa(i.value)));for(const i of p2)a_.set(i,new Qa(i));for(const i of p2)a_.set(-i,new Qa(-i));const o_={bool:_S,uint:vS,ints:yS,float:a_},H1=new Map([..._S,...a_]),Xx=(i,e)=>H1.has(i)?H1.get(i):i.isNode===!0?i:new Qa(i,e),S6=i=>{try{return i.getNodeType()}catch{return}},ui=function(i,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(i)&&t.every(r=>typeof r!="object"))&&(t=[u2(i,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Fe(e.get(t[0]));if(t.length===1){const r=Xx(t[0],i);return S6(r)===i?Fe(r):Fe(new h2(r,i))}const n=t.map(r=>Xx(r));return Fe(new o6(n,i))}},j1=i=>typeof i=="object"&&i!==null?i.value:i,T6=i=>i!=null?i.nodeType||i.convertTo||(typeof i=="string"?i:null):null;function og(i,e){return new Proxy(new v6(i,e),d2)}const Fe=(i,e=null)=>f6(i,e),l_=(i,e=null)=>new d6(i,e),vc=(i,e=null)=>new p6(i,e),Le=(...i)=>new m6(...i),Ge=(...i)=>new g6(...i);let E6=0;const Ie=(i,e=null)=>{let t=null;e!==null&&(typeof e=="object"?t=e.return:(typeof e=="string"?t=e:console.error("THREE.TSL: Invalid layout type."),e=null));const n=new og(i,t),r=(...s)=>{let o;return l_(s),s[0]&&s[0].isNode?o=[...s]:o=s[0],n.call(o)};if(r.shaderNode=n,r.setLayout=s=>(n.setLayout(s),r),r.once=()=>(n.once=!0,r),e!==null){if(typeof e.inputs!="object"){const s={name:"fn"+E6++,type:t,inputs:[]};for(const o in e)o!=="return"&&s.inputs.push({name:o,type:e[o]});e=s}r.setLayout(e)}return r};be("toGlobal",i=>(i.global=!0,i));const Cg=i=>{Hc=i},m2=()=>Hc,Qn=(...i)=>Hc.If(...i);function M6(i){return Hc&&Hc.add(i),i}be("append",M6);const A6=new ui("color"),Te=new ui("float",o_.float),kn=new ui("int",o_.ints),w6=new ui("uint",o_.uint),g2=new ui("bool",o_.bool),He=new ui("vec2"),Ca=new ui("ivec2"),R6=new ui("uvec2"),C6=new ui("bvec2"),Ae=new ui("vec3"),N6=new ui("ivec3"),D6=new ui("uvec3"),P6=new ui("bvec3"),wt=new ui("vec4"),L6=new ui("ivec4"),U6=new ui("uvec4"),O6=new ui("bvec4"),xS=new ui("mat2"),nr=new ui("mat3"),yc=new ui("mat4");be("toColor",A6);be("toFloat",Te);be("toInt",kn);be("toUint",w6);be("toBool",g2);be("toVec2",He);be("toIVec2",Ca);be("toUVec2",R6);be("toBVec2",C6);be("toVec3",Ae);be("toIVec3",N6);be("toUVec3",D6);be("toBVec3",P6);be("toVec4",wt);be("toIVec4",L6);be("toUVec4",U6);be("toBVec4",O6);be("toMat2",xS);be("toMat3",nr);be("toMat4",yc);const B6=Le(Od).setParameterLength(2),F6=(i,e)=>Fe(new h2(Fe(i),e));be("element",B6);be("convert",F6);class W1 extends Zn{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const I6=(...i)=>{let e;if(i.length===1){const t=i[0];e=new W1(null,t.length,t)}else{const t=i[0],n=i[1];e=new W1(t,n)}return Fe(e)};be("toArray",(i,e)=>I6(Array(e).fill(i)));class _2 extends Dt{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const z6=i=>new _2(i),bS=(i,e=0)=>new _2(i,!0,e),k6=bS("frame"),Tt=bS("render"),v2=z6("object");class Bd extends gS{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=v2}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const n=this.getSelf();return e=e.bind(n),super.onUpdate(r=>{const s=e(r,n);s!==void 0&&(this.value=s)},t)}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let s=e.getNodeFromHash(r);s===void 0&&(e.setHashNode(this,r),s=this);const o=s.getInputType(e),u=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.label),c=e.getPropertyName(u);return e.context.label!==void 0&&delete e.context.label,e.format(c,n,t)}}const Rt=(i,e)=>{const t=T6(e||i),n=i&&i.isNode===!0?i.node&&i.node.value||i.value:i;return Fe(new Bd(n,t))};class ln extends Dt{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Fd=(i,e)=>Fe(new ln(i,e)),Ng=(i,e)=>Fe(new ln(i,e,!0)),sn=Ge(ln,"vec4","DiffuseColor"),q1=Ge(ln,"vec3","EmissiveColor"),La=Ge(ln,"float","Roughness"),Dg=Ge(ln,"float","Metalness"),Yx=Ge(ln,"float","Clearcoat"),Pg=Ge(ln,"float","ClearcoatRoughness"),hc=Ge(ln,"vec3","Sheen"),SS=Ge(ln,"float","SheenRoughness"),TS=Ge(ln,"float","Iridescence"),y2=Ge(ln,"float","IridescenceIOR"),x2=Ge(ln,"float","IridescenceThickness"),Kx=Ge(ln,"float","AlphaT"),Nl=Ge(ln,"float","Anisotropy"),lg=Ge(ln,"vec3","AnisotropyT"),xc=Ge(ln,"vec3","AnisotropyB"),kr=Ge(ln,"color","SpecularColor"),Lg=Ge(ln,"float","SpecularF90"),Qx=Ge(ln,"float","Shininess"),kf=Ge(ln,"vec4","Output"),L0=Ge(ln,"float","dashSize"),$1=Ge(ln,"float","gapSize"),ug=Ge(ln,"float","IOR"),Zx=Ge(ln,"float","Transmission"),b2=Ge(ln,"float","Thickness"),S2=Ge(ln,"float","AttenuationDistance"),T2=Ge(ln,"color","AttenuationColor"),E2=Ge(ln,"float","Dispersion");class G6 extends Zn{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return nh.join("").slice(0,n)!==t.components}return!1}generate(e,t){const{targetNode:n,sourceNode:r}=this,s=this.needsSplitAssign(e),o=n.getNodeType(e),u=n.context({assign:!0}).build(e),c=r.build(e,o),f=r.getNodeType(e),d=e.getDataFromNode(this);let m;if(d.initialized===!0)t!=="void"&&(m=u);else if(s){const g=e.getVarFromNode(this,null,o),_=e.getPropertyName(g);e.addLineFlowCode(`${_} = ${c}`,this);const v=n.node.context({assign:!0}).build(e);for(let S=0;S<n.components.length;S++){const b=n.components[S];e.addLineFlowCode(`${v}.${b} = ${_}[ ${S} ]`,this)}t!=="void"&&(m=u)}else m=`${u} = ${c}`,(t==="void"||f==="void")&&(e.addLineFlowCode(m,this),t!=="void"&&(m=u));return d.initialized=!0,e.format(m,o,t)}}const V6=Le(G6).setParameterLength(2);be("assign",V6);class H6 extends Zn{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),s=this.parameters,o=(c,f)=>{const d=f.type,m=d==="pointer";let g;return m?g="&"+c.build(e):g=c.build(e,d),g};if(Array.isArray(s)){if(s.length>r.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=r.length;else if(s.length<r.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<r.length;)s.push(Te(0));for(let c=0;c<s.length;c++)t.push(o(s[c],r[c]))}else for(const c of r){const f=s[c.name];f!==void 0?t.push(o(f,c)):(console.error(`THREE.TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(Te(0),c)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const j6=(i,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?vc(e):l_(e[0]),Fe(new H6(Fe(i),e)));be("call",j6);class Bn extends Zn{static get type(){return"OperatorNode"}constructor(e,t,n,...r){if(super(),r.length>0){let s=new Bn(e,t,n);for(let o=0;o<r.length-1;o++)s=new Bn(e,s,r[o]);t=s,n=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getNodeType(e,t){const n=this.op,r=this.aNode,s=this.bNode,o=r.getNodeType(e),u=typeof s<"u"?s.getNodeType(e):null;if(o==="void"||u==="void")return"void";if(n==="%")return o;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(o);if(n==="!"||n==="=="||n==="!="||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="<"||n===">"||n==="<="||n===">="){const c=t?e.getTypeLength(t):Math.max(e.getTypeLength(o),e.getTypeLength(u));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(o)){if(u==="float")return o;if(e.isVector(u))return e.getVectorFromMatrix(o);if(e.isMatrix(u))return o}else if(e.isMatrix(u)){if(o==="float")return u;if(e.isVector(o))return e.getVectorFromMatrix(u)}return e.getTypeLength(u)>e.getTypeLength(o)?u:o}}generate(e,t){const n=this.op,r=this.aNode,s=this.bNode,o=this.getNodeType(e,t);let u=null,c=null;o!=="void"?(u=r.getNodeType(e),c=typeof s<"u"?s.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(u)?c=u:u!==c&&(u=c="float"):n===">>"||n==="<<"?(u=o,c=e.changeComponentType(c,"uint")):n==="%"?(u=o,c=e.isInteger(u)&&e.isInteger(c)?c:u):e.isMatrix(u)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(u):e.isMatrix(c)||(u=c=o):e.isMatrix(c)?u==="float"?u="float":e.isVector(u)?u=e.getVectorFromMatrix(c):u=c=o:u=c=o):u=c=o;const f=r.build(e,u),d=typeof s<"u"?s.build(e,c):null,m=e.getTypeLength(t),g=e.getFunctionOperator(n);if(t!=="void"){const _=e.renderer.coordinateSystem===gr;if(n==="==")return _?m>1?e.format(`${e.getMethod("equal",t)}( ${f}, ${d} )`,o,t):e.format(`( ${f} ${n} ${d} )`,o,t):m>1||!e.isVector(u)?e.format(`( ${f} == ${d} )`,o,t):e.format(`all( ${f} == ${d} )`,o,t);if(n==="<"&&m>1)return _?e.format(`${e.getMethod("lessThan",t)}( ${f}, ${d} )`,o,t):e.format(`( ${f} < ${d} )`,o,t);if(n==="<="&&m>1)return _?e.format(`${e.getMethod("lessThanEqual",t)}( ${f}, ${d} )`,o,t):e.format(`( ${f} <= ${d} )`,o,t);if(n===">"&&m>1)return _?e.format(`${e.getMethod("greaterThan",t)}( ${f}, ${d} )`,o,t):e.format(`( ${f} > ${d} )`,o,t);if(n===">="&&m>1)return _?e.format(`${e.getMethod("greaterThanEqual",t)}( ${f}, ${d} )`,o,t):e.format(`( ${f} >= ${d} )`,o,t);if(n==="%")return e.isInteger(c)?e.format(`( ${f} % ${d} )`,o,t):e.format(`${e.getMethod("mod",o)}( ${f}, ${d} )`,o,t);if(n==="!"||n==="~")return e.format(`(${n}${f})`,u,t);if(g)return e.format(`${g}( ${f}, ${d} )`,o,t);if(e.isMatrix(u)&&c==="float")return e.format(`( ${d} ${n} ${f} )`,o,t);if(u==="float"&&e.isMatrix(c))return e.format(`${f} ${n} ${d}`,o,t);{let v=`( ${f} ${n} ${d} )`;return!_&&o==="bool"&&e.isVector(u)&&e.isVector(c)&&(v=`all${v}`),e.format(v,o,t)}}else if(u!=="void")return g?e.format(`${g}( ${f}, ${d} )`,o,t):e.isMatrix(u)&&c==="float"?e.format(`${d} ${n} ${f}`,o,t):e.format(`${f} ${n} ${d}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const ir=Le(Bn,"+").setParameterLength(2,1/0).setName("add"),pr=Le(Bn,"-").setParameterLength(2,1/0).setName("sub"),Vt=Le(Bn,"*").setParameterLength(2,1/0).setName("mul"),Wa=Le(Bn,"/").setParameterLength(2,1/0).setName("div"),u_=Le(Bn,"%").setParameterLength(2).setName("mod"),M2=Le(Bn,"==").setParameterLength(2).setName("equal"),W6=Le(Bn,"!=").setParameterLength(2).setName("notEqual"),q6=Le(Bn,"<").setParameterLength(2).setName("lessThan"),$6=Le(Bn,">").setParameterLength(2).setName("greaterThan"),X6=Le(Bn,"<=").setParameterLength(2).setName("lessThanEqual"),Y6=Le(Bn,">=").setParameterLength(2).setName("greaterThanEqual"),K6=Le(Bn,"&&").setParameterLength(2,1/0).setName("and"),Q6=Le(Bn,"||").setParameterLength(2,1/0).setName("or"),Z6=Le(Bn,"!").setParameterLength(1).setName("not"),J6=Le(Bn,"^^").setParameterLength(2).setName("xor"),e8=Le(Bn,"&").setParameterLength(2).setName("bitAnd"),t8=Le(Bn,"~").setParameterLength(2).setName("bitNot"),n8=Le(Bn,"|").setParameterLength(2).setName("bitOr"),i8=Le(Bn,"^").setParameterLength(2).setName("bitXor"),r8=Le(Bn,"<<").setParameterLength(2).setName("shiftLeft"),s8=Le(Bn,">>").setParameterLength(2).setName("shiftRight");be("add",ir);be("sub",pr);be("mul",Vt);be("div",Wa);be("mod",u_);be("equal",M2);be("notEqual",W6);be("lessThan",q6);be("greaterThan",$6);be("lessThanEqual",X6);be("greaterThanEqual",Y6);be("and",K6);be("or",Q6);be("not",Z6);be("xor",J6);be("bitAnd",e8);be("bitNot",t8);be("bitOr",n8);be("bitXor",i8);be("shiftLeft",r8);be("shiftRight",s8);const a8=(i,e)=>(console.warn('THREE.TSL: "remainder()" is deprecated. Use "mod( int( ... ) )" instead.'),u_(i,e)),o8=(i,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),u_(kn(i),kn(e)));be("remainder",a8);be("modInt",o8);class oe extends Zn{static get type(){return"MathNode"}constructor(e,t,n=null,r=null){if(super(),(e===oe.MAX||e===oe.MIN)&&arguments.length>3){let s=new oe(e,t,n);for(let o=2;o<arguments.length-1;o++)s=new oe(e,s,arguments[o]);t=s,n=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(n)?0:e.getTypeLength(n),u=e.isMatrix(r)?0:e.getTypeLength(r);return s>o&&s>u?t:o>u?n:u>s?r:t}getNodeType(e){const t=this.method;return t===oe.LENGTH||t===oe.DISTANCE||t===oe.DOT?"float":t===oe.CROSS?"vec3":t===oe.ALL||t===oe.ANY?"bool":t===oe.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}generate(e,t){let n=this.method;const r=this.getNodeType(e),s=this.getInputType(e),o=this.aNode,u=this.bNode,c=this.cNode,f=e.renderer.coordinateSystem;if(n===oe.TRANSFORM_DIRECTION){let d=o,m=u;e.isMatrix(d.getNodeType(e))?m=wt(Ae(m),0):d=wt(Ae(d),0);const g=Vt(d,m).xyz;return md(g).build(e,t)}else{if(n===oe.NEGATE)return e.format("( - "+o.build(e,s)+" )",r,t);if(n===oe.ONE_MINUS)return pr(1,o).build(e,t);if(n===oe.RECIPROCAL)return Wa(1,o).build(e,t);if(n===oe.DIFFERENCE)return ns(pr(o,u)).build(e,t);{const d=[];return n===oe.CROSS?d.push(o.build(e,r),u.build(e,r)):f===gr&&n===oe.STEP?d.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":s),u.build(e,s)):f===gr&&(n===oe.MIN||n===oe.MAX)?d.push(o.build(e,s),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":s)):n===oe.REFRACT?d.push(o.build(e,s),u.build(e,s),c.build(e,"float")):n===oe.MIX?d.push(o.build(e,s),u.build(e,s),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":s)):(f===qo&&n===oe.ATAN&&u!==null&&(n="atan2"),d.push(o.build(e,s)),u!==null&&d.push(u.build(e,s)),c!==null&&d.push(c.build(e,s))),e.format(`${e.getMethod(n,r)}( ${d.join(", ")} )`,r,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}oe.ALL="all";oe.ANY="any";oe.RADIANS="radians";oe.DEGREES="degrees";oe.EXP="exp";oe.EXP2="exp2";oe.LOG="log";oe.LOG2="log2";oe.SQRT="sqrt";oe.INVERSE_SQRT="inversesqrt";oe.FLOOR="floor";oe.CEIL="ceil";oe.NORMALIZE="normalize";oe.FRACT="fract";oe.SIN="sin";oe.COS="cos";oe.TAN="tan";oe.ASIN="asin";oe.ACOS="acos";oe.ATAN="atan";oe.ABS="abs";oe.SIGN="sign";oe.LENGTH="length";oe.NEGATE="negate";oe.ONE_MINUS="oneMinus";oe.DFDX="dFdx";oe.DFDY="dFdy";oe.ROUND="round";oe.RECIPROCAL="reciprocal";oe.TRUNC="trunc";oe.FWIDTH="fwidth";oe.TRANSPOSE="transpose";oe.BITCAST="bitcast";oe.EQUALS="equals";oe.MIN="min";oe.MAX="max";oe.STEP="step";oe.REFLECT="reflect";oe.DISTANCE="distance";oe.DIFFERENCE="difference";oe.DOT="dot";oe.CROSS="cross";oe.POW="pow";oe.TRANSFORM_DIRECTION="transformDirection";oe.MIX="mix";oe.CLAMP="clamp";oe.REFRACT="refract";oe.SMOOTHSTEP="smoothstep";oe.FACEFORWARD="faceforward";const l8=Te(1e-6),u8=Te(Math.PI),c8=Le(oe,oe.ALL).setParameterLength(1),h8=Le(oe,oe.ANY).setParameterLength(1),f8=Le(oe,oe.RADIANS).setParameterLength(1),d8=Le(oe,oe.DEGREES).setParameterLength(1),A2=Le(oe,oe.EXP).setParameterLength(1),pd=Le(oe,oe.EXP2).setParameterLength(1),w2=Le(oe,oe.LOG).setParameterLength(1),Va=Le(oe,oe.LOG2).setParameterLength(1),ES=Le(oe,oe.SQRT).setParameterLength(1),p8=Le(oe,oe.INVERSE_SQRT).setParameterLength(1),Hl=Le(oe,oe.FLOOR).setParameterLength(1),MS=Le(oe,oe.CEIL).setParameterLength(1),md=Le(oe,oe.NORMALIZE).setParameterLength(1),Yo=Le(oe,oe.FRACT).setParameterLength(1),Ss=Le(oe,oe.SIN).setParameterLength(1),Oo=Le(oe,oe.COS).setParameterLength(1),m8=Le(oe,oe.TAN).setParameterLength(1),g8=Le(oe,oe.ASIN).setParameterLength(1),_8=Le(oe,oe.ACOS).setParameterLength(1),R2=Le(oe,oe.ATAN).setParameterLength(1,2),ns=Le(oe,oe.ABS).setParameterLength(1),Ug=Le(oe,oe.SIGN).setParameterLength(1),Vo=Le(oe,oe.LENGTH).setParameterLength(1),v8=Le(oe,oe.NEGATE).setParameterLength(1),y8=Le(oe,oe.ONE_MINUS).setParameterLength(1),C2=Le(oe,oe.DFDX).setParameterLength(1),N2=Le(oe,oe.DFDY).setParameterLength(1),x8=Le(oe,oe.ROUND).setParameterLength(1),b8=Le(oe,oe.RECIPROCAL).setParameterLength(1),S8=Le(oe,oe.TRUNC).setParameterLength(1),T8=Le(oe,oe.FWIDTH).setParameterLength(1),E8=Le(oe,oe.TRANSPOSE).setParameterLength(1),M8=(i,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),M2(i,e)),gd=Le(oe,oe.MIN).setParameterLength(2,1/0),Er=Le(oe,oe.MAX).setParameterLength(2,1/0),D2=Le(oe,oe.STEP).setParameterLength(2),A8=Le(oe,oe.REFLECT).setParameterLength(2),w8=Le(oe,oe.DISTANCE).setParameterLength(2),R8=Le(oe,oe.DIFFERENCE).setParameterLength(2),AS=Le(oe,oe.DOT).setParameterLength(2),P2=Le(oe,oe.CROSS).setParameterLength(2),c_=Le(oe,oe.POW).setParameterLength(2),L2=Le(oe,oe.POW,2).setParameterLength(1),C8=Le(oe,oe.POW,3).setParameterLength(1),N8=Le(oe,oe.POW,4).setParameterLength(1),D8=Le(oe,oe.TRANSFORM_DIRECTION).setParameterLength(2),P8=i=>Vt(Ug(i),c_(ns(i),1/3)),U2=i=>AS(i,i),Nn=Le(oe,oe.MIX).setParameterLength(3),qa=(i,e=0,t=1)=>Fe(new oe(oe.CLAMP,Fe(i),Fe(e),Fe(t))),L8=i=>qa(i),O2=Le(oe,oe.REFRACT).setParameterLength(3),Xo=Le(oe,oe.SMOOTHSTEP).setParameterLength(3),U8=Le(oe,oe.FACEFORWARD).setParameterLength(3),O8=Ie(([i])=>{const n=43758.5453,r=AS(i.xy,He(12.9898,78.233)),s=u_(r,u8);return Yo(Ss(s).mul(n))}),B8=(i,e,t)=>Nn(e,t,i),F8=(i,e,t)=>Xo(e,t,i),I8=(i,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),R2(i,e));be("all",c8);be("any",h8);be("equals",M8);be("radians",f8);be("degrees",d8);be("exp",A2);be("exp2",pd);be("log",w2);be("log2",Va);be("sqrt",ES);be("inverseSqrt",p8);be("floor",Hl);be("ceil",MS);be("normalize",md);be("fract",Yo);be("sin",Ss);be("cos",Oo);be("tan",m8);be("asin",g8);be("acos",_8);be("atan",R2);be("abs",ns);be("sign",Ug);be("length",Vo);be("lengthSq",U2);be("negate",v8);be("oneMinus",y8);be("dFdx",C2);be("dFdy",N2);be("round",x8);be("reciprocal",b8);be("trunc",S8);be("fwidth",T8);be("atan2",I8);be("min",gd);be("max",Er);be("step",D2);be("reflect",A8);be("distance",w8);be("dot",AS);be("cross",P2);be("pow",c_);be("pow2",L2);be("pow3",C8);be("pow4",N8);be("transformDirection",D8);be("mix",B8);be("clamp",qa);be("refract",O2);be("smoothstep",F8);be("faceForward",U8);be("difference",R8);be("saturate",L8);be("cbrt",P8);be("transpose",E8);be("rand",O8);class z8 extends Dt{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const r=t.getNodeType(e);if(n!==null){const s=n.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(r))return s}return r}setup(e){const t=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=s,r!==null&&(e.getDataFromNode(r).parentNodeBlock=s);const o=e.getNodeProperties(this);o.condNode=t,o.ifNode=n.context({nodeBlock:n}),o.elseNode=r?r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:s,ifNode:o,elseNode:u}=e.getNodeProperties(this),c=e.currentFunctionNode,f=t!=="void",d=f?Fd(n).build(e):"";r.nodeProperty=d;const m=s.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${m} ) {

`).addFlowTab();let g=o.build(e,n);if(g&&(f?g=d+" = "+g+";":(g="return "+g+";",c===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),g="// "+g))),e.removeFlowTab().addFlowCode(e.tab+"	"+g+`

`+e.tab+"}"),u!==null){e.addFlowCode(` else {

`).addFlowTab();let _=u.build(e,n);_&&(f?_=d+" = "+_+";":(_="return "+_+";",c===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),_="// "+_))),e.removeFlowTab().addFlowCode(e.tab+"	"+_+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(d,n,t)}}const _r=Le(z8).setParameterLength(2,3);be("select",_r);const k8=(...i)=>(console.warn("THREE.TSL: cond() has been renamed to select()."),_r(...i));be("cond",k8);class B2 extends Dt{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e);return e.setContext(t),n}generate(e,t){const n=e.getContext();e.setContext({...e.context,...this.value});const r=this.node.build(e,t);return e.setContext(n),r}}const wS=Le(B2).setParameterLength(1,2),G8=(i,e)=>wS(i,{label:e});be("context",wS);be("label",G8);class cg extends Dt{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:s}=e,o=s.backend.isWebGPUBackend===!0;let u=!1,c=!1;r&&(u=e.isDeterministic(t),c=o?r:u);const f=e.getVectorType(this.getNodeType(e)),d=t.build(e,f),m=e.getVarFromNode(this,n,f,void 0,c),g=e.getPropertyName(m);let _=g;if(c)if(o)_=u?`const ${g}`:`let ${g}`;else{const v=e.getArrayCount(t);_=`const ${e.getVar(m.type,g,v)}`}return e.addLineFlowCode(`${_} = ${d}`,this),g}}const RS=Le(cg),V8=(i,e=null)=>RS(i,e).append(),H8=(i,e=null)=>RS(i,e,!0).append();be("toVar",V8);be("toConst",H8);const j8=i=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),RS(i));be("temp",j8);class W8 extends Dt{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const r=this.name,s=this.getNodeType(e);t.varying=n=e.getVaryingFromNode(this,r,s),t.node=this.node}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const t=e.getNodeProperties(this),n=this.setupVarying(e),r=e.shaderStage==="fragment"&&t.reassignPosition===!0&&e.context.needsPositionReassign;if(t.propertyName===void 0||r){const s=this.getNodeType(e),o=e.getPropertyName(n,B1.VERTEX);e.flowNodeFromShaderStage(B1.VERTEX,this.node,s,o),t.propertyName=o,r?t.reassignPosition=!1:t.reassignPosition===void 0&&e.context.isPositionNodeInput&&(t.reassignPosition=!0)}return e.getPropertyName(n)}}const Ns=Le(W8).setParameterLength(1,2),q8=i=>Ns(i);be("toVarying",Ns);be("toVertexStage",q8);be("varying",(...i)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),Ns(...i)));be("vertexStage",(...i)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),Ns(...i)));const $8=Ie(([i])=>{const e=i.mul(.9478672986).add(.0521327014).pow(2.4),t=i.mul(.0773993808),n=i.lessThanEqual(.04045);return Nn(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),X8=Ie(([i])=>{const e=i.pow(.41666).mul(1.055).sub(.055),t=i.mul(12.92),n=i.lessThanEqual(.0031308);return Nn(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Id="WorkingColorSpace",CS="OutputColorSpace";class h_ extends Zn{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===Id?Ft.workingColorSpace:t===CS?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let s=t;return Ft.enabled===!1||n===r||!n||!r||(Ft.getTransfer(n)===on&&(s=wt($8(s.rgb),s.a)),Ft.getPrimaries(n)!==Ft.getPrimaries(r)&&(s=wt(nr(Ft._getMatrix(new Mt,n,r)).mul(s.rgb),s.a)),Ft.getTransfer(r)===on&&(s=wt(X8(s.rgb),s.a))),s}}const Y8=i=>Fe(new h_(Fe(i),Id,CS)),K8=i=>Fe(new h_(Fe(i),CS,Id)),Q8=(i,e)=>Fe(new h_(Fe(i),Id,e)),NS=(i,e)=>Fe(new h_(Fe(i),e,Id));be("toOutputColorSpace",Y8);be("toWorkingColorSpace",K8);be("workingToColorSpace",Q8);be("colorSpaceToWorking",NS);let Z8=class extends Od{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}};class F2 extends Dt{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=It.OBJECT}setGroup(e){return this.group=e,this}element(e){return Fe(new Z8(this,Fe(e)))}setNodeType(e){const t=Rt(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const J8=(i,e,t)=>Fe(new F2(i,e,t));class ej extends F2{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(Tt)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const tj=(i,e,t=null)=>Fe(new ej(i,e,t));class nj extends Zn{static get type(){return"ToneMappingNode"}constructor(e,t=rj,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return dd(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,n=this.toneMapping;if(n===Sr)return t;let r=null;const s=e.renderer.library.getToneMappingFunction(n);return s!==null?r=wt(s(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=t),r}}const ij=(i,e,t)=>Fe(new nj(i,Fe(e),Fe(t))),rj=tj("toneMappingExposure","float");be("toneMapping",(i,e,t)=>ij(e,t,i));class sj extends gS{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=vg,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=this.value,r=e.getTypeLength(t),s=this.bufferStride||r,o=this.bufferOffset,u=n.isInterleavedBuffer===!0?n:new hN(n,s),c=new nS(u,r,o);u.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,s=r):s=Ns(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const DS=(i,e=null,t=0,n=0)=>Fe(new sj(i,e,t,n)),aj=(i,e=null,t=0,n=0)=>DS(i,e,t,n).setUsage(oc),X1=(i,e=null,t=0,n=0)=>DS(i,e,t,n).setInstanced(!0),Y1=(i,e=null,t=0,n=0)=>aj(i,e,t,n).setInstanced(!0);be("toAttribute",i=>DS(i.value));class oj extends Dt{static get type(){return"ComputeNode"}constructor(e,t,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=It.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let n=t[0];for(let r=1;r<t.length;r++)n*=t[r];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.setup(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const lj=(i,e,t)=>Fe(new oj(Fe(i),e,t));be("compute",lj);class uj extends Dt{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.build(e,...t);return e.setCache(n),s}}const hg=(i,e)=>Fe(new uj(Fe(i),e));be("cache",hg);class cj extends Dt{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const hj=Le(cj).setParameterLength(2);be("bypass",hj);class I2 extends Dt{static get type(){return"RemapNode"}constructor(e,t,n,r=Te(0),s=Te(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:s,doClamp:o}=this;let u=e.sub(t).div(n.sub(t));return o===!0&&(u=u.clamp()),u.mul(s.sub(r)).add(r)}}const fj=Le(I2,null,null,{doClamp:!1}).setParameterLength(3,5),dj=Le(I2).setParameterLength(3,5);be("remap",fj);be("remapClamp",dj);class fg extends Dt{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if(n==="void")e.addLineFlowCode(r,this);else return e.format(r,n,t)}}const _d=Le(fg).setParameterLength(1,2),pj=i=>(i?_r(i,_d("discard")):_d("discard")).append();be("discard",pj);class mj extends Zn{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const n=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Sr,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Vr;return n!==Sr&&(t=t.toneMapping(n)),r!==Vr&&r!==Ft.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const gj=(i,e=null,t=null)=>Fe(new mj(Fe(i),e,t));be("renderOutput",gj);class _j extends Zn{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e);let r="";return r+=`// #--- TSL Debug ---#
`,r+=e.flow.code.replace(/^\t/mg,"")+`
`,r+="/* ... */ "+n+` /* ... */
`,r+=`// #-----------------#
`,t!==null?t(r):console.log(r),n}}const vj=(i,e=null)=>Fe(new _j(Fe(i),e));be("debug",vj);class yj extends Dt{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),u=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(u.name,o,n):Ns(this).build(e,n)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const $a=(i,e)=>Fe(new yj(i,e)),zd=(i=0)=>$a("uv"+(i>0?i:""),"vec2");class xj extends Dt{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),t)}}const Gf=Le(xj).setParameterLength(1,2);class bj extends Bd{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=It.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:r,height:s}=n;this.value=Math.log2(Math.max(r,s))}}}const Sj=Le(bj).setParameterLength(1);class kd extends Bd{static get type(){return"TextureNode"}constructor(e,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=It.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Sn?"uvec4":this.value.type===Ri?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return zd(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Rt(this.value.matrix)),this._matrixUniform.mul(Ae(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?It.RENDER:It.NONE,this}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&n.flipY===!0||n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(kn(Gf(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;(r===null||e.context.forceUVContext===!0)&&e.context.getUV&&(r=e.context.getUV(this)),r||(r=this.getDefaultUV()),this.updateMatrix===!0&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,n,r,s,o,u,c){const f=this.value;let d;return r?d=e.generateTextureLevel(f,t,n,r,o):s?d=e.generateTextureBias(f,t,n,s,o):c?d=e.generateTextureGrad(f,t,n,c,o):u?d=e.generateTextureCompare(f,t,n,u,o):this.sampler===!1?d=e.generateTextureLoad(f,t,n,o):d=e.generateTexture(f,t,n,o),d}generate(e,t){const n=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let u=o.propertyName;if(u===void 0){const{uvNode:d,levelNode:m,biasNode:g,compareNode:_,depthNode:v,gradNode:S}=r,b=this.generateUV(e,d),x=m?m.build(e,"float"):null,E=g?g.build(e,"float"):null,M=v?v.build(e,"int"):null,A=_?_.build(e,"float"):null,C=S?[S[0].build(e,"vec2"),S[1].build(e,"vec2")]:null,w=e.getVarFromNode(this);u=e.getPropertyName(w);const N=this.generateSnippet(e,s,b,x,E,M,A,C);e.addLineFlowCode(`${u} = ${N}`,this),o.snippet=N,o.propertyName=u}let c=u;const f=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(c=NS(_d(c,f),n.colorSpace).setup(e).build(e,f)),e.format(c,f,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}blur(e){const t=this.clone();t.biasNode=Fe(e).mul(Sj(t)),t.referenceNode=this.getSelf();const n=t.value;return(n&&n.generateMipmaps===!1||n.minFilter===Rn||n.magFilter===Rn)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Fe(t)}level(e){const t=this.clone();return t.levelNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}size(e){return Gf(this,e)}bias(e){const t=this.clone();return t.biasNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}compare(e){const t=this.clone();return t.compareNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}grad(e,t){const n=this.clone();return n.gradNode=[Fe(e),Fe(t)],n.referenceNode=this.getSelf(),Fe(n)}depth(e){const t=this.clone();return t.depthNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const Jt=Le(kd).setParameterLength(1,4),ys=(...i)=>Jt(...i).setSampler(!1);class z2 extends Bd{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const k2=(i,e,t)=>Fe(new z2(i,e,t));class Tj extends Od{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}}class Ej extends z2{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Rg(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=It.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let r=0;r<e.length;r++){const s=r*4;t[s]=e[r]}else if(n==="color")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(n==="mat2")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(n==="mat3")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(n==="mat4")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];for(let u=0;u<o.elements.length;u++)t[s+u]=o.elements[u]}else for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return n.charAt(0)==="i"&&(r=Int32Array),n.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return Fe(new Tj(this,Fe(e)))}}const Vs=(i,e)=>Fe(new Ej(i,e)),G2=Rt(0,"uint").setGroup(bS("cameraIndex")).toVarying("v_cameraIndex"),Ul=Rt("float").label("cameraNear").setGroup(Tt).onRenderUpdate(({camera:i})=>i.near),Ol=Rt("float").label("cameraFar").setGroup(Tt).onRenderUpdate(({camera:i})=>i.far),PS=Ie(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.projectionMatrix);e=Vs(t).setGroup(Tt).label("cameraProjectionMatrices").element(G2).toVar("cameraProjectionMatrix")}else e=Rt("mat4").label("cameraProjectionMatrix").setGroup(Tt).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),Za=Ie(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.matrixWorldInverse);e=Vs(t).setGroup(Tt).label("cameraViewMatrices").element(G2).toVar("cameraViewMatrix")}else e=Rt("mat4").label("cameraViewMatrix").setGroup(Tt).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),Mj=Rt(new H).label("cameraPosition").setGroup(Tt).onRenderUpdate(({camera:i},e)=>e.value.setFromMatrixPosition(i.matrixWorld)),K1=new Nd;class gn extends Dt{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=It.OBJECT,this._uniformNode=new Bd(null)}getNodeType(){const e=this.scope;if(e===gn.WORLD_MATRIX)return"mat4";if(e===gn.POSITION||e===gn.VIEW_POSITION||e===gn.DIRECTION||e===gn.SCALE)return"vec3";if(e===gn.RADIUS)return"float"}update(e){const t=this.object3d,n=this._uniformNode,r=this.scope;if(r===gn.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===gn.POSITION)n.value=n.value||new H,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===gn.SCALE)n.value=n.value||new H,n.value.setFromMatrixScale(t.matrixWorld);else if(r===gn.DIRECTION)n.value=n.value||new H,t.getWorldDirection(n.value);else if(r===gn.VIEW_POSITION){const s=e.camera;n.value=n.value||new H,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(s.matrixWorldInverse)}else if(r===gn.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),K1.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),n.value=K1.radius}}generate(e){const t=this.scope;return t===gn.WORLD_MATRIX?this._uniformNode.nodeType="mat4":t===gn.POSITION||t===gn.VIEW_POSITION||t===gn.DIRECTION||t===gn.SCALE?this._uniformNode.nodeType="vec3":t===gn.RADIUS&&(this._uniformNode.nodeType="float"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}gn.WORLD_MATRIX="worldMatrix";gn.POSITION="position";gn.SCALE="scale";gn.VIEW_POSITION="viewPosition";gn.DIRECTION="direction";gn.RADIUS="radius";const Aj=Le(gn,gn.POSITION).setParameterLength(1);class us extends gn{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}us.DIRECTION;const Ql=Ge(us,us.WORLD_MATRIX);us.POSITION;us.SCALE;us.VIEW_POSITION;us.RADIUS;const wj=Rt(new Mt).onObjectUpdate(({object:i},e)=>e.value.getNormalMatrix(i.matrixWorld)),f_=Ie(i=>i.renderer.nodes.modelViewMatrix||Rj).once()().toVar("modelViewMatrix"),Rj=Za.mul(Ql),d_=$a("position","vec3"),$i=d_.toVarying("positionLocal"),Q1=d_.toVarying("positionPrevious"),vd=Ql.mul($i).xyz.toVarying("v_positionWorld").context({needsPositionReassign:!0}),V2=$i.transformDirection(Ql).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection").context({needsPositionReassign:!0}),ai=Ie(i=>i.context.setupPositionView(),"vec3").once()().toVarying("v_positionView").context({needsPositionReassign:!0}),zn=ai.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class Cj extends Dt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:n}=e;return t.coordinateSystem===gr&&n.side===Tn?"false":e.getFrontFacing()}}const Nj=Ge(Cj),p_=Te(Nj).mul(2).sub(1),H2=$a("normal","vec3"),Ys=Ie(i=>i.geometry.hasAttribute("normal")===!1?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),Ae(0,1,0)):H2,"vec3").once()().toVar("normalLocal"),Dj=ai.dFdx().cross(ai.dFdy()).normalize().toVar("normalFlat"),Cs=Ie(i=>{let e;return i.material.flatShading===!0?e=Dj:e=Ns(W2(Ys),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),j2=Ns(Cs.transformDirection(Za),"v_normalWorld").normalize().toVar("normalWorld"),si=Ie(i=>i.context.setupNormal().context({getUV:null}),"vec3").once()().mul(p_).toVar("transformedNormalView"),LS=si.transformDirection(Za).toVar("transformedNormalWorld"),Nf=Ie(i=>i.context.setupClearcoatNormal().context({getUV:null}),"vec3").once()().mul(p_).toVar("transformedClearcoatNormalView"),Pj=Ie(([i,e=Ql])=>{const t=nr(e),n=i.div(Ae(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),W2=Ie(([i],e)=>{const t=e.renderer.nodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(i);const n=wj.mul(i);return Za.transformDirection(n)}),Z1=new Tr,U0=new qt,Lj=Rt(0).onReference(({material:i})=>i).onObjectUpdate(({material:i})=>i.refractionRatio),O0=Rt(1).onReference(({material:i})=>i).onObjectUpdate(function({material:i,scene:e}){return i.envMap?i.envMapIntensity:e.environmentIntensity}),q2=Rt(new qt).onReference(function(i){return i.material}).onObjectUpdate(function({material:i,scene:e}){const t=e.environment!==null&&i.envMap===null?e.environmentRotation:i.envMapRotation;return t?(Z1.copy(t),U0.makeRotationFromEuler(Z1)):U0.identity(),U0}),Uj=zn.negate().reflect(si),Oj=zn.negate().refract(si,Lj),Bj=Uj.transformDirection(Za).toVar("reflectVector"),Fj=Oj.transformDirection(Za).toVar("reflectVector");class Ij extends kd{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===os?Bj:e.mapping===ls?Fj:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),Ae(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return(e.renderer.coordinateSystem===qo||!n.isRenderTargetTexture)&&(t=Ae(t.x.negate(),t.yz)),q2.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const yd=Le(Ij).setParameterLength(1,4).setName("cubeTexture");class zj extends Od{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}}class US extends Dt{static get type(){return"ReferenceNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=It.OBJECT}element(e){return Fe(new zj(this,Fe(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=k2(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Vs(null,e):e==="texture"?t=Jt(null):e==="cubeTexture"?t=yd(null):t=Rt(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const bn=(i,e,t)=>Fe(new US(i,e,t)),J1=(i,e,t,n)=>Fe(new US(i,e,n,t));class kj extends US{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Bo=(i,e,t=null)=>Fe(new kj(i,e,t)),$2=Ie(i=>(i.geometry.hasAttribute("tangent")===!1&&i.geometry.computeTangents(),$a("tangent","vec4")))(),OS=$2.xyz.toVar("tangentLocal"),X2=f_.mul(wt(OS,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),Gj=i=>i.mul($2.w).xyz,Vj=Ns(Gj(Cs.cross(X2)),"v_bitangentView").normalize().toVar("bitangentView"),Df=nr(X2,Vj,Cs),Hj=(()=>{let i=xc.cross(zn);return i=i.cross(xc).normalize(),i=Nn(i,si,Nl.mul(La.oneMinus()).oneMinus().pow2().pow2()).normalize(),i})(),jj=Ie(i=>{const{eye_pos:e,surf_norm:t,mapN:n,uv:r}=i,s=e.dFdx(),o=e.dFdy(),u=r.dFdx(),c=r.dFdy(),f=t,d=o.cross(f),m=f.cross(s),g=d.mul(u.x).add(m.mul(c.x)),_=d.mul(u.y).add(m.mul(c.y)),v=g.dot(g).max(_.dot(_)),S=p_.mul(v.inverseSqrt());return ir(g.mul(n.x,S),_.mul(n.y,S),f.mul(n.z)).normalize()});class Wj extends Zn{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=ja}setup(e){const{normalMapType:t,scaleNode:n}=this;let r=this.node.mul(2).sub(1);n!==null&&(r=Ae(r.xy.mul(n),r.z));let s=null;return t===iN?s=W2(r):t===ja&&(e.hasGeometryAttribute("tangent")===!0?s=Df.mul(r).normalize():s=jj({eye_pos:ai,surf_norm:Cs,mapN:r,uv:zd()})),s}}const eR=Le(Wj).setParameterLength(1,2),qj=Ie(({textureNode:i,bumpScale:e})=>{const t=r=>i.cache().context({getUV:s=>r(s.uvNode||zd()),forceUVContext:!0}),n=Te(t(r=>r));return He(Te(t(r=>r.add(r.dFdx()))).sub(n),Te(t(r=>r.add(r.dFdy()))).sub(n)).mul(e)}),$j=Ie(i=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=i,r=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,u=s.cross(o),c=o.cross(r),f=r.dot(u).mul(p_),d=f.sign().mul(n.x.mul(u).add(n.y.mul(c)));return f.abs().mul(t).sub(d).normalize()});class Xj extends Zn{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=qj({textureNode:this.textureNode,bumpScale:e});return $j({surf_pos:ai,surf_norm:Cs,dHdxy:t})}}const Yj=Le(Xj).setParameterLength(1,2),tR=new Map;class ye extends Dt{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=tR.get(e);return n===void 0&&(n=Bo(e,t),tR.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===ye.COLOR){const s=t.color!==void 0?this.getColor(n):Ae();t.map&&t.map.isTexture===!0?r=s.mul(this.getTexture("map")):r=s}else if(n===ye.OPACITY){const s=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?r=s.mul(this.getTexture("alpha")):r=s}else if(n===ye.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=Te(1);else if(n===ye.SPECULAR_INTENSITY){const s=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s}else if(n===ye.SPECULAR_COLOR){const s=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=s.mul(this.getTexture(n).rgb):r=s}else if(n===ye.ROUGHNESS){const s=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).g):r=s}else if(n===ye.METALNESS){const s=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=s.mul(this.getTexture(n).b):r=s}else if(n===ye.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(n).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(n)):r=o}else if(n===ye.NORMAL)t.normalMap?(r=eR(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):t.bumpMap?r=Yj(this.getTexture("bump").r,this.getFloat("bumpScale")):r=Cs;else if(n===ye.CLEARCOAT){const s=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===ye.CLEARCOAT_ROUGHNESS){const s=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===ye.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=eR(this.getTexture(n),this.getCache(n+"Scale","vec2")):r=Cs;else if(n===ye.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=s.mul(this.getTexture("sheenColor").rgb):r=s}else if(n===ye.SHEEN_ROUGHNESS){const s=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s,r=r.clamp(.07,1)}else if(n===ye.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(n);r=xS(pf.x,pf.y,pf.y.negate(),pf.x).mul(s.rg.mul(2).sub(He(1)).normalize().mul(s.b))}else r=pf;else if(n===ye.IRIDESCENCE_THICKNESS){const s=bn("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=bn("0","float",t.iridescenceThicknessRange);r=s.sub(o).mul(this.getTexture(n).g).add(o)}else r=s}else if(n===ye.TRANSMISSION){const s=this.getFloat(n);t.transmissionMap?r=s.mul(this.getTexture(n).r):r=s}else if(n===ye.THICKNESS){const s=this.getFloat(n);t.thicknessMap?r=s.mul(this.getTexture(n).g):r=s}else if(n===ye.IOR)r=this.getFloat(n);else if(n===ye.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===ye.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const s=this.getNodeType(e);r=this.getCache(n,s)}return r}}ye.ALPHA_TEST="alphaTest";ye.COLOR="color";ye.OPACITY="opacity";ye.SHININESS="shininess";ye.SPECULAR="specular";ye.SPECULAR_STRENGTH="specularStrength";ye.SPECULAR_INTENSITY="specularIntensity";ye.SPECULAR_COLOR="specularColor";ye.REFLECTIVITY="reflectivity";ye.ROUGHNESS="roughness";ye.METALNESS="metalness";ye.NORMAL="normal";ye.CLEARCOAT="clearcoat";ye.CLEARCOAT_ROUGHNESS="clearcoatRoughness";ye.CLEARCOAT_NORMAL="clearcoatNormal";ye.EMISSIVE="emissive";ye.ROTATION="rotation";ye.SHEEN="sheen";ye.SHEEN_ROUGHNESS="sheenRoughness";ye.ANISOTROPY="anisotropy";ye.IRIDESCENCE="iridescence";ye.IRIDESCENCE_IOR="iridescenceIOR";ye.IRIDESCENCE_THICKNESS="iridescenceThickness";ye.IOR="ior";ye.TRANSMISSION="transmission";ye.THICKNESS="thickness";ye.ATTENUATION_DISTANCE="attenuationDistance";ye.ATTENUATION_COLOR="attenuationColor";ye.LINE_SCALE="scale";ye.LINE_DASH_SIZE="dashSize";ye.LINE_GAP_SIZE="gapSize";ye.LINE_WIDTH="linewidth";ye.LINE_DASH_OFFSET="dashOffset";ye.POINT_SIZE="size";ye.DISPERSION="dispersion";ye.LIGHT_MAP="light";ye.AO="ao";const Kj=Ge(ye,ye.ALPHA_TEST),Qj=Ge(ye,ye.COLOR),Zj=Ge(ye,ye.SHININESS),Jj=Ge(ye,ye.EMISSIVE),Y2=Ge(ye,ye.OPACITY),eW=Ge(ye,ye.SPECULAR),nR=Ge(ye,ye.SPECULAR_INTENSITY),tW=Ge(ye,ye.SPECULAR_COLOR),dg=Ge(ye,ye.SPECULAR_STRENGTH),B0=Ge(ye,ye.REFLECTIVITY),nW=Ge(ye,ye.ROUGHNESS),iW=Ge(ye,ye.METALNESS),rW=Ge(ye,ye.NORMAL),sW=Ge(ye,ye.CLEARCOAT),aW=Ge(ye,ye.CLEARCOAT_ROUGHNESS),oW=Ge(ye,ye.CLEARCOAT_NORMAL),lW=Ge(ye,ye.ROTATION),uW=Ge(ye,ye.SHEEN),cW=Ge(ye,ye.SHEEN_ROUGHNESS),hW=Ge(ye,ye.ANISOTROPY),fW=Ge(ye,ye.IRIDESCENCE),dW=Ge(ye,ye.IRIDESCENCE_IOR),pW=Ge(ye,ye.IRIDESCENCE_THICKNESS),mW=Ge(ye,ye.TRANSMISSION),gW=Ge(ye,ye.THICKNESS),_W=Ge(ye,ye.IOR),vW=Ge(ye,ye.ATTENUATION_DISTANCE),yW=Ge(ye,ye.ATTENUATION_COLOR),xW=Ge(ye,ye.LINE_SCALE),bW=Ge(ye,ye.LINE_DASH_SIZE),SW=Ge(ye,ye.LINE_GAP_SIZE);ye.LINE_WIDTH;const TW=Ge(ye,ye.LINE_DASH_OFFSET),EW=Ge(ye,ye.POINT_SIZE),MW=Ge(ye,ye.DISPERSION),K2=Ge(ye,ye.LIGHT_MAP),AW=Ge(ye,ye.AO),pf=Rt(new Oe).onReference(function(i){return i.material}).onRenderUpdate(function({material:i}){this.value.set(i.anisotropy*Math.cos(i.anisotropyRotation),i.anisotropy*Math.sin(i.anisotropyRotation))}),Q2=Ie(i=>i.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Dn extends Dt{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r;if(n===Dn.VERTEX)r=e.getVertexIndex();else if(n===Dn.INSTANCE)r=e.getInstanceIndex();else if(n===Dn.DRAW)r=e.getDrawIndex();else if(n===Dn.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===Dn.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(n===Dn.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=r:s=Ns(this).build(e,t),s}}Dn.VERTEX="vertex";Dn.INSTANCE="instance";Dn.SUBGROUP="subgroup";Dn.INVOCATION_LOCAL="invocationLocal";Dn.INVOCATION_SUBGROUP="invocationSubgroup";Dn.DRAW="draw";const wW=Ge(Dn,Dn.VERTEX),BS=Ge(Dn,Dn.INSTANCE);Dn.SUBGROUP;Dn.INVOCATION_SUBGROUP;Dn.INVOCATION_LOCAL;const RW=Ge(Dn,Dn.DRAW);class CW extends Dt{static get type(){return"InstanceNode"}constructor(e,t,n){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=It.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:n,instanceColor:r}=this;let{instanceMatrixNode:s,instanceColorNode:o}=this;if(s===null){if(t<=1e3)s=k2(n.array,"mat4",Math.max(t,1)).element(BS);else{const c=new kF(n.array,16,1);this.buffer=c;const f=n.usage===oc?Y1:X1,d=[f(c,"vec4",16,0),f(c,"vec4",16,4),f(c,"vec4",16,8),f(c,"vec4",16,12)];s=yc(...d)}this.instanceMatrixNode=s}if(r&&o===null){const c=new Z3(r.array,3),f=r.usage===oc?Y1:X1;this.bufferColor=c,o=Ae(f(c,"vec3",3,0)),this.instanceColorNode=o}const u=s.mul($i).xyz;if($i.assign(u),e.hasGeometryAttribute("normal")){const c=Pj(Ys,s);Ys.assign(c)}this.instanceColorNode!==null&&Ng("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==oc&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==oc&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class NW extends CW{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}}const DW=Le(NW).setParameterLength(1);class PW extends Dt{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=BS:this.batchingIdNode=RW);const n=Ie(([v])=>{const S=kn(Gf(ys(this.batchMesh._indirectTexture),0).x),b=kn(v).mod(S),x=kn(v).div(S);return ys(this.batchMesh._indirectTexture,Ca(b,x)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(kn(this.batchingIdNode)),r=this.batchMesh._matricesTexture,s=kn(Gf(ys(r),0).x),o=Te(n).mul(4).toInt().toVar(),u=o.mod(s),c=o.div(s),f=yc(ys(r,Ca(u,c)),ys(r,Ca(u.add(1),c)),ys(r,Ca(u.add(2),c)),ys(r,Ca(u.add(3),c))),d=this.batchMesh._colorsTexture;if(d!==null){const S=Ie(([b])=>{const x=kn(Gf(ys(d),0).x),E=b,M=E.mod(x),A=E.div(x);return ys(d,Ca(M,A)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);Ng("vec3","vBatchColor").assign(S)}const m=nr(f);$i.assign(f.mul($i));const g=Ys.div(Ae(m[0].dot(m[0]),m[1].dot(m[1]),m[2].dot(m[2]))),_=m.mul(g).xyz;Ys.assign(_),e.hasGeometryAttribute("tangent")&&OS.mulAssign(m)}}const LW=Le(PW).setParameterLength(1),iR=new WeakMap;class UW extends Dt{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=It.OBJECT,this.skinIndexNode=$a("skinIndex","uvec4"),this.skinWeightNode=$a("skinWeight","vec4"),this.bindMatrixNode=bn("bindMatrix","mat4"),this.bindMatrixInverseNode=bn("bindMatrixInverse","mat4"),this.boneMatricesNode=J1("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=$i,this.toPositionNode=$i,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,u=e.element(n.x),c=e.element(n.y),f=e.element(n.z),d=e.element(n.w),m=s.mul(t),g=ir(u.mul(r.x).mul(m),c.mul(r.y).mul(m),f.mul(r.z).mul(m),d.mul(r.w).mul(m));return o.mul(g).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=Ys){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,u=e.element(n.x),c=e.element(n.y),f=e.element(n.z),d=e.element(n.w);let m=ir(r.x.mul(u),r.y.mul(c),r.z.mul(f),r.w.mul(d));return m=o.mul(m).mul(s),m.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=J1("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Q1)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||c2(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&Q1.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();Ys.assign(n),e.hasGeometryAttribute("tangent")&&OS.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;iR.get(t)!==e.frameId&&(iR.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const OW=i=>Fe(new UW(i));class BW extends Dt{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let s=0,o=this.params.length-1;s<o;s++){const u=this.params[s],c=u.isNode!==!0&&u.name||this.getVarName(s),f=u.isNode!==!0&&u.type||"int";n[c]=_d(c,f)}const r=e.addStack();return t.returnsNode=this.params[this.params.length-1](n,r,e),t.stackNode=r,e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let u=0,c=n.length-1;u<c;u++){const f=n[u];let d=!1,m=null,g=null,_=null,v=null,S=null,b=null;f.isNode?f.getNodeType(e)==="bool"?(d=!0,v="bool",g=f.build(e,v)):(v="int",_=this.getVarName(u),m="0",g=f.build(e,v),S="<"):(v=f.type||"int",_=f.name||this.getVarName(u),m=f.start,g=f.end,S=f.condition,b=f.update,typeof m=="number"?m=e.generateConst(v,m):m&&m.isNode&&(m=m.build(e,v)),typeof g=="number"?g=e.generateConst(v,g):g&&g.isNode&&(g=g.build(e,v)),m!==void 0&&g===void 0?(m=m+" - 1",g="0",S=">="):g!==void 0&&m===void 0&&(m="0",S="<"),S===void 0&&(Number(m)>Number(g)?S=">=":S="<"));let x;if(d)x=`while ( ${g} )`;else{const E={start:m,end:g},M=E.start,A=E.end;let C="",w="",N="";b||(v==="int"||v==="uint"?S.includes("<")?b="++":b="--":S.includes("<")?b="+= 1.":b="-= 1."),C+=e.getVar(v,_)+" = "+M,w+=_+" "+S+" "+A,N+=_+" "+b,x=`for ( ${C}; ${w}; ${N} )`}e.addFlowCode((u===0?`
`:"")+e.tab+x+` {

`).addFlowTab()}const s=r.build(e,"void"),o=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let u=0,c=this.params.length-1;u<c;u++)e.addFlowCode((u===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),o}}const Es=(...i)=>Fe(new BW(vc(i,"int"))).append(),FW=()=>_d("break").append(),F0=new WeakMap,Ir=new xt,rR=Ie(({bufferMap:i,influence:e,stride:t,width:n,depth:r,offset:s})=>{const o=kn(wW).mul(t).add(s),u=o.div(n),c=o.sub(u.mul(n));return ys(i,Ca(c,u)).depth(r).xyz.mul(e)});function IW(i){const e=i.morphAttributes.position!==void 0,t=i.morphAttributes.normal!==void 0,n=i.morphAttributes.color!==void 0,r=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,s=r!==void 0?r.length:0;let o=F0.get(i);if(o===void 0||o.count!==s){let E=function(){b.dispose(),F0.delete(i),i.removeEventListener("dispose",E)};var u=E;o!==void 0&&o.texture.dispose();const c=i.morphAttributes.position||[],f=i.morphAttributes.normal||[],d=i.morphAttributes.color||[];let m=0;e===!0&&(m=1),t===!0&&(m=2),n===!0&&(m=3);let g=i.attributes.position.count*m,_=1;const v=4096;g>v&&(_=Math.ceil(g/v),g=v);const S=new Float32Array(g*_*4*s),b=new Qb(S,g,_,s);b.type=Yn,b.needsUpdate=!0;const x=m*4;for(let M=0;M<s;M++){const A=c[M],C=f[M],w=d[M],N=g*_*4*M;for(let L=0;L<A.count;L++){const P=L*x;e===!0&&(Ir.fromBufferAttribute(A,L),S[N+P+0]=Ir.x,S[N+P+1]=Ir.y,S[N+P+2]=Ir.z,S[N+P+3]=0),t===!0&&(Ir.fromBufferAttribute(C,L),S[N+P+4]=Ir.x,S[N+P+5]=Ir.y,S[N+P+6]=Ir.z,S[N+P+7]=0),n===!0&&(Ir.fromBufferAttribute(w,L),S[N+P+8]=Ir.x,S[N+P+9]=Ir.y,S[N+P+10]=Ir.z,S[N+P+11]=w.itemSize===4?Ir.w:1)}}o={count:s,texture:b,stride:m,size:new Oe(g,_)},F0.set(i,o),i.addEventListener("dispose",E)}return o}class zW extends Dt{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Rt(1),this.updateType=It.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:u,stride:c,size:f}=IW(t);n===!0&&$i.mulAssign(this.morphBaseInfluence),r===!0&&Ys.mulAssign(this.morphBaseInfluence);const d=kn(f.width);Es(o,({i:m})=>{const g=Te(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?g.assign(ys(this.mesh.morphTexture,Ca(kn(m).add(1),kn(BS))).r):g.assign(bn("morphTargetInfluences","float").element(m).toVar()),Qn(g.notEqual(0),()=>{n===!0&&$i.addAssign(rR({bufferMap:u,influence:g,stride:c,width:d,depth:m,offset:kn(0)})),r===!0&&Ys.addAssign(rR({bufferMap:u,influence:g,stride:c,width:d,depth:m,offset:kn(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const kW=Le(zW).setParameterLength(1);class ih extends Dt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class GW extends ih{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class VW extends B2{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=Ae().toVar("directDiffuse"),r=Ae().toVar("directSpecular"),s=Ae().toVar("indirectDiffuse"),o=Ae().toVar("indirectSpecular"),u={directDiffuse:n,directSpecular:r,indirectDiffuse:s,indirectSpecular:o};return{radiance:Ae().toVar("radiance"),irradiance:Ae().toVar("irradiance"),iblIrradiance:Ae().toVar("iblIrradiance"),ambientOcclusion:Te(1).toVar("ambientOcclusion"),reflectedLight:u,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const HW=Le(VW);class jW extends ih{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let mf,gf;class ri extends Dt{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===ri.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=It.NONE;return(this.scope===ri.SIZE||this.scope===ri.VIEWPORT)&&(e=It.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===ri.VIEWPORT?t!==null?gf.copy(t.viewport):(e.getViewport(gf),gf.multiplyScalar(e.getPixelRatio())):t!==null?(mf.width=t.width,mf.height=t.height):e.getDrawingBufferSize(mf)}setup(){const e=this.scope;let t=null;return e===ri.SIZE?t=Rt(mf||(mf=new Oe)):e===ri.VIEWPORT?t=Rt(gf||(gf=new xt)):t=He(m_.div(Jx)),t}generate(e){if(this.scope===ri.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(Jx).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}ri.COORDINATE="coordinate";ri.VIEWPORT="viewport";ri.SIZE="size";ri.UV="uv";const xd=Ge(ri,ri.UV),Jx=Ge(ri,ri.SIZE),m_=Ge(ri,ri.COORDINATE),Vf=Ge(ri,ri.VIEWPORT);Vf.zw;Vf.xy;const _f=new Oe;class Z2 extends kd{static get type(){return"ViewportTextureNode"}constructor(e=xd,t=null,n=null){n===null&&(n=new iF,n.minFilter=mr),super(n,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=It.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(_f);const n=this.value;(n.image.width!==_f.width||n.image.height!==_f.height)&&(n.image.width=_f.width,n.image.height=_f.height,n.needsUpdate=!0);const r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const J2=Le(Z2,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let I0=null;class WW extends Z2{static get type(){return"ViewportDepthTextureNode"}constructor(e=xd,t=null){I0===null&&(I0=new ss),super(e,t,I0)}}const qW=Le(WW).setParameterLength(0,2);class vr extends Dt{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===vr.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let r=null;if(t===vr.DEPTH_BASE)n!==null&&(r=nD().assign(n));else if(t===vr.DEPTH)e.isPerspectiveCamera?r=$W(ai.z,Ul,Ol):r=Hf(ai.z,Ul,Ol);else if(t===vr.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const s=eD(n,Ul,Ol);r=Hf(s,Ul,Ol)}else r=n;else r=Hf(ai.z,Ul,Ol);return r}}vr.DEPTH_BASE="depthBase";vr.DEPTH="depth";vr.LINEAR_DEPTH="linearDepth";const Hf=(i,e,t)=>i.add(e).div(e.sub(t)),$W=(i,e,t)=>e.add(i).mul(t).div(t.sub(e).mul(i)),eD=(i,e,t)=>e.mul(t).div(t.sub(e).mul(i).sub(t)),tD=(i,e,t)=>{e=e.max(1e-6).toVar();const n=Va(i.negate().div(e)),r=Va(t.div(e));return n.div(r)},nD=Le(vr,vr.DEPTH_BASE),iD=Ge(vr,vr.DEPTH),XW=Le(vr,vr.LINEAR_DEPTH).setParameterLength(0,1);qW();iD.assign=i=>nD(i);class YW extends Dt{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const KW=Le(YW).setParameterLength(1);class as extends Dt{static get type(){return"ClippingNode"}constructor(e=as.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===as.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===as.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Ie(()=>{const n=Te().toVar("distanceToPlane"),r=Te().toVar("distanceToGradient"),s=Te(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=Vs(t);Es(o,({i:f})=>{const d=c.element(f);n.assign(ai.dot(d.xyz).negate().add(d.w)),r.assign(n.fwidth().div(2)),s.mulAssign(Xo(r.negate(),r,n))})}const u=e.length;if(u>0){const c=Vs(e),f=Te(1).toVar("intersectionClipOpacity");Es(u,({i:d})=>{const m=c.element(d);n.assign(ai.dot(m.xyz).negate().add(m.w)),r.assign(n.fwidth().div(2)),f.mulAssign(Xo(r.negate(),r,n).oneMinus())}),s.mulAssign(f.oneMinus())}sn.a.mulAssign(s),sn.a.equal(0).discard()})()}setupDefault(e,t){return Ie(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const s=Vs(t);Es(n,({i:o})=>{const u=s.element(o);ai.dot(u.xyz).greaterThan(u.w).discard()})}const r=e.length;if(r>0){const s=Vs(e),o=g2(!0).toVar("clipped");Es(r,({i:u})=>{const c=s.element(u);o.assign(ai.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Ie(()=>{const r=Vs(e),s=KW(t.getClipDistance());Es(n,({i:o})=>{const u=r.element(o),c=ai.dot(u.xyz).sub(u.w).negate();s.element(o).assign(c)})})()}}as.ALPHA_TO_COVERAGE="alphaToCoverage";as.DEFAULT="default";as.HARDWARE="hardware";const QW=()=>Fe(new as),ZW=()=>Fe(new as(as.ALPHA_TO_COVERAGE)),JW=()=>Fe(new as(as.HARDWARE)),e9=.05,sR=Ie(([i])=>Yo(Vt(1e4,Ss(Vt(17,i.x).add(Vt(.1,i.y)))).mul(ir(.1,ns(Ss(Vt(13,i.y).add(i.x))))))),aR=Ie(([i])=>sR(He(sR(i.xy),i.z))),t9=Ie(([i])=>{const e=Er(Vo(C2(i.xyz)),Vo(N2(i.xyz))),t=Te(1).div(Te(e9).mul(e)).toVar("pixScale"),n=He(pd(Hl(Va(t))),pd(MS(Va(t)))),r=He(aR(Hl(n.x.mul(i.xyz))),aR(Hl(n.y.mul(i.xyz)))),s=Yo(Va(t)),o=ir(Vt(s.oneMinus(),r.x),Vt(s,r.y)),u=gd(s,s.oneMinus()),c=Ae(o.mul(o).div(Vt(2,u).mul(pr(1,u))),o.sub(Vt(.5,u)).div(pr(1,u)),pr(1,pr(1,o).mul(pr(1,o)).div(Vt(2,u).mul(pr(1,u))))),f=o.lessThan(u.oneMinus()).select(o.lessThan(u).select(c.x,c.y),c.z);return qa(f,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class xi extends Yi{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+l2(this)}build(e){this.setup(e)}setupObserver(e){return new J5(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const r=this.vertexNode||this.setupVertex(e);e.stack.outputNode=r,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let s;const o=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const u=this.setupLighting(e);o!==null&&e.stack.add(o);const c=wt(u,sn.a).max(0);s=this.setupOutput(e,c),kf.assign(s);const f=this.outputNode!==null;if(f&&(s=this.outputNode),n!==null){const d=t.getMRT(),m=this.mrtNode;d!==null?(f&&kf.assign(s),s=d,m!==null&&(s=d.merge(m))):m!==null&&(s=m)}}else{let u=this.fragmentNode;u.isOutputStructNode!==!0&&(u=wt(u)),s=this.setupOutput(e,u)}e.stack.outputNode=s,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const s=e.renderer.samples;this.alphaToCoverage&&s>1?r=ZW():e.stack.add(QW())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(JW()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(r===null){const s=t.getMRT();s&&s.has("depth")?r=s.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?r=tD(ai.z,Ul,Ol):r=Hf(ai.z,Ul,Ol))}r!==null&&iD.assign(r).append()}setupPositionView(){return f_.mul($i).xyz}setupModelViewProjection(){return PS.mul(ai)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),Q2}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&kW(t).append(),t.isSkinnedMesh===!0&&OW(t).append(),this.displacementMap){const r=Bo("displacementMap","texture"),s=Bo("displacementScale","float"),o=Bo("displacementBias","float");$i.addAssign(Ys.normalize().mul(r.x.mul(s).add(o)))}return t.isBatchedMesh&&LW(t).append(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&DW(t).append(),this.positionNode!==null&&$i.assign(this.positionNode.context({isPositionNodeInput:!0})),$i}setupDiffuseColor({object:e,geometry:t}){let n=this.colorNode?wt(this.colorNode):Qj;this.vertexColors===!0&&t.hasAttribute("color")&&(n=wt(n.xyz.mul($a("color","vec3")),n.a)),e.instanceColor&&(n=Ng("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=Ng("vec3","vBatchColor").mul(n)),sn.assign(n);const r=this.opacityNode?Te(this.opacityNode):Y2;if(sn.a.assign(sn.a.mul(r)),this.alphaTestNode!==null||this.alphaTest>0){const s=this.alphaTestNode!==null?Te(this.alphaTestNode):Kj;sn.a.lessThanEqual(s).discard()}this.alphaHash===!0&&sn.a.lessThan(t9($i)).discard(),this.transparent===!1&&this.blending===rs&&this.alphaToCoverage===!1&&sn.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Ae(0):sn.rgb}setupNormal(){return this.normalNode?Ae(this.normalNode):rW}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Bo("envMap","cubeTexture"):Bo("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new jW(K2)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),this.aoNode!==null||e.material.aoMap){const o=this.aoNode!==null?this.aoNode:AW;t.push(new GW(o))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:s}=this,u=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(u&&u.getScope().hasLights){const f=this.setupLightingModel(e)||null;c=HW(u,f,n,r)}else n!==null&&(c=Ae(r!==null?Nn(c,n,r):n));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(q1.assign(Ae(s||Jj)),c=c.add(q1)),c}setupFog(e,t){const n=e.fogNode;return n&&(kf.assign(t),t=wt(n)),t}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const n in e){const r=e[n];this[n]===void 0&&(this[n]=r,r&&r.clone&&(this[n]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=Yi.prototype.toJSON.call(this,e),r=wg(this);n.inputNodes={};for(const{property:o,childNode:u}of r)n.inputNodes[o]=u.toJSON(e).uuid;function s(o){const u=[];for(const c in o){const f=o[c];delete f.metadata,u.push(f)}return u}if(t){const o=s(e.textures),u=s(e.images),c=s(e.nodes);o.length>0&&(n.textures=o),u.length>0&&(n.images=u),c.length>0&&(n.nodes=c)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowPositionNode=e.shadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const n9=new Zg;class i9 extends xi{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(n9),this.setValues(e)}}const r9=new wF;class s9 extends xi{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(r9),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?Te(this.offsetNode):TW,t=this.dashScaleNode?Te(this.dashScaleNode):xW,n=this.dashSizeNode?Te(this.dashSizeNode):bW,r=this.gapSizeNode?Te(this.gapSizeNode):SW;L0.assign(n),$1.assign(r);const s=Ns($a("lineDistance").mul(t));(e?s.add(e):s).mod(L0.add($1)).greaterThan(L0).discard()}}const a9=i=>Fe(i).mul(.5).add(.5),o9=new TF;class l9 extends xi{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(o9),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?Te(this.opacityNode):Y2;sn.assign(NS(wt(a9(si),e),ut))}}class u9 extends Zn{static get type(){return"EquirectUVNode"}constructor(e=V2){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(Math.PI*2)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return He(t,n)}}const rD=Le(u9).setParameterLength(0,1);class sD extends cN{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new tu(5,5,5),o=rD(V2),u=new xi;u.colorNode=Jt(t,o,0),u.side=Tn,u.blending=br;const c=new oi(s,u),f=new Kg;f.add(c),t.minFilter===mr&&(t.minFilter=gi);const d=new uN(1,10,this),m=e.getMRT();return e.setMRT(null),d.update(e,f),e.setMRT(m),t.minFilter=n,t.currentGenerateMipmaps=r,c.geometry.dispose(),c.material.dispose(),this}}const jf=new WeakMap;class c9 extends Zn{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=yd(null);const t=new Yg;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=It.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const s=r.isTextureNode?r.value:n[r.property];if(s&&s.isTexture){const o=s.mapping;if(o===jo||o===Wo){if(jf.has(s)){const u=jf.get(s);oR(u,s.mapping),this._cubeTexture=u}else{const u=s.image;if(h9(u)){const c=new sD(u.height);c.fromEquirectangularTexture(t,s),oR(c.texture,s.mapping),this._cubeTexture=c.texture,jf.set(s,c.texture),s.addEventListener("dispose",aD)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function h9(i){return i==null?!1:i.height>0}function aD(i){const e=i.target;e.removeEventListener("dispose",aD);const t=jf.get(e);t!==void 0&&(jf.delete(e),t.dispose())}function oR(i,e){e===jo?i.mapping=os:e===Wo&&(i.mapping=ls)}const oD=Le(c9).setParameterLength(1);class FS extends ih{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=oD(this.envNode)}}class f9 extends ih{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=Te(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class g_{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class lD extends g_{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign(wt(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(wt(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(sn.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case wd:r.rgb.assign(Nn(r.rgb,r.rgb.mul(s.rgb),dg.mul(B0)));break;case YC:r.rgb.assign(Nn(r.rgb,s.rgb,dg.mul(B0)));break;case KC:r.rgb.addAssign(s.rgb.mul(dg.mul(B0)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const d9=new Gs;class p9 extends xi{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(d9),this.setValues(e)}setupNormal(){return Cs}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new FS(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new f9(K2)),t}setupOutgoingLight(){return sn.rgb}setupLightingModel(){return new lD}}const bd=Ie(({f0:i,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return i.mul(n.oneMinus()).add(e.mul(n))}),jc=Ie(i=>i.diffuseColor.mul(1/Math.PI)),m9=()=>Te(.25),g9=Ie(({dotNH:i})=>Qx.mul(Te(.5)).add(1).mul(Te(1/Math.PI)).mul(i.pow(Qx))),_9=Ie(({lightDirection:i})=>{const e=i.add(zn).normalize(),t=si.dot(e).clamp(),n=zn.dot(e).clamp(),r=bd({f0:kr,f90:1,dotVH:n}),s=m9(),o=g9({dotNH:t});return r.mul(s).mul(o)});class uD extends lD{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=si.dot(e).clamp().mul(t);n.directDiffuse.addAssign(s.mul(jc({diffuseColor:sn.rgb}))),this.specular===!0&&n.directSpecular.addAssign(s.mul(_9({lightDirection:e})).mul(dg))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(jc({diffuseColor:sn}))),r.indirectDiffuse.mulAssign(t)}}const v9=new mN;class y9 extends xi{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(v9),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new FS(t):null}setupLightingModel(){return new uD(!1)}}const x9=new bF;class b9 extends xi{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(x9),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new FS(t):null}setupLightingModel(){return new uD}setupVariants(){const e=(this.shininessNode?Te(this.shininessNode):Zj).max(1e-4);Qx.assign(e);const t=this.specularNode||eW;kr.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const S9=Ie(i=>{if(i.geometry.hasAttribute("normal")===!1)return Te(0);const e=Cs.dFdx().abs().max(Cs.dFdy().abs());return e.x.max(e.y).max(e.z)}),cD=Ie(i=>{const{roughness:e}=i,t=S9();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),T9=Ie(({alpha:i,dotNL:e,dotNV:t})=>{const n=i.pow2(),r=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return Wa(.5,r.add(s).max(l8))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),E9=Ie(({alphaT:i,alphaB:e,dotTV:t,dotBV:n,dotTL:r,dotBL:s,dotNV:o,dotNL:u})=>{const c=u.mul(Ae(i.mul(t),e.mul(n),o).length()),f=o.mul(Ae(i.mul(r),e.mul(s),u).length());return Wa(.5,c.add(f)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),M9=Ie(({alpha:i,dotNH:e})=>{const t=i.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),A9=Te(1/Math.PI),w9=Ie(({alphaT:i,alphaB:e,dotNH:t,dotTH:n,dotBH:r})=>{const s=i.mul(e),o=Ae(e.mul(n),i.mul(r),s.mul(t)),u=o.dot(o),c=s.div(u);return A9.mul(s.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),lR=Ie(i=>{const{lightDirection:e,f0:t,f90:n,roughness:r,f:s,USE_IRIDESCENCE:o,USE_ANISOTROPY:u}=i,c=i.normalView||si,f=r.pow2(),d=e.add(zn).normalize(),m=c.dot(e).clamp(),g=c.dot(zn).clamp(),_=c.dot(d).clamp(),v=zn.dot(d).clamp();let S=bd({f0:t,f90:n,dotVH:v}),b,x;if(j1(o)&&(S=TS.mix(S,s)),j1(u)){const E=lg.dot(e),M=lg.dot(zn),A=lg.dot(d),C=xc.dot(e),w=xc.dot(zn),N=xc.dot(d);b=E9({alphaT:Kx,alphaB:f,dotTV:M,dotBV:w,dotTL:E,dotBL:C,dotNV:g,dotNL:m}),x=w9({alphaT:Kx,alphaB:f,dotNH:_,dotTH:A,dotBH:N})}else b=T9({alpha:f,dotNL:m,dotNV:g}),x=M9({alpha:f,dotNH:_});return S.mul(b).mul(x)}),hD=Ie(({roughness:i,dotNV:e})=>{const t=wt(-1,-.0275,-.572,.022),n=wt(1,.0425,1.04,-.04),r=i.mul(t).add(n),s=r.x.mul(r.x).min(e.mul(-9.28).exp2()).mul(r.x).add(r.y);return He(-1.04,1.04).mul(s).add(r.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),fD=Ie(i=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:r}=i,s=hD({dotNV:e,roughness:r});return t.mul(s.x).add(n.mul(s.y))}),R9=Ie(({f:i,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),r=n.mul(n),s=n.mul(r,r).clamp(0,.9999);return i.sub(Ae(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),C9=Ie(({roughness:i,dotNH:e})=>{const t=i.pow2(),n=Te(1).div(t),s=e.pow2().oneMinus().max(.0078125);return Te(2).add(n).mul(s.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),N9=Ie(({dotNV:i,dotNL:e})=>Te(1).div(Te(4).mul(e.add(i).sub(e.mul(i))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),D9=Ie(({lightDirection:i})=>{const e=i.add(zn).normalize(),t=si.dot(i).clamp(),n=si.dot(zn).clamp(),r=si.dot(e).clamp(),s=C9({roughness:SS,dotNH:r}),o=N9({dotNV:n,dotNL:t});return hc.mul(s).mul(o)}),P9=Ie(({N:i,V:e,roughness:t})=>{const s=.0078125,o=i.dot(e).saturate(),u=He(t,o.oneMinus().sqrt());return u.assign(u.mul(.984375).add(s)),u}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),L9=Ie(({f:i})=>{const e=i.length();return Er(e.mul(e).add(i.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Pm=Ie(({v1:i,v2:e})=>{const t=i.dot(e),n=t.abs().toVar(),r=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),s=n.add(4.1616724).mul(n).add(3.417594).toVar(),o=r.div(s),u=t.greaterThan(0).select(o,Er(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return i.cross(e).mul(u)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),uR=Ie(({N:i,V:e,P:t,mInv:n,p0:r,p1:s,p2:o,p3:u})=>{const c=s.sub(r).toVar(),f=u.sub(r).toVar(),d=c.cross(f),m=Ae().toVar();return Qn(d.dot(t.sub(r)).greaterThanEqual(0),()=>{const g=e.sub(i.mul(e.dot(i))).normalize(),_=i.cross(g).negate(),v=n.mul(nr(g,_,i).transpose()).toVar(),S=v.mul(r.sub(t)).normalize().toVar(),b=v.mul(s.sub(t)).normalize().toVar(),x=v.mul(o.sub(t)).normalize().toVar(),E=v.mul(u.sub(t)).normalize().toVar(),M=Ae(0).toVar();M.addAssign(Pm({v1:S,v2:b})),M.addAssign(Pm({v1:b,v2:x})),M.addAssign(Pm({v1:x,v2:E})),M.addAssign(Pm({v1:E,v2:S})),m.assign(Ae(L9({f:M})))}),m}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),__=1/6,dD=i=>Vt(__,Vt(i,Vt(i,i.negate().add(3)).sub(3)).add(1)),eb=i=>Vt(__,Vt(i,Vt(i,Vt(3,i).sub(6))).add(4)),pD=i=>Vt(__,Vt(i,Vt(i,Vt(-3,i).add(3)).add(3)).add(1)),tb=i=>Vt(__,c_(i,3)),cR=i=>dD(i).add(eb(i)),hR=i=>pD(i).add(tb(i)),fR=i=>ir(-1,eb(i).div(dD(i).add(eb(i)))),dR=i=>ir(1,tb(i).div(pD(i).add(tb(i)))),pR=(i,e,t)=>{const n=i.uvNode,r=Vt(n,e.zw).add(.5),s=Hl(r),o=Yo(r),u=cR(o.x),c=hR(o.x),f=fR(o.x),d=dR(o.x),m=fR(o.y),g=dR(o.y),_=He(s.x.add(f),s.y.add(m)).sub(.5).mul(e.xy),v=He(s.x.add(d),s.y.add(m)).sub(.5).mul(e.xy),S=He(s.x.add(f),s.y.add(g)).sub(.5).mul(e.xy),b=He(s.x.add(d),s.y.add(g)).sub(.5).mul(e.xy),x=cR(o.y).mul(ir(u.mul(i.sample(_).level(t)),c.mul(i.sample(v).level(t)))),E=hR(o.y).mul(ir(u.mul(i.sample(S).level(t)),c.mul(i.sample(b).level(t))));return x.add(E)},U9=Ie(([i,e=Te(3)])=>{const t=He(i.size(kn(e))),n=He(i.size(kn(e.add(1)))),r=Wa(1,t),s=Wa(1,n),o=pR(i,wt(r,t),Hl(e)),u=pR(i,wt(s,n),MS(e));return Yo(e).mix(o,u)}),mR=Ie(([i,e,t,n,r])=>{const s=Ae(O2(e.negate(),md(i),Wa(1,n))),o=Ae(Vo(r[0].xyz),Vo(r[1].xyz),Vo(r[2].xyz));return md(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),O9=Ie(([i,e])=>i.mul(qa(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),B9=J2(),F9=J2(),gR=Ie(([i,e,t],{material:n})=>{const s=(n.side===Tn?B9:F9).sample(i),o=Va(Jx.x).mul(O9(e,t));return U9(s,o)}),_R=Ie(([i,e,t])=>(Qn(t.notEqual(0),()=>{const n=w2(e).negate().div(t);return A2(n.negate().mul(i))}),Ae(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),I9=Ie(([i,e,t,n,r,s,o,u,c,f,d,m,g,_,v])=>{let S,b;if(v){S=wt().toVar(),b=Ae().toVar();const C=d.sub(1).mul(v.mul(.025)),w=Ae(d.sub(C),d,d.add(C));Es({start:0,end:3},({i:N})=>{const L=w.element(N),P=mR(i,e,m,L,u),D=o.add(P),I=f.mul(c.mul(wt(D,1))),j=He(I.xy.div(I.w)).toVar();j.addAssign(1),j.divAssign(2),j.assign(He(j.x,j.y.oneMinus()));const J=gR(j,t,L);S.element(N).assign(J.element(N)),S.a.addAssign(J.a),b.element(N).assign(n.element(N).mul(_R(Vo(P),g,_).element(N)))}),S.a.divAssign(3)}else{const C=mR(i,e,m,d,u),w=o.add(C),N=f.mul(c.mul(wt(w,1))),L=He(N.xy.div(N.w)).toVar();L.addAssign(1),L.divAssign(2),L.assign(He(L.x,L.y.oneMinus())),S=gR(L,t,d),b=n.mul(_R(Vo(C),g,_))}const x=b.rgb.mul(S.rgb),E=i.dot(e).clamp(),M=Ae(fD({dotNV:E,specularColor:r,specularF90:s,roughness:t})),A=b.r.add(b.g,b.b).div(3);return wt(M.oneMinus().mul(x),S.a.oneMinus().mul(A).oneMinus())}),z9=nr(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),k9=i=>{const e=i.sqrt();return Ae(1).add(e).div(Ae(1).sub(e))},vR=(i,e)=>i.sub(e).div(i.add(e)).pow2(),G9=(i,e)=>{const t=i.mul(2*Math.PI*1e-9),n=Ae(54856e-17,44201e-17,52481e-17),r=Ae(1681e3,1795300,2208400),s=Ae(43278e5,93046e5,66121e5),o=Te(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let u=n.mul(s.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return u=Ae(u.x.add(o),u.y,u.z).div(10685e-11),z9.mul(u)},V9=Ie(({outsideIOR:i,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:r})=>{const s=Nn(i,e,Xo(0,.03,n)),u=i.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();Qn(u.lessThan(0),()=>Ae(1));const c=u.sqrt(),f=vR(s,i),d=bd({f0:f,f90:1,dotVH:t}),m=d.oneMinus(),g=s.lessThan(i).select(Math.PI,0),_=Te(Math.PI).sub(g),v=k9(r.clamp(0,.9999)),S=vR(v,s.toVec3()),b=bd({f0:S,f90:1,dotVH:c}),x=Ae(v.x.lessThan(s).select(Math.PI,0),v.y.lessThan(s).select(Math.PI,0),v.z.lessThan(s).select(Math.PI,0)),E=s.mul(n,c,2),M=Ae(_).add(x),A=d.mul(b).clamp(1e-5,.9999),C=A.sqrt(),w=m.pow2().mul(b).div(Ae(1).sub(A)),L=d.add(w).toVar(),P=w.sub(m).toVar();return Es({start:1,end:2,condition:"<=",name:"m"},({m:D})=>{P.mulAssign(C);const I=G9(Te(D).mul(E),Te(D).mul(M)).mul(2);L.addAssign(P.mul(I))}),L.max(Ae(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),H9=Ie(({normal:i,viewDir:e,roughness:t})=>{const n=i.dot(e).saturate(),r=t.pow2(),s=_r(t.lessThan(.25),Te(-339.2).mul(r).add(Te(161.4).mul(t)).sub(25.9),Te(-8.48).mul(r).add(Te(14.3).mul(t)).sub(9.95)),o=_r(t.lessThan(.25),Te(44).mul(r).sub(Te(23.7).mul(t)).add(3.26),Te(1.97).mul(r).sub(Te(3.27).mul(t)).add(.72));return _r(t.lessThan(.25),0,Te(.1).mul(t).sub(.025)).add(s.mul(n).add(o).exp()).mul(1/Math.PI).saturate()}),z0=Ae(.04),k0=Te(1);class mD extends g_{constructor(e=!1,t=!1,n=!1,r=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Ae().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Ae().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Ae().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Ae().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Ae().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=si.dot(zn).clamp();this.iridescenceFresnel=V9({outsideIOR:Te(1),eta2:y2,cosTheta1:t,thinFilmThickness:x2,baseF0:kr}),this.iridescenceF0=R9({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=vd,n=Mj.sub(vd).normalize(),r=LS,s=e.context;s.backdrop=I9(r,n,La,sn,kr,Lg,t,Ql,Za,PS,ug,b2,T2,S2,this.dispersion?E2:null),s.backdropAlpha=Zx,sn.a.mulAssign(Nn(1,s.backdrop.a,Zx))}super.start(e)}computeMultiscattering(e,t,n){const r=si.dot(zn).clamp(),s=hD({roughness:La,dotNV:r}),u=(this.iridescenceF0?TS.mix(kr,this.iridescenceF0):kr).mul(s.x).add(n.mul(s.y)),f=s.x.add(s.y).oneMinus(),d=kr.add(kr.oneMinus().mul(.047619)),m=u.mul(d).div(f.mul(d).oneMinus());e.addAssign(u),t.addAssign(m.mul(f))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=si.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(D9({lightDirection:e}))),this.clearcoat===!0){const u=Nf.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(u.mul(lR({lightDirection:e,f0:z0,f90:k0,roughness:Pg,normalView:Nf})))}n.directDiffuse.addAssign(s.mul(jc({diffuseColor:sn.rgb}))),n.directSpecular.addAssign(s.mul(lR({lightDirection:e,f0:kr,f90:1,roughness:La,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:r,reflectedLight:s,ltc_1:o,ltc_2:u}){const c=t.add(n).sub(r),f=t.sub(n).sub(r),d=t.sub(n).add(r),m=t.add(n).add(r),g=si,_=zn,v=ai.toVar(),S=P9({N:g,V:_,roughness:La}),b=o.sample(S).toVar(),x=u.sample(S).toVar(),E=nr(Ae(b.x,0,b.y),Ae(0,1,0),Ae(b.z,0,b.w)).toVar(),M=kr.mul(x.x).add(kr.oneMinus().mul(x.y)).toVar();s.directSpecular.addAssign(e.mul(M).mul(uR({N:g,V:_,P:v,mInv:E,p0:c,p1:f,p2:d,p3:m}))),s.directDiffuse.addAssign(e.mul(sn).mul(uR({N:g,V:_,P:v,mInv:nr(1,0,0,0,1,0,0,0,1),p0:c,p1:f,p2:d,p3:m})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(jc({diffuseColor:sn})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(hc,H9({normal:si,viewDir:zn,roughness:SS}))),this.clearcoat===!0){const d=Nf.dot(zn).clamp(),m=fD({dotNV:d,specularColor:z0,specularF90:k0,roughness:Pg});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(m))}const s=Ae().toVar("singleScattering"),o=Ae().toVar("multiScattering"),u=n.mul(1/Math.PI);this.computeMultiscattering(s,o,Lg);const c=s.add(o),f=sn.mul(c.r.max(c.g).max(c.b).oneMinus());r.indirectSpecular.addAssign(t.mul(s)),r.indirectSpecular.addAssign(o.mul(u)),r.indirectDiffuse.addAssign(f.mul(u))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,s=si.dot(zn).clamp().add(t),o=La.mul(-16).oneMinus().negate().exp2(),u=t.sub(s.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(u)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=Nf.dot(zn).clamp(),r=bd({dotVH:n,f0:z0,f90:k0}),s=t.mul(Yx.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Yx));t.assign(s)}if(this.sheen===!0){const n=hc.r.max(hc.g).max(hc.b).mul(.157).oneMinus(),r=t.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(r)}}}const yR=Te(1),nb=Te(-2),Lm=Te(.8),G0=Te(-1),Um=Te(.4),V0=Te(2),Om=Te(.305),H0=Te(3),xR=Te(.21),j9=Te(4),bR=Te(4),W9=Te(16),q9=Ie(([i])=>{const e=Ae(ns(i)).toVar(),t=Te(-1).toVar();return Qn(e.x.greaterThan(e.z),()=>{Qn(e.x.greaterThan(e.y),()=>{t.assign(_r(i.x.greaterThan(0),0,3))}).Else(()=>{t.assign(_r(i.y.greaterThan(0),1,4))})}).Else(()=>{Qn(e.z.greaterThan(e.y),()=>{t.assign(_r(i.z.greaterThan(0),2,5))}).Else(()=>{t.assign(_r(i.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),$9=Ie(([i,e])=>{const t=He().toVar();return Qn(e.equal(0),()=>{t.assign(He(i.z,i.y).div(ns(i.x)))}).ElseIf(e.equal(1),()=>{t.assign(He(i.x.negate(),i.z.negate()).div(ns(i.y)))}).ElseIf(e.equal(2),()=>{t.assign(He(i.x.negate(),i.y).div(ns(i.z)))}).ElseIf(e.equal(3),()=>{t.assign(He(i.z.negate(),i.y).div(ns(i.x)))}).ElseIf(e.equal(4),()=>{t.assign(He(i.x.negate(),i.z).div(ns(i.y)))}).Else(()=>{t.assign(He(i.x,i.y).div(ns(i.z)))}),Vt(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),X9=Ie(([i])=>{const e=Te(0).toVar();return Qn(i.greaterThanEqual(Lm),()=>{e.assign(yR.sub(i).mul(G0.sub(nb)).div(yR.sub(Lm)).add(nb))}).ElseIf(i.greaterThanEqual(Um),()=>{e.assign(Lm.sub(i).mul(V0.sub(G0)).div(Lm.sub(Um)).add(G0))}).ElseIf(i.greaterThanEqual(Om),()=>{e.assign(Um.sub(i).mul(H0.sub(V0)).div(Um.sub(Om)).add(V0))}).ElseIf(i.greaterThanEqual(xR),()=>{e.assign(Om.sub(i).mul(j9.sub(H0)).div(Om.sub(xR)).add(H0))}).Else(()=>{e.assign(Te(-2).mul(Va(Vt(1.16,i))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),Y9=Ie(([i,e])=>{const t=i.toVar();t.assign(Vt(2,t).sub(1));const n=Ae(t,1).toVar();return Qn(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),K9=Ie(([i,e,t,n,r,s])=>{const o=Te(t),u=Ae(e),c=qa(X9(o),nb,s),f=Yo(c),d=Hl(c),m=Ae(ib(i,u,d,n,r,s)).toVar();return Qn(f.notEqual(0),()=>{const g=Ae(ib(i,u,d.add(1),n,r,s)).toVar();m.assign(Nn(m,g,f))}),m}),ib=Ie(([i,e,t,n,r,s])=>{const o=Te(t).toVar(),u=Ae(e),c=Te(q9(u)).toVar(),f=Te(Er(bR.sub(o),0)).toVar();o.assign(Er(o,bR));const d=Te(pd(o)).toVar(),m=He($9(u,c).mul(d.sub(2)).add(1)).toVar();return Qn(c.greaterThan(2),()=>{m.y.addAssign(d),c.subAssign(3)}),m.x.addAssign(c.mul(d)),m.x.addAssign(f.mul(Vt(3,W9))),m.y.addAssign(Vt(4,pd(s).sub(d))),m.x.mulAssign(n),m.y.mulAssign(r),i.sample(m).grad(He(),He())}),j0=Ie(({envMap:i,mipInt:e,outputDirection:t,theta:n,axis:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:u})=>{const c=Oo(n),f=t.mul(c).add(r.cross(t).mul(Ss(n))).add(r.mul(r.dot(t).mul(c.oneMinus())));return ib(i,f,e,s,o,u)}),Q9=Ie(({n:i,latitudinal:e,poleAxis:t,outputDirection:n,weights:r,samples:s,dTheta:o,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:m})=>{const g=Ae(_r(e,t,P2(t,n))).toVar();Qn(g.equal(Ae(0)),()=>{g.assign(Ae(n.z,0,n.x.negate()))}),g.assign(md(g));const _=Ae().toVar();return _.addAssign(r.element(0).mul(j0({theta:0,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:m}))),Es({start:kn(1),end:i},({i:v})=>{Qn(v.greaterThanEqual(s),()=>{FW()});const S=Te(o.mul(Te(v))).toVar();_.addAssign(r.element(v).mul(j0({theta:S.mul(-1),axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:m}))),_.addAssign(r.element(v).mul(j0({theta:S,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:m})))}),wt(_,1)}),fc=4,SR=[.125,.215,.35,.446,.526,.582],Bl=20,W0=new Ud(-1,1,1,-1,0,1),Z9=new Ci(90,1),TR=new it;let q0=null,$0=0,X0=0;const Dl=(1+Math.sqrt(5))/2,Zu=1/Dl,ER=[new H(-Dl,Zu,0),new H(Dl,Zu,0),new H(-Zu,0,Dl),new H(Zu,0,Dl),new H(0,Dl,-Zu),new H(0,Dl,Zu),new H(-1,1,-1),new H(1,1,-1),new H(-1,1,1),new H(1,1,1)],J9=new H,gD=new WeakMap,eq=[3,1,5,0,4,2],Y0=Y9(zd(),$a("faceIndex")).normalize(),IS=Ae(Y0.x,Y0.y,Y0.z);class tq{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,r=100,s={}){const{size:o=256,position:u=J9,renderTarget:c=null}=s;if(this._setSize(o),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const d=c||this._allocateTargets();return s.renderTarget=d,this.fromSceneAsync(e,t,n,r,s),d}q0=this._renderer.getRenderTarget(),$0=this._renderer.getActiveCubeFace(),X0=this._renderer.getActiveMipmapLevel();const f=c||this._allocateTargets();return f.depthBuffer=!0,this._sceneToCubeUV(e,n,r,f,u),t>0&&this._blur(f,0,0,t),this._applyPMREM(f),this._cleanup(f),f}async fromSceneAsync(e,t=0,n=.1,r=100,s={}){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,n,r,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=AR(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=wR(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===os||e.mapping===ls?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(q0,$0,X0),e.scissorTest=!1,Bm(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),q0=this._renderer.getRenderTarget(),$0=this._renderer.getActiveCubeFace(),X0=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:gi,minFilter:gi,generateMipmaps:!1,type:Xi,format:qn,colorSpace:qs},r=MR(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=MR(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=nq(s)),this._blurMaterial=iq(s,e,t)}return r}async _compileMaterial(e){const t=new oi(this._lodPlanes[0],e);await this._renderer.compile(t,W0)}_sceneToCubeUV(e,t,n,r,s){const o=Z9;o.near=t,o.far=n;const u=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],f=this._renderer,d=f.autoClear;f.getClearColor(TR),f.autoClear=!1;let m=this._backgroundBox;if(m===null){const v=new Gs({name:"PMREM.Background",side:Tn,depthWrite:!1,depthTest:!1});m=new oi(new tu,v)}let g=!1;const _=e.background;_?_.isColor&&(m.material.color.copy(_),e.background=null,g=!0):(m.material.color.copy(TR),g=!0),f.setRenderTarget(r),f.clear(),g&&f.render(m,o);for(let v=0;v<6;v++){const S=v%3;S===0?(o.up.set(0,u[v],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x+c[v],s.y,s.z)):S===1?(o.up.set(0,0,u[v]),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y+c[v],s.z)):(o.up.set(0,u[v],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y,s.z+c[v]));const b=this._cubeSize;Bm(r,S*b,v>2?b:0,b,b),f.render(e,o)}f.autoClear=d,e.background=_}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===os||e.mapping===ls;r?this._cubemapMaterial===null&&(this._cubemapMaterial=AR(e)):this._equirectMaterial===null&&(this._equirectMaterial=wR(e));const s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const u=this._cubeSize;Bm(t,0,0,3*u,2*u),n.setRenderTarget(t),n.render(o,W0)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),u=ER[(r-s-1)%ER.length];this._blur(e,s-1,s,o,u)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,u){const c=this._renderer,f=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,m=this._lodMeshes[r];m.material=f;const g=gD.get(f),_=this._sizeLods[n]-1,v=isFinite(s)?Math.PI/(2*_):2*Math.PI/(2*Bl-1),S=s/v,b=isFinite(s)?1+Math.floor(d*S):Bl;b>Bl&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${Bl}`);const x=[];let E=0;for(let N=0;N<Bl;++N){const L=N/S,P=Math.exp(-L*L/2);x.push(P),N===0?E+=P:N<b&&(E+=2*P)}for(let N=0;N<x.length;N++)x[N]=x[N]/E;e.texture.frame=(e.texture.frame||0)+1,g.envMap.value=e.texture,g.samples.value=b,g.weights.array=x,g.latitudinal.value=o==="latitudinal"?1:0,u&&(g.poleAxis.value=u);const{_lodMax:M}=this;g.dTheta.value=v,g.mipInt.value=M-n;const A=this._sizeLods[r],C=3*A*(r>M-fc?r-M+fc:0),w=4*(this._cubeSize-A);Bm(t,C,w,3*A,2*A),c.setRenderTarget(t),c.render(m,W0)}}function nq(i){const e=[],t=[],n=[],r=[];let s=i;const o=i-fc+1+SR.length;for(let u=0;u<o;u++){const c=Math.pow(2,s);t.push(c);let f=1/c;u>i-fc?f=SR[u-i+fc-1]:u===0&&(f=0),n.push(f);const d=1/(c-2),m=-d,g=1+d,_=[m,m,g,m,g,g,m,m,g,g,m,g],v=6,S=6,b=3,x=2,E=1,M=new Float32Array(b*S*v),A=new Float32Array(x*S*v),C=new Float32Array(E*S*v);for(let N=0;N<v;N++){const L=N%3*2/3-1,P=N>2?0:-1,D=[L,P,0,L+2/3,P,0,L+2/3,P+1,0,L,P,0,L+2/3,P+1,0,L,P+1,0],I=eq[N];M.set(D,b*S*I),A.set(_,x*S*I);const j=[I,I,I,I,I,I];C.set(j,E*S*I)}const w=new rr;w.setAttribute("position",new Fi(M,b)),w.setAttribute("uv",new Fi(A,x)),w.setAttribute("faceIndex",new Fi(C,E)),e.push(w),r.push(new oi(w,null)),s>fc&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n,lodMeshes:r}}function MR(i,e,t){const n=new Jl(i,e,t);return n.texture.mapping=Wl,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function Bm(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function zS(i){const e=new xi;return e.depthTest=!1,e.depthWrite=!1,e.blending=br,e.name=`PMREM_${i}`,e}function iq(i,e,t){const n=Vs(new Array(Bl).fill(0)),r=Rt(new H(0,1,0)),s=Rt(0),o=Te(Bl),u=Rt(0),c=Rt(1),f=Jt(null),d=Rt(0),m=Te(1/e),g=Te(1/t),_=Te(i),v={n:o,latitudinal:u,weights:n,poleAxis:r,outputDirection:IS,dTheta:s,samples:c,envMap:f,mipInt:d,CUBEUV_TEXEL_WIDTH:m,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:_},S=zS("blur");return S.fragmentNode=Q9({...v,latitudinal:u.equal(1)}),gD.set(S,v),S}function AR(i){const e=zS("cubemap");return e.fragmentNode=yd(i,IS),e}function wR(i){const e=zS("equirect");return e.fragmentNode=Jt(i,rD(IS),0),e}const RR=new WeakMap;function rq(i){const e=Math.log2(i)-2,t=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function sq(i,e,t){const n=aq(e);let r=n.get(i);if((r!==void 0?r.pmremVersion:-1)!==i.pmremVersion){const o=i.image;if(i.isCubeTexture)if(lq(o))r=t.fromCubemap(i,r);else return null;else if(uq(o))r=t.fromEquirectangular(i,r);else return null;r.pmremVersion=i.pmremVersion,n.set(i,r)}return r.texture}function aq(i){let e=RR.get(i);return e===void 0&&(e=new WeakMap,RR.set(i,e)),e}class oq extends Zn{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const r=new _i;r.isRenderTargetTexture=!0,this._texture=Jt(r),this._width=Rt(0),this._height=Rt(0),this._maxMip=Rt(0),this.updateBeforeType=It.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=rq(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(r.isPMREMTexture===!0?t=r:t=sq(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new tq(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=q2.mul(Ae(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),K9(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function lq(i){if(i==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)i[n]!==void 0&&e++;return e===t}function uq(i){return i==null?!1:i.height>0}const _D=Le(oq).setParameterLength(1,3),CR=new WeakMap;class cq extends ih{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const m=n.isTextureNode?n.value:t[n.property];let g=CR.get(m);g===void 0&&(g=_D(m),CR.set(m,g)),n=g}const s=t.useAnisotropy===!0||t.anisotropy>0?Hj:si,o=n.context(NR(La,s)).mul(O0),u=n.context(hq(LS)).mul(Math.PI).mul(O0),c=hg(o),f=hg(u);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(f);const d=e.context.lightingModel.clearcoatRadiance;if(d){const m=n.context(NR(Pg,Nf)).mul(O0),g=hg(m);d.addAssign(g)}}}const NR=(i,e)=>{let t=null;return{getUV:()=>(t===null&&(t=zn.negate().reflect(e),t=i.mul(i).mix(t,e).normalize(),t=t.transformDirection(Za)),t),getTextureLevel:()=>i}},hq=i=>({getUV:()=>i,getTextureLevel:()=>Te(1)}),fq=new pN;class vD extends xi{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(fq),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new cq(t):null}setupLightingModel(){return new mD}setupSpecular(){const e=Nn(Ae(.04),sn.rgb,Dg);kr.assign(e),Lg.assign(1)}setupVariants(){const e=this.metalnessNode?Te(this.metalnessNode):iW;Dg.assign(e);let t=this.roughnessNode?Te(this.roughnessNode):nW;t=cD({roughness:t}),La.assign(t),this.setupSpecular(),sn.assign(wt(sn.rgb.mul(e.oneMinus()),sn.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const dq=new xF;class pq extends vD{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(dq),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?Te(this.iorNode):_W;ug.assign(e),kr.assign(Nn(gd(L2(ug.sub(1).div(ug.add(1))).mul(tW),Ae(1)).mul(nR),sn.rgb,Dg)),Lg.assign(Nn(nR,1,Dg))}setupLightingModel(){return new mD(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?Te(this.clearcoatNode):sW,n=this.clearcoatRoughnessNode?Te(this.clearcoatRoughnessNode):aW;Yx.assign(t),Pg.assign(cD({roughness:n}))}if(this.useSheen){const t=this.sheenNode?Ae(this.sheenNode):uW,n=this.sheenRoughnessNode?Te(this.sheenRoughnessNode):cW;hc.assign(t),SS.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?Te(this.iridescenceNode):fW,n=this.iridescenceIORNode?Te(this.iridescenceIORNode):dW,r=this.iridescenceThicknessNode?Te(this.iridescenceThicknessNode):pW;TS.assign(t),y2.assign(n),x2.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?He(this.anisotropyNode):hW).toVar();Nl.assign(t.length()),Qn(Nl.equal(0),()=>{t.assign(He(1,0))}).Else(()=>{t.divAssign(He(Nl)),Nl.assign(Nl.saturate())}),Kx.assign(Nl.pow2().mix(La.pow2(),1)),lg.assign(Df[0].mul(t.x).add(Df[1].mul(t.y))),xc.assign(Df[1].mul(t.x).sub(Df[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?Te(this.transmissionNode):mW,n=this.thicknessNode?Te(this.thicknessNode):gW,r=this.attenuationDistanceNode?Te(this.attenuationDistanceNode):vW,s=this.attenuationColorNode?Ae(this.attenuationColorNode):yW;if(Zx.assign(t),b2.assign(n),S2.assign(r),T2.assign(s),this.useDispersion){const o=this.dispersionNode?Te(this.dispersionNode):MW;E2.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Ae(this.clearcoatNormalNode):oW}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const mq=Ie(({normal:i,lightDirection:e,builder:t})=>{const n=i.dot(e),r=He(n.mul(.5).add(.5),0);if(t.material.gradientMap){const s=Bo("gradientMap","texture").context({getUV:()=>r});return Ae(s.r)}else{const s=r.fwidth().mul(.5);return Nn(Ae(.7),Ae(1),Xo(Te(.7).sub(s.x),Te(.7).add(s.x),r.x))}});class gq extends g_{direct({lightDirection:e,lightColor:t,reflectedLight:n},r){const s=mq({normal:H2,lightDirection:e,builder:r}).mul(t);n.directDiffuse.addAssign(s.mul(jc({diffuseColor:sn.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(jc({diffuseColor:sn}))),r.indirectDiffuse.mulAssign(t)}}const _q=new SF;class vq extends xi{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(_q),this.setValues(e)}setupLightingModel(){return new gq}}class yq extends Zn{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=Ae(zn.z,0,zn.x.negate()).normalize(),t=zn.cross(e);return He(e.dot(si),t.dot(si)).mul(.495).add(.5)}}const xq=Ge(yq),bq=new AF;class Sq extends xi{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(bq),this.setValues(e)}setupVariants(e){const t=xq;let n;e.material.matcap?n=Bo("matcap","texture").context({getUV:()=>t}):n=Ae(Nn(.2,.8,t.y)),sn.rgb.mulAssign(n.rgb)}}class Tq extends Zn{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return xS(s,o,o.negate(),s).mul(n)}else{const s=t,o=yc(wt(1,0,0,0),wt(0,Oo(s.x),Ss(s.x).negate(),0),wt(0,Ss(s.x),Oo(s.x),0),wt(0,0,0,1)),u=yc(wt(Oo(s.y),0,Ss(s.y),0),wt(0,1,0,0),wt(Ss(s.y).negate(),0,Oo(s.y),0),wt(0,0,0,1)),c=yc(wt(Oo(s.z),Ss(s.z).negate(),0,0),wt(Ss(s.z),Oo(s.z),0,0),wt(0,0,1,0),wt(0,0,0,1));return o.mul(u).mul(c).mul(wt(n,1)).xyz}}}const yD=Le(Tq).setParameterLength(2),Eq=new K3;class xD extends xi{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(Eq),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,r=this.sizeAttenuation,{positionNode:s,rotationNode:o,scaleNode:u}=this,c=f_.mul(Ae(s||0));let f=He(Ql[0].xyz.length(),Ql[1].xyz.length());if(u!==null&&(f=f.mul(He(u))),r===!1)if(n.isPerspectiveCamera)f=f.mul(c.z.negate());else{const _=Te(2).div(PS.element(1).element(1));f=f.mul(_.mul(2))}let d=d_.xy;if(t.center&&t.center.isVector2===!0){const _=J8("center","vec2",t);d=d.sub(_.sub(.5))}d=d.mul(f);const m=Te(o||lW),g=yD(d,m);return wt(c.xy.add(g),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const Mq=new nF;class Aq extends xD{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Mq),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return f_.mul(Ae(e||$i)).xyz}setupVertex(e){const t=super.setupVertex(e);if(e.material.isNodeMaterial!==!0)return t;const{rotationNode:n,scaleNode:r,sizeNode:s}=this,o=d_.xy.toVar(),u=Vf.z.div(Vf.w);if(n&&n.isNode){const f=Te(n);o.assign(yD(o,f))}let c=s!==null?He(s):EW;return this.sizeAttenuation===!0&&(c=c.mul(c.div(ai.z.negate()))),r&&r.isNode&&(c=c.mul(He(r))),o.mulAssign(c.mul(2)),o.assign(o.div(Vf.z)),o.y.assign(o.y.mul(u)),o.assign(o.mul(t.w)),t.addAssign(wt(o,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class wq extends g_{constructor(){super(),this.shadowNode=Te(1).toVar("shadowMask")}direct({lightNode:e}){this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){sn.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(sn.rgb)}}const Rq=new yF;class Cq extends xi{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(Rq),this.setValues(e)}setupLightingModel(){return new wq}}Fd("vec3");Fd("vec3");Fd("vec3");class Nq{constructor(e,t){this.nodes=e,this.info=t,this._context=self,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Ks{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let r=0;r<e.length-1;r++){const s=e[r];n.has(s)===!1&&n.set(s,new WeakMap),n=n.get(s)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let Dq=0;function Pq(i){const e=Object.keys(i);let t=Object.getPrototypeOf(i);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const r in n)if(n[r]!==void 0){const s=n[r];s&&typeof s.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class Lq{constructor(e,t,n,r,s,o,u,c,f,d){this.id=Dq++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=s,this.scene=o,this.camera=u,this.lightsNode=c,this.context=f,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=d,this.clippingContextCacheKey=d!==null?d.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set;for(const s of e){const o=s.node&&s.node.attribute?s.node.attribute:t.getAttribute(s.name);if(o===void 0)continue;n.push(o);const u=o.isInterleavedBufferAttribute?o.data:o;r.add(u)}return this.attributes=n,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:r,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),u=this.getIndex(),c=u!==null,f=n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1;if(f===0)return null;if(o.instanceCount=f,e.isBatchedMesh===!0)return o;let d=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(d=2);let m=s.start*d,g=(s.start+s.count)*d;r!==null&&(m=Math.max(m,r.start*d),g=Math.min(g,(r.start+r.count)*d));const _=n.attributes.position;let v=1/0;c?v=u.count:_!=null&&(v=_.count),m=Math.max(m,0),g=Math.min(g,v);const S=g-m;return S<0||S===1/0?null:(o.vertexCount=S,o.firstVertex=m,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const r=e.attributes[n];t+=n+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[n];t+="morph-"+n+",";for(let s=0,o=r.length;s<o;s++){const u=r[s];t+=u.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let n=t.customProgramCacheKey();for(const r of Pq(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const s=t[r];let o;if(s!==null){const u=typeof s;u==="number"?o=s!==0?"1":"0":u==="object"?(o="{",s.isTexture&&(o+=s.mapping),o+="}"):o=String(s)}else o=String(s);n+=o+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),n+=e.receiveShadow+",",e6(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=dd(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=dd(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Ml=[];class Uq{constructor(e,t,n,r,s,o){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,n,r,s,o,u,c){const f=this.getChainMap(c);Ml[0]=e,Ml[1]=t,Ml[2]=o,Ml[3]=s;let d=f.get(Ml);return d===void 0?(d=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,s,o,u,c),f.set(Ml,d)):(d.updateClipping(u),d.needsGeometryUpdate&&d.setGeometry(e.geometry),(d.version!==t.version||d.needsUpdate)&&(d.initialCacheKey!==d.getCacheKey()?(d.dispose(),d=this.get(e,t,n,r,s,o,u,c)):d.version=t.version)),Ml.length=0,d}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Ks)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,s,o,u,c,f,d,m){const g=this.getChainMap(m),_=new Lq(e,t,n,r,s,o,u,c,f,d);return _.onDispose=()=>{this.pipelines.delete(_),this.bindings.delete(_),this.nodes.delete(_),g.delete(_.getChainArray())},_}}class Ko{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const is={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Fo=16,Oq=211,Bq=212;class Fq extends Ko{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===is.VERTEX?this.backend.createAttribute(e):t===is.INDEX?this.backend.createIndexAttribute(e):t===is.STORAGE?this.backend.createStorageAttribute(e):t===is.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(n.version<r.version||r.usage===oc)&&(this.backend.updateAttribute(e),n.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function bD(i){return i.index!==null?i.index.version:i.attributes.position.version}function DR(i){const e=[],t=i.index,n=i.attributes.position;if(t!==null){const s=t.array;for(let o=0,u=s.length;o<u;o+=3){const c=s[o+0],f=s[o+1],d=s[o+2];e.push(c,f,f,d,d,c)}}else{const s=n.array;for(let o=0,u=s.length/3-1;o<u;o+=3){const c=o+0,f=o+1,d=o+2;e.push(c,f,f,d,d,c)}}const r=new(Yb(e)?eS:Jb)(e,1);return r.version=bD(i),r}class Iq extends Ko{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const c of o)this.attributes.delete(c);const u=this.wireframes.get(t);u!==void 0&&this.attributes.delete(u),t.removeEventListener("dispose",r)};t.addEventListener("dispose",r)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,is.STORAGE):this.updateAttribute(s,is.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,is.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,is.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let r=t.index;if(n.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=DR(t),s.set(t,o)):o.version!==bD(t)&&(this.attributes.delete(o),o=DR(t),s.set(t,o)),r=o}return r}}class zq{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class SD{constructor(e){this.cacheKey=e,this.usedTimes=0}}class kq extends SD{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class Gq extends SD{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let Vq=0;class K0{constructor(e,t,n,r=null,s=null){this.id=Vq++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=s,this.usedTimes=0}}class Hq extends Ko{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let u=this.programs.compute.get(o.computeShader);u===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),u=new K0(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,u),n.createProgram(u));const c=this._getComputeCacheKey(e,u);let f=this.caches.get(c);f===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),f=this._getComputePipeline(e,u,c,t)),f.usedTimes++,u.usedTimes++,r.version=e.version,r.pipeline=f}return r.pipeline}getForRender(e,t=null){const{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),u=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),c=new K0(o.vertexShader,"vertex",u),this.programs.vertex.set(o.vertexShader,c),n.createProgram(c));let f=this.programs.fragment.get(o.fragmentShader);f===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),f=new K0(o.fragmentShader,"fragment",u),this.programs.fragment.set(o.fragmentShader,f),n.createProgram(f));const d=this._getRenderCacheKey(e,c,f);let m=this.caches.get(d);m===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),m=this._getRenderPipeline(e,c,f,d,t)):e.pipeline=m,m.usedTimes++,c.usedTimes++,f.usedTimes++,r.pipeline=m}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n=n||this._getComputeCacheKey(e,t);let s=this.caches.get(n);return s===void 0&&(s=new Gq(n,t),this.caches.set(n,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,t,n,r,s){r=r||this._getRenderCacheKey(e,t,n);let o=this.caches.get(r);return o===void 0&&(o=new kq(r,t,n),this.caches.set(r,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class jq extends Ko{constructor(e,t,n,r,s,o){super(),this.backend=e,this.textures=n,this.pipelines=s,this.attributes=r,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const n=t.attribute,r=n.isIndirectStorageBufferAttribute?is.INDIRECT:is.STORAGE;this.attributes.update(n,r)}}_update(e,t){const{backend:n}=this;let r=!1,s=!0,o=0,u=0;for(const c of e.bindings)if(!(c.isNodeUniformsGroup&&this.nodes.updateGroup(c)===!1)){if(c.isStorageBuffer){const f=c.attribute,d=f.isIndirectStorageBufferAttribute?is.INDIRECT:is.STORAGE;this.attributes.update(f,d)}if(c.isUniformBuffer)c.update()&&n.updateBinding(c);else if(c.isSampler)c.update();else if(c.isSampledTexture){const f=this.textures.get(c.texture);c.needsBindingsUpdate(f.generation)&&(r=!0);const d=c.update(),m=c.texture;d&&this.textures.updateTexture(m);const g=n.get(m);if(g.externalTexture!==void 0||f.isDefaultTexture?s=!1:(o=o*10+m.id,u+=m.version),n.isWebGPUBackend===!0&&g.texture===void 0&&g.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",c,d,m,c.textureNode.value,r),this.textures.updateTexture(m),r=!0),m.isStorageTexture===!0){const _=this.get(m);c.store===!0?_.needsMipmap=!0:this.textures.needsMipmaps(m)&&_.needsMipmap===!0&&(this.backend.generateMipmaps(m),_.needsMipmap=!1)}}}r===!0&&this.backend.updateBindings(e,t,s?o:0,u)}}function Wq(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function PR(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function LR(i){return(i.transmission>0||i.transmissionNode)&&i.side===Ji&&i.forceSinglePass===!1}class qq{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,s,o,u){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:s,group:o,clippingContext:u},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=n,c.groupOrder=r,c.renderOrder=e.renderOrder,c.z=s,c.group=o,c.clippingContext=u),this.renderItemsIndex++,c}push(e,t,n,r,s,o,u){const c=this.getNextRenderItem(e,t,n,r,s,o,u);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0?(LR(n)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,n,r,s,o,u){const c=this.getNextRenderItem(e,t,n,r,s,o,u);n.transparent===!0||n.transmission>0?(LR(n)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||Wq),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||PR),this.transparent.length>1&&this.transparent.sort(t||PR)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const vf=[];class $q{constructor(e){this.lighting=e,this.lists=new Ks}get(e,t){const n=this.lists;vf[0]=e,vf[1]=t;let r=n.get(vf);return r===void 0&&(r=new qq(this.lighting,e,t),n.set(vf,r)),vf.length=0,r}dispose(){this.lists=new Ks}}let Xq=0;class Yq{constructor(){this.id=Xq++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new xt,this.scissor=!1,this.scissorValue=new xt,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return TD(this)}}function TD(i){const{textures:e,activeCubeFace:t}=i,n=[t];for(const r of e)n.push(r.id);return mS(n)}const yf=[],Kq=new Kg,Qq=new tS;class Zq{constructor(){this.chainMaps={}}get(e,t,n=null){yf[0]=e,yf[1]=t;let r;if(n===null)r="default";else{const u=n.texture.format;r=`${n.textures.length}:${u}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const s=this._getChainMap(r);let o=s.get(yf);return o===void 0&&(o=new Yq,s.set(yf,o)),yf.length=0,n!==null&&(o.sampleCount=n.samples===0?1:n.samples),o}getForClear(e=null){return this.get(Kq,Qq,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Ks)}dispose(){this.chainMaps={}}}const Jq=new H;class e$ extends Ko{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),r=e.samples===0?1:e.samples,s=n.depthTextureMips||(n.depthTextureMips={}),o=e.textures,u=this.getSize(o[0]),c=u.width>>t,f=u.height>>t;let d=e.depthTexture||s[t];const m=e.depthBuffer===!0||e.stencilBuffer===!0;let g=!1;d===void 0&&m&&(d=new ss,d.format=e.stencilBuffer?Wr:jr,d.type=e.stencilBuffer?Hr:Sn,d.image.width=c,d.image.height=f,s[t]=d),(n.width!==u.width||u.height!==n.height)&&(g=!0,d&&(d.needsUpdate=!0,d.image.width=c,d.image.height=f)),n.width=u.width,n.height=u.height,n.textures=o,n.depthTexture=d||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(g=!0,d&&(d.needsUpdate=!0),n.sampleCount=r);const _={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let v=0;v<o.length;v++){const S=o[v];g&&(S.needsUpdate=!0),this.updateTexture(S,_)}d&&this.updateTexture(d,_)}if(n.initialized!==!0){n.initialized=!0;const v=()=>{e.removeEventListener("dispose",v);for(let S=0;S<o.length;S++)this._destroyTexture(o[S]);d&&this._destroyTexture(d),this.delete(e)};e.addEventListener("dispose",v)}}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&n.initialized===!0&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){const f=this.renderer.getRenderTarget();f?e.type=f.texture.type:e.type=Wn}const{width:o,height:u,depth:c}=this.getSize(e);if(t.width=o,t.height=u,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,u):1,r||e.isStorageTexture===!0)s.createSampler(e),s.createTexture(e,t),n.generation=e.version;else if(n.initialized!==!0&&s.createSampler(e),e.version>0){const d=e.image;if(d===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(d.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const m=[];for(const g of e.images)m.push(g);t.images=m}else t.image=d;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(s.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&s.generateMipmaps(e)}}else s.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(n.initialized!==!0){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const f=()=>{e.removeEventListener("dispose",f),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",f)}n.version=e.version}getSize(e,t=Jq){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return e.isCompressedTexture?e.mipmaps?r=e.mipmaps.length:r=1:r=Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return this.isEnvironmentTexture(e)||e.isCompressedTexture===!0||e.generateMipmaps}isEnvironmentTexture(e){const t=e.mapping;return t===jo||t===Wo||t===os||t===ls}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class kS extends it{constructor(e,t,n,r=1){super(e,t,n),this.a=r}set(e,t,n,r=1){return this.a=r,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class t$ extends ln{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class n$ extends Dt{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const n=new og(t);return this._currentCond=_r(e,n),this.add(this._currentCond)}ElseIf(e,t){const n=new og(t),r=_r(e,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new og(e),this}build(e,...t){const n=m2();Cg(this);for(const r of this.nodes)r.build(e,"void");return Cg(n),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("THREE.TSL: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("THREE.TSL: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const Q0=Le(n$).setParameterLength(0,1);new bs;new H;new H;new H;new qt;new H(0,0,-1);new xt;new H;new H;new xt;new Oe;const i$=new Jl;xd.flipX();i$.depthTexture=new ss(1,1);const Z0=new Ud(-1,1,1,-1,0,1);class r$ extends rr{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Kn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Kn(t,2))}}const s$=new r$;class ED extends oi{constructor(e=null){super(s$,e),this.camera=Z0,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,Z0)}render(e){e.render(this,Z0)}}const xf=new Tr,J0=new qt;class yr extends Dt{static get type(){return"SceneNode"}constructor(e=yr.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let r;return t===yr.BACKGROUND_BLURRINESS?r=bn("backgroundBlurriness","float",n):t===yr.BACKGROUND_INTENSITY?r=bn("backgroundIntensity","float",n):t===yr.BACKGROUND_ROTATION?r=Rt("mat4").label("backgroundRotation").setGroup(Tt).onRenderUpdate(()=>{const s=n.background;return s!==null&&s.isTexture&&s.mapping!==Bb?(xf.copy(n.backgroundRotation),xf.x*=-1,xf.y*=-1,xf.z*=-1,J0.makeRotationFromEuler(xf)):J0.identity(),J0}):console.error("THREE.SceneNode: Unknown scope:",t),r}}yr.BACKGROUND_BLURRINESS="backgroundBlurriness";yr.BACKGROUND_INTENSITY="backgroundIntensity";yr.BACKGROUND_ROTATION="backgroundRotation";const a$=Ge(yr,yr.BACKGROUND_BLURRINESS),UR=Ge(yr,yr.BACKGROUND_INTENSITY),o$=Ge(yr,yr.BACKGROUND_ROTATION);Ie(({texture:i,uv:e})=>{const n=Ae().toVar();return Qn(e.x.lessThan(1e-4),()=>{n.assign(Ae(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(Ae(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(Ae(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(Ae(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(Ae(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(Ae(0,0,-1))}).Else(()=>{const s=i.sample(e.add(Ae(-.01,0,0))).r.sub(i.sample(e.add(Ae(.01,0,0))).r),o=i.sample(e.add(Ae(0,-.01,0))).r.sub(i.sample(e.add(Ae(0,.01,0))).r),u=i.sample(e.add(Ae(0,0,-.01))).r.sub(i.sample(e.add(Ae(0,0,.01))).r);n.assign(Ae(s,o,u))}),n.normalize()});const Fm=new Oe;class l$ extends kd{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class OR extends l${static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class v_ extends Zn{static get type(){return"PassNode"}constructor(e,t,n,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new ss;s.isRenderTargetTexture=!0,s.name="depth";const o=new Jl(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Xi,...r});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Rt(0),this._cameraFar=Rt(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=It.FRAME}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=Fe(new OR(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=Fe(new OR(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=eD(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=Hf(s,n,r)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.texture.type=e.getColorBufferType(),this.scope===v_.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,s;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(s=1,r=t.xr.getCamera(),t.xr.updateCamera(r),Fm.set(o.width,o.height)):(r=this.camera,s=t.getPixelRatio(),t.getSize(Fm)),this._pixelRatio=s,this.setSize(Fm.width,Fm.height);const u=t.getRenderTarget(),c=t.getMRT(),f=r.layers.mask;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const d in this._previousTextures)this.toggleTexture(d);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(n,r),t.setRenderTarget(u),t.setMRT(c),r.layers.mask=f}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio*this._resolution,r=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}v_.COLOR="color";v_.DEPTH="depth";const u$=Ie(([i,e])=>i.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),c$=Ie(([i,e])=>(i=i.mul(e),i.div(i.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),h$=Ie(([i,e])=>{i=i.mul(e),i=i.sub(.004).max(0);const t=i.mul(i.mul(6.2).add(.5)),n=i.mul(i.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),f$=Ie(([i])=>{const e=i.mul(i.add(.0245786)).sub(90537e-9),t=i.mul(i.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),d$=Ie(([i,e])=>{const t=nr(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=nr(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return i=i.mul(e).div(.6),i=t.mul(i),i=f$(i),i=n.mul(i),i.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),p$=nr(Ae(1.6605,-.1246,-.0182),Ae(-.5876,1.1329,-.1006),Ae(-.0728,-.0083,1.1187)),m$=nr(Ae(.6274,.0691,.0164),Ae(.3293,.9195,.088),Ae(.0433,.0113,.8956)),g$=Ie(([i])=>{const e=Ae(i).toVar(),t=Ae(e.mul(e)).toVar(),n=Ae(t.mul(t)).toVar();return Te(15.5).mul(n.mul(t)).sub(Vt(40.14,n.mul(e))).add(Vt(31.96,n).sub(Vt(6.868,t.mul(e))).add(Vt(.4298,t).add(Vt(.1191,e).sub(.00232))))}),_$=Ie(([i,e])=>{const t=Ae(i).toVar(),n=nr(Ae(.856627153315983,.137318972929847,.11189821299995),Ae(.0951212405381588,.761241990602591,.0767994186031903),Ae(.0482516061458583,.101439036467562,.811302368396859)),r=nr(Ae(1.1271005818144368,-.1413297634984383,-.14132976349843826),Ae(-.11060664309660323,1.157823702216272,-.11060664309660294),Ae(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=Te(-12.47393),o=Te(4.026069);return t.mulAssign(e),t.assign(m$.mul(t)),t.assign(n.mul(t)),t.assign(Er(t,1e-10)),t.assign(Va(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(qa(t,0,1)),t.assign(g$(t)),t.assign(r.mul(t)),t.assign(c_(Er(Ae(0),t),Ae(2.2))),t.assign(p$.mul(t)),t.assign(qa(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),v$=Ie(([i,e])=>{const t=Te(.76),n=Te(.15);i=i.mul(e);const r=gd(i.r,gd(i.g,i.b)),s=_r(r.lessThan(.08),r.sub(Vt(6.25,r.mul(r))),.04);i.subAssign(s);const o=Er(i.r,Er(i.g,i.b));Qn(o.lessThan(t),()=>i);const u=pr(1,t),c=pr(1,u.mul(u).div(o.add(u.sub(t))));i.mulAssign(c.div(o));const f=pr(1,Wa(1,n.mul(o.sub(c)).add(1)));return Nn(i,Ae(c),f)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class mi extends Dt{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.code=e,this.includes=t,this.language=n}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class y$ extends mi{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),r=n.name,s=n.type,o=e.getCodeFromNode(this,s);r!==""&&(o.name=r);const u=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(u);return o.code=c+`
`,t==="property"?u:e.format(`${u}()`,s,t)}}function MD(i){let e;const t=i.context.getViewZ;return t!==void 0&&(e=t(this)),(e||ai.z).negate()}const x$=Ie(([i,e],t)=>{const n=MD(t);return Xo(i,e,n)}),b$=Ie(([i],e)=>{const t=MD(e);return i.mul(i,t,t).negate().exp().oneMinus()}),BR=Ie(([i,e])=>wt(e.toFloat().mix(kf.rgb,i.toVec3()),kf.a));class S$ extends Dt{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}Le(S$);class Js extends Zn{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=this.method,n=this.getNodeType(e),r=this.getInputType(e),s=this.pointerNode,o=this.valueNode,u=[];u.push(`&${s.build(e,r)}`),o!==null&&u.push(o.build(e,r));const c=`${e.getMethod(t,n)}( ${u.join(", ")} )`;return o!==null&&e.addLineFlowCode(c,this),c}}Js.ATOMIC_LOAD="atomicLoad";Js.ATOMIC_STORE="atomicStore";Js.ATOMIC_ADD="atomicAdd";Js.ATOMIC_SUB="atomicSub";Js.ATOMIC_MAX="atomicMax";Js.ATOMIC_MIN="atomicMin";Js.ATOMIC_AND="atomicAnd";Js.ATOMIC_OR="atomicOr";Js.ATOMIC_XOR="atomicXor";Le(Js);let Im;function y_(i){Im=Im||new WeakMap;let e=Im.get(i);return e===void 0&&Im.set(i,e={}),e}function AD(i){const e=y_(i);return e.shadowMatrix||(e.shadowMatrix=Rt("mat4").setGroup(Tt).onRenderUpdate(()=>(i.castShadow!==!0&&i.shadow.updateMatrices(i),i.shadow.matrix)))}function T$(i,e=vd){const t=AD(i).mul(e);return t.xyz.div(t.w)}function wD(i){const e=y_(i);return e.position||(e.position=Rt(new H).setGroup(Tt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.matrixWorld)))}function E$(i){const e=y_(i);return e.targetPosition||(e.targetPosition=Rt(new H).setGroup(Tt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.target.matrixWorld)))}function RD(i){const e=y_(i);return e.viewPosition||(e.viewPosition=Rt(new H).setGroup(Tt).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new H,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const CD=i=>Za.transformDirection(wD(i).sub(E$(i))),M$=i=>i.sort((e,t)=>e.id-t.id),A$=(i,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===i)return t;return null},ex=new WeakMap;class ND extends Dt{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Ae().toVar(),this.totalSpecularNode=Ae().toVar(),this.outgoingLightNode=Ae().toVar(),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=[],t=this._lights;for(let n=0;n<t.length;n++)e.push(t[n].id);return mS(e)}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getDataFromNode(this);for(const n of t.nodes)n.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,r=M$(this._lights),s=e.renderer.library;for(const o of r)if(o.isNode)t.push(Fe(o));else{let u=null;if(n!==null&&(u=A$(o.id,n)),u===null){const c=s.getLightNodeClass(o.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let f=null;ex.has(o)?f=ex.get(o):(f=Fe(new c(o)),ex.set(o,f)),t.push(f)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.direct({...n,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.directRectArea({...n,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const r=e.context,s=r.lightingModel,o=e.getDataFromNode(this);if(s){const{totalDiffuseNode:u,totalSpecularNode:c}=this;r.outgoingLight=n;const f=e.addStack();o.nodes=f.nodes,s.start(e);const{backdrop:d,backdropAlpha:m}=r,{directDiffuse:g,directSpecular:_,indirectDiffuse:v,indirectSpecular:S}=r.reflectedLight;let b=g.add(v);d!==null&&(m!==null?b=Ae(m.mix(b,d)):b=Ae(d),r.material.transparent=!0),u.assign(b),c.assign(_.add(S)),n.assign(u.add(c)),s.finish(e),n=n.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class w$ extends Dt{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=It.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){DD.assign(t.shadowPositionNode||e.shadowPositionWorld||vd)}dispose(){this.updateBeforeType=It.NONE}}const DD=Fd("vec3","shadowPositionWorld");function R$(i,e={}){return e.toneMapping=i.toneMapping,e.toneMappingExposure=i.toneMappingExposure,e.outputColorSpace=i.outputColorSpace,e.renderTarget=i.getRenderTarget(),e.activeCubeFace=i.getActiveCubeFace(),e.activeMipmapLevel=i.getActiveMipmapLevel(),e.renderObjectFunction=i.getRenderObjectFunction(),e.pixelRatio=i.getPixelRatio(),e.mrt=i.getMRT(),e.clearColor=i.getClearColor(e.clearColor||new it),e.clearAlpha=i.getClearAlpha(),e.autoClear=i.autoClear,e.scissorTest=i.getScissorTest(),e}function C$(i,e){return e=R$(i,e),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,e}function N$(i,e){i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),i.setRenderObjectFunction(e.renderObjectFunction),i.setPixelRatio(e.pixelRatio),i.setMRT(e.mrt),i.setClearColor(e.clearColor,e.clearAlpha),i.autoClear=e.autoClear,i.setScissorTest(e.scissorTest)}function D$(i,e={}){return e.background=i.background,e.backgroundNode=i.backgroundNode,e.overrideMaterial=i.overrideMaterial,e}function P$(i,e){return e=D$(i,e),i.background=null,i.backgroundNode=null,i.overrideMaterial=null,e}function L$(i,e){i.background=e.background,i.backgroundNode=e.backgroundNode,i.overrideMaterial=e.overrideMaterial}function U$(i,e,t){return t=C$(i,t),t=P$(e,t),t}function O$(i,e,t){N$(i,t),L$(e,t)}const FR=new WeakMap,B$=Ie(([i,e,t])=>{let n=vd.sub(i).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),F$=i=>{const e=i.shadow.camera,t=bn("near","float",e).setGroup(Tt),n=bn("far","float",e).setGroup(Tt),r=Aj(i);return B$(r,t,n)},I$=i=>{let e=FR.get(i);if(e===void 0){const t=i.isPointLight?F$(i):null;e=new xi,e.colorNode=wt(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,FR.set(i,e)}return e},z$=Ie(({depthTexture:i,shadowCoord:e})=>Jt(i,e.xy).compare(e.z)),k$=Ie(({depthTexture:i,shadowCoord:e,shadow:t})=>{const n=(S,b)=>Jt(i,S).compare(b),r=bn("mapSize","vec2",t).setGroup(Tt),s=bn("radius","float",t).setGroup(Tt),o=He(1).div(r),u=o.x.negate().mul(s),c=o.y.negate().mul(s),f=o.x.mul(s),d=o.y.mul(s),m=u.div(2),g=c.div(2),_=f.div(2),v=d.div(2);return ir(n(e.xy.add(He(u,c)),e.z),n(e.xy.add(He(0,c)),e.z),n(e.xy.add(He(f,c)),e.z),n(e.xy.add(He(m,g)),e.z),n(e.xy.add(He(0,g)),e.z),n(e.xy.add(He(_,g)),e.z),n(e.xy.add(He(u,0)),e.z),n(e.xy.add(He(m,0)),e.z),n(e.xy,e.z),n(e.xy.add(He(_,0)),e.z),n(e.xy.add(He(f,0)),e.z),n(e.xy.add(He(m,v)),e.z),n(e.xy.add(He(0,v)),e.z),n(e.xy.add(He(_,v)),e.z),n(e.xy.add(He(u,d)),e.z),n(e.xy.add(He(0,d)),e.z),n(e.xy.add(He(f,d)),e.z)).mul(1/17)}),G$=Ie(({depthTexture:i,shadowCoord:e,shadow:t})=>{const n=(d,m)=>Jt(i,d).compare(m),r=bn("mapSize","vec2",t).setGroup(Tt),s=He(1).div(r),o=s.x,u=s.y,c=e.xy,f=Yo(c.mul(r).add(.5));return c.subAssign(f.mul(s)),ir(n(c,e.z),n(c.add(He(o,0)),e.z),n(c.add(He(0,u)),e.z),n(c.add(s),e.z),Nn(n(c.add(He(o.negate(),0)),e.z),n(c.add(He(o.mul(2),0)),e.z),f.x),Nn(n(c.add(He(o.negate(),u)),e.z),n(c.add(He(o.mul(2),u)),e.z),f.x),Nn(n(c.add(He(0,u.negate())),e.z),n(c.add(He(0,u.mul(2))),e.z),f.y),Nn(n(c.add(He(o,u.negate())),e.z),n(c.add(He(o,u.mul(2))),e.z),f.y),Nn(Nn(n(c.add(He(o.negate(),u.negate())),e.z),n(c.add(He(o.mul(2),u.negate())),e.z),f.x),Nn(n(c.add(He(o.negate(),u.mul(2))),e.z),n(c.add(He(o.mul(2),u.mul(2))),e.z),f.x),f.y)).mul(1/9)}),V$=Ie(({depthTexture:i,shadowCoord:e})=>{const t=Te(1).toVar(),n=Jt(i).sample(e.xy).rg,r=D2(e.z,n.x);return Qn(r.notEqual(Te(1)),()=>{const s=e.z.sub(n.x),o=Er(0,n.y.mul(n.y));let u=o.div(o.add(s.mul(s)));u=qa(pr(u,.3).div(.95-.3)),t.assign(qa(Er(r,u)))}),t}),H$=Ie(({samples:i,radius:e,size:t,shadowPass:n})=>{const r=Te(0).toVar(),s=Te(0).toVar(),o=i.lessThanEqual(Te(1)).select(Te(0),Te(2).div(i.sub(1))),u=i.lessThanEqual(Te(1)).select(Te(0),Te(-1));Es({start:kn(0),end:kn(i),type:"int",condition:"<"},({i:f})=>{const d=u.add(Te(f).mul(o)),m=n.sample(ir(m_.xy,He(0,d).mul(e)).div(t)).x;r.addAssign(m),s.addAssign(m.mul(m))}),r.divAssign(i),s.divAssign(i);const c=ES(s.sub(r.mul(r)));return He(r,c)}),j$=Ie(({samples:i,radius:e,size:t,shadowPass:n})=>{const r=Te(0).toVar(),s=Te(0).toVar(),o=i.lessThanEqual(Te(1)).select(Te(0),Te(2).div(i.sub(1))),u=i.lessThanEqual(Te(1)).select(Te(0),Te(-1));Es({start:kn(0),end:kn(i),type:"int",condition:"<"},({i:f})=>{const d=u.add(Te(f).mul(o)),m=n.sample(ir(m_.xy,He(d,0).mul(e)).div(t));r.addAssign(m.x),s.addAssign(ir(m.y.mul(m.y),m.x.mul(m.x)))}),r.divAssign(i),s.divAssign(i);const c=ES(s.sub(r.mul(r)));return He(r,c)}),W$=[z$,k$,G$,V$];let tx;const zm=new ED;class PD extends w${static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:s}){const o=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),u=t({depthTexture:n,shadowCoord:r,shadow:s});return o.select(u,Te(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:r}=e,s=bn("bias","float",n).setGroup(Tt);let o=t,u;if(n.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),u=o.z,r.coordinateSystem===qo&&(u=u.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const f=bn("near","float",n.camera).setGroup(Tt),d=bn("far","float",n.camera).setGroup(Tt);u=tD(c.negate(),f,d)}return o=Ae(o.x,o.y.oneMinus(),u.add(s)),o}getShadowFilterFn(e){return W$[e]}setupShadow(e){const{renderer:t}=e,{light:n,shadow:r}=this,s=t.shadowMap.type,o=new ss(r.mapSize.width,r.mapSize.height);o.compareFunction=qg;const u=e.createRenderTarget(r.mapSize.width,r.mapSize.height);if(u.depthTexture=o,r.camera.updateProjectionMatrix(),s===Gr){o.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Xl,type:Xi}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Xl,type:Xi});const x=Jt(o),E=Jt(this.vsmShadowMapVertical.texture),M=bn("blurSamples","float",r).setGroup(Tt),A=bn("radius","float",r).setGroup(Tt),C=bn("mapSize","vec2",r).setGroup(Tt);let w=this.vsmMaterialVertical||(this.vsmMaterialVertical=new xi);w.fragmentNode=H$({samples:M,radius:A,size:C,shadowPass:x}).context(e.getSharedContext()),w.name="VSMVertical",w=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new xi),w.fragmentNode=j$({samples:M,radius:A,size:C,shadowPass:E}).context(e.getSharedContext()),w.name="VSMHorizontal"}const c=bn("intensity","float",r).setGroup(Tt),f=bn("normalBias","float",r).setGroup(Tt),d=AD(n).mul(DD.add(LS.mul(f))),m=this.setupShadowCoord(e,d),g=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(g===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const _=s===Gr?this.vsmShadowMapHorizontal.texture:o,v=this.setupShadowFilter(e,{filterFn:g,shadowTexture:u.texture,depthTexture:_,shadowCoord:m,shadow:r}),S=Jt(u.texture,m),b=Nn(1,v.rgb.mix(S,1),c.mul(S.a)).toVar();return this.shadowMap=u,this.shadow.map=u,b}setup(e){if(e.renderer.shadowMap.enabled!==!1)return Ie(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:o}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height),s.render(o,t.camera)}updateShadow(e){const{shadowMap:t,light:n,shadow:r}=this,{renderer:s,scene:o,camera:u}=e,c=s.shadowMap.type,f=t.depthTexture.version;this._depthVersionCached=f,r.camera.layers.mask=u.layers.mask;const d=s.getRenderObjectFunction(),m=s.getMRT(),g=m?m.has("velocity"):!1;tx=U$(s,o,tx),o.overrideMaterial=I$(n),s.setRenderObjectFunction((_,v,S,b,x,E,...M)=>{(_.castShadow===!0||_.receiveShadow&&c===Gr)&&(g&&(c2(_).useVelocity=!0),_.onBeforeShadow(s,_,u,r.camera,b,v.overrideMaterial,E),s.renderObject(_,v,S,b,x,E,...M),_.onAfterShadow(s,_,u,r.camera,b,v.overrideMaterial,E))}),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(d),n.isPointLight!==!0&&c===Gr&&this.vsmPass(s),O$(s,o,tx)}vsmPass(e){const{shadow:t}=this;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),zm.material=this.vsmMaterialVertical,zm.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),zm.material=this.vsmMaterialHorizontal,zm.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const q$=(i,e)=>Fe(new PD(i,e)),$$=new it,zs=Ie(([i,e])=>{const t=i.toVar(),n=ns(t),r=Wa(1,Er(n.x,Er(n.y,n.z)));n.mulAssign(r),t.mulAssign(r.mul(e.mul(2).oneMinus()));const s=He(t.xy).toVar(),u=e.mul(1.5).oneMinus();return Qn(n.z.greaterThanEqual(u),()=>{Qn(t.z.greaterThan(0),()=>{s.x.assign(pr(4,t.x))})}).ElseIf(n.x.greaterThanEqual(u),()=>{const c=Ug(t.x);s.x.assign(t.z.mul(c).add(c.mul(2)))}).ElseIf(n.y.greaterThanEqual(u),()=>{const c=Ug(t.y);s.x.assign(t.x.add(c.mul(2)).add(2)),s.y.assign(t.z.mul(c).sub(2))}),He(.125,.25).mul(s).add(He(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),X$=Ie(({depthTexture:i,bd3D:e,dp:t,texelSize:n})=>Jt(i,zs(e,n.y)).compare(t)),Y$=Ie(({depthTexture:i,bd3D:e,dp:t,texelSize:n,shadow:r})=>{const s=bn("radius","float",r).setGroup(Tt),o=He(-1,1).mul(s).mul(n.y);return Jt(i,zs(e.add(o.xyy),n.y)).compare(t).add(Jt(i,zs(e.add(o.yyy),n.y)).compare(t)).add(Jt(i,zs(e.add(o.xyx),n.y)).compare(t)).add(Jt(i,zs(e.add(o.yyx),n.y)).compare(t)).add(Jt(i,zs(e,n.y)).compare(t)).add(Jt(i,zs(e.add(o.xxy),n.y)).compare(t)).add(Jt(i,zs(e.add(o.yxy),n.y)).compare(t)).add(Jt(i,zs(e.add(o.xxx),n.y)).compare(t)).add(Jt(i,zs(e.add(o.yxx),n.y)).compare(t)).mul(1/9)}),K$=Ie(({filterFn:i,depthTexture:e,shadowCoord:t,shadow:n})=>{const r=t.xyz.toVar(),s=r.length(),o=Rt("float").setGroup(Tt).onRenderUpdate(()=>n.camera.near),u=Rt("float").setGroup(Tt).onRenderUpdate(()=>n.camera.far),c=bn("bias","float",n).setGroup(Tt),f=Rt(n.mapSize).setGroup(Tt),d=Te(1).toVar();return Qn(s.sub(u).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const m=s.sub(o).div(u.sub(o)).toVar();m.addAssign(c);const g=r.normalize(),_=He(1).div(f.mul(He(4,2)));d.assign(i({depthTexture:e,bd3D:g,dp:m,texelSize:_,shadow:n}))}),d}),IR=new xt,Ju=new Oe,bf=new Oe;class Q$ extends PD{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===kB?X$:Y$}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:o}){return K$({filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:o}=e,u=t.getFrameExtents();bf.copy(t.mapSize),bf.multiply(u),n.setSize(bf.width,bf.height),Ju.copy(t.mapSize);const c=s.autoClear,f=s.getClearColor($$),d=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const m=t.getViewportCount();for(let g=0;g<m;g++){const _=t.getViewport(g),v=Ju.x*_.x,S=bf.y-Ju.y-Ju.y*_.y;IR.set(v,S,Ju.x*_.z,Ju.y*_.w),n.viewport.copy(IR),t.updateMatrices(r,g),s.render(o,t.camera)}s.autoClear=c,s.setClearColor(f,d)}}const Z$=(i,e)=>Fe(new Q$(i,e));class iu extends ih{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new it,this.colorNode=e&&e.colorNode||Rt(this.color).setGroup(Tt),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=It.FRAME}customCacheKey(){return dd(this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}getLightVector(e){return RD(this.light).sub(e.context.positionView||ai)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return q$(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const r=this.light.shadow.shadowNode;let s;r!==void 0?s=Fe(r):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=n=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const LD=Ie(({lightDistance:i,cutoffDistance:e,decayExponent:t})=>{const n=i.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(i.div(e).pow4().oneMinus().clamp().pow2()),n)}),J$=({color:i,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const r=e.normalize(),s=e.length(),o=LD({lightDistance:s,cutoffDistance:t,decayExponent:n}),u=i.mul(o);return{lightDirection:r,lightColor:u}};class eX extends iu{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Rt(0).setGroup(Tt),this.decayExponentNode=Rt(2).setGroup(Tt)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return Z$(this.light)}setupDirect(e){return J$({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}Ie(([i=zd()],{renderer:e,material:t})=>{const n=Te(1).toVar(),r=U2(i.mul(2).sub(1));if(t.alphaToCoverage&&e.samples>1){const s=Te(r.fwidth()).toVar();n.assign(Xo(s.oneMinus(),s.add(1),r).oneMinus())}else r.greaterThan(1).discard();return n});const tX=Ie(([i,e])=>{const t=i.x,n=i.y,r=i.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(n)),s=s.add(e.element(2).mul(2*.511664).mul(r)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(n)),s=s.add(e.element(5).mul(2*.429043).mul(n).mul(r)),s=s.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(8).mul(.429043).mul(Vt(t,t).sub(Vt(n,n)))),s}),_s=new kS;class nX extends Ko{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)r._clearColor.getRGB(_s),_s.a=r._clearColor.a;else if(s.isColor===!0)s.getRGB(_s),_s.a=1,o=!0;else if(s.isNode===!0){const c=this.get(e),f=s;_s.copy(r._clearColor);let d=c.backgroundMesh;if(d===void 0){const g=wS(wt(f).mul(UR),{getUV:()=>o$.mul(j2),getTextureLevel:()=>a$});let _=Q2;_=_.setZ(_.w);const v=new xi;v.name="Background.material",v.side=Tn,v.depthTest=!1,v.depthWrite=!1,v.allowOverride=!1,v.fog=!1,v.lights=!1,v.vertexNode=_,v.colorNode=g,c.backgroundMeshNode=g,c.backgroundMesh=d=new oi(new Ld(1,32,32),v),d.frustumCulled=!1,d.name="Background.mesh",d.onBeforeRender=function(S,b,x){this.matrixWorld.copyPosition(x.matrixWorld)}}const m=f.getCacheKey();c.backgroundCacheKey!==m&&(c.backgroundMeshNode.node=wt(f).mul(UR),c.backgroundMeshNode.needsUpdate=!0,d.material.needsUpdate=!0,c.backgroundCacheKey=m),t.unshift(d,d.geometry,d.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);const u=r.xr.getEnvironmentBlendMode();if(u==="additive"?_s.set(0,0,0,1):u==="alpha-blend"&&_s.set(0,0,0,0),r.autoClear===!0||o===!0){const c=n.clearColorValue;c.r=_s.r,c.g=_s.g,c.b=_s.b,c.a=_s.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(c.r*=c.a,c.g*=c.a,c.b*=c.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=r.autoClearColor===!0,n.clearDepth=r.autoClearDepth===!0,n.clearStencil=r.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let iX=0;class rb{constructor(e="",t=[],n=0,r=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=r,this.id=iX++}}class rX{constructor(e,t,n,r,s,o,u,c,f,d=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=d,this.nodeAttributes=r,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=u,this.updateAfterNodes=c,this.observer=f,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new rb(t.name,[],t.index,t);e.push(r);for(const s of t.bindings)r.bindings.push(s.clone())}else e.push(t);return e}}class zR{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class sX{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class UD{constructor(e,t,n=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}}class aX extends UD{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}class oX{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let lX=0;class nx{constructor(e=null){this.id=lX++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class uX{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class Qo{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class cX extends Qo{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class hX extends Qo{constructor(e,t=new Oe){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class fX extends Qo{constructor(e,t=new H){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class dX extends Qo{constructor(e,t=new xt){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class pX extends Qo{constructor(e,t=new it){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class mX extends Qo{constructor(e,t=new Jg){super(e,t),this.isMatrix2Uniform=!0,this.boundary=16,this.itemSize=4}}class gX extends Qo{constructor(e,t=new Mt){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class _X extends Qo{constructor(e,t=new qt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class vX extends cX{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class yX extends hX{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class xX extends fX{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class bX extends dX{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class SX extends pX{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class TX extends mX{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class EX extends gX{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class MX extends _X{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const kR=new WeakMap,AX=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),km=i=>/e/g.test(i)?String(i).replace(/\+/g,""):(i=Number(i),i+(i%1?"":".0"));class OD{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=Q0(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new nx,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}getBindGroupsCache(){let e=kR.get(this.renderer);return e===void 0&&(e=new Ks,kR.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new Jl(e,t,n)}createCubeRenderTarget(e,t){return new sD(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),r=[];let s=!0;for(const u of t)r.push(u),s=s&&u.groupNode.shared!==!0;let o;return s?(o=n.get(r),o===void 0&&(o=new rb(e,r,this.bindingsIndexes[e].group,r),n.set(r,o))):o=new rb(e,r,this.bindingsIndexes[e].group,r),o}getBindGroupArray(e,t){const n=this.bindings[t];let r=n[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const r of I1)for(const s in n[r]){const o=n[r][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const r in t){const s=t[r],o=this._getBindGroup(r,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==It.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==It.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==It.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===gi||e.magFilter===mc||e.magFilter===Oa||e.magFilter===mr||e.minFilter===gi||e.minFilter===mc||e.minFilter===Oa||e.minFilter===mr}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new nx(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const o=n?n[s]:null;o!==null?r+=o.build(this,e):r+=this.generateConst(e),s<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,n=null){const r=[];for(const s of t){const{name:o,type:u}=s;n&&n[o]&&n[o].isNode?r.push(n[o].build(this,u)):r.push(this.generateConst(u))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new it:e==="vec2"?t=new Oe:e==="vec3"?t=new H:e==="vec4"&&(t=new xt)),e==="float")return km(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${km(t.r)}, ${km(t.g)}, ${km(t.b)} )`;const n=this.getTypeLength(e),r=this.getComponentType(e),s=o=>this.generateConst(r,o);if(n===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(n===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const s of n)if(s.name===e)return s;const r=new zR(e,t);return this.registerDeclaration(r),n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Ri)return"int";if(t===Sn)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=n6(e);const r=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(e){return AX.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,r=e.itemSize,s=e.normalized;let o;return!(e instanceof aN)&&s!==!0&&(o=this.getTypeFromArray(n)),this.getTypeFromLength(r,o)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=Q0(this.stack),this.stacks.push(m2()||this.stack),Cg(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,Cg(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let r=n.getData(e);return r===void 0&&(r={},n.setData(e,r)),r[t]===void 0&&(r[t]={}),r[t]}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let r=n.bufferAttribute;if(r===void 0){const s=this.uniforms.index++;r=new zR("nodeAttribute"+s,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeFromNode(e,t,n=null,r=this.shaderStage){const s=this.getDataFromNode(e,r,this.globalCache);let o=s.structType;if(o===void 0){const u=this.structs.index++;n===null&&(n="StructType"+u),o=new uX(n,t),this.structs[r].push(o),s.structType=o}return o}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,r=null){const s=this.getDataFromNode(e,n,this.globalCache);let o=s.uniform;if(o===void 0){const u=this.uniforms.index++;o=new sX(r||"nodeUniform"+u,t,e),this.uniforms[n].push(o),this.registerDeclaration(o),s.uniform=o}return o}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e,t=null,n=e.getNodeType(this),r=this.shaderStage,s=!1){const o=this.getDataFromNode(e,r);let u=o.variable;if(u===void 0){const c=s?"_const":"_var",f=this.vars[r]||(this.vars[r]=[]),d=this.vars[c]||(this.vars[c]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+d,this.vars[c]++);const m=this.getArrayCount(e);u=new UD(t,n,s,m),s||f.push(u),this.registerDeclaration(u),o.variable=u}return u}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this)){const r=this.getDataFromNode(e,"any");let s=r.varying;if(s===void 0){const o=this.varyings,u=o.length;t===null&&(t="nodeVarying"+u),s=new aX(t,n),o.push(s),this.registerDeclaration(s),r.varying=s}return s}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let s=1,o=r;for(;n[o]!==void 0;)o=r+"_"+s++;n[o]=e,s>1&&(e.name=o,console.warn(`THREE.TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${o}'.`))}getCodeFromNode(e,t,n=this.shaderStage){const r=this.getDataFromNode(e);let s=r.code;if(s===void 0){const o=this.codes[n]||(this.codes[n]=[]),u=o.length;s=new oX("nodeCode"+u,t),o.push(s),r.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(r.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const u of n)this.addLineFlowCode(u)}addLineFlowCodeBlock(e,t,n){const r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),o=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(t),o.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new y$,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let o=0;const u=Object.values(this);return{next:()=>({value:u[o],done:o++>=u.length})}}};for(const o of t.inputs)n[o.name]=new t$(o.type,o.name);e.layout=null;const r=e.call(n),s=this.flowStagesNode(r,t.type);return e.layout=t,s}flowStagesNode(e,t=null){const n=this.flow,r=this.vars,s=this.declarations,o=this.cache,u=this.buildStage,c=this.stack,f={code:""};this.flow=f,this.vars={},this.declarations={},this.cache=new nx,this.stack=Q0();for(const d of F1)this.setBuildStage(d),f.result=e.build(this,t);return f.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.declarations=s,this.cache=o,this.stack=c,this.setBuildStage(u),f}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t,n=null,r=null){const s=this.shaderStage;this.setShaderStage(e);const o=this.flowChildNode(t,n);return r!==null&&(o.code+=`${this.tab+r} = ${o.result};
`),this.flowCode[e]=this.flowCode[e]+o.code,this.setShaderStage(s),o}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const r of n)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const r of t)n+=r.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let r=n.library.fromMaterial(t);r===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new xi),r.build(this)}else this.addFlow("compute",e);for(const r of F1){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of I1){this.setShaderStage(s);const o=this.flowNodes[s];for(const u of o)r==="generate"?this.flowNode(u):u.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new vX(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new yX(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new xX(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new bX(e);if(t==="color")return new SX(e);if(t==="mat2")return new TX(e);if(t==="mat3")return new EX(e);if(t==="mat4")return new MX(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const r=this.getTypeLength(t),s=this.getTypeLength(n);return r===16&&s===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&s===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||s>4||s===0?e:r===s?`${this.getType(n)}( ${e} )`:r>s?this.format(`${e}.${"xyz".slice(0,s)}`,this.getTypeFromLength(s,this.getComponentType(t)),n):s===4&&r>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&s>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${Kc} - Node System
`}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class GR{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===It.FRAME){const{frameMap:r}=this._getMaps(this.updateBeforeMap,n);r.get(n)!==this.frameId&&e.updateBefore(this)!==!1&&r.set(n,this.frameId)}else if(t===It.RENDER){const{renderMap:r}=this._getMaps(this.updateBeforeMap,n);r.get(n)!==this.renderId&&e.updateBefore(this)!==!1&&r.set(n,this.renderId)}else t===It.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===It.FRAME){const{frameMap:r}=this._getMaps(this.updateAfterMap,n);r.get(n)!==this.frameId&&e.updateAfter(this)!==!1&&r.set(n,this.frameId)}else if(t===It.RENDER){const{renderMap:r}=this._getMaps(this.updateAfterMap,n);r.get(n)!==this.renderId&&e.updateAfter(this)!==!1&&r.set(n,this.renderId)}else t===It.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===It.FRAME){const{frameMap:r}=this._getMaps(this.updateMap,n);r.get(n)!==this.frameId&&e.update(this)!==!1&&r.set(n,this.frameId)}else if(t===It.RENDER){const{renderMap:r}=this._getMaps(this.updateMap,n);r.get(n)!==this.renderId&&e.update(this)!==!1&&r.set(n,this.renderId)}else t===It.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class GS{constructor(e,t,n=null,r="",s=!1){this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=s}}GS.isNodeFunctionInput=!0;class wX extends iu{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:CD(this.light),lightColor:e}}}const ix=new qt,Gm=new qt;let Sf=null;class RX extends iu{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Rt(new H).setGroup(Tt),this.halfWidth=Rt(new H).setGroup(Tt),this.updateType=It.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;Gm.identity(),ix.copy(t.matrixWorld),ix.premultiply(n),Gm.extractRotation(ix),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Gm),this.halfHeight.value.applyMatrix4(Gm)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=Jt(Sf.LTC_FLOAT_1),n=Jt(Sf.LTC_FLOAT_2)):(t=Jt(Sf.LTC_HALF_1),n=Jt(Sf.LTC_HALF_2));const{colorNode:r,light:s}=this,o=RD(s);return{lightColor:r,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){Sf=e}}class BD extends iu{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Rt(0).setGroup(Tt),this.penumbraCosNode=Rt(0).setGroup(Tt),this.cutoffDistanceNode=Rt(0).setGroup(Tt),this.decayExponentNode=Rt(0).setGroup(Tt)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:n}=this;return Xo(t,n,e)}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:s}=this,o=this.getLightVector(e),u=o.normalize(),c=u.dot(CD(s)),f=this.getSpotAttenuation(c),d=o.length(),m=LD({lightDistance:d,cutoffDistance:n,decayExponent:r});let g=t.mul(f).mul(m);if(s.map){const _=T$(s,e.context.positionWorld),v=Jt(s.map,_.xy).onRenderUpdate(()=>s.map);g=_.mul(2).sub(1).abs().lessThan(1).all().select(g.mul(v),g)}return{lightColor:g,lightDirection:u}}}class CX extends BD{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const t=this.light.iesMap;let n=null;if(t&&t.isTexture===!0){const r=e.acos().mul(1/Math.PI);n=Jt(t,He(r,0),0).r}else n=super.getSpotAttenuation(e);return n}}class NX extends iu{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class DX extends iu{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=wD(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Rt(new it).setGroup(Tt)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,o=Cs.dot(r).mul(.5).add(.5),u=Nn(n,t,o);e.context.irradiance.addAssign(u)}}class PX extends iu{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new H);this.lightProbe=Vs(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=tX(j2,this.lightProbe);e.context.irradiance.addAssign(t)}}class FD{parseFunction(){console.warn("Abstract function.")}}class VS{constructor(e,t,n="",r=""){this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){console.warn("Abstract function.")}}VS.isNodeFunction=!0;const LX=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,UX=/[a-z_0-9]+/ig,VR="#pragma main",OX=i=>{i=i.trim();const e=i.indexOf(VR),t=e!==-1?i.slice(e+VR.length):i,n=t.match(LX);if(n!==null&&n.length===5){const r=n[4],s=[];let o=null;for(;(o=UX.exec(r))!==null;)s.push(o);const u=[];let c=0;for(;c<s.length;){const v=s[c][0]==="const";v===!0&&c++;let S=s[c][0];S==="in"||S==="out"||S==="inout"?c++:S="";const b=s[c++][0];let x=Number.parseInt(s[c][0]);Number.isNaN(x)===!1?c++:x=null;const E=s[c++][0];u.push(new GS(b,E,x,S,v))}const f=t.substring(n[0].length),d=n[3]!==void 0?n[3]:"",m=n[2],g=n[1]!==void 0?n[1]:"",_=e!==-1?i.slice(0,e):"";return{type:m,inputs:u,name:d,precision:g,inputsCode:r,blockCode:f,headerCode:_}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class BX extends VS{constructor(e){const{type:t,inputs:n,name:r,precision:s,inputsCode:o,blockCode:u,headerCode:c}=OX(e);super(t,n,r,s),this.inputsCode=o,this.blockCode=u,this.headerCode=c}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:r,inputsCode:s,headerCode:o,precision:u}=this;let c=`${r} ${e} ( ${s.trim()} )`;u!==""&&(c=`${u} ${c}`),t=o+c+n}else t="";return t}}class FX extends FD{parseFunction(e){return new BX(e)}}const HR=new WeakMap,Fs=[],ec=[];class IX extends Ko{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new GR,this.nodeBuilderCache=new Map,this.callHashCache=new Ks,this.groupsData=new Ks,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===v2.name)return!0;if(n===Tt.name){const s=this.get(e),o=this.nodeFrame.renderId;return s.renderId!==o?(s.renderId=o,!0):!1}if(n===k6.name){const s=this.get(e),o=this.nodeFrame.frameId;return s.frameId!==o?(s.frameId=o,!0):!1}Fs[0]=t,Fs[1]=e;let r=this.groupsData.get(Fs);return r===void 0&&this.groupsData.set(Fs,r={}),Fs.length=0,r.version!==t.version?(r.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(n=r.get(s),n===void 0){const o=this.backend.createNodeBuilder(e.object,this.renderer);o.scene=e.scene,o.material=e.material,o.camera=e.camera,o.context.material=e.material,o.lightsNode=e.lightsNode,o.environmentNode=this.getEnvironmentNode(e.scene),o.fogNode=this.getFogNode(e.scene),o.clippingContext=e.clippingContext,o.build(),n=this._createNodeBuilderState(o),r.set(s,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new rX(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Fs[0]=e,Fs[1]=t;const n=this.renderer.info.calls,r=this.callHashCache.get(Fs)||{};if(r.callId!==n){const s=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&ec.push(t.getCacheKey(!0)),s&&ec.push(s.getCacheKey()),o&&ec.push(o.getCacheKey()),ec.push(this.renderer.shadowMap.enabled?1:0),r.callId=n,r.cacheKey=mS(ec),this.callHashCache.set(Fs,r),ec.length=0}return Fs.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||r){const s=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===jo||n.mapping===Wo||n.mapping===Wl){if(e.backgroundBlurriness>0||n.mapping===Wl)return _D(n);{let o;return n.isCubeTexture===!0?o=yd(n):o=Jt(n),oD(o)}}else{if(n.isTexture===!0)return Jt(n,xd.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",n)}},r);t.backgroundNode=s,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,r=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||r)&&(o=n(),s.set(t,o)),o}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const r=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const s=bn("color","color",n).setGroup(Tt),o=bn("density","float",n).setGroup(Tt);return BR(s,b$(o))}else if(n.isFog){const s=bn("color","color",n).setGroup(Tt),o=bn("near","float",n).setGroup(Tt),u=bn("far","float",n).setGroup(Tt);return BR(s,x$(o,u))}else console.error("THREE.Renderer: Unsupported fog configuration.",n)});t.fogNode=r,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const r=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return yd(n);if(n.isTexture===!0)return Jt(n);console.error("Nodes: Unsupported environment configuration.",n)});t.environmentNode=r,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,r=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=n,o.camera=r,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return HR.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),r=Jt(e,xd).renderOutput(t.toneMapping,t.currentColorSpace);return HR.set(e,n),r}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const r of n.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const r of n.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new GR,this.nodeBuilderCache=new Map,this.cacheLib={}}}const rx=new bs;class Og{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Mt,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const r=e.length;for(let s=0;s<r;s++){rx.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[n+s],u=rx.normal;o.x=-u.x,o.y=-u.y,o.z=-u.z,o.w=rx.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,s=r.length;let o,u;if(this.clipIntersection?(o=this.intersectionPlanes,u=e.intersectionPlanes.length):(o=this.unionPlanes,u=e.unionPlanes.length),o.length!==u+s){o.length=u+s;for(let c=0;c<s;c++)o[u+c]=new xt;n=!0}this.projectPlanes(r,o,u),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new Og(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class zX{constructor(e,t){this.bundleGroup=e,this.camera=t}}const Tf=[];class kX{constructor(){this.bundles=new Ks}get(e,t){const n=this.bundles;Tf[0]=e,Tf[1]=t;let r=n.get(Tf);return r===void 0&&(r=new zX(e,t),n.set(Tf,r)),Tf.length=0,r}dispose(){this.bundles=new Ks}}class ID{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const GX=new ND,Ef=[];class VX extends Ks{constructor(){super()}createNode(e=[]){return new ND().setLights(e)}getNode(e,t){if(e.isQuadMesh)return GX;Ef[0]=e,Ef[1]=t;let n=this.get(Ef);return n===void 0&&(n=this.createNode(),this.set(Ef,n)),Ef.length=0,n}}class Pf extends Jl{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}}const jR=new H,WR=new H;class HX extends Ya{constructor(e){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Ci,this._cameraL.viewport=new xt,this._cameraR=new Ci,this._cameraR.viewport=new xt,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new yN,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._supportsLayers=!1,this._createXRLayer=YX.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Oe,this._onSessionEvent=qX.bind(this),this._onSessionEnd=$X.bind(this),this._onInputSourcesChange=XX.bind(this),this._onAnimationFrame=KX.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers=typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}createQuadLayer(e,t,n,r,s,o,u,c=[]){const f=new Pd(e,t),d=new Pf(s,o,{format:qn,type:Wn,depthTexture:new ss(s,o,c.stencil?Hr:Sn,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?Wr:jr),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),m=new Gs({color:16777215,side:xr});m.map=d.texture,m.map.offset.y=1,m.map.repeat.y=-1;const g=new oi(f,m);g.position.copy(n),g.quaternion.copy(r);const _={type:"quad",width:e,height:t,translation:n,quaternion:r,pixelwidth:s,pixelheight:o,plane:g,material:m,rendercall:u,renderTarget:d};if(this._layers.push(_),this._session!==null){_.plane.material=new Gs({color:16777215,side:xr}),_.plane.material.blending=pc,_.plane.material.blendEquation=qi,_.plane.material.blendSrc=wa,_.plane.material.blendDst=wa,_.xrlayer=this._createXRLayer(_);const v=this._session.renderState.layers;v.unshift(_.xrlayer),this._session.updateRenderState({layers:v})}else d.isXRRenderTarget=!1;return g}createCylinderLayer(e,t,n,r,s,o,u,c,f=[]){const d=new Dd(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),m=new Pf(o,u,{format:qn,type:Wn,depthTexture:new ss(o,u,f.stencil?Hr:Sn,void 0,void 0,void 0,void 0,void 0,void 0,f.stencil?Wr:jr),stencilBuffer:f.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),g=new Gs({color:16777215,side:Tn});g.map=m.texture,g.map.offset.y=1,g.map.repeat.y=-1;const _=new oi(d,g);_.position.copy(r),_.quaternion.copy(s);const v={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:r,quaternion:s,pixelwidth:o,pixelheight:u,plane:_,material:g,rendercall:c,renderTarget:m};if(this._layers.push(v),this._session!==null){v.plane.material=new Gs({color:16777215,side:Tn}),v.plane.material.blending=pc,v.plane.material.blendEquation=qi,v.plane.material.blendSrc=wa,v.plane.material.blendDst=wa,v.xrlayer=this._createXRLayer(v);const S=this._session.renderState.layers;S.unshift(v.xrlayer),this._session.updateRenderState({layers:S})}else m.isXRRenderTarget=!1;return _}renderLayers(){const e=new H,t=new Rs,n=this.isPresenting;this.isPresenting=!1;for(const r of this._layers){if(r.renderTarget.isXRRenderTarget=this._session!==null,r.renderTarget.hasExternalTextures=r.renderTarget.isXRRenderTarget,r.renderTarget.autoAllocateDepthBuffer=!r.renderTarget.isXRRenderTarget,r.renderTarget.isXRRenderTarget&&this._supportsLayers){r.xrlayer.transform=new XRRigidTransform(r.plane.getWorldPosition(e),r.plane.getWorldQuaternion(t));const s=this._glBinding.getSubImage(r.xrlayer,this._xrFrame);this._renderer.backend.setXRRenderTargetTextures(r.renderTarget,s.colorTexture,s.depthStencilTexture)}this._renderer.setRenderTarget(r.renderTarget),r.rendercall()}this.isPresenting=n,this._renderer.setRenderTarget(null)}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const r=this._gl,s=r.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._useLayers===!0){let o=null,u=null,c=null;t.depth&&(c=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,o=t.stencil?Wr:jr,u=t.stencil?Hr:Sn);const f={colorFormat:r.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor},d=new XRWebGLBinding(e,r),m=d.createProjectionLayer(f),g=[m];if(this._glBinding=d,this._glProjLayer=m,t.setPixelRatio(1),t.setSize(m.textureWidth,m.textureHeight,!1),this._xrRenderTarget=new Pf(m.textureWidth,m.textureHeight,{format:qn,type:Wn,colorSpace:t.outputColorSpace,depthTexture:new ss(m.textureWidth,m.textureHeight,u,void 0,void 0,void 0,void 0,void 0,void 0,o),stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1}),this._xrRenderTarget.hasExternalTextures=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._supportsLayers=e.enabledFeatures.includes("layers"),this._supportsLayers)for(const _ of this._layers)_.plane.material=new Gs({color:16777215,side:_.type==="cylinder"?Tn:xr}),_.plane.material.blending=pc,_.plane.material.blendEquation=qi,_.plane.material.blendSrc=wa,_.plane.material.blendDst=wa,_.xrlayer=this._createXRLayer(_),g.unshift(_.xrlayer);e.updateRenderState({layers:g})}else{const o={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},u=new XRWebGLLayer(e,r,o);this._glBaseLayer=u,e.updateRenderState({baseLayer:u}),t.setPixelRatio(1),t.setSize(u.framebufferWidth,u.framebufferHeight,!1),this._xrRenderTarget=new Pf(u.framebufferWidth,u.framebufferHeight,{format:qn,type:Wn,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:u.ignoreDepthValues===!1,resolveStencilBuffer:u.ignoreDepthValues===!1})}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,r=e.far,s=this._cameraXR,o=this._cameraL,u=this._cameraR;s.near=u.near=o.near=n,s.far=u.far=o.far=r,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),o.layers.mask=e.layers.mask|2,u.layers.mask=e.layers.mask|4,s.layers.mask=o.layers.mask|u.layers.mask;const c=e.parent,f=s.cameras;qR(s,c);for(let d=0;d<f.length;d++)qR(f[d],c);f.length===2?jX(s,o,u):s.projectionMatrix.copy(o.projectionMatrix),WX(e,s,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new ig,this._controllers[e]=t),t}}function jX(i,e,t){jR.setFromMatrixPosition(e.matrixWorld),WR.setFromMatrixPosition(t.matrixWorld);const n=jR.distanceTo(WR),r=e.projectionMatrix.elements,s=t.projectionMatrix.elements,o=r[14]/(r[10]-1),u=r[14]/(r[10]+1),c=(r[9]+1)/r[5],f=(r[9]-1)/r[5],d=(r[8]-1)/r[0],m=(s[8]+1)/s[0],g=o*d,_=o*m,v=n/(-d+m),S=v*-d;if(e.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.translateX(S),i.translateZ(v),i.matrixWorld.compose(i.position,i.quaternion,i.scale),i.matrixWorldInverse.copy(i.matrixWorld).invert(),r[10]===-1)i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const b=o+v,x=u+v,E=g-S,M=_+(n-S),A=c*u/x*b,C=f*u/x*b;i.projectionMatrix.makePerspective(E,M,A,C,b,x),i.projectionMatrixInverse.copy(i.projectionMatrix).invert()}}function qR(i,e){e===null?i.matrixWorld.copy(i.matrix):i.matrixWorld.multiplyMatrices(e.matrixWorld,i.matrix),i.matrixWorldInverse.copy(i.matrixWorld).invert()}function WX(i,e,t){t===null?i.matrix.copy(e.matrixWorld):(i.matrix.copy(t.matrixWorld),i.matrix.invert(),i.matrix.multiply(e.matrixWorld)),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0),i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse),i.isPerspectiveCamera&&(i.fov=Yl*2*Math.atan(1/i.projectionMatrix.elements[5]),i.zoom=1)}function qX(i){const e=this._controllerInputSources.indexOf(i.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(i.inputSource,i.frame,n),t.dispatchEvent({type:i.type,data:i.inputSource})}}function $X(){const i=this._session,e=this._renderer;i.removeEventListener("select",this._onSessionEvent),i.removeEventListener("selectstart",this._onSessionEvent),i.removeEventListener("selectend",this._onSessionEvent),i.removeEventListener("squeeze",this._onSessionEvent),i.removeEventListener("squeezestart",this._onSessionEvent),i.removeEventListener("squeezeend",this._onSessionEvent),i.removeEventListener("end",this._onSessionEnd),i.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e.backend.setXRTarget(null),e.setOutputRenderTarget(null),e.setRenderTarget(null),this._session=null,this._xrRenderTarget=null,this._supportsLayers===!0)for(const t of this._layers)t.renderTarget=new Pf(t.pixelwidth,t.pixelheight,{format:qn,type:Wn,depthTexture:new ss(t.pixelwidth,t.pixelheight,t.stencilBuffer?Hr:Sn,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?Wr:jr),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,delete t.xrlayer;this.isPresenting=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function XX(i){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<i.removed.length;n++){const r=i.removed[n],s=t.indexOf(r);s>=0&&(t[s]=null,e[s].disconnect(r))}for(let n=0;n<i.added.length;n++){const r=i.added[n];let s=t.indexOf(r);if(s===-1){for(let u=0;u<e.length;u++)if(u>=t.length){t.push(r),s=u;break}else if(t[u]===null){t[u]=r,s=u;break}if(s===-1)break}const o=e[s];o&&o.connect(r)}}function YX(i){return i.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(i.translation,i.quaternion),depthFormat:this._gl.DEPTH_COMPONENT,width:i.width/2,height:i.height/2,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(i.translation,i.quaternion),depthFormat:this._gl.DEPTH_COMPONENT,radius:i.radius,centralAngle:i.centralAngle,aspectRatio:i.aspectRatio,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight})}function KX(i,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,r=n.backend,s=this._glBaseLayer,o=this.getReferenceSpace(),u=e.getViewerPose(o);if(this._xrFrame=e,u!==null){const c=u.views;this._glBaseLayer!==null&&r.setXRTarget(s.framebuffer);let f=!1;c.length!==t.cameras.length&&(t.cameras.length=0,f=!0);for(let d=0;d<c.length;d++){const m=c[d];let g;if(this._useLayers===!0){const v=this._glBinding.getViewSubImage(this._glProjLayer,m);g=v.viewport,d===0&&r.setXRRenderTargetTextures(this._xrRenderTarget,v.colorTexture,this._glProjLayer.ignoreDepthValues?void 0:v.depthStencilTexture)}else g=s.getViewport(m);let _=this._cameras[d];_===void 0&&(_=new Ci,_.layers.enable(d),_.viewport=new xt,this._cameras[d]=_),_.matrix.fromArray(m.transform.matrix),_.matrix.decompose(_.position,_.quaternion,_.scale),_.projectionMatrix.fromArray(m.projectionMatrix),_.projectionMatrixInverse.copy(_.projectionMatrix).invert(),_.viewport.set(g.x,g.y,g.width,g.height),d===0&&(t.matrix.copy(_.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),f===!0&&t.cameras.push(_)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const f=this._controllerInputSources[c],d=this._controllers[c];f!==null&&d!==void 0&&d.update(f,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(i,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}const $R=new Kg,Vm=new Oe,sx=new xt,ax=new Qg,Hm=new qt,Po=new xt;class QX{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:s=!0,stencil:o=!1,antialias:u=!1,samples:c=0,getFallback:f=null,colorBufferType:d=Xi}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=c||u===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=ut,this.toneMapping=Sr,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new zq,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new ID,this.lighting=new VX,this._getFallback=f,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new xt(0,0,this._width,this._height),this._scissor=new xt(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new ED(new xi),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const m=this.alpha===!0?0:1;this._clearColor=new kS(0,0,0,m),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=d,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:Mb},this.xr=new HX(this),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(g,_,v)=>{await this.compileAsync(g,_);const S=this._renderLists.get(g,_),b=this._renderContexts.get(g,_,this._renderTarget),x=g.overrideMaterial||v.material,E=this._objects.get(v,x,g,_,S.lightsNode,b,b.clippingContext),{fragmentShader:M,vertexShader:A}=E.getNodeBuilderState();return{fragmentShader:M,vertexShader:A}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=n=this._getFallback(r),await n.init(this)}catch(s){t(s);return}else{t(r);return}}this._nodes=new IX(this,n),this._animation=new Nq(this._nodes,this.info),this._attributes=new Fq(n),this._background=new nX(this,this._nodes),this._geometries=new Iq(this._attributes,this.info),this._textures=new e$(this,n,this.info),this._pipelines=new Hq(n,this._nodes),this._bindings=new jq(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Uq(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new $q(this.lighting),this._bundles=new kX,this._renderContexts=new Zq,this._animation.start(),this._initialized=!0,e(this)}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,s=r.renderId,o=this._currentRenderContext,u=this._currentRenderObjectFunction,c=this._compilationPromises,f=e.isScene===!0?e:$R;n===null&&(n=e);const d=this._renderTarget,m=this._renderContexts.get(n,t,d),g=this._activeMipmapLevel,_=[];this._currentRenderContext=m,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=_,r.renderId++,r.update(),m.depth=this.depth,m.stencil=this.stencil,m.clippingContext||(m.clippingContext=new Og),m.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,d);const v=this._renderLists.get(e,t);if(v.begin(),this._projectObject(e,t,0,v,m.clippingContext),n!==e&&n.traverseVisible(function(M){M.isLight&&M.layers.test(t.layers)&&v.pushLight(M)}),v.finish(),d!==null){this._textures.updateRenderTarget(d,g);const M=this._textures.get(d);m.textures=M.textures,m.depthTexture=M.depthTexture}else m.textures=null,m.depthTexture=null;this._background.update(f,v,m);const S=v.opaque,b=v.transparent,x=v.transparentDoublePass,E=v.lightsNode;this.opaque===!0&&S.length>0&&this._renderObjects(S,t,f,E),this.transparent===!0&&b.length>0&&this._renderTransparents(b,x,t,f,E),r.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=u,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(_)}async renderAsync(e,t){this._initialized===!1&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:r,camera:s,renderList:o}=e,u=this._currentRenderContext,c=this._bundles.get(r,s),f=this.backend.get(c);f.renderContexts===void 0&&(f.renderContexts=new Set);const d=r.version!==f.version,m=f.renderContexts.has(u)===!1||d;if(f.renderContexts.add(u),m){this.backend.beginBundle(u),(f.renderObjects===void 0||d)&&(f.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:g,transparent:_,opaque:v}=o;this.opaque===!0&&v.length>0&&this._renderObjects(v,s,t,n),this.transparent===!0&&_.length>0&&this._renderTransparents(_,g,s,t,n),this._currentRenderBundle=null,this.backend.finishBundle(u,c),f.version=r.version}else{const{renderObjects:g}=f;for(let _=0,v=g.length;_<v;_++){const S=g[_];this._nodes.needsRefresh(S)&&(this._nodes.updateBefore(S),this._nodes.updateForRender(S),this._bindings.updateForRender(S),this._nodes.updateAfter(S))}}this.backend.addBundle(u,c)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(e!==Sr===!1&&t!==qs===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(Vm),{depth:u,stencil:c}=this;let f=this._frameBufferTarget;return f===null&&(f=new Jl(s,o,{depthBuffer:u,stencilBuffer:c,type:this._colorBufferType,format:qn,colorSpace:qs,generateMipmaps:!1,minFilter:gi,magFilter:gi,samples:this.samples}),f.isPostProcessingRenderTarget=!0,this._frameBufferTarget=f),f.depthBuffer=u,f.stencilBuffer=c,f.setSize(s,o),f.viewport.copy(this._viewport),f.scissor.copy(this._scissor),f.viewport.multiplyScalar(this._pixelRatio),f.scissor.multiplyScalar(this._pixelRatio),f.scissorTest=this._scissorTest,f}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const r=n?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,u=this._currentRenderContext,c=this._currentRenderObjectFunction,f=e.isScene===!0?e:$R,d=this._renderTarget||this._outputRenderTarget,m=this._activeCubeFace,g=this._activeMipmapLevel;let _;r!==null?(_=r,this.setRenderTarget(_)):_=d;const v=this._renderContexts.get(e,t,_);this._currentRenderContext=v,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls;const S=this.coordinateSystem,b=this.xr;if(t.coordinateSystem!==S&&b.isPresenting===!1&&(t.coordinateSystem=S,t.updateProjectionMatrix(),t.isArrayCamera))for(const j of t.cameras)j.coordinateSystem=S,j.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),b.enabled===!0&&b.isPresenting===!0&&(b.cameraAutoUpdate===!0&&b.updateCamera(t),t=b.getCamera());let x=this._viewport,E=this._scissor,M=this._pixelRatio;_!==null&&(x=_.viewport,E=_.scissor,M=1),this.getDrawingBufferSize(Vm),sx.set(0,0,Vm.width,Vm.height);const A=x.minDepth===void 0?0:x.minDepth,C=x.maxDepth===void 0?1:x.maxDepth;v.viewportValue.copy(x).multiplyScalar(M).floor(),v.viewportValue.width>>=g,v.viewportValue.height>>=g,v.viewportValue.minDepth=A,v.viewportValue.maxDepth=C,v.viewport=v.viewportValue.equals(sx)===!1,v.scissorValue.copy(E).multiplyScalar(M).floor(),v.scissor=this._scissorTest&&v.scissorValue.equals(sx)===!1,v.scissorValue.width>>=g,v.scissorValue.height>>=g,v.clippingContext||(v.clippingContext=new Og),v.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,_),Hm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ax.setFromProjectionMatrix(Hm,S);const w=this._renderLists.get(e,t);if(w.begin(),this._projectObject(e,t,0,w,v.clippingContext),w.finish(),this.sortObjects===!0&&w.sort(this._opaqueSort,this._transparentSort),_!==null){this._textures.updateRenderTarget(_,g);const j=this._textures.get(_);v.textures=j.textures,v.depthTexture=j.depthTexture,v.width=j.width,v.height=j.height,v.renderTarget=_,v.depth=_.depthBuffer,v.stencil=_.stencilBuffer}else v.textures=null,v.depthTexture=null,v.width=this.domElement.width,v.height=this.domElement.height,v.depth=this.depth,v.stencil=this.stencil;v.width>>=g,v.height>>=g,v.activeCubeFace=m,v.activeMipmapLevel=g,v.occlusionQueryCount=w.occlusionQueryCount,this._background.update(f,w,v),this.backend.beginRender(v);const{bundles:N,lightsNode:L,transparentDoublePass:P,transparent:D,opaque:I}=w;return N.length>0&&this._renderBundles(N,f,L),this.opaque===!0&&I.length>0&&this._renderObjects(I,t,f,L),this.transparent===!0&&D.length>0&&this._renderTransparents(D,P,t,f,L),this.backend.finishRender(v),s.renderId=o,this._currentRenderContext=u,this._currentRenderObjectFunction=c,r!==null&&(this.setRenderTarget(d,m,g),this._renderOutput(_)),f.onAfterRender(this,e,t,_),v}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r,s=0,o=1){const u=this._viewport;e.isVector4?u.copy(e):u.set(e,t,n,r),u.minDepth=s,u.maxDepth=o}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,n);const r=this._renderTarget||this._getFrameBufferTarget();let s=null;if(r!==null){this._textures.updateRenderTarget(r);const o=this._textures.get(r);s=this._renderContexts.getForClear(r),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,s),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){this._initialized===!1&&await this.init(),this.clear(e,t,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Sr}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:qs}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,n=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const r=this.backend,s=this._pipelines,o=this._bindings,u=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const f of c){if(s.has(f)===!1){const g=()=>{f.removeEventListener("dispose",g),s.delete(f),o.delete(f),u.delete(f)};f.addEventListener("dispose",g);const _=f.onInitFunction;_!==null&&_.call(f,{renderer:this})}u.updateForCompute(f),o.updateForCompute(f);const d=o.getForCompute(f),m=s.getForCompute(f,d);r.compute(e,f,d,m)}r.finishCompute(e),t.renderId=n}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=Po.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=Po.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=Po.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,r;n!==null?r=n.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),n=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,n,t)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,s,o)}async readRenderTargetPixelsAsync(e,t,n,r,s,o=0,u=0){return this.backend.copyTextureToBuffer(e.textures[o],t,n,r,s,u)}_projectObject(e,t,n,r,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||ax.intersectsSprite(e)){this.sortObjects===!0&&Po.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Hm);const{geometry:c,material:f}=e;f.visible&&r.push(e,c,f,n,Po.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||ax.intersectsObject(e))){const{geometry:c,material:f}=e;if(this.sortObjects===!0&&(c.boundingSphere===null&&c.computeBoundingSphere(),Po.copy(c.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(Hm)),Array.isArray(f)){const d=c.groups;for(let m=0,g=d.length;m<g;m++){const _=d[m],v=f[_.materialIndex];v&&v.visible&&r.push(e,c,v,n,Po.z,_,s)}}else f.visible&&r.push(e,c,f,n,Po.z,null,s)}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=r;r=this._renderLists.get(e,t),r.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const u=e.children;for(let c=0,f=u.length;c<f;c++)this._projectObject(u[c],t,n,r,s)}_renderBundles(e,t,n){for(const r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,s){if(t.length>0){for(const{material:o}of t)o.side=Tn;this._renderObjects(t,n,r,s,"backSide");for(const{material:o}of t)o.side=xr;this._renderObjects(e,n,r,s);for(const{material:o}of t)o.side=Ji}else this._renderObjects(e,n,r,s)}_renderObjects(e,t,n,r,s=null){for(let o=0,u=e.length;o<u;o++){const{object:c,geometry:f,material:d,group:m,clippingContext:g}=e[o];this._currentRenderObjectFunction(c,n,t,f,d,m,r,g,s)}}renderObject(e,t,n,r,s,o,u,c=null,f=null){let d,m,g;if(e.onBeforeRender(this,t,n,r,s,o),s.allowOverride===!0&&t.overrideMaterial!==null){const _=t.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(d=_.positionNode,_.positionNode=s.positionNode),_.alphaTest=s.alphaTest,_.alphaMap=s.alphaMap,_.transparent=s.transparent||s.transmission>0,_.isShadowPassMaterial&&(_.side=s.shadowSide===null?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(g=_.depthNode,_.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(m=_.colorNode,_.colorNode=s.castShadowNode)),s=_}s.transparent===!0&&s.side===Ji&&s.forceSinglePass===!1?(s.side=Tn,this._handleObjectFunction(e,s,t,n,u,o,c,"backSide"),s.side=xr,this._handleObjectFunction(e,s,t,n,u,o,c,f),s.side=Ji):this._handleObjectFunction(e,s,t,n,u,o,c,f),d!==void 0&&(t.overrideMaterial.positionNode=d),g!==void 0&&(t.overrideMaterial.depthNode=g),m!==void 0&&(t.overrideMaterial.colorNode=m),e.onAfterRender(this,t,n,r,s,o)}_renderObjectDirect(e,t,n,r,s,o,u,c){const f=this._objects.get(e,t,n,r,s,this._currentRenderContext,u,c);f.drawRange=e.geometry.drawRange,f.group=o;const d=this._nodes.needsRefresh(f);d&&(this._nodes.updateBefore(f),this._geometries.updateForRender(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f)),this._pipelines.updateForRender(f),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(f),f.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(f,this.info),d&&this._nodes.updateAfter(f)}_createObjectPipeline(e,t,n,r,s,o,u,c){const f=this._objects.get(e,t,n,r,s,this._currentRenderContext,u,c);f.drawRange=e.geometry.drawRange,f.group=o,this._nodes.updateBefore(f),this._geometries.updateForRender(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f),this._pipelines.getForRender(f,this._compilationPromises),this._nodes.updateAfter(f)}get compile(){return this.compileAsync}}class HS{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function ZX(i){return i+(Fo-i%Fo)%Fo}class zD extends HS{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return ZX(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class kD extends zD{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let JX=0;class GD extends kD{constructor(e,t){super("UniformBuffer_"+JX++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class e7 extends kD{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){let e=0;for(let t=0,n=this.uniforms.length;t<n;t++){const r=this.uniforms[t],{boundary:s,itemSize:o}=r,u=e%Fo,c=Fo-u;u!==0&&c-s<0?e+=Fo-u:u%s!==0&&(e+=u%s),r.offset=e/this.bytesPerElement,e+=o*this.bytesPerElement}return Math.ceil(e/Fo)*Fo}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s]!==r){const u=this._getBufferForType(o);u[s]=n[s]=r,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y){const u=this._getBufferForType(o);u[s+0]=n[s+0]=r.x,u[s+1]=n[s+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z){const u=this._getBufferForType(o);u[s+0]=n[s+0]=r.x,u[s+1]=n[s+1]=r.y,u[s+2]=n[s+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z||n[s+4]!==r.w){const u=this._getBufferForType(o);u[s+0]=n[s+0]=r.x,u[s+1]=n[s+1]=r.y,u[s+2]=n[s+2]=r.z,u[s+3]=n[s+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset;if(n[s+0]!==r.r||n[s+1]!==r.g||n[s+2]!==r.b){const o=this.buffer;o[s+0]=n[s+0]=r.r,o[s+1]=n[s+1]=r.g,o[s+2]=n[s+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;if(n[s+0]!==r[0]||n[s+1]!==r[1]||n[s+2]!==r[2]||n[s+4]!==r[3]||n[s+5]!==r[4]||n[s+6]!==r[5]||n[s+8]!==r[6]||n[s+9]!==r[7]||n[s+10]!==r[8]){const o=this.buffer;o[s+0]=n[s+0]=r[0],o[s+1]=n[s+1]=r[1],o[s+2]=n[s+2]=r[2],o[s+4]=n[s+4]=r[3],o[s+5]=n[s+5]=r[4],o[s+6]=n[s+6]=r[5],o[s+8]=n[s+8]=r[6],o[s+9]=n[s+9]=r[7],o[s+10]=n[s+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;return n7(n,r,s)===!1&&(this.buffer.set(r,s),t7(n,r,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function t7(i,e,t){for(let n=0,r=e.length;n<r;n++)i[t+n]=e[n]}function n7(i,e,t){for(let n=0,r=e.length;n<r;n++)if(i[t+n]!==e[n])return!1;return!0}let i7=0;class VD extends e7{constructor(e,t){super(e),this.id=i7++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let r7=0;class s7 extends HS{constructor(e,t){super(e),this.id=r7++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}}class x_ extends s7{constructor(e,t,n,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class HD extends x_{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledCubeTexture=!0}}class jD extends x_{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledTexture3D=!0}}const a7={textureDimensions:"textureSize",equals:"equal"},o7={low:"lowp",medium:"mediump",high:"highp"},XR={swizzleAssign:!0,storageBuffer:!1},YR=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class l7 extends OD{constructor(e,t){super(e,t,new FX),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Vr}getMethod(e){return a7[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,r=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let u=o?Qc:Cd;s===2?u=o?Zc:Xl:s===3?u=o?$B:Rd:s===4&&(u=o?Jc:qn);const c={Float32Array:Yn,Uint8Array:Wn,Uint16Array:Ms,Uint32Array:Sn,Int8Array:zl,Int16Array:kl,Int32Array:Ri,Uint8ClampedArray:Wn},f=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/s))));let d=Math.ceil(r/s/f);f*d*s<r&&d++;const m=f*d*s,g=new n.constructor(m);g.set(n,0),t.array=g;const _=new Q3(t.array,f,d,u,c[t.array.constructor.name]||Yn);_.needsUpdate=!0,_.isPBOTexture=!0;const v=new kd(_,null,null);v.setPrecision("high"),t.pboNode=v,t.pbo=v.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){const d=this.renderer.backend.get(r);d.pbo=r.pbo}const s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),o=this.getPropertyName(s);this.increaseUsage(n);const u=n.build(this,"uint"),c=this.getDataFromNode(e);let f=c.propertyName;if(f===void 0){const d=this.getVarFromNode(e);f=this.getPropertyName(d);const m=this.getDataFromNode(t);let g=m.propertySizeName;g===void 0&&(g=f+"Size",this.getVarFromNode(t,g,"uint"),this.addLineFlowCode(`${g} = uint( textureSize( ${o}, 0 ).x )`,e),m.propertySizeName=g);const{itemSize:_}=r,v="."+nh.join("").slice(0,_),S=`ivec2(${u} % ${g}, ${u} / ${g})`,b=this.generateTextureLoad(null,o,S,null,"0");let x="vec4";r.pbo.type===Sn?x="uvec4":r.pbo.type===Ri&&(x="ivec4"),this.addLineFlowCode(`${f} = ${x}(${b})${v}`,e),c.propertyName=f}return f}generateTextureLoad(e,t,n,r,s="0"){return r?`texelFetch( ${t}, ivec3( ${n}, ${r} ), ${s} )`:`texelFetch( ${t}, ${n}, ${s} )`}generateTexture(e,t,n,r){return e.isDepthTexture?`texture( ${t}, ${n} ).x`:(r&&(n=`vec3( ${n}, ${r} )`),`texture( ${t}, ${n} )`)}generateTextureLevel(e,t,n,r){return`textureLod( ${t}, ${n}, ${r} )`}generateTextureBias(e,t,n,r){return`texture( ${t}, ${n}, ${r} )`}generateTextureGrad(e,t,n,r){return`textureGrad( ${t}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return`texture( ${t}, vec3( ${n}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],r={};for(const o of t){let u=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const d=o.node.value;let m="";(d.isDataTexture===!0||d.isData3DTexture===!0)&&(d.type===Sn?m="u":d.type===Ri&&(m="i")),o.type==="texture3D"?u=`${m}sampler3D ${o.name};`:d.compareFunction?u=`sampler2DShadow ${o.name};`:d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0?u=`${m}sampler2DArray ${o.name};`:u=`${m}sampler2D ${o.name};`}else if(o.type==="cubeTexture")u=`samplerCube ${o.name};`;else if(o.type==="buffer"){const d=o.node,m=this.getType(d.bufferType),g=d.bufferCount,_=g>0?g:"";u=`${d.name} {
	${m} ${o.name}[${_}];
};
`}else u=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,c=!0;const f=o.node.precision;if(f!==null&&(u=o7[f]+" "+u),c){u="	"+u;const d=o.groupNode.name;(r[d]||(r[d]=[])).push(u)}else u="uniform "+u,n.push(u)}let s="";for(const o in r){const u=r[o];s+=this._getGLSLUniformStruct(e+"_"+o,u.join(`
`))+`
`}return s+=n.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Ri){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const r=n.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let r=0;for(const s of n)t+=`layout( location = ${r++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],r=[];for(const s of n)if(s.output)for(const o of s.members)r.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+s.name+` {
`;o+=this.getStructMembers(s),o+=`
};
`,t.push(o)}return r.length===0&&r.push("layout( location = 0 ) out vec4 fragColor;"),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const r of n){e==="compute"&&(r.needsInterpolation=!0);const s=this.getType(r.type);if(r.needsInterpolation){const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}out ${s} ${r.name};
`}else t+=`${s} ${r.name};
`}else if(e==="fragment"){for(const r of n)if(r.needsInterpolation){const s=this.getType(r.type),o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${r.name};
`}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,r)=>n*r,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:r,behavior:s}of n.values())t.push(`#extension ${r} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=XR[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const r=this.renderer.backend.extensions;r.has(n)&&(r.get(n),t=!0)}XR[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const r=e[n],s=this.getPropertyName(r.attributeNode);s&&(t+=`${r.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${YR}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${YR}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

// structs
${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const r=this.flowNodes[t],s=r[r.length-1];for(const u of r){const c=this.getFlowData(u),f=u.name;f&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${f}
	`),n+=`${c.code}
	`,u===s&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):t==="fragment"&&(u.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);let u=o.uniformGPU;if(u===void 0){const c=e.groupNode,f=c.name,d=this.getBindGroupArray(f,n);if(t==="texture")u=new x_(s.name,s.node,c),d.push(u);else if(t==="cubeTexture")u=new HD(s.name,s.node,c),d.push(u);else if(t==="texture3D")u=new jD(s.name,s.node,c),d.push(u);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const m=new GD(e,c);m.name=e.name,d.push(m),u=m}else{const m=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=m[f];g===void 0&&(g=new VD(n+"_"+f,c),m[f]=g,d.push(g)),u=this.getNodeUniform(s,t),g.addUniform(u)}o.uniformGPU=u}return s}}let ox=null,tc=null;class WD{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){ws("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t){ws(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);return}const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return ox=ox||new Oe,this.renderer.getDrawingBufferSize(ox)}setScissorTest(){}getClearColor(){const e=this.renderer;return tc=tc||new kS,e.getClearColor(tc),tc.getRGB(tc),tc}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:rN(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Kc} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let u7=0;class c7{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class h7{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:r}=n,s=e.array,o=e.usage||r.STATIC_DRAW,u=e.isInterleavedBufferAttribute?e.data:e,c=n.get(u);let f=c.bufferGPU;f===void 0&&(f=this._createBuffer(r,t,s,o),c.bufferGPU=f,c.bufferType=t,c.version=u.version);let d;if(s instanceof Float32Array)d=r.FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?d=r.HALF_FLOAT:d=r.UNSIGNED_SHORT;else if(s instanceof Int16Array)d=r.SHORT;else if(s instanceof Uint32Array)d=r.UNSIGNED_INT;else if(s instanceof Int32Array)d=r.INT;else if(s instanceof Int8Array)d=r.BYTE;else if(s instanceof Uint8Array)d=r.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)d=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let m={bufferGPU:f,bufferType:t,type:d,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:d===r.INT||d===r.UNSIGNED_INT||e.gpuType===Ri,id:u7++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const g=this._createBuffer(r,t,s,o);m=new c7(m,g)}n.set(e,m)}updateAttribute(e){const t=this.backend,{gl:n}=t,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),u=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(u,o.bufferGPU),c.length===0)n.bufferSubData(u,0,r);else{for(let f=0,d=c.length;f<d;f++){const m=c[f];n.bufferSubData(u,m.start*r.BYTES_PER_ELEMENT,r,m.start,m.count)}s.clearUpdateRanges()}n.bindBuffer(u,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(r),o=e.array,u=o.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,s);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,u,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,u),await t.utils._clientWaitAsync();const f=new e.array.constructor(o.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,f),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),f.buffer}_createBuffer(e,t,n,r){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,n,r),e.bindBuffer(t,null),s}}let lx,Mf;class f7{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;lx={[qi]:e.FUNC_ADD,[Ab]:e.FUNC_SUBTRACT,[wb]:e.FUNC_REVERSE_SUBTRACT},Mf={[wa]:e.ZERO,[Rb]:e.ONE,[Cb]:e.SRC_COLOR,[$f]:e.SRC_ALPHA,[Ob]:e.SRC_ALPHA_SATURATE,[Lb]:e.DST_COLOR,[Db]:e.DST_ALPHA,[Nb]:e.ONE_MINUS_SRC_COLOR,[Xf]:e.ONE_MINUS_SRC_ALPHA,[Ub]:e.ONE_MINUS_DST_COLOR,[Pb]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new xt().fromArray(t),this.currentViewport=new xt().fromArray(n),this._tempVec4=new xt}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==WC?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===Dx?t.cullFace(t.BACK):e===qC?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,r,s,o,u,c){const{gl:f}=this;if(e===br){this.currentBlendingEnabled===!0&&(this.disable(f.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(f.BLEND),this.currentBlendingEnabled=!0),e!==pc){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==qi||this.currentBlendEquationAlpha!==qi)&&(f.blendEquation(f.FUNC_ADD),this.currentBlendEquation=qi,this.currentBlendEquationAlpha=qi),c)switch(e){case rs:f.blendFuncSeparate(f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case bc:f.blendFunc(f.ONE,f.ONE);break;case Sc:f.blendFuncSeparate(f.ZERO,f.ONE_MINUS_SRC_COLOR,f.ZERO,f.ONE);break;case Tc:f.blendFuncSeparate(f.ZERO,f.SRC_COLOR,f.ZERO,f.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case rs:f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case bc:f.blendFunc(f.SRC_ALPHA,f.ONE);break;case Sc:f.blendFuncSeparate(f.ZERO,f.ONE_MINUS_SRC_COLOR,f.ZERO,f.ONE);break;case Tc:f.blendFunc(f.ZERO,f.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}s=s||t,o=o||n,u=u||r,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(f.blendEquationSeparate(lx[t],lx[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(n!==this.currentBlendSrc||r!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||u!==this.currentBlendDstAlpha)&&(f.blendFuncSeparate(Mf[n],Mf[r],Mf[o],Mf[u]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=u),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case Yf:t.depthFunc(t.NEVER);break;case Kf:t.depthFunc(t.ALWAYS);break;case Qf:t.depthFunc(t.LESS);break;case Ho:t.depthFunc(t.LEQUAL);break;case Zf:t.depthFunc(t.EQUAL);break;case Jf:t.depthFunc(t.GEQUAL);break;case ed:t.depthFunc(t.GREATER);break;case td:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentScissor.equals(s)===!1){const{gl:o}=this;o.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentViewport.equals(s)===!1){const{gl:o}=this;o.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:r}=this;e.side===Ji?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===Tn;t&&(s=!s),this.setFlipSided(s),e.blending===rs&&e.transparent===!1?this.setBlending(br):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let c=0;c<8;c++)c<n?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,n){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==t?(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let r=[],s=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const o=e.textures;if(r.length!==o.length||r[0]!==n.COLOR_ATTACHMENT0){for(let u=0,c=o.length;u<c;u++)r[u]=n.COLOR_ATTACHMENT0+u;r.length=o.length,s=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,s=!0);s&&n.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:r,currentTextureSlot:s,currentBoundTextures:o,maxTextures:u}=this;n===void 0&&(s===null?n=r.TEXTURE0+u-1:n=s);let c=o[n];c===void 0&&(c={type:void 0,texture:void 0},o[n]=c),(c.type!==e||c.texture!==t)&&(s!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,n){const{gl:r}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==n?(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[s]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class d7{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Vr){const{gl:n,extensions:r}=this;let s;if(e===Wn)return n.UNSIGNED_BYTE;if(e===Hg)return n.UNSIGNED_SHORT_4_4_4_4;if(e===jg)return n.UNSIGNED_SHORT_5_5_5_1;if(e===Wg)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===zl)return n.BYTE;if(e===kl)return n.SHORT;if(e===Ms)return n.UNSIGNED_SHORT;if(e===Ri)return n.INT;if(e===Sn)return n.UNSIGNED_INT;if(e===Yn)return n.FLOAT;if(e===Xi)return n.HALF_FLOAT;if(e===Ib)return n.ALPHA;if(e===Rd)return n.RGB;if(e===qn)return n.RGBA;if(e===zb)return n.LUMINANCE;if(e===kb)return n.LUMINANCE_ALPHA;if(e===jr)return n.DEPTH_COMPONENT;if(e===Wr)return n.DEPTH_STENCIL;if(e===Cd)return n.RED;if(e===Qc)return n.RED_INTEGER;if(e===Xl)return n.RG;if(e===Zc)return n.RG_INTEGER;if(e===Jc)return n.RGBA_INTEGER;if(e===Gl||e===Io||e===zo||e===ko)if(t===ut)if(s=r.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===Gl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Io)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===zo)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===ko)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=r.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===Gl)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Io)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===zo)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===ko)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===nd||e===id||e===rd||e===sd)if(s=r.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===nd)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===id)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===rd)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===sd)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===ad||e===Ec||e===Mc)if(s=r.get("WEBGL_compressed_texture_etc"),s!==null){if(e===ad||e===Ec)return t===ut?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===Mc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===Ac||e===wc||e===Rc||e===Cc||e===Nc||e===Dc||e===Pc||e===Lc||e===Uc||e===Oc||e===Bc||e===Fc||e===Ic||e===zc)if(s=r.get("WEBGL_compressed_texture_astc"),s!==null){if(e===Ac)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===wc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Rc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Cc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Nc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Dc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Pc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Lc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Uc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Oc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Bc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Fc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Ic)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===zc)return t===ut?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Vl)if(s=r.get("EXT_texture_compression_bptc"),s!==null){if(e===Vl)return t===ut?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Gb||e===od||e===ld||e===ud)if(s=r.get("EXT_texture_compression_rgtc"),s!==null){if(e===Vl)return s.COMPRESSED_RED_RGTC1_EXT;if(e===od)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===ld)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===ud)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Hr?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),r();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),n()}s()})}}let KR=!1,jm,ux,QR;class p7{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},KR===!1&&(this._init(),KR=!0)}_init(){const e=this.gl;jm={[ql]:e.REPEAT,[Hs]:e.CLAMP_TO_EDGE,[$l]:e.MIRRORED_REPEAT},ux={[Rn]:e.NEAREST,[Fb]:e.NEAREST_MIPMAP_NEAREST,[Oa]:e.NEAREST_MIPMAP_LINEAR,[gi]:e.LINEAR,[mc]:e.LINEAR_MIPMAP_NEAREST,[mr]:e.LINEAR_MIPMAP_LINEAR},QR={[Vb]:e.NEVER,[$b]:e.ALWAYS,[qg]:e.LESS,[$g]:e.LEQUAL,[Hb]:e.EQUAL,[qb]:e.GEQUAL,[jb]:e.GREATER,[Wb]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,r,s=!1){const{gl:o,extensions:u}=this;if(e!==null){if(o[e]!==void 0)return o[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;return t===o.RED&&(n===o.FLOAT&&(c=o.R32F),n===o.HALF_FLOAT&&(c=o.R16F),n===o.UNSIGNED_BYTE&&(c=o.R8),n===o.UNSIGNED_SHORT&&(c=o.R16),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.R8UI),n===o.UNSIGNED_SHORT&&(c=o.R16UI),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RG&&(n===o.FLOAT&&(c=o.RG32F),n===o.HALF_FLOAT&&(c=o.RG16F),n===o.UNSIGNED_BYTE&&(c=o.RG8),n===o.UNSIGNED_SHORT&&(c=o.RG16),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RG8UI),n===o.UNSIGNED_SHORT&&(c=o.RG16UI),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RGB&&(n===o.FLOAT&&(c=o.RGB32F),n===o.HALF_FLOAT&&(c=o.RGB16F),n===o.UNSIGNED_BYTE&&(c=o.RGB8),n===o.UNSIGNED_SHORT&&(c=o.RGB16),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I),n===o.UNSIGNED_BYTE&&(c=r===ut&&s===!1?o.SRGB8:o.RGB8),n===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),n===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5)),t===o.RGB_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGB8UI),n===o.UNSIGNED_SHORT&&(c=o.RGB16UI),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I)),t===o.RGBA&&(n===o.FLOAT&&(c=o.RGBA32F),n===o.HALF_FLOAT&&(c=o.RGBA16F),n===o.UNSIGNED_BYTE&&(c=o.RGBA8),n===o.UNSIGNED_SHORT&&(c=o.RGBA16),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I),n===o.UNSIGNED_BYTE&&(c=r===ut&&s===!1?o.SRGB8_ALPHA8:o.RGBA8),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)),t===o.RGBA_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),n===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(n===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),n===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),n===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&n===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&u.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:n,extensions:r,backend:s}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(e,n.TEXTURE_WRAP_S,jm[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,jm[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&n.texParameteri(e,n.TEXTURE_WRAP_R,jm[t.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,ux[t.magFilter]);const o=t.mipmaps!==void 0&&t.mipmaps.length>0,u=t.minFilter===gi&&o?mr:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,ux[u]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,QR[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Rn||t.minFilter!==Oa&&t.minFilter!==mr||t.type===Yn&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const c=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:r}=this,s=this.getGLTextureType(e);let o=r[s];o===void 0&&(o=t.createTexture(),n.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),r[s]=o),n.set(e,{textureGPU:o,glTextureType:s,isDefault:!0})}createTexture(e,t){const{gl:n,backend:r}=this,{levels:s,width:o,height:u,depth:c}=t,f=r.utils.convert(e.format,e.colorSpace),d=r.utils.convert(e.type),m=this.getInternalFormat(e.internalFormat,f,d,e.colorSpace,e.isVideoTexture),g=n.createTexture(),_=this.getGLTextureType(e);r.state.bindTexture(_,g),this.setTextureParameters(_,e),e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,s,m,o,u,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,s,m,o,u,c):e.isVideoTexture||n.texStorage2D(_,s,m,o,u),r.set(e,{textureGPU:g,glTextureType:_,glFormat:f,glType:d,glInternalFormat:m})}copyBufferToTexture(e,t){const{gl:n,backend:r}=this,{textureGPU:s,glTextureType:o,glFormat:u,glType:c}=r.get(t),{width:f,height:d}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(o,s),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(o,0,0,0,f,d,u,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:r,height:s}=t,{textureGPU:o,glTextureType:u,glFormat:c,glType:f,glInternalFormat:d}=this.backend.get(e);if(e.isRenderTargetTexture||o===void 0)return;const m=g=>g.isDataTexture?g.image.data:typeof HTMLImageElement<"u"&&g instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&g instanceof ImageBitmap||g instanceof OffscreenCanvas?g:g.data;if(this.backend.state.bindTexture(u,o),this.setTextureParameters(u,e),e.isCompressedTexture){const g=e.mipmaps,_=t.image;for(let v=0;v<g.length;v++){const S=g[v];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,v,0,0,0,S.width,S.height,_.depth,c,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,v,0,0,0,S.width,S.height,_.depth,c,f,S.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,v,0,0,S.width,S.height,c,S.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const g=t.images;for(let _=0;_<6;_++){const v=m(g[_]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+_,0,0,0,r,s,c,f,v)}}else if(e.isDataArrayTexture){const g=t.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,g.width,g.height,g.depth,c,f,g.data)}else if(e.isData3DTexture){const g=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,g.width,g.height,g.depth,c,f,g.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(u,0,d,c,f,t.image);else{const g=m(t.image);n.texSubImage2D(u,0,0,0,r,s,c,f,g)}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:r,glTextureType:s}=n.get(e);n.state.bindTexture(s,r),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const s in r.framebuffers)t.deleteFramebuffer(r.framebuffers[s]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let s=0;s<r.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(r.msaaRenderbuffers[s]);delete r.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:n}=this,{textureGPU:r,renderTarget:s}=n.get(e);this.deallocateRenderBuffers(s),t.deleteTexture(r),n.delete(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){const{gl:u,backend:c}=this,{state:f}=this.backend,{textureGPU:d,glTextureType:m,glType:g,glFormat:_}=c.get(t);f.bindTexture(m,d);let v,S,b,x,E,M,A,C,w;const N=e.isCompressedTexture?e.mipmaps[o]:e.image;if(n!==null)v=n.max.x-n.min.x,S=n.max.y-n.min.y,b=n.isBox3?n.max.z-n.min.z:1,x=n.min.x,E=n.min.y,M=n.isBox3?n.min.z:0;else{const ue=Math.pow(2,-s);v=Math.floor(N.width*ue),S=Math.floor(N.height*ue),e.isDataArrayTexture?b=N.depth:e.isData3DTexture?b=Math.floor(N.depth*ue):b=1,x=0,E=0,M=0}r!==null?(A=r.x,C=r.y,w=r.z):(A=0,C=0,w=0),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,t.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,t.unpackAlignment);const L=u.getParameter(u.UNPACK_ROW_LENGTH),P=u.getParameter(u.UNPACK_IMAGE_HEIGHT),D=u.getParameter(u.UNPACK_SKIP_PIXELS),I=u.getParameter(u.UNPACK_SKIP_ROWS),j=u.getParameter(u.UNPACK_SKIP_IMAGES);u.pixelStorei(u.UNPACK_ROW_LENGTH,N.width),u.pixelStorei(u.UNPACK_IMAGE_HEIGHT,N.height),u.pixelStorei(u.UNPACK_SKIP_PIXELS,x),u.pixelStorei(u.UNPACK_SKIP_ROWS,E),u.pixelStorei(u.UNPACK_SKIP_IMAGES,M);const J=t.isDataArrayTexture||t.isData3DTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const ue=c.get(e),$=c.get(t),k=c.get(ue.renderTarget),G=c.get($.renderTarget),W=k.framebuffers[ue.cacheKey],ce=G.framebuffers[$.cacheKey];f.bindFramebuffer(u.READ_FRAMEBUFFER,W),f.bindFramebuffer(u.DRAW_FRAMEBUFFER,ce);let z=u.COLOR_BUFFER_BIT;e.isDepthTexture&&(z=u.DEPTH_BUFFER_BIT),u.blitFramebuffer(x,E,v,S,A,C,v,S,z,u.NEAREST),f.bindFramebuffer(u.READ_FRAMEBUFFER,null),f.bindFramebuffer(u.DRAW_FRAMEBUFFER,null)}else J?e.isDataTexture||e.isData3DTexture?u.texSubImage3D(m,o,A,C,w,v,S,b,_,g,N.data):t.isCompressedArrayTexture?u.compressedTexSubImage3D(m,o,A,C,w,v,S,b,_,N.data):u.texSubImage3D(m,o,A,C,w,v,S,b,_,g,N):e.isDataTexture?u.texSubImage2D(m,o,A,C,v,S,_,g,N.data):e.isCompressedTexture?u.compressedTexSubImage2D(m,o,A,C,N.width,N.height,_,N.data):u.texSubImage2D(m,o,A,C,v,S,_,g,N);u.pixelStorei(u.UNPACK_ROW_LENGTH,L),u.pixelStorei(u.UNPACK_IMAGE_HEIGHT,P),u.pixelStorei(u.UNPACK_SKIP_PIXELS,D),u.pixelStorei(u.UNPACK_SKIP_ROWS,I),u.pixelStorei(u.UNPACK_SKIP_IMAGES,j),o===0&&t.generateMipmaps&&u.generateMipmap(m),f.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:r}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:u,y:c,z:f,w:d}=n,m=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,g=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(m){const _=u!==0||c!==0;let v,S;if(e.isDepthTexture===!0?(v=r.DEPTH_BUFFER_BIT,S=r.DEPTH_ATTACHMENT,t.stencil&&(v|=r.STENCIL_BUFFER_BIT)):(v=r.COLOR_BUFFER_BIT,S=r.COLOR_ATTACHMENT0),_){const b=this.backend.get(t.renderTarget),x=b.framebuffers[t.getCacheKey()],E=b.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,x),s.bindFramebuffer(r.READ_FRAMEBUFFER,E);const M=g-c-d;r.blitFramebuffer(u,M,u+f,M+d,u,M,u+f,M+d,v,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,x),s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,u,M,f,d),s.unbindTexture()}else{const b=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,b),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,S,r.TEXTURE_2D,o,0),r.blitFramebuffer(0,0,f,d,0,0,f,d,v,r.NEAREST),r.deleteFramebuffer(b)}}else s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,u,g-d-c,f,d),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,r=!1){const{gl:s}=this,o=t.renderTarget,{depthTexture:u,depthBuffer:c,stencilBuffer:f,width:d,height:m}=o;if(s.bindRenderbuffer(s.RENDERBUFFER,e),c&&!f){let g=s.DEPTH_COMPONENT24;r===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,o.samples,g,d,m):n>0?(u&&u.isDepthTexture&&u.type===s.FLOAT&&(g=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,g,d,m)):s.renderbufferStorage(s.RENDERBUFFER,g,d,m),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else c&&f&&(n>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,d,m):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,d,m),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,n,r,s,o){const{backend:u,gl:c}=this,{textureGPU:f,glFormat:d,glType:m}=this.backend.get(e),g=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,g);const _=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,_,f,0);const v=this._getTypedArrayType(m),S=this._getBytesPerTexel(m,d),x=r*s*S,E=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,E),c.bufferData(c.PIXEL_PACK_BUFFER,x,c.STREAM_READ),c.readPixels(t,n,r,s,d,m,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await u.utils._clientWaitAsync();const M=new v(x/v.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,E),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,M),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(g),M}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let r=0;if(e===n.UNSIGNED_BYTE&&(r=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(r=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(r=4),t===n.RGBA)return r*4;if(t===n.RGB)return r*3;if(t===n.ALPHA)return r}}class m7{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class g7{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const ZR={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class _7{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:r,object:s,type:o,info:u,index:c}=this;c!==0?n.drawElements(r,t,o,e):n.drawArrays(r,e,t),u.update(s,t,1)}renderInstances(e,t,n){const{gl:r,mode:s,type:o,index:u,object:c,info:f}=this;n!==0&&(u!==0?r.drawElementsInstanced(s,t,o,e,n):r.drawArraysInstanced(s,e,t,n),f.update(c,t,n))}renderMultiDraw(e,t,n){const{extensions:r,mode:s,object:o,info:u}=this;if(n===0)return;const c=r.get("WEBGL_multi_draw");if(c===null)for(let f=0;f<n;f++)this.render(e[f],t[f]);else{this.index!==0?c.multiDrawElementsWEBGL(s,t,0,this.type,e,0,n):c.multiDrawArraysWEBGL(s,e,0,t,0,n);let f=0;for(let d=0;d<n;d++)f+=t[d];u.update(o,f,1)}}renderMultiDrawInstances(e,t,n,r){const{extensions:s,mode:o,object:u,info:c}=this;if(n===0)return;const f=s.get("WEBGL_multi_draw");if(f===null)for(let d=0;d<n;d++)this.renderInstances(e[d],t[d],r[d]);else{this.index!==0?f.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,r,0,n):f.multiDrawArraysInstancedWEBGL(o,e,0,t,0,r,0,n);let d=0;for(let m=0;m<n;m++)d+=t[m]*r[m];c.update(u,d,1)}}}class qD{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class v7 extends qD{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return ws(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){console.error("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){console.error("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[r,s]of this.queryStates)if(s==="ended"){const o=this.queries[r];e.push(this.resolveQuery(o))}if(e.length===0)return this.lastValue;const n=(await Promise.all(e)).reduce((r,s)=>r+s,0);return this.lastValue=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,n}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,r=!1;const s=()=>{n&&(clearTimeout(n),n=null)},o=c=>{r||(r=!0,s(),t(c))},u=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(u,1);return}const d=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(d)/1e6)}catch(c){console.error("Error checking query:",c),t(this.lastValue)}};u()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class JR extends WD{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function s(o){o.preventDefault();const u={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(u)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=r,this.extensions=new m7(this),this.capabilities=new g7(this),this.attributeUtils=new h7(this),this.textureUtils=new p7(this),this.bufferRenderer=new _7(this),this.state=new f7(this),this.utils=new d7(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return gr}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),n!==null){const s=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e.autoAllocateDepthBuffer=!1}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new v7(this.gl,t,2048));const n=this.timestampQueryPool[t];n.allocateQueriesForContext(e)!==null&&n.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t,gl:n}=this,r=this.get(e);if(e.viewport?this.updateViewport(e):t.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),e.scissor){const{x:o,y:u,width:c,height:f}=e.scissorValue;t.scissor(o,e.height-f-u,c,f)}this.initTimestampQuery(e),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const s=e.occlusionQueryCount;s>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(s),r.occlusionQueryObjects=new Array(s),r.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,r=this.get(e),s=r.previousContext;n.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const u=e.textures;if(u!==null)for(let c=0;c<u.length;c++){const f=u[c];f.generateMipmaps&&this.generateMipmaps(f)}if(this._currentContext=s,e.textures!==null&&e.renderTarget){const c=this.get(e.renderTarget),{samples:f}=e.renderTarget;if(f>0&&this._useMultisampledRTT(e.renderTarget)===!1){const d=c.framebuffers[e.getCacheKey()],m=t.COLOR_BUFFER_BIT,g=c.msaaFrameBuffer,_=e.textures;n.bindFramebuffer(t.READ_FRAMEBUFFER,g),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,d);for(let v=0;v<_.length;v++)if(e.scissor){const{x:S,y:b,width:x,height:E}=e.scissorValue,M=e.height-E-b;t.blitFramebuffer(S,M,S+x,M+E,S,M,S+x,M+E,m,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,c.invalidationArray,S,M,x,E)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,m,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,c.invalidationArray)}}s!==null&&(this._setFramebuffer(s),s.viewport?this.updateViewport(s):n.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const u=()=>{let c=0;for(let f=0;f<n.length;f++){const d=n[f];d!==null&&o.getQueryParameter(d,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(d,o.QUERY_RESULT)===0&&s.add(r[f]),n[f]=null,o.deleteQuery(d),c++)}c<n.length?requestAnimationFrame(u):t.occluded=s};u()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:r,width:s,height:o}=e.viewportValue;t.viewport(n,e.height-o-r,s,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,r=null,s=!0){const{gl:o,renderer:u}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let c=0;if(e&&(c|=o.COLOR_BUFFER_BIT),t&&(c|=o.DEPTH_BUFFER_BIT),n&&(c|=o.STENCIL_BUFFER_BIT),c!==0){let f;r.clearColorValue?f=r.clearColorValue:f=this.getClearColor();const d=u.getClearDepth(),m=u.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)o.clearColor(f.r,f.g,f.b,f.a),o.clear(c);else{if(s&&this._setFramebuffer(r),e)for(let g=0;g<r.textures.length;g++)g===0?o.clearBufferfv(o.COLOR,g,[f.r,f.g,f.b,f.a]):o.clearBufferfv(o.COLOR,g,[0,0,0,1]);t&&n?o.clearBufferfi(o.DEPTH_STENCIL,0,d,m):t?o.clearBufferfv(o.DEPTH,0,[d]):n&&o.clearBufferiv(o.STENCIL,0,[m])}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,n,r){const{state:s,gl:o}=this;this.discard===!1&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:u,transformBuffers:c,attributes:f}=this.get(r),d=this._getVaoKey(f),m=this.vaoCache[d];m===void 0?this._createVao(f):s.setVertexState(m),s.useProgram(u),this._bindUniforms(n);const g=this._getTransformFeedback(c);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,g),o.beginTransformFeedback(o.POINTS),f[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,t.count):o.drawArrays(o.POINTS,0,t.count),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let _=0;_<c.length;_++){const v=c[_];v.pbo&&this.textureUtils.copyBufferToTexture(v.transformBuffer,v.pbo),v.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:t,pipeline:n,material:r,context:s,hardwareClippingPlanes:o}=e,{programGPU:u}=this.get(n),{gl:c,state:f}=this,d=this.get(s),m=e.getDrawParameters();if(m===null)return;this._bindUniforms(e.getBindings());const g=t.isMesh&&t.matrixWorld.determinant()<0;f.setMaterial(r,g,o),f.useProgram(u);const _=this.get(e);let v=_.staticVao;if(v===void 0||_.geometryId!==e.geometry.id){const N=this._getVaoKey(e.getAttributes());if(v=this.vaoCache[N],v===void 0){let L;({vaoGPU:v,staticVao:L}=this._createVao(e.getAttributes())),L&&(_.staticVao=v,_.geometryId=e.geometry.id)}}const S=e.getIndex(),b=S!==null?this.get(S).bufferGPU:null;f.setVertexState(v,b);const x=d.lastOcclusionObject;if(x!==t&&x!==void 0){if(x!==null&&x.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),d.occlusionQueryIndex++),t.occlusionTest===!0){const N=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,N),d.occlusionQueries[d.occlusionQueryIndex]=N,d.occlusionQueryObjects[d.occlusionQueryIndex]=t}d.lastOcclusionObject=t}const E=this.bufferRenderer;t.isPoints?E.mode=c.POINTS:t.isLineSegments?E.mode=c.LINES:t.isLine?E.mode=c.LINE_STRIP:t.isLineLoop?E.mode=c.LINE_LOOP:r.wireframe===!0?(f.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),E.mode=c.LINES):E.mode=c.TRIANGLES;const{vertexCount:M,instanceCount:A}=m;let{firstVertex:C}=m;if(E.object=t,S!==null){C*=S.array.BYTES_PER_ELEMENT;const N=this.get(S);E.index=S.count,E.type=N.type}else E.index=0;const w=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(ws("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),E.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?E.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):ws("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):A>1?E.renderInstances(C,M,A):E.render(C,M)};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const N=this.get(e.camera),L=e.camera.cameras,P=e.getBindingGroup("cameraIndex").bindings[0];if(N.indexesGPU===void 0||N.indexesGPU.length!==L.length){const j=new Uint32Array([0,0,0,0]),J=[];for(let ue=0,$=L.length;ue<$;ue++){const k=c.createBuffer();j[0]=ue,c.bindBuffer(c.UNIFORM_BUFFER,k),c.bufferData(c.UNIFORM_BUFFER,j,c.STATIC_DRAW),J.push(k)}N.indexesGPU=J}const D=this.get(P),I=this.renderer.getPixelRatio();for(let j=0,J=L.length;j<J;j++){const ue=L[j];if(t.layers.test(ue.layers)){const $=ue.viewport,k=$.x*I,G=$.y*I,W=$.width*I,ce=$.height*I;f.viewport(Math.floor(k),Math.floor(e.context.height-ce-G),Math.floor(W),Math.floor(ce)),f.bindBufferBase(c.UNIFORM_BUFFER,D.index,N.indexesGPU[j]),w()}}}else w()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,o)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new l7(e,t)}createProgram(e){const t=this.gl,{stage:n,code:r}=e,s=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,r),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:o}=r,u=n.createProgram(),c=this.get(s).shaderGPU,f=this.get(o).shaderGPU;if(n.attachShader(u,c),n.attachShader(u,f),n.linkProgram(u),this.set(r,{programGPU:u,fragmentShader:c,vertexShader:f}),t!==null&&this.parallel){const d=new Promise(m=>{const g=this.parallel,_=()=>{n.getProgramParameter(u,g.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),m()):requestAnimationFrame(_)};_()});t.push(d);return}this._completeCompile(e,r)}_handleSource(e,t){const n=e.split(`
`),r=[],s=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let u=s;u<o;u++){const c=u+1;r.push(`${c===t?">":" "} ${c}: ${n[u]}`)}return r.join(`
`)}_getShaderErrors(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(r&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const u=parseInt(o[1]);return n.toUpperCase()+`

`+s+`

`+this._handleSource(e.getShaderSource(t),u)}else return s}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,s=r.getProgramInfoLog(e).trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,n,t);else{const o=this._getShaderErrors(r,n,"vertex"),u=this._getShaderErrors(r,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+s+`
`+o+`
`+u)}else s!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",s)}}_completeCompile(e,t){const{state:n,gl:r}=this,s=this.get(t),{programGPU:o,fragmentShader:u,vertexShader:c}=s;r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,u,c),n.useProgram(o);const f=e.getBindings();this._setupBindings(f,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:n,gl:r}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,u=r.createProgram(),c=this.get(s).shaderGPU,f=this.get(o).shaderGPU,d=o.transforms,m=[],g=[];for(let b=0;b<d.length;b++){const x=d[b];m.push(x.varyingName),g.push(x.attributeNode)}r.attachShader(u,c),r.attachShader(u,f),r.transformFeedbackVaryings(u,m,r.SEPARATE_ATTRIBS),r.linkProgram(u),r.getProgramParameter(u,r.LINK_STATUS)===!1&&this._logProgramError(u,c,f),n.useProgram(u),this._setupBindings(t,u);const _=o.attributes,v=[],S=[];for(let b=0;b<_.length;b++){const x=_[b].node.attribute;v.push(x),this.has(x)||this.attributeUtils.createAttribute(x,r.ARRAY_BUFFER)}for(let b=0;b<g.length;b++){const x=g[b].attribute;this.has(x)||this.attributeUtils.createAttribute(x,r.ARRAY_BUFFER);const E=this.get(x);S.push(E)}this.set(e,{programGPU:u,transformBuffers:S,attributes:v})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,r=0;for(const s of t){this.set(s,{textures:r,uniformBuffers:n});for(const o of s.bindings)o.isUniformBuffer&&n++,o.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let r=n.uniformBuffers,s=n.textures;for(const o of e.bindings)if(o.isUniformsGroup||o.isUniformBuffer){const u=o.buffer,c=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,c),t.bufferData(t.UNIFORM_BUFFER,u,t.DYNAMIC_DRAW),this.set(o,{index:r++,bufferGPU:c})}else if(o.isSampledTexture){const{textureGPU:u,glTextureType:c}=this.get(o.texture);this.set(o,{index:s++,textureGPU:u,glTextureType:c})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(ZR).filter(r=>ZR[r]===e),n=this.extensions;for(let r=0;r<t.length;r++)if(n.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){this.textureUtils.copyTextureToTexture(e,t,n,r,s,o)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let r=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:u,depthBuffer:c,stencilBuffer:f}=s,d=s.isWebGLCubeRenderTarget===!0,m=s.isRenderTarget3D===!0,g=s.isRenderTargetArray===!0,_=s.isXRRenderTarget===!0,v=_===!0&&s.hasExternalTextures===!0;let S=o.msaaFrameBuffer,b=o.depthRenderbuffer;const x=this.extensions.get("WEBGL_multisampled_render_to_texture"),E=this._useMultisampledRTT(s),M=TD(e);let A;if(d?(o.cubeFramebuffers||(o.cubeFramebuffers={}),A=o.cubeFramebuffers[M]):_&&v===!1?A=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),A=o.framebuffers[M]),A===void 0){A=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,A);const C=e.textures;if(d){o.cubeFramebuffers[M]=A;const{textureGPU:w}=this.get(C[0]),N=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+N,w,0)}else{o.framebuffers[M]=A;for(let w=0;w<C.length;w++){const N=C[w],L=this.get(N);L.renderTarget=e.renderTarget,L.cacheKey=M;const P=t.COLOR_ATTACHMENT0+w;if(m||g){const D=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,P,L.textureGPU,0,D)}else v&&E?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,P,t.TEXTURE_2D,L.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,P,t.TEXTURE_2D,L.textureGPU,0)}n.drawBuffers(e,A)}if(s.isXRRenderTarget&&s.autoAllocateDepthBuffer===!0){const w=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(w,e,0,E),o.xrDepthRenderbuffer=w}else if(e.depthTexture!==null){const w=this.get(e.depthTexture),N=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;w.renderTarget=e.renderTarget,w.cacheKey=M,v&&E?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,N,t.TEXTURE_2D,w.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,N,t.TEXTURE_2D,w.textureGPU,0)}}else if(_&&v){n.bindFramebuffer(t.FRAMEBUFFER,A);const C=this.get(e.textures[0]);E?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,C.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,C.textureGPU,0);const w=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s.autoAllocateDepthBuffer===!0){const N=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,N),t.framebufferRenderbuffer(t.FRAMEBUFFER,w,t.RENDERBUFFER,N)}else{const N=this.get(e.depthTexture);E?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,w,t.TEXTURE_2D,N.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,w,t.TEXTURE_2D,N.textureGPU,0)}}if(u>0&&E===!1){if(S===void 0){const C=[];S=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,S);const w=[],N=e.textures;for(let L=0;L<N.length;L++){if(w[L]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,w[L]),C.push(t.COLOR_ATTACHMENT0+L),c){const I=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;C.push(I)}const P=e.textures[L],D=this.get(P);t.renderbufferStorageMultisample(t.RENDERBUFFER,u,D.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+L,t.RENDERBUFFER,w[L])}if(o.msaaFrameBuffer=S,o.msaaRenderbuffers=w,b===void 0){b=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(b,e,u),o.depthRenderbuffer=b;const L=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;C.push(L)}o.invalidationArray=C}r=o.msaaFrameBuffer}else r=A}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const r=this.get(e[n]);t+=":"+r.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();let r="",s=!0;t.bindVertexArray(n);for(let o=0;o<e.length;o++){const u=e[o],c=this.get(u);r+=":"+c.id,t.bindBuffer(t.ARRAY_BUFFER,c.bufferGPU),t.enableVertexAttribArray(o),(u.isStorageBufferAttribute||u.isStorageInstancedBufferAttribute)&&(s=!1);let f,d;u.isInterleavedBufferAttribute===!0?(f=u.data.stride*c.bytesPerElement,d=u.offset*c.bytesPerElement):(f=0,d=0),c.isInteger?t.vertexAttribIPointer(o,u.itemSize,c.type,f,d):t.vertexAttribPointer(o,u.itemSize,c.type,u.normalized,f,d),u.isInstancedBufferAttribute&&!u.isInterleavedBufferAttribute?t.vertexAttribDivisor(o,u.meshPerAttribute):u.isInterleavedBufferAttribute&&u.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(o,u.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[r]=n,{vaoGPU:n,staticVao:s}}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let s=0;s<e.length;s++){const o=e[s];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const r of e)for(const s of r.bindings){const u=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const c=n.getUniformBlockIndex(t,s.name);n.uniformBlockBinding(t,c,u)}else if(s.isSampledTexture){const c=n.getUniformLocation(t,s.name);n.uniform1i(c,u)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const r of e)for(const s of r.bindings){const o=this.get(s),u=o.index;s.isUniformsGroup||s.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,u,o.bufferGPU):s.isSampledTexture&&n.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+u)}}_useMultisampledRTT(e){return e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer!==!1}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const dc={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Oi={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},wi={Store:"store"},wn={Load:"load",Clear:"clear"},cx={CCW:"ccw"},hx={None:"none",Front:"front",Back:"back"},Wc={Uint16:"uint16",Uint32:"uint32"},Q={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},fx={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Fl={Linear:"linear",Nearest:"nearest"},At={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Al={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},eC={None:0,All:15},Lo={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},dx={Storage:"storage",ReadOnlyStorage:"read-only-storage"},px={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},nc={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},tC={TwoD:"2d",ThreeD:"3d"},fr={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},y7={All:"all"},Wm={Vertex:"vertex",Instance:"instance"},sb={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class x7 extends HS{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class b7 extends x7{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){this.texture=this.textureNode.value}}class S7 extends zD{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let T7=0;class E7 extends S7{constructor(e,t){super("StorageBuffer_"+T7++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Fa.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class M7 extends Ko{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Fl.Linear}),this.flipYSampler=e.createSampler({minFilter:Fl.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:dc.TriangleStrip,stripIndexFormat:Wc.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:dc.TriangleStrip,stripIndexFormat:Wc.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const r=t.format,{width:s,height:o}=t.size,u=this.getTransferPipeline(r),c=this.getFlipYPipeline(r),f=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),d=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:fr.TwoD,baseArrayLayer:n}),m=f.createView({baseMipLevel:0,mipLevelCount:1,dimension:fr.TwoD,baseArrayLayer:0}),g=this.device.createCommandEncoder({}),_=(v,S,b)=>{const x=v.getBindGroupLayout(0),E=this.device.createBindGroup({layout:x,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:S}]}),M=g.beginRenderPass({colorAttachments:[{view:b,loadOp:wn.Clear,storeOp:wi.Store,clearValue:[0,0,0,0]}]});M.setPipeline(v),M.setBindGroup(0,E),M.draw(4,1,0,0),M.end()};_(u,d,m),_(c,m,d),this.device.queue.submit([g.finish()]),f.destroy()}generateMipmaps(e,t,n=0){const r=this.get(e);r.useCount===void 0&&(r.useCount=0,r.layers=[]);const s=r.layers[n]||this._mipmapCreateBundles(e,t,n),o=this.device.createCommandEncoder({});this._mipmapRunBundles(o,s),this.device.queue.submit([o.finish()]),r.useCount!==0&&(r.layers[n]=s),r.useCount++}_mipmapCreateBundles(e,t,n){const r=this.getTransferPipeline(t.format),s=r.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:fr.TwoD,baseArrayLayer:n});const u=[];for(let c=1;c<t.mipLevelCount;c++){const f=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),d=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:fr.TwoD,baseArrayLayer:n}),m={colorAttachments:[{view:d,loadOp:wn.Clear,storeOp:wi.Store,clearValue:[0,0,0,0]}]},g=this.device.createRenderBundleEncoder({colorFormats:[t.format]});g.setPipeline(r),g.setBindGroup(0,f),g.draw(4,1,0,0),u.push({renderBundles:[g.finish()],passDescriptor:m}),o=d}return u}_mipmapRunBundles(e,t){const n=t.length;for(let r=0;r<n;r++){const s=t[r],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}}const A7={[Vb]:"never",[qg]:"less",[Hb]:"equal",[$g]:"less-equal",[jb]:"greater",[qb]:"greater-equal",[$b]:"always",[Wb]:"not-equal"},w7=[0,1,3,2,4,5];class R7{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new ss,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,n=t.device,r=t.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===Fl.Linear&&s.minFilter===Fl.Linear&&s.mipmapFilter===Fl.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(s.compare=A7[e.compareFunction]),r.sampler=n.createSampler(s)}createDefaultTexture(e){let t;const n=ab(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,r=n.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:u,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const f=this._getDimension(e),d=e.internalFormat||t.format||ab(e,n.device);r.format=d;const{samples:m,primarySamples:g,isMSAA:_}=n.utils.getTextureSampleData(e);let v=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(v|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(v|=GPUTextureUsage.RENDER_ATTACHMENT);const S={label:e.name,size:{width:s,height:o,depthOrArrayLayers:u},mipLevelCount:c,sampleCount:g,dimension:f,format:d,usage:v};if(e.isVideoTexture){const b=e.source.data,x=new VideoFrame(b);S.size.width=x.displayWidth,S.size.height=x.displayHeight,x.close(),r.externalTexture=b}else{if(d===void 0){console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}r.texture=n.device.createTexture(S)}if(_){const b=Object.assign({},S);b.label=b.label+"-msaa",b.sampleCount=m,r.msaaTexture=n.device.createTexture(b)}r.initialized=!0,r.textureDescriptorGPU=S}destroyTexture(e){const t=this.backend,n=t.get(e);n.texture!==void 0&&n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const n=this.backend.get(e);delete n.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let r=0;r<n;r++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,r)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const n=this.backend,{width:r,height:s}=n.getDrawingBufferSize(),o=this.depthTexture,u=n.get(o).texture;let c,f;if(t?(c=Wr,f=Hr):e&&(c=jr,f=Sn),u!==void 0){if(o.image.width===r&&o.image.height===s&&o.format===c&&o.type===f)return u;this.destroyTexture(o)}return o.name="depthBuffer",o.format=c,o.type=f,o.image.width=r,o.image.height=s,this.createTexture(o,{width:r,height:s}),n.get(o).texture}updateTexture(e,t){const n=this.backend.get(e),{textureDescriptorGPU:r}=n;if(!(e.isRenderTargetTexture||r===void 0)){if(e.isDataTexture)this._copyBufferToTexture(t.image,n.texture,r,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let s=0;s<t.image.depth;s++)this._copyBufferToTexture(t.image,n.texture,r,s,e.flipY,s);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,n.texture,r,e.flipY);else if(e.isVideoTexture){const s=e.source.data;n.externalTexture=s}else this._copyImageToTexture(t.image,n.texture,r,0,e.flipY);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,n,r,s,o){const u=this.backend.device,c=this.backend.get(e),f=c.texture,d=c.textureDescriptorGPU.format,m=this._getBytesPerTexel(d);let g=r*m;g=Math.ceil(g/256)*256;const _=u.createBuffer({size:r*s*m,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),v=u.createCommandEncoder();v.copyTextureToBuffer({texture:f,origin:{x:t,y:n,z:o}},{buffer:_,bytesPerRow:g},{width:r,height:s});const S=this._getTypedArrayType(d);u.queue.submit([v.finish()]),await _.mapAsync(GPUMapMode.READ);const b=_.getMappedRange();return new S(b)}_isEnvironmentTexture(e){const t=e.mapping;return t===jo||t===Wo||t===os||t===ls}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new _i;n.minFilter=Rn,n.magFilter=Rn,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new Yg;n.minFilter=Rn,n.magFilter=Rn,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,n,r){for(let s=0;s<6;s++){const o=e[s],u=r===!0?w7[s]:s;o.isDataTexture?this._copyBufferToTexture(o.image,t,n,u,r):this._copyImageToTexture(o,t,n,u,r)}}_copyImageToTexture(e,t,n,r,s){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new M7(this.backend.device)),e}_generateMipmaps(e,t,n=0){this._getPassUtils().generateMipmaps(e,t,n)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,s,o=0){const u=this.backend.device,c=e.data,f=this._getBytesPerTexel(n.format),d=e.width*f;u.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},c,{offset:e.width*e.height*f*o,bytesPerRow:d},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){const r=this.backend.device,s=this._getBlockData(n.format),o=n.size.depthOrArrayLayers>1;for(let u=0;u<e.length;u++){const c=e[u],f=c.width,d=c.height,m=o?n.size.depthOrArrayLayers:1,g=Math.ceil(f/s.width)*s.byteLength,_=g*Math.ceil(d/s.height);for(let v=0;v<m;v++)r.queue.writeTexture({texture:t,mipLevel:u,origin:{x:0,y:0,z:v}},c.data,{offset:v*_,bytesPerRow:g,rowsPerImage:Math.ceil(d/s.height)},{width:Math.ceil(f/s.width)*s.width,height:Math.ceil(d/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===Q.BC1RGBAUnorm||e===Q.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===Q.BC2RGBAUnorm||e===Q.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===Q.BC3RGBAUnorm||e===Q.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===Q.BC4RUnorm||e===Q.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===Q.BC5RGUnorm||e===Q.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===Q.BC6HRGBUFloat||e===Q.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===Q.BC7RGBAUnorm||e===Q.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===Q.ETC2RGB8Unorm||e===Q.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===Q.ETC2RGB8A1Unorm||e===Q.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===Q.ETC2RGBA8Unorm||e===Q.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===Q.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===Q.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===Q.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===Q.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===Q.ASTC4x4Unorm||e===Q.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===Q.ASTC5x4Unorm||e===Q.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===Q.ASTC5x5Unorm||e===Q.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===Q.ASTC6x5Unorm||e===Q.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===Q.ASTC6x6Unorm||e===Q.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===Q.ASTC8x5Unorm||e===Q.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===Q.ASTC8x6Unorm||e===Q.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===Q.ASTC8x8Unorm||e===Q.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===Q.ASTC10x5Unorm||e===Q.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===Q.ASTC10x6Unorm||e===Q.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===Q.ASTC10x8Unorm||e===Q.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===Q.ASTC10x10Unorm||e===Q.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===Q.ASTC12x10Unorm||e===Q.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===Q.ASTC12x12Unorm||e===Q.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=fx.ClampToEdge;return e===ql?t=fx.Repeat:e===$l&&(t=fx.MirrorRepeat),t}_convertFilterMode(e){let t=Fl.Linear;return(e===Rn||e===Fb||e===Oa)&&(t=Fl.Nearest),t}_getBytesPerTexel(e){if(e===Q.R8Unorm||e===Q.R8Snorm||e===Q.R8Uint||e===Q.R8Sint)return 1;if(e===Q.R16Uint||e===Q.R16Sint||e===Q.R16Float||e===Q.RG8Unorm||e===Q.RG8Snorm||e===Q.RG8Uint||e===Q.RG8Sint)return 2;if(e===Q.R32Uint||e===Q.R32Sint||e===Q.R32Float||e===Q.RG16Uint||e===Q.RG16Sint||e===Q.RG16Float||e===Q.RGBA8Unorm||e===Q.RGBA8UnormSRGB||e===Q.RGBA8Snorm||e===Q.RGBA8Uint||e===Q.RGBA8Sint||e===Q.BGRA8Unorm||e===Q.BGRA8UnormSRGB||e===Q.RGB9E5UFloat||e===Q.RGB10A2Unorm||e===Q.RG11B10UFloat||e===Q.Depth32Float||e===Q.Depth24Plus||e===Q.Depth24PlusStencil8||e===Q.Depth32FloatStencil8)return 4;if(e===Q.RG32Uint||e===Q.RG32Sint||e===Q.RG32Float||e===Q.RGBA16Uint||e===Q.RGBA16Sint||e===Q.RGBA16Float)return 8;if(e===Q.RGBA32Uint||e===Q.RGBA32Sint||e===Q.RGBA32Float)return 16}_getTypedArrayType(e){if(e===Q.R8Uint)return Uint8Array;if(e===Q.R8Sint)return Int8Array;if(e===Q.R8Unorm)return Uint8Array;if(e===Q.R8Snorm)return Int8Array;if(e===Q.RG8Uint)return Uint8Array;if(e===Q.RG8Sint)return Int8Array;if(e===Q.RG8Unorm)return Uint8Array;if(e===Q.RG8Snorm)return Int8Array;if(e===Q.RGBA8Uint)return Uint8Array;if(e===Q.RGBA8Sint)return Int8Array;if(e===Q.RGBA8Unorm)return Uint8Array;if(e===Q.RGBA8Snorm)return Int8Array;if(e===Q.R16Uint)return Uint16Array;if(e===Q.R16Sint)return Int16Array;if(e===Q.RG16Uint)return Uint16Array;if(e===Q.RG16Sint)return Int16Array;if(e===Q.RGBA16Uint)return Uint16Array;if(e===Q.RGBA16Sint)return Int16Array;if(e===Q.R16Float||e===Q.RG16Float||e===Q.RGBA16Float)return Uint16Array;if(e===Q.R32Uint)return Uint32Array;if(e===Q.R32Sint)return Int32Array;if(e===Q.R32Float)return Float32Array;if(e===Q.RG32Uint)return Uint32Array;if(e===Q.RG32Sint)return Int32Array;if(e===Q.RG32Float)return Float32Array;if(e===Q.RGBA32Uint)return Uint32Array;if(e===Q.RGBA32Sint)return Int32Array;if(e===Q.RGBA32Float)return Float32Array;if(e===Q.BGRA8Unorm||e===Q.BGRA8UnormSRGB)return Uint8Array;if(e===Q.RGB10A2Unorm||e===Q.RGB9E5UFloat||e===Q.RG11B10UFloat)return Uint32Array;if(e===Q.Depth32Float)return Float32Array;if(e===Q.Depth24Plus||e===Q.Depth24PlusStencil8)return Uint32Array;if(e===Q.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.isData3DTexture?t=tC.ThreeD:t=tC.TwoD,t}}function ab(i,e=null){const t=i.format,n=i.type,r=i.colorSpace;let s;if(i.isCompressedTexture===!0||i.isCompressedArrayTexture===!0)switch(t){case Io:s=r===ut?Q.BC1RGBAUnormSRGB:Q.BC1RGBAUnorm;break;case zo:s=r===ut?Q.BC2RGBAUnormSRGB:Q.BC2RGBAUnorm;break;case ko:s=r===ut?Q.BC3RGBAUnormSRGB:Q.BC3RGBAUnorm;break;case Ec:s=r===ut?Q.ETC2RGB8UnormSRGB:Q.ETC2RGB8Unorm;break;case Mc:s=r===ut?Q.ETC2RGBA8UnormSRGB:Q.ETC2RGBA8Unorm;break;case Ac:s=r===ut?Q.ASTC4x4UnormSRGB:Q.ASTC4x4Unorm;break;case wc:s=r===ut?Q.ASTC5x4UnormSRGB:Q.ASTC5x4Unorm;break;case Rc:s=r===ut?Q.ASTC5x5UnormSRGB:Q.ASTC5x5Unorm;break;case Cc:s=r===ut?Q.ASTC6x5UnormSRGB:Q.ASTC6x5Unorm;break;case Nc:s=r===ut?Q.ASTC6x6UnormSRGB:Q.ASTC6x6Unorm;break;case Dc:s=r===ut?Q.ASTC8x5UnormSRGB:Q.ASTC8x5Unorm;break;case Pc:s=r===ut?Q.ASTC8x6UnormSRGB:Q.ASTC8x6Unorm;break;case Lc:s=r===ut?Q.ASTC8x8UnormSRGB:Q.ASTC8x8Unorm;break;case Uc:s=r===ut?Q.ASTC10x5UnormSRGB:Q.ASTC10x5Unorm;break;case Oc:s=r===ut?Q.ASTC10x6UnormSRGB:Q.ASTC10x6Unorm;break;case Bc:s=r===ut?Q.ASTC10x8UnormSRGB:Q.ASTC10x8Unorm;break;case Fc:s=r===ut?Q.ASTC10x10UnormSRGB:Q.ASTC10x10Unorm;break;case Ic:s=r===ut?Q.ASTC12x10UnormSRGB:Q.ASTC12x10Unorm;break;case zc:s=r===ut?Q.ASTC12x12UnormSRGB:Q.ASTC12x12Unorm;break;case qn:s=r===ut?Q.RGBA8UnormSRGB:Q.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case qn:switch(n){case zl:s=Q.RGBA8Snorm;break;case kl:s=Q.RGBA16Sint;break;case Ms:s=Q.RGBA16Uint;break;case Sn:s=Q.RGBA32Uint;break;case Ri:s=Q.RGBA32Sint;break;case Wn:s=r===ut?Q.RGBA8UnormSRGB:Q.RGBA8Unorm;break;case Xi:s=Q.RGBA16Float;break;case Yn:s=Q.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case Rd:switch(n){case Wg:s=Q.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case Cd:switch(n){case zl:s=Q.R8Snorm;break;case kl:s=Q.R16Sint;break;case Ms:s=Q.R16Uint;break;case Sn:s=Q.R32Uint;break;case Ri:s=Q.R32Sint;break;case Wn:s=Q.R8Unorm;break;case Xi:s=Q.R16Float;break;case Yn:s=Q.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case Xl:switch(n){case zl:s=Q.RG8Snorm;break;case kl:s=Q.RG16Sint;break;case Ms:s=Q.RG16Uint;break;case Sn:s=Q.RG32Uint;break;case Ri:s=Q.RG32Sint;break;case Wn:s=Q.RG8Unorm;break;case Xi:s=Q.RG16Float;break;case Yn:s=Q.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case jr:switch(n){case Ms:s=Q.Depth16Unorm;break;case Sn:s=Q.Depth24Plus;break;case Yn:s=Q.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case Wr:switch(n){case Hr:s=Q.Depth24PlusStencil8;break;case Yn:e&&e.features.has(sb.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),s=Q.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case Qc:switch(n){case Ri:s=Q.R32Sint;break;case Sn:s=Q.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case Zc:switch(n){case Ri:s=Q.RG32Sint;break;case Sn:s=Q.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case Jc:switch(n){case Ri:s=Q.RGBA32Sint;break;case Sn:s=Q.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return s}const C7=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,N7=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,nC={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},D7=i=>{i=i.trim();const e=i.match(C7);if(e!==null&&e.length===4){const t=e[2],n=[];let r=null;for(;(r=N7.exec(t))!==null;)n.push({name:r[1],type:r[2]});const s=[];for(let d=0;d<n.length;d++){const{name:m,type:g}=n[d];let _=g;_.startsWith("ptr")?_="pointer":(_.startsWith("texture")&&(_=g.split("<")[0]),_=nC[_]),s.push(new GS(_,m))}const o=i.substring(e[0].length),u=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:nC[u]||u,inputs:s,name:c,inputsCode:t,blockCode:o,outputType:u}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class P7 extends VS{constructor(e){const{type:t,inputs:n,name:r,inputsCode:s,blockCode:o,outputType:u}=D7(e);super(t,n,r),this.inputsCode=s,this.blockCode=o,this.outputType=u}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class L7 extends FD{parseFunction(e){return new P7(e)}}const ic=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},U7={[Fa.READ_ONLY]:"read",[Fa.WRITE_ONLY]:"write",[Fa.READ_WRITE]:"read_write"},iC={[ql]:"repeat",[Hs]:"clamp",[$l]:"mirror"},qm={vertex:ic?ic.VERTEX:1,fragment:ic?ic.FRAGMENT:2,compute:ic?ic.COMPUTE:4},rC={instance:!0,swizzleAssign:!1,storageBuffer:!0},O7={"^^":"tsl_xor"},B7={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},sC={},ts={tsl_xor:new mi("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new mi("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new mi("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new mi("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new mi("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new mi("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new mi("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new mi("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new mi("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new mi("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new mi("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new mi("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new mi(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},Lf={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(ts.pow_float=new mi("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),ts.pow_vec2=new mi("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[ts.pow_float]),ts.pow_vec3=new mi("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[ts.pow_float]),ts.pow_vec4=new mi("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[ts.pow_float]),Lf.pow_float="tsl_pow_float",Lf.pow_vec2="tsl_pow_vec2",Lf.pow_vec3="tsl_pow_vec3",Lf.pow_vec4="tsl_pow_vec4");let $D="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&($D+=`diagnostic( off, derivative_uniformity );
`);class F7 extends OD{constructor(e,t){super(e,t,new L7),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Vr}_generateTextureSample(e,t,n,r,s=this.shaderStage){return s==="fragment"?r?`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n):this.generateTextureLod(e,t,n,r,"0")}_generateVideoSample(e,t,n=this.shaderStage){if(n==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,t,n,r,s,o=this.shaderStage){return(o==="fragment"||o==="compute")&&this.isUnfilterable(e)===!1?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,r):this.generateTextureLod(e,t,n,s,r)}generateWrapFunction(e){const t=`tsl_coord_${iC[e.wrapS]}S_${iC[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let n=sC[t];if(n===void 0){const r=[],s=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const u=(c,f)=>{c===ql?(r.push(ts.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${f} )`):c===Hs?(r.push(ts.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${f} )`):c===$l?(r.push(ts.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${f} )`):(o+=`		coord.${f}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};u(e.wrapS,"x"),o+=`,
`,u(e.wrapT,"y"),e.isData3DTexture&&(o+=`,
`,u(e.wrapR,"z")),o+=`
	);

}
`,sC[t]=n=new mi(o,r)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[n];if(r.dimensionsSnippet[n]===void 0){let o,u;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),f=c>1;e.isData3DTexture?u="vec3<u32>":u="vec2<u32>",f||e.isVideoTexture||e.isStorageTexture?o=t:o=`${t}${n?`, u32( ${n} )`:""}`,s=new cg(new fg(`textureDimensions( ${o} )`,u)),r.dimensionsSnippet[n]=s,(e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new cg(new fg(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new cg(new fg("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,n,r="0u"){this._include("biquadraticTexture");const s=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,r);return`tsl_biquadraticTexture( ${t}, ${s}( ${n} ), ${o}, u32( ${r} ) )`}generateTextureLod(e,t,n,r,s="0u"){const o=this.generateWrapFunction(e),u=this.generateTextureDimension(e,t,s),c=e.isData3DTexture?"vec3":"vec2",f=`${c}<u32>(${o}(${n}) * ${c}<f32>(${u}))`;return this.generateTextureLoad(e,t,f,r,s)}generateTextureLoad(e,t,n,r,s="0u"){return e.isVideoTexture===!0||e.isStorageTexture===!0?`textureLoad( ${t}, ${n} )`:r?`textureLoad( ${t}, ${n}, ${r}, u32( ${s} ) )`:`textureLoad( ${t}, ${n}, u32( ${s} ) )`}generateTextureStore(e,t,n,r){return`textureStore( ${t}, ${n}, ${r} )`}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Yn||this.isSampleCompare(e)===!1&&e.minFilter===Rn&&e.magFilter===Rn||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r,s=this.shaderStage){let o=null;return e.isVideoTexture===!0?o=this._generateVideoSample(t,n,s):this.isUnfilterable(e)?o=this.generateTextureLod(e,t,n,r,"0",s):o=this._generateTextureSample(e,t,n,r,s),o}generateTextureGrad(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,n,r,s,o=this.shaderStage){let u=null;return e.isVideoTexture===!0?u=this._generateVideoSample(t,n,o):u=this._generateTextureSampleLevel(e,t,n,r,s,o),u}generateTextureBias(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="storageTexture"||r==="texture3D"?n:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=O7[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?Fa.READ_ONLY:e.access}getStorageAccess(e,t){return U7[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);if(o.uniformGPU===void 0){let u;const c=e.groupNode,f=c.name,d=this.getBindGroupArray(f,n);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let m=null;const g=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?m=new x_(s.name,s.node,c,g):t==="cubeTexture"?m=new HD(s.name,s.node,c,g):t==="texture3D"&&(m=new jD(s.name,s.node,c,g)),m.store=e.isStorageTextureNode===!0,m.setVisibility(qm[n]),(n==="fragment"||n==="compute")&&this.isUnfilterable(e.value)===!1&&m.store===!1){const _=new b7(`${s.name}_sampler`,s.node,c);_.setVisibility(qm[n]),d.push(_,m),u=[_,m]}else d.push(m),u=[m]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const m=t==="buffer"?GD:E7,g=new m(e,c);g.setVisibility(qm[n]),d.push(g),u=g,s.name=r||"NodeBuffer_"+s.id}else{const m=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=m[f];g===void 0&&(g=new VD(f,c),g.setVisibility(qm[n]),m[f]=g,d.push(g)),u=this.getNodeUniform(s,t),g.addUniform(u)}o.uniformGPU=u}return s}getBuiltin(e,t,n,r=this.shaderStage){const s=this.builtins[r]||(this.builtins[r]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(s+=`	return ${n.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const r of n)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:r,property:s,type:o}of n.values())t.push(`@builtin( ${r} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,n,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:r,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const u=this.getType(s);t.push(`var<${r}> ${n}: array< ${u}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const r=this.getAttributesArray();for(let s=0,o=r.length;s<o;s++){const u=r[s],c=u.name,f=this.getType(u.type);t.push(`@location( ${s} ) ${c} : ${f}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const r=e.output?"@location( "+n.index+" ) ":"";let s=this.getType(n.type);n.atomic&&(s="atomic< "+s+" >"),t.push(`	${r+n.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const r=[];for(const s of n){let o=`struct ${s.name} {
`;o+=this.getStructMembers(s),o+=`
};`,r.push(o)}t=`
`+r.join(`

`)+`
`}return t}getVar(e,t,n=null){let r=`var ${t} : `;return n!==null?r+=this.generateArrayDeclaration(e,n):r+=this.getType(e),r}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`	${this.getVar(r.type,r.name,r.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let u=0;u<s.length;u++){const c=s[u];if(c.needsInterpolation){let f=`@location( ${u} )`;/^(int|uint|ivec|uvec)/.test(c.type)&&(f+=" @interpolate( flat )"),t.push(`${f} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const n=this.getBuiltins(e);n&&t.push(n);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}isCustomStruct(e){return e.value.isStorageBufferAttribute&&e.node.structTypeNode!==null}getUniforms(e){const t=this.uniforms[e],n=[],r=[],s=[],o={};for(const c of t){const f=c.groupNode.name,d=this.bindingsIndexes[f];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const m=c.node.value;(e==="fragment"||e==="compute")&&this.isUnfilterable(m)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(m)?n.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var ${c.name}_sampler : sampler;`));let g,_="";const{primarySamples:v}=this.renderer.backend.utils.getTextureSampleData(m);if(v>1&&(_="_multisampled"),m.isCubeTexture===!0)g="texture_cube<f32>";else if(m.isDataArrayTexture===!0||m.isCompressedArrayTexture===!0)g="texture_2d_array<f32>";else if(m.isDepthTexture===!0)g=`texture_depth${_}_2d`;else if(m.isVideoTexture===!0)g="texture_external";else if(m.isData3DTexture===!0)g="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const S=ab(m),b=this.getStorageAccess(c.node,e);g=`texture_storage_2d<${S}, ${b}>`}else{const S=this.getComponentTypeFromTexture(m).charAt(0);g=`texture${_}_2d<${S}32>`}n.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var ${c.name} : ${g};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const m=c.node,g=this.getType(m.getNodeType(this)),_=m.bufferCount,v=_>0&&c.type==="buffer"?", "+_:"",S=m.isStorageBufferNode?`storage, ${this.getStorageAccess(m,e)}`:"uniform";if(this.isCustomStruct(c))r.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var<${S}> ${c.name} : ${g};`);else{const x=`	value : array< ${m.isAtomic?`atomic<${g}>`:`${g}`}${v} >`;r.push(this._getWGSLStructBinding(c.name,x,S,d.binding++,d.group))}}else{const m=this.getType(this.getVectorType(c.type)),g=c.groupNode.name;(o[g]||(o[g]={index:d.binding++,id:d.group,snippets:[]})).snippets.push(`	${c.name} : ${m}`)}}for(const c in o){const f=o[c];s.push(this._getWGSLStructBinding(c,f.snippets.join(`,
`),"uniform",f.index,f.id))}let u=n.join(`
`);return u+=r.join(`
`),u+=s.join(`
`),u}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],u=o.outputNode,c=u!==void 0&&u.isOutputStructNode===!0;for(const f of s){const d=this.getFlowData(f),m=f.name;if(m&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${m}
`),r+=`${d.code}
	`,f===o&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${d.result};`;else if(t==="fragment")if(c)n.returnType=u.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+=`return ${d.result};`;else{let g="	@location(0) color: vec4<f32>";const _=this.getBuiltins("output");_&&(g+=`,
	`+_),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",g),n.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${d.result};

	return output;`}}}n.flow=r}this.shaderStage=null,this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getType(e){return B7[e]||e}isAvailable(e){let t=rC[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),rC[e]=t),t}_getWGSLMethod(e){return ts[e]!==void 0&&this._include(e),Lf[e]}_include(e){const t=ts[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${$D}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${t} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,r=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${r} ) @group( ${s} )
var<${n}> ${e} : ${o};`}}class I7{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=Q.Depth24PlusStencil8:e.depth&&(t=Q.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return dc.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return dc.LineList;if(e.isLine)return dc.LineStrip;if(e.isMesh)return dc.TriangleList}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),t===2&&(t=4)),t}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===Wn)return Q.BGRA8Unorm;if(e===Xi)return Q.RGBA16Float;throw new Error("Unsupported outputType")}}const z7=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),k7=new Map([[aN,["float16"]]]),G7=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class V7{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),r=this.backend,s=r.get(n);let o=s.buffer;if(o===void 0){const u=r.device;let c=n.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let d=0;d<c.length;d++)c[d]===65535&&(c[d]=4294967295)}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let d=0;d<n.count;d++)c.set(n.array.subarray(d*3,d*3+3),d*4);n.itemSize=4,n.array=c,s._force3to4BytesAlignment=!0}const f=c.byteLength+(4-c.byteLength%4)%4;o=u.createBuffer({label:n.name,size:f,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,r=n.device,s=n.get(t),o=n.get(t).buffer;let u=t.array;if(s._force3to4BytesAlignment===!0){u=new u.constructor(t.count*4);for(let d=0;d<t.count;d++)u.set(t.array.subarray(d*3,d*3+3),d*4);t.array=u}const c=this._isTypedArray(u),f=t.updateRanges;if(f.length===0)r.queue.writeBuffer(o,0,u,0);else{const d=c?1:u.BYTES_PER_ELEMENT;for(let m=0,g=f.length;m<g;m++){const _=f[m];let v,S;if(s._force3to4BytesAlignment===!0){const x=Math.floor(_.start/3),E=Math.ceil(_.count/3);v=x*4*d,S=E*4*d}else v=_.start*d,S=_.count*d;const b=v*(c?u.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(o,b,u,v,S)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let r=0;r<t.length;r++){const s=t[r],o=s.array.BYTES_PER_ELEMENT,u=this._getBufferAttribute(s);let c=n.get(u);if(c===void 0){let m,g;s.isInterleavedBufferAttribute===!0?(m=s.data.stride*o,g=s.data.isInstancedInterleavedBuffer?Wm.Instance:Wm.Vertex):(m=s.itemSize*o,g=s.isInstancedBufferAttribute?Wm.Instance:Wm.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(m=4),c={arrayStride:m,attributes:[],stepMode:g},n.set(u,c)}const f=this._getVertexFormat(s),d=s.isInterleavedBufferAttribute===!0?s.offset*o:0;c.attributes.push({shaderLocation:r,offset:d,format:f})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,u=n.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=n.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(s,0,u,0,o);const f=c.finish();n.queue.submit([f]),await u.mapAsync(GPUMapMode.READ);const d=u.getMappedRange(),m=new e.array.constructor(d.slice(0));return u.unmap(),m.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,r=e.array.constructor,s=e.constructor;let o;if(t===1)o=G7.get(r);else{const c=(k7.get(s)||z7.get(r))[n?1:0];if(c){const f=r.BYTES_PER_ELEMENT*t,m=Math.floor((f+3)/4)*4/r.BYTES_PER_ELEMENT;if(m%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${m}`}}return o||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class H7{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,r=[];let s=0;for(const o of e.bindings){const u={binding:s++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const c={};o.isStorageBuffer&&(o.visibility&4&&(o.access===Fa.READ_WRITE||o.access===Fa.WRITE_ONLY)?c.type=dx.Storage:c.type=dx.ReadOnlyStorage),u.buffer=c}else if(o.isSampler){const c={};o.texture.isDepthTexture&&o.texture.compareFunction!==null&&(c.type="comparison"),u.sampler=c}else if(o.isSampledTexture&&o.texture.isVideoTexture)u.externalTexture={};else if(o.isSampledTexture&&o.store){const c={};c.format=this.backend.get(o.texture).texture.format;const f=o.access;f===Fa.READ_WRITE?c.access=px.ReadWrite:f===Fa.WRITE_ONLY?c.access=px.WriteOnly:c.access=px.ReadOnly,u.storageTexture=c}else if(o.isSampledTexture){const c={},{primarySamples:f}=t.utils.getTextureSampleData(o.texture);if(f>1&&(c.multisampled=!0,o.texture.isDepthTexture||(c.sampleType=nc.UnfilterableFloat)),o.texture.isDepthTexture)c.sampleType=nc.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const d=o.texture.type;d===Ri?c.sampleType=nc.SInt:d===Sn?c.sampleType=nc.UInt:d===Yn&&(this.backend.hasFeature("float32-filterable")?c.sampleType=nc.Float:c.sampleType=nc.UnfilterableFloat)}o.isSampledCubeTexture?c.viewDimension=fr.Cube:o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?c.viewDimension=fr.TwoDArray:o.isSampledTexture3D&&(c.viewDimension=fr.ThreeD),u.texture=c}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);r.push(u)}return n.createBindGroupLayout({entries:r})}createBindings(e,t,n,r=0){const{backend:s,bindGroupLayoutCache:o}=this,u=s.get(e);let c=o.get(e.bindingsReference);c===void 0&&(c=this.createBindingsLayout(e),o.set(e.bindingsReference,c));let f;n>0&&(u.groups===void 0&&(u.groups=[],u.versions=[]),u.versions[n]===r&&(f=u.groups[n])),f===void 0&&(f=this.createBindGroup(e,c),n>0&&(u.groups[n]=f,u.versions[n]=r)),u.group=f,u.layout=c}updateBinding(e){const t=this.backend,n=t.device,r=e.buffer,s=t.get(e).buffer;n.queue.writeBuffer(s,0,r,0)}createBindGroupIndex(e,t){const r=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],u=r.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:s});r.queue.writeBuffer(u,0,e,0);const c=[{binding:0,resource:{buffer:u}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const n=this.backend,r=n.device;let s=0;const o=[];for(const u of e.bindings){if(u.isUniformBuffer){const c=n.get(u);if(c.buffer===void 0){const f=u.byteLength,d=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,m=r.createBuffer({label:"bindingBuffer_"+u.name,size:f,usage:d});c.buffer=m}o.push({binding:s,resource:{buffer:c.buffer}})}else if(u.isStorageBuffer){const c=n.get(u);if(c.buffer===void 0){const f=u.attribute;c.buffer=n.get(f).buffer}o.push({binding:s,resource:{buffer:c.buffer}})}else if(u.isSampler){const c=n.get(u.texture);o.push({binding:s,resource:c.sampler})}else if(u.isSampledTexture){const c=n.get(u.texture);let f;if(c.externalTexture!==void 0)f=r.importExternalTexture({source:c.externalTexture});else{const d=u.store?1:c.texture.mipLevelCount,m=`view-${c.texture.width}-${c.texture.height}-${d}`;if(f=c[m],f===void 0){const g=y7.All;let _;u.isSampledCubeTexture?_=fr.Cube:u.isSampledTexture3D?_=fr.ThreeD:u.texture.isDataArrayTexture||u.texture.isCompressedArrayTexture?_=fr.TwoDArray:_=fr.TwoD,f=c[m]=c.texture.createView({aspect:g,dimension:_,mipLevelCount:d})}}o.push({binding:s,resource:f})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}}class j7{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:r,geometry:s,pipeline:o}=e,{vertexProgram:u,fragmentProgram:c}=o,f=this.backend,d=f.device,m=f.utils,g=f.get(o),_=[];for(const J of e.getBindings()){const ue=f.get(J);_.push(ue.layout)}const v=f.attributeUtils.createShaderVertexBuffers(e);let S;r.transparent===!0&&r.blending!==br&&(S=this._getBlending(r));let b={};r.stencilWrite===!0&&(b={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const x=this._getColorWriteMask(r),E=[];if(e.context.textures!==null){const J=e.context.textures;for(let ue=0;ue<J.length;ue++){const $=m.getTextureFormatGPU(J[ue]);E.push({format:$,blend:S,writeMask:x})}}else{const J=m.getCurrentColorFormat(e.context);E.push({format:J,blend:S,writeMask:x})}const M=f.get(u).module,A=f.get(c).module,C=this._getPrimitiveState(n,s,r),w=this._getDepthCompare(r),N=m.getCurrentDepthStencilFormat(e.context),L=this._getSampleCount(e.context),P={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},M,{buffers:v}),fragment:Object.assign({},A,{targets:E}),primitive:C,multisample:{count:L,alphaToCoverageEnabled:r.alphaToCoverage&&L>1},layout:d.createPipelineLayout({bindGroupLayouts:_})},D={},I=e.context.depth,j=e.context.stencil;if((I===!0||j===!0)&&(I===!0&&(D.format=N,D.depthWriteEnabled=r.depthWrite,D.depthCompare=w),j===!0&&(D.stencilFront=b,D.stencilBack={},D.stencilReadMask=r.stencilFuncMask,D.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&(D.depthBias=r.polygonOffsetUnits,D.depthBiasSlopeScale=r.polygonOffsetFactor,D.depthBiasClamp=0),P.depthStencil=D),t===null)g.pipeline=d.createRenderPipeline(P);else{const J=new Promise(ue=>{d.createRenderPipelineAsync(P).then($=>{g.pipeline=$,ue()})});t.push(J)}}createBundleEncoder(e){const t=this.backend,{utils:n,device:r}=t,s=n.getCurrentDepthStencilFormat(e),o=n.getCurrentColorFormat(e),u=this._getSampleCount(e),c={label:"renderBundleEncoder",colorFormats:[o],depthStencilFormat:s,sampleCount:u};return r.createRenderBundleEncoder(c)}createComputePipeline(e,t){const n=this.backend,r=n.device,s=n.get(e.computeProgram).module,o=n.get(e),u=[];for(const c of t){const f=n.get(c);u.push(f.layout)}o.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:u})})}_getBlending(e){let t,n;const r=e.blending,s=e.blendSrc,o=e.blendDst,u=e.blendEquation;if(r===pc){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,f=e.blendDstAlpha!==null?e.blendDstAlpha:o,d=e.blendEquationAlpha!==null?e.blendEquationAlpha:u;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(u)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(f),operation:this._getBlendOperation(d)}}else{const c=e.premultipliedAlpha,f=(d,m,g,_)=>{t={srcFactor:d,dstFactor:m,operation:Al.Add},n={srcFactor:g,dstFactor:_,operation:Al.Add}};if(c)switch(r){case rs:f(At.One,At.OneMinusSrcAlpha,At.One,At.OneMinusSrcAlpha);break;case bc:f(At.One,At.One,At.One,At.One);break;case Sc:f(At.Zero,At.OneMinusSrc,At.Zero,At.One);break;case Tc:f(At.Zero,At.Src,At.Zero,At.SrcAlpha);break}else switch(r){case rs:f(At.SrcAlpha,At.OneMinusSrcAlpha,At.One,At.OneMinusSrcAlpha);break;case bc:f(At.SrcAlpha,At.One,At.SrcAlpha,At.One);break;case Sc:f(At.Zero,At.OneMinusSrc,At.Zero,At.One);break;case Tc:f(At.Zero,At.Src,At.Zero,At.Src);break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case wa:t=At.Zero;break;case Rb:t=At.One;break;case Cb:t=At.Src;break;case Nb:t=At.OneMinusSrc;break;case $f:t=At.SrcAlpha;break;case Xf:t=At.OneMinusSrcAlpha;break;case Lb:t=At.Dst;break;case Ub:t=At.OneMinusDstColor;break;case Db:t=At.DstAlpha;break;case Pb:t=At.OneMinusDstAlpha;break;case Ob:t=At.SrcAlphaSaturated;break;case Oq:t=At.Constant;break;case Bq:t=At.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case i3:t=Oi.Never;break;case Ux:t=Oi.Always;break;case r3:t=Oi.Less;break;case a3:t=Oi.LessEqual;break;case s3:t=Oi.Equal;break;case u3:t=Oi.GreaterEqual;break;case o3:t=Oi.Greater;break;case l3:t=Oi.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case Rl:t=Lo.Keep;break;case KB:t=Lo.Zero;break;case QB:t=Lo.Replace;break;case n3:t=Lo.Invert;break;case ZB:t=Lo.IncrementClamp;break;case JB:t=Lo.DecrementClamp;break;case e3:t=Lo.IncrementWrap;break;case t3:t=Lo.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case qi:t=Al.Add;break;case Ab:t=Al.Subtract;break;case wb:t=Al.ReverseSubtract;break;case $C:t=Al.Min;break;case XC:t=Al.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const r={},s=this.backend.utils;switch(r.topology=s.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?Wc.Uint16:Wc.Uint32),n.side){case xr:r.frontFace=cx.CCW,r.cullMode=hx.Back;break;case Tn:r.frontFace=cx.CCW,r.cullMode=hx.Front;break;case Ji:r.frontFace=cx.CCW,r.cullMode=hx.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side);break}return r}_getColorWriteMask(e){return e.colorWrite===!0?eC.All:eC.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Oi.Always;else{const n=e.depthFunc;switch(n){case Yf:t=Oi.Never;break;case Kf:t=Oi.Always;break;case Qf:t=Oi.Less;break;case Ho:t=Oi.LessEqual;break;case Zf:t=Oi.Equal;break;case Jf:t=Oi.GreaterEqual;break;case ed:t=Oi.Greater;break;case td:t=Oi.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class W7 extends qD{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return ws(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const s=r.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let u=0;for(const[,c]of e){const f=o[c],d=o[c+1],m=Number(d-f)/1e6;u+=m}return this.resultBuffer.unmap(),this.lastValue=u,u}catch(e){return console.error("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class q7 extends WD{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new I7(this),this.attributeUtils=new V7(this),this.bindingUtils=new H7(this),this.pipelineUtils=new j7(this),this.textureUtils=new R7(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const o={powerPreference:t.powerPreference},u=typeof navigator<"u"?await navigator.gpu.requestAdapter(o):null;if(u===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const c=Object.values(sb),f=[];for(const m of c)u.features.has(m)&&f.push(m);const d={requiredFeatures:f,requiredLimits:t.requiredLimits};n=await u.requestDevice(d)}else n=t.device;n.lost.then(o=>{const u={api:"WebGPU",message:o.message||"Unknown reason",reason:o.reason||null,originalEvent:o};e.onDeviceLost(u)});const r=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=n,this.context=r;const s=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(sb.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s}),this.updateSize()}get coordinateSystem(){return qo}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const n=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()});const r=e.colorAttachments[0];this.renderer.samples>0?r.view=this.colorBuffer.createView():r.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,r=this.get(n);let s=r.descriptors;if(s===void 0||r.width!==n.width||r.height!==n.height||r.dimensions!==n.dimensions||r.activeMipmapLevel!==e.activeMipmapLevel||r.activeCubeFace!==e.activeCubeFace||r.samples!==n.samples){s={},r.descriptors=s;const f=()=>{n.removeEventListener("dispose",f),this.delete(n)};n.hasEventListener("dispose",f)===!1&&n.addEventListener("dispose",f)}const o=e.getCacheKey();let u=s[o];if(u===void 0){const f=e.textures,d=[];let m;for(let g=0;g<f.length;g++){const _=this.get(f[g]),v={label:`colorAttachment_${g}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:fr.TwoD};n.isRenderTarget3D?(m=e.activeCubeFace,v.baseArrayLayer=0,v.dimension=fr.ThreeD,v.depthOrArrayLayers=f[g].image.depth):n.isRenderTargetArray&&(v.dimension=fr.TwoDArray,v.depthOrArrayLayers=f[g].image.depth);const S=_.texture.createView(v);let b,x;_.msaaTexture!==void 0?(b=_.msaaTexture.createView(),x=S):(b=S,x=void 0),d.push({view:b,resolveTarget:x,depthSlice:m})}if(u={textureViews:d},e.depth){const g=this.get(e.depthTexture);u.depthStencilView=g.texture.createView()}s[o]=u,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace,r.dimensions=n.dimensions}const c={colorAttachments:[]};for(let f=0;f<u.textureViews.length;f++){const d=u.textureViews[f];let m={r:0,g:0,b:0,a:1};f===0&&t.clearValue&&(m=t.clearValue),c.colorAttachments.push({view:d.view,depthSlice:d.depthSlice,resolveTarget:d.resolveTarget,loadOp:t.loadOp||wn.Load,storeOp:t.storeOp||wi.Store,clearValue:m})}return u.depthStencilView&&(c.depthStencilAttachment={view:u.depthStencilView}),c}beginRender(e){const t=this.get(e),n=this.device,r=e.occlusionQueryCount;let s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=n.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:wn.Load}),this.initTimestampQuery(e,o),o.occlusionQuerySet=s;const u=o.depthStencilAttachment;if(e.textures!==null){const d=o.colorAttachments;for(let m=0;m<d.length;m++){const g=d[m];e.clearColor?(g.clearValue=m===0?e.clearColorValue:{r:0,g:0,b:0,a:1},g.loadOp=wn.Clear,g.storeOp=wi.Store):(g.loadOp=wn.Load,g.storeOp=wi.Store)}}else{const d=o.colorAttachments[0];e.clearColor?(d.clearValue=e.clearColorValue,d.loadOp=wn.Clear,d.storeOp=wi.Store):(d.loadOp=wn.Load,d.storeOp=wi.Store)}e.depth&&(e.clearDepth?(u.depthClearValue=e.clearDepthValue,u.depthLoadOp=wn.Clear,u.depthStoreOp=wi.Store):(u.depthLoadOp=wn.Load,u.depthStoreOp=wi.Store)),e.stencil&&(e.clearStencil?(u.stencilClearValue=e.clearStencilValue,u.stencilLoadOp=wn.Clear,u.stencilStoreOp=wi.Store):(u.stencilLoadOp=wn.Load,u.stencilStoreOp=wi.Store));const c=n.createCommandEncoder({label:"renderContext_"+e.id}),f=c.beginRenderPass(o);if(t.descriptor=o,t.encoder=c,t.currentPass=f,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:d,y:m,width:g,height:_}=e.scissorValue;f.setScissorRect(d,m,g,_)}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;if(t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery(),t.currentPass.end(),n>0){const r=n*8;let s=this.occludedResolveCache.get(r);s===void 0&&(s=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,s));const o=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,s,0),t.encoder.copyBufferToBuffer(s,0,o,0,r),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const r=e.textures;for(let s=0;s<r.length;s++){const o=r[s];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const o=n.getMappedRange(),u=new BigUint64Array(o);for(let c=0;c<r.length;c++)u[c]===BigInt(0)&&s.add(r[c]);n.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:s,height:o,minDepth:u,maxDepth:c}=e.viewportValue;t.setViewport(n,r,s,o,u,c)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,r=null){const s=this.device,o=this.renderer;let u=[],c,f,d,m;if(e){const v=this.getClearColor();f={r:v.r,g:v.g,b:v.b,a:v.a}}if(r===null){d=o.depth,m=o.stencil;const v=this._getDefaultRenderPassDescriptor();if(e){u=v.colorAttachments;const S=u[0];S.clearValue=f,S.loadOp=wn.Clear,S.storeOp=wi.Store}(d||m)&&(c=v.depthStencilAttachment)}else{d=r.depth,m=r.stencil;const v={loadOp:e?wn.Clear:wn.Load,clearValue:e?f:void 0};d&&(v.depthLoadOp=t?wn.Clear:wn.Load,v.depthClearValue=t?o.getClearDepth():void 0,v.depthStoreOp=wi.Store),m&&(v.stencilLoadOp=n?wn.Clear:wn.Load,v.stencilClearValue=n?o.getClearStencil():void 0,v.stencilStoreOp=wi.Store);const S=this._getRenderPassDescriptor(r,v);u=S.colorAttachments,c=S.depthStencilAttachment}d&&c&&c.depthLoadOp===void 0&&(t?(c.depthLoadOp=wn.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=wi.Store):(c.depthLoadOp=wn.Load,c.depthStoreOp=wi.Store)),m&&c&&c.stencilLoadOp===void 0&&(n?(c.stencilLoadOp=wn.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=wi.Store):(c.stencilLoadOp=wn.Load,c.stencilStoreOp=wi.Store));const g=s.createCommandEncoder({label:"clear"});g.beginRenderPass({colorAttachments:u,depthStencilAttachment:c}).end(),s.queue.submit([g.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(e,n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r){const{passEncoderGPU:s}=this.get(e),o=this.get(r).pipeline;s.setPipeline(o);for(let d=0,m=n.length;d<m;d++){const g=n[d],_=this.get(g);s.setBindGroup(d,_.group)}const u=this.device.limits.maxComputeWorkgroupsPerDimension,c=this.get(t);c.dispatchSize===void 0&&(c.dispatchSize={x:0,y:1,z:1});const{dispatchSize:f}=c;t.dispatchCount>u?(f.x=Math.min(t.dispatchCount,u),f.y=Math.ceil(t.dispatchCount/u)):f.x=t.dispatchCount,s.dispatchWorkgroups(f.x,f.y,f.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:n,material:r,context:s,pipeline:o}=e,u=e.getBindings(),c=this.get(s),f=this.get(o).pipeline,d=c.currentSets,m=c.currentPass,g=e.getDrawParameters();if(g===null)return;d.pipeline!==f&&(m.setPipeline(f),d.pipeline=f);const _=d.bindingGroups;for(let E=0,M=u.length;E<M;E++){const A=u[E],C=this.get(A);_[A.index]!==A.id&&(m.setBindGroup(A.index,C.group),_[A.index]=A.id)}const v=e.getIndex(),S=v!==null;if(S===!0&&d.index!==v){const E=this.get(v).buffer,M=v.array instanceof Uint16Array?Wc.Uint16:Wc.Uint32;m.setIndexBuffer(E,M),d.index=v}const b=e.getVertexBuffers();for(let E=0,M=b.length;E<M;E++){const A=b[E];if(d.attributes[E]!==A){const C=this.get(A).buffer;m.setVertexBuffer(E,C),d.attributes[E]=A}}if(c.occlusionQuerySet!==void 0){const E=c.lastOcclusionObject;E!==n&&(E!==null&&E.occlusionTest===!0&&(m.endOcclusionQuery(),c.occlusionQueryIndex++),n.occlusionTest===!0&&(m.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=n),c.lastOcclusionObject=n)}s.stencil===!0&&r.stencilWrite===!0&&c.currentStencilRef!==r.stencilRef&&(m.setStencilReference(r.stencilRef),c.currentStencilRef=r.stencilRef);const x=()=>{if(n.isBatchedMesh===!0){const E=n._multiDrawStarts,M=n._multiDrawCounts,A=n._multiDrawCount,C=n._multiDrawInstances;C!==null&&ws("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let w=0;w<A;w++){const N=C?C[w]:1,L=N>1?0:w;S===!0?m.drawIndexed(M[w],N,E[w]/v.array.BYTES_PER_ELEMENT,0,L):m.draw(M[w],N,E[w],L),t.update(n,M[w],N)}}else if(S===!0){const{vertexCount:E,instanceCount:M,firstVertex:A}=g,C=e.getIndirect();if(C!==null){const w=this.get(C).buffer;m.drawIndexedIndirect(w,0)}else m.drawIndexed(E,M,A,0,0);t.update(n,E,M)}else{const{vertexCount:E,instanceCount:M,firstVertex:A}=g,C=e.getIndirect();if(C!==null){const w=this.get(C).buffer;m.drawIndirect(w,0)}else m.draw(E,M,A,0);t.update(n,E,M)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const E=this.get(e.camera),M=e.camera.cameras,A=e.getBindingGroup("cameraIndex");if(E.indexesGPU===void 0||E.indexesGPU.length!==M.length){const w=this.get(A),N=[],L=new Uint32Array([0,0,0,0]);for(let P=0,D=M.length;P<D;P++){L[0]=P;const I=this.bindingUtils.createBindGroupIndex(L,w.layout);N.push(I)}E.indexesGPU=N}const C=this.renderer.getPixelRatio();for(let w=0,N=M.length;w<N;w++){const L=M[w];if(n.layers.test(L.layers)){const P=L.viewport;m.setViewport(Math.floor(P.x*C),Math.floor(P.y*C),Math.floor(P.width*C),Math.floor(P.height*C),s.viewportValue.minDepth,s.viewportValue.maxDepth),m.setBindGroup(A.index,E.indexesGPU[w]),x()}}}else x()}needsRenderUpdate(e){const t=this.get(e),{object:n,material:r}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),u=s.getCurrentColorSpace(e.context),c=s.getCurrentColorFormat(e.context),f=s.getCurrentDepthStencilFormat(e.context),d=s.getPrimitiveTopology(n,r);let m=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==u||t.colorFormat!==c||t.depthStencilFormat!==f||t.primitiveTopology!==d||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=o,t.colorSpace=u,t.colorFormat=c,t.depthStencilFormat=f,t.primitiveTopology=d,t.clippingContextCacheKey=e.clippingContextCacheKey,m=!0),m}getRenderCacheKey(e){const{object:t,material:n}=e,r=this.utils,s=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,o)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const n=e.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new W7(this.device,n,2048));const r=this.timestampQueryPool[n],s=r.allocateQueriesForContext(e);t.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new F7(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),s=n.currentPass.finish();this.get(t).bundleGPU=s,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){let u=0,c=0,f=0,d=0,m=0,g=0,_=e.image.width,v=e.image.height,S=1;n!==null&&(n.isBox3===!0?(d=n.min.x,m=n.min.y,g=n.min.z,_=n.max.x-n.min.x,v=n.max.y-n.min.y,S=n.max.z-n.min.z):(d=n.min.x,m=n.min.y,_=n.max.x-n.min.x,v=n.max.y-n.min.y,S=1)),r!==null&&(u=r.x,c=r.y,f=r.z||0);const b=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),x=this.get(e).texture,E=this.get(t).texture;b.copyTextureToTexture({texture:x,mipLevel:s,origin:{x:d,y:m,z:g}},{texture:E,mipLevel:o,origin:{x:u,y:c,z:f}},[_,v,S]),this.device.queue.submit([b.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const r=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let u;if(r.currentPass?(r.currentPass.end(),u=r.encoder):u=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),u.copyTextureToTexture({texture:s,origin:[n.x,n.y,0]},{texture:o},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),r.currentPass){const{descriptor:c}=r;for(let f=0;f<c.colorAttachments.length;f++)c.colorAttachments[f].loadOp=wn.Load;if(t.depth&&(c.depthStencilAttachment.depthLoadOp=wn.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=wn.Load),r.currentPass=u.beginRenderPass(c),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:f,y:d,width:m,height:g}=t.scissorValue;r.currentPass.setScissorRect(f,d,m,g)}}else this.device.queue.submit([u.finish()])}}class $7 extends gN{constructor(e,t,n,r,s,o){super(e,t,n,r,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class X7 extends ID{constructor(){super(),this.addMaterial(b9,"MeshPhongMaterial"),this.addMaterial(vD,"MeshStandardMaterial"),this.addMaterial(pq,"MeshPhysicalMaterial"),this.addMaterial(vq,"MeshToonMaterial"),this.addMaterial(p9,"MeshBasicMaterial"),this.addMaterial(y9,"MeshLambertMaterial"),this.addMaterial(l9,"MeshNormalMaterial"),this.addMaterial(Sq,"MeshMatcapMaterial"),this.addMaterial(i9,"LineBasicMaterial"),this.addMaterial(s9,"LineDashedMaterial"),this.addMaterial(Aq,"PointsMaterial"),this.addMaterial(xD,"SpriteMaterial"),this.addMaterial(Cq,"ShadowMaterial"),this.addLight(eX,OF),this.addLight(wX,_N),this.addLight(RX,FF),this.addLight(BD,gN),this.addLight(NX,vN),this.addLight(DX,PF),this.addLight(PX,zF),this.addLight(CX,$7),this.addToneMapping(u$,QC),this.addToneMapping(c$,ZC),this.addToneMapping(h$,JC),this.addToneMapping(d$,eN),this.addToneMapping(_$,tN),this.addToneMapping(v$,nN)}}class Y7 extends QX{constructor(e={}){let t;e.forceWebGL?t=JR:(t=q7,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new JR(e)));const n=new t(e);super(n,e),this.library=new X7,this.isWebGPURenderer=!0}}const mx={type:"change"},jS={type:"start"},WS={type:"end"},aC=1e-6,an={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},$m=new Oe,Uo=new Oe,K7=new H,Xm=new H,gx=new H,rc=new Rs,oC=new H,Ym=new H,_x=new H,Km=new H;class Q7 extends e_{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Bi.ROTATE,MIDDLE:Bi.DOLLY,RIGHT:Bi.PAN},this.target=new H,this.state=an.NONE,this.keyState=an.NONE,this._lastPosition=new H,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new H,this._movePrev=new Oe,this._moveCurr=new Oe,this._lastAxis=new H,this._zoomStart=new Oe,this._zoomEnd=new Oe,this._panStart=new Oe,this._panEnd=new Oe,this._pointers=[],this._pointerPositions={},this._onPointerMove=J7.bind(this),this._onPointerDown=Z7.bind(this),this._onPointerUp=eY.bind(this),this._onPointerCancel=tY.bind(this),this._onContextMenu=lY.bind(this),this._onMouseWheel=oY.bind(this),this._onKeyDown=iY.bind(this),this._onKeyUp=nY.bind(this),this._onTouchStart=uY.bind(this),this._onTouchMove=cY.bind(this),this._onTouchEnd=hY.bind(this),this._onMouseDown=rY.bind(this),this._onMouseMove=sY.bind(this),this._onMouseUp=aY.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>aC&&(this.dispatchEvent(mx),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>aC||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(mx),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=an.NONE,this.keyState=an.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(mx),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Uo.copy(this._panEnd).sub(this._panStart),Uo.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Uo.x*=e,Uo.y*=t}Uo.multiplyScalar(this._eye.length()*this.panSpeed),Xm.copy(this._eye).cross(this.object.up).setLength(Uo.x),Xm.add(K7.copy(this.object.up).setLength(Uo.y)),this.object.position.add(Xm),this.target.add(Xm),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Uo.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){Km.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=Km.length();e?(this._eye.copy(this.object.position).sub(this.target),oC.copy(this._eye).normalize(),Ym.copy(this.object.up).normalize(),_x.crossVectors(Ym,oC).normalize(),Ym.setLength(this._moveCurr.y-this._movePrev.y),_x.setLength(this._moveCurr.x-this._movePrev.x),Km.copy(Ym.add(_x)),gx.crossVectors(Km,this._eye).normalize(),e*=this.rotateSpeed,rc.setFromAxisAngle(gx,e),this._eye.applyQuaternion(rc),this.object.up.applyQuaternion(rc),this._lastAxis.copy(gx),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),rc.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(rc),this.object.up.applyQuaternion(rc)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===an.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=yg.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=yg.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return $m.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),$m}_getMouseOnCircle(e,t){return $m.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),$m}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Oe,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function Z7(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i))}function J7(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function eY(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchEnd(i):this._onMouseUp(),this._removePointer(i),this._pointers.length===0&&(this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function tY(i){this._removePointer(i)}function nY(){this.enabled!==!1&&(this.keyState=an.NONE,window.addEventListener("keydown",this._onKeyDown))}function iY(i){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===an.NONE&&(i.code===this.keys[an.ROTATE]&&!this.noRotate?this.keyState=an.ROTATE:i.code===this.keys[an.ZOOM]&&!this.noZoom?this.keyState=an.ZOOM:i.code===this.keys[an.PAN]&&!this.noPan&&(this.keyState=an.PAN)))}function rY(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Bi.DOLLY:this.state=an.ZOOM;break;case Bi.ROTATE:this.state=an.ROTATE;break;case Bi.PAN:this.state=an.PAN;break;default:this.state=an.NONE}const t=this.keyState!==an.NONE?this.keyState:this.state;t===an.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY)),this._movePrev.copy(this._moveCurr)):t===an.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(i.pageX,i.pageY)),this._zoomEnd.copy(this._zoomStart)):t===an.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(i.pageX,i.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(jS)}function sY(i){const e=this.keyState!==an.NONE?this.keyState:this.state;e===an.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY))):e===an.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(i.pageX,i.pageY)):e===an.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(i.pageX,i.pageY))}function aY(){this.state=an.NONE,this.dispatchEvent(WS)}function oY(i){if(this.enabled!==!1&&this.noZoom!==!0){switch(i.preventDefault(),i.deltaMode){case 2:this._zoomStart.y-=i.deltaY*.025;break;case 1:this._zoomStart.y-=i.deltaY*.01;break;default:this._zoomStart.y-=i.deltaY*25e-5;break}this.dispatchEvent(jS),this.dispatchEvent(WS)}}function lY(i){this.enabled!==!1&&i.preventDefault()}function uY(i){switch(this._trackPointer(i),this._pointers.length){case 1:this.state=an.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=an.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,r)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(jS)}function cY(i){switch(this._trackPointer(i),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY));break;default:const e=this._getSecondPointerPosition(i),t=i.pageX-e.x,n=i.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);const r=(i.pageX+e.x)/2,s=(i.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(r,s));break}}function hY(i){switch(this._pointers.length){case 0:this.state=an.NONE;break;case 1:this.state=an.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=an.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==i.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(WS)}const lC={type:"change"},qS={type:"start"},XD={type:"end"},Qm=new Xg,uC=new bs,fY=Math.cos(70*yg.DEG2RAD),pi=new H,hr=2*Math.PI,_n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},vx=1e-6;class dY extends e_{constructor(e,t=null){super(e,t),this.state=_n.NONE,this.target=new H,this.cursor=new H,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Bi.ROTATE,MIDDLE:Bi.DOLLY,RIGHT:Bi.PAN},this.touches={ONE:Ua.ROTATE,TWO:Ua.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new H,this._lastQuaternion=new Rs,this._lastTargetPosition=new H,this._quat=new Rs().setFromUnitVectors(e.up,new H(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new xw,this._sphericalDelta=new xw,this._scale=1,this._panOffset=new H,this._rotateStart=new Oe,this._rotateEnd=new Oe,this._rotateDelta=new Oe,this._panStart=new Oe,this._panEnd=new Oe,this._panDelta=new Oe,this._dollyStart=new Oe,this._dollyEnd=new Oe,this._dollyDelta=new Oe,this._dollyDirection=new H,this._mouse=new Oe,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=mY.bind(this),this._onPointerDown=pY.bind(this),this._onPointerUp=gY.bind(this),this._onContextMenu=TY.bind(this),this._onMouseWheel=yY.bind(this),this._onKeyDown=xY.bind(this),this._onTouchStart=bY.bind(this),this._onTouchMove=SY.bind(this),this._onMouseDown=_Y.bind(this),this._onMouseMove=vY.bind(this),this._interceptControlDown=EY.bind(this),this._interceptControlUp=MY.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(lC),this.update(),this.state=_n.NONE}update(e=null){const t=this.object.position;pi.copy(t).sub(this.target),pi.applyQuaternion(this._quat),this._spherical.setFromVector3(pi),this.autoRotate&&this.state===_n.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=hr:n>Math.PI&&(n-=hr),r<-Math.PI?r+=hr:r>Math.PI&&(r-=hr),n<=r?this._spherical.theta=Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(pi.setFromSpherical(this._spherical),pi.applyQuaternion(this._quatInverse),t.copy(this.target).add(pi),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const u=pi.length();o=this._clampDistance(u*this._scale);const c=u-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const u=new H(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const f=new H(this._mouse.x,this._mouse.y,0);f.unproject(this.object),this.object.position.sub(f).add(u),this.object.updateMatrixWorld(),o=pi.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Qm.origin.copy(this.object.position),Qm.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Qm.direction))<fY?this.object.lookAt(this.target):(uC.setFromNormalAndCoplanarPoint(this.object.up,this.target),Qm.intersectPlane(uC,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>vx||8*(1-this._lastQuaternion.dot(this.object.quaternion))>vx||this._lastTargetPosition.distanceToSquared(this.target)>vx?(this.dispatchEvent(lC),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?hr/60*this.autoRotateSpeed*e:hr/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){pi.setFromMatrixColumn(t,0),pi.multiplyScalar(-e),this._panOffset.add(pi)}_panUp(e,t){this.screenSpacePanning===!0?pi.setFromMatrixColumn(t,1):(pi.setFromMatrixColumn(t,0),pi.crossVectors(this.object.up,pi)),pi.multiplyScalar(e),this._panOffset.add(pi)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;pi.copy(r).sub(this.target);let s=pi.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/n.clientHeight,this.object.matrix),this._panUp(2*t*s/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=e-n.left,s=t-n.top,o=n.width,u=n.height;this._mouse.x=r/o*2-1,this._mouse.y=-(s/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(hr*this._rotateDelta.x/t.clientHeight),this._rotateUp(hr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(hr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-hr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(hr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-hr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(n,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),r=.5*(e.pageX+n.x),s=.5*(e.pageY+n.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(hr*this._rotateDelta.x/t.clientHeight),this._rotateUp(hr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,u=(e.pageY+t.y)*.5;this._updateZoomParameters(o,u)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Oe,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function pY(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i)))}function mY(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function gY(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(XD),this.state=_n.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function _Y(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Bi.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=_n.DOLLY;break;case Bi.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=_n.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=_n.ROTATE}break;case Bi.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=_n.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=_n.PAN}break;default:this.state=_n.NONE}this.state!==_n.NONE&&this.dispatchEvent(qS)}function vY(i){switch(this.state){case _n.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case _n.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case _n.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function yY(i){this.enabled===!1||this.enableZoom===!1||this.state!==_n.NONE||(i.preventDefault(),this.dispatchEvent(qS),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(XD))}function xY(i){this.enabled!==!1&&this._handleKeyDown(i)}function bY(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case Ua.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=_n.TOUCH_ROTATE;break;case Ua.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=_n.TOUCH_PAN;break;default:this.state=_n.NONE}break;case 2:switch(this.touches.TWO){case Ua.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=_n.TOUCH_DOLLY_PAN;break;case Ua.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=_n.TOUCH_DOLLY_ROTATE;break;default:this.state=_n.NONE}break;default:this.state=_n.NONE}this.state!==_n.NONE&&this.dispatchEvent(qS)}function SY(i){switch(this._trackPointer(i),this.state){case _n.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case _n.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case _n.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case _n.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=_n.NONE}}function TY(i){this.enabled!==!1&&i.preventDefault()}function EY(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function MY(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const AY={type:"change"},cC=1e-6,hC=new Rs;class wY extends e_{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new H(0,0,0),this._rotationVector=new H(0,0,0),this._lastQuaternion=new Rs,this._lastPosition=new H,this._status=0,this._onKeyDown=RY.bind(this),this._onKeyUp=CY.bind(this),this._onPointerMove=DY.bind(this),this._onPointerDown=NY.bind(this),this._onPointerUp=PY.bind(this),this._onPointerCancel=LY.bind(this),this._onContextMenu=UY.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,n=e*this.movementSpeed,r=e*this.rollSpeed;t.translateX(this._moveVector.x*n),t.translateY(this._moveVector.y*n),t.translateZ(this._moveVector.z*n),hC.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),t.quaternion.multiply(hC),(this._lastPosition.distanceToSquared(t.position)>cC||8*(1-this._lastQuaternion.dot(t.quaternion))>cC)&&(this.dispatchEvent(AY),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function RY(i){if(!(i.altKey||this.enabled===!1)){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function CY(i){if(this.enabled!==!1){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function NY(i){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(i.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function DY(i){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,n=e.size[1]/2;this._moveState.yawLeft=-(i.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(i.pageY-e.offset[1]-n)/n,this._updateRotationVector()}}function PY(i){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(i.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function LY(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function UY(i){this.enabled!==!1&&i.preventDefault()}const OY={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class b_{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const BY=new Ud(-1,1,1,-1,0,1);class FY extends rr{constructor(){super(),this.setAttribute("position",new Kn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Kn([0,2,0,0,2,0],2))}}const IY=new FY;class zY{constructor(e){this._mesh=new oi(IY,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,BY)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class kY extends b_{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof Xs?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=lN.clone(e.uniforms),this.material=new Xs({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new zY(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class fC extends b_{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,u;this.inverse?(o=0,u=1):(o=1,u=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(u),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class GY extends b_{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class VY{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new Oe);this._width=n.width,this._height=n.height,t=new $o(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Xi}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new kY(OY),this.copyPass.material.blending=br,this.clock=new xN}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let r=0,s=this.passes.length;r<s;r++){const o=this.passes[r];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),o.needsSwap){if(n){const u=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(u.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(u.EQUAL,1,4294967295)}this.swapBuffers()}fC!==void 0&&(o instanceof fC?n=!0:o instanceof GY&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Oe);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class HY extends b_{constructor(e,t,n=null,r=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new it}render(e,t,n){const r=e.autoClear;e.autoClear=!1;let s,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=r}}function Mr(){return Mr=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Mr.apply(null,arguments)}function jY(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Sd(i,e){return Sd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Sd(i,e)}function WY(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,Sd(i,e)}function ob(i){return ob=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ob(i)}function qY(i){try{return Function.toString.call(i).indexOf("[native code]")!==-1}catch{return typeof i=="function"}}function YD(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(YD=function(){return!!i})()}function $Y(i,e,t){if(YD())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var r=new(i.bind.apply(i,n));return t&&Sd(r,t.prototype),r}function lb(i){var e=typeof Map=="function"?new Map:void 0;return lb=function(n){if(n===null||!qY(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,r)}function r(){return $Y(n,arguments,ob(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Sd(r,n)},lb(i)}var js=function(i){WY(e,i);function e(t){var n;return n=i.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,jY(n)}return e}(lb(Error));function yx(i){return Math.round(i*255)}function XY(i,e,t){return yx(i)+","+yx(e)+","+yx(t)}function Bg(i,e,t,n){if(n===void 0&&(n=XY),e===0)return n(t,t,t);var r=(i%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,o=s*(1-Math.abs(r%2-1)),u=0,c=0,f=0;r>=0&&r<1?(u=s,c=o):r>=1&&r<2?(u=o,c=s):r>=2&&r<3?(c=s,f=o):r>=3&&r<4?(c=o,f=s):r>=4&&r<5?(u=o,f=s):r>=5&&r<6&&(u=s,f=o);var d=t-s/2,m=u+d,g=c+d,_=f+d;return n(m,g,_)}var dC={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function YY(i){if(typeof i!="string")return i;var e=i.toLowerCase();return dC[e]?"#"+dC[e]:i}var KY=/^#[a-fA-F0-9]{6}$/,QY=/^#[a-fA-F0-9]{8}$/,ZY=/^#[a-fA-F0-9]{3}$/,JY=/^#[a-fA-F0-9]{4}$/,xx=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,eK=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,tK=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,nK=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function qc(i){if(typeof i!="string")throw new js(3);var e=YY(i);if(e.match(KY))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(QY)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(ZY))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(JY)){var n=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:n}}var r=xx.exec(e);if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10)};var s=eK.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=tK.exec(e);if(o){var u=parseInt(""+o[1],10),c=parseInt(""+o[2],10)/100,f=parseInt(""+o[3],10)/100,d="rgb("+Bg(u,c,f)+")",m=xx.exec(d);if(!m)throw new js(4,e,d);return{red:parseInt(""+m[1],10),green:parseInt(""+m[2],10),blue:parseInt(""+m[3],10)}}var g=nK.exec(e.substring(0,50));if(g){var _=parseInt(""+g[1],10),v=parseInt(""+g[2],10)/100,S=parseInt(""+g[3],10)/100,b="rgb("+Bg(_,v,S)+")",x=xx.exec(b);if(!x)throw new js(4,e,b);return{red:parseInt(""+x[1],10),green:parseInt(""+x[2],10),blue:parseInt(""+x[3],10),alpha:parseFloat(""+g[4])>1?parseFloat(""+g[4])/100:parseFloat(""+g[4])}}throw new js(5)}function iK(i){var e=i.red/255,t=i.green/255,n=i.blue/255,r=Math.max(e,t,n),s=Math.min(e,t,n),o=(r+s)/2;if(r===s)return i.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:i.alpha}:{hue:0,saturation:0,lightness:o};var u,c=r-s,f=o>.5?c/(2-r-s):c/(r+s);switch(r){case e:u=(t-n)/c+(t<n?6:0);break;case t:u=(n-e)/c+2;break;default:u=(e-t)/c+4;break}return u*=60,i.alpha!==void 0?{hue:u,saturation:f,lightness:o,alpha:i.alpha}:{hue:u,saturation:f,lightness:o}}function Zo(i){return iK(qc(i))}var rK=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},ub=rK;function Pl(i){var e=i.toString(16);return e.length===1?"0"+e:e}function bx(i){return Pl(Math.round(i*255))}function sK(i,e,t){return ub("#"+bx(i)+bx(e)+bx(t))}function KD(i,e,t){return Bg(i,e,t,sK)}function aK(i,e,t){if(typeof i=="object"&&e===void 0&&t===void 0)return KD(i.hue,i.saturation,i.lightness);throw new js(1)}function oK(i,e,t,n){if(typeof i=="object"&&e===void 0&&t===void 0&&n===void 0)return i.alpha>=1?KD(i.hue,i.saturation,i.lightness):"rgba("+Bg(i.hue,i.saturation,i.lightness)+","+i.alpha+")";throw new js(2)}function QD(i,e,t){if(typeof i=="number"&&typeof e=="number"&&typeof t=="number")return ub("#"+Pl(i)+Pl(e)+Pl(t));if(typeof i=="object"&&e===void 0&&t===void 0)return ub("#"+Pl(i.red)+Pl(i.green)+Pl(i.blue));throw new js(6)}function S_(i,e,t,n){if(typeof i=="object"&&e===void 0&&t===void 0&&n===void 0)return i.alpha>=1?QD(i.red,i.green,i.blue):"rgba("+i.red+","+i.green+","+i.blue+","+i.alpha+")";throw new js(7)}var lK=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},uK=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},cK=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},hK=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function Jo(i){if(typeof i!="object")throw new js(8);if(uK(i))return S_(i);if(lK(i))return QD(i);if(hK(i))return oK(i);if(cK(i))return aK(i);throw new js(8)}function ZD(i,e,t){return function(){var r=t.concat(Array.prototype.slice.call(arguments));return r.length>=e?i.apply(this,r):ZD(i,e,r)}}function qr(i){return ZD(i,i.length,[])}function fK(i,e){if(e==="transparent")return e;var t=Zo(e);return Jo(Mr({},t,{hue:t.hue+parseFloat(i)}))}qr(fK);function rh(i,e,t){return Math.max(i,Math.min(e,t))}function dK(i,e){if(e==="transparent")return e;var t=Zo(e);return Jo(Mr({},t,{lightness:rh(0,1,t.lightness-parseFloat(i))}))}qr(dK);function pK(i,e){if(e==="transparent")return e;var t=Zo(e);return Jo(Mr({},t,{saturation:rh(0,1,t.saturation-parseFloat(i))}))}qr(pK);function mK(i,e){if(e==="transparent")return e;var t=Zo(e);return Jo(Mr({},t,{lightness:rh(0,1,t.lightness+parseFloat(i))}))}qr(mK);function gK(i,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(i===0)return t;var n=qc(e),r=Mr({},n,{alpha:typeof n.alpha=="number"?n.alpha:1}),s=qc(t),o=Mr({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),u=r.alpha-o.alpha,c=parseFloat(i)*2-1,f=c*u===-1?c:c+u,d=1+c*u,m=(f/d+1)/2,g=1-m,_={red:Math.floor(r.red*m+o.red*g),green:Math.floor(r.green*m+o.green*g),blue:Math.floor(r.blue*m+o.blue*g),alpha:r.alpha*parseFloat(i)+o.alpha*(1-parseFloat(i))};return S_(_)}var _K=qr(gK),JD=_K;function vK(i,e){if(e==="transparent")return e;var t=qc(e),n=typeof t.alpha=="number"?t.alpha:1,r=Mr({},t,{alpha:rh(0,1,(n*100+parseFloat(i)*100)/100)});return S_(r)}var yK=qr(vK),xK=yK;function bK(i,e){if(e==="transparent")return e;var t=Zo(e);return Jo(Mr({},t,{saturation:rh(0,1,t.saturation+parseFloat(i))}))}qr(bK);function SK(i,e){return e==="transparent"?e:Jo(Mr({},Zo(e),{hue:parseFloat(i)}))}qr(SK);function TK(i,e){return e==="transparent"?e:Jo(Mr({},Zo(e),{lightness:parseFloat(i)}))}qr(TK);function EK(i,e){return e==="transparent"?e:Jo(Mr({},Zo(e),{saturation:parseFloat(i)}))}qr(EK);function MK(i,e){return e==="transparent"?e:JD(parseFloat(i),"rgb(0, 0, 0)",e)}qr(MK);function AK(i,e){return e==="transparent"?e:JD(parseFloat(i),"rgb(255, 255, 255)",e)}qr(AK);function wK(i,e){if(e==="transparent")return e;var t=qc(e),n=typeof t.alpha=="number"?t.alpha:1,r=Mr({},t,{alpha:rh(0,1,+(n*100-parseFloat(i)*100).toFixed(2)/100)});return S_(r)}qr(wK);var jl=Object.freeze({Linear:Object.freeze({None:function(i){return i},In:function(i){return i},Out:function(i){return i},InOut:function(i){return i}}),Quadratic:Object.freeze({In:function(i){return i*i},Out:function(i){return i*(2-i)},InOut:function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)}}),Cubic:Object.freeze({In:function(i){return i*i*i},Out:function(i){return--i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)}}),Quartic:Object.freeze({In:function(i){return i*i*i*i},Out:function(i){return 1- --i*i*i*i},InOut:function(i){return(i*=2)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2)}}),Quintic:Object.freeze({In:function(i){return i*i*i*i*i},Out:function(i){return--i*i*i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2)}}),Sinusoidal:Object.freeze({In:function(i){return 1-Math.sin((1-i)*Math.PI/2)},Out:function(i){return Math.sin(i*Math.PI/2)},InOut:function(i){return .5*(1-Math.sin(Math.PI*(.5-i)))}}),Exponential:Object.freeze({In:function(i){return i===0?0:Math.pow(1024,i-1)},Out:function(i){return i===1?1:1-Math.pow(2,-10*i)},InOut:function(i){return i===0?0:i===1?1:(i*=2)<1?.5*Math.pow(1024,i-1):.5*(-Math.pow(2,-10*(i-1))+2)}}),Circular:Object.freeze({In:function(i){return 1-Math.sqrt(1-i*i)},Out:function(i){return Math.sqrt(1- --i*i)},InOut:function(i){return(i*=2)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1)}}),Elastic:Object.freeze({In:function(i){return i===0?0:i===1?1:-Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI)},Out:function(i){return i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i-.1)*5*Math.PI)+1},InOut:function(i){return i===0?0:i===1?1:(i*=2,i<1?-.5*Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI):.5*Math.pow(2,-10*(i-1))*Math.sin((i-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(i){var e=1.70158;return i===1?1:i*i*((e+1)*i-e)},Out:function(i){var e=1.70158;return i===0?0:--i*i*((e+1)*i+e)+1},InOut:function(i){var e=2.5949095;return(i*=2)<1?.5*(i*i*((e+1)*i-e)):.5*((i-=2)*i*((e+1)*i+e)+2)}}),Bounce:Object.freeze({In:function(i){return 1-jl.Bounce.Out(1-i)},Out:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},InOut:function(i){return i<.5?jl.Bounce.In(i*2)*.5:jl.Bounce.Out(i*2-1)*.5+.5}}),generatePow:function(i){return i===void 0&&(i=4),i=i<Number.EPSILON?Number.EPSILON:i,i=i>1e4?1e4:i,{In:function(e){return Math.pow(e,i)},Out:function(e){return 1-Math.pow(1-e,i)},InOut:function(e){return e<.5?Math.pow(e*2,i)/2:(1-Math.pow(2-e*2,i))/2+.5}}}}),Uf=function(){return performance.now()},eP=function(){function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return i.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},i.prototype.removeAll=function(){this._tweens={}},i.prototype.add=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0,s=t;r<s.length;r++){var o=s[r];(e=o._group)===null||e===void 0||e.remove(o),o._group=this,this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o}},i.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=e;n<r.length;n++){var s=r[n];s._group=void 0,delete this._tweens[s.getId()],delete this._tweensAddedDuringUpdate[s.getId()]}},i.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},i.prototype.update=function(e,t){e===void 0&&(e=Uf()),t===void 0&&(t=!0);var n=Object.keys(this._tweens);if(n.length!==0)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var s=this._tweens[n[r]],o=!t;s&&s.update(e,o)===!1&&!t&&this.remove(s)}n=Object.keys(this._tweensAddedDuringUpdate)}},i}(),cb={Linear:function(i,e){var t=i.length-1,n=t*e,r=Math.floor(n),s=cb.Utils.Linear;return e<0?s(i[0],i[1],n):e>1?s(i[t],i[t-1],t-n):s(i[r],i[r+1>t?t:r+1],n-r)},Utils:{Linear:function(i,e,t){return(e-i)*t+i}}},tP=function(){function i(){}return i.nextId=function(){return i._nextId++},i._nextId=0,i}(),hb=new eP,pC=function(){function i(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=jl.Linear.None,this._interpolationFunction=cb.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=tP.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=hb,hb.add(this))}return i.prototype.getId=function(){return this._id},i.prototype.isPlaying=function(){return this._isPlaying},i.prototype.isPaused=function(){return this._isPaused},i.prototype.getDuration=function(){return this._duration},i.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},i.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},i.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},i.prototype.start=function(e,t){if(e===void 0&&(e=Uf()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var s in this._valuesEnd)r[s]=this._valuesEnd[s];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},i.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},i.prototype._setupProperties=function(e,t,n,r,s){for(var o in n){var u=e[o],c=Array.isArray(u),f=c?"array":typeof u,d=!c&&Array.isArray(n[o]);if(!(f==="undefined"||f==="function")){if(d){var m=n[o];if(m.length===0)continue;for(var g=[u],_=0,v=m.length;_<v;_+=1){var S=this._handleRelativeValue(u,m[_]);if(isNaN(S)){d=!1,console.warn("Found invalid interpolation list. Skipping.");break}g.push(S)}d&&(n[o]=g)}if((f==="object"||c)&&u&&!d){t[o]=c?[]:{};var b=u;for(var x in b)t[o][x]=b[x];r[o]=c?[]:{};var m=n[o];if(!this._isDynamic){var E={};for(var x in m)E[x]=m[x];n[o]=m=E}this._setupProperties(b,t[o],m,r[o],s)}else(typeof t[o]>"u"||s)&&(t[o]=u),c||(t[o]*=1),d?r[o]=n[o].slice().reverse():r[o]=t[o]||0}}},i.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},i.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},i.prototype.pause=function(e){return e===void 0&&(e=Uf()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},i.prototype.resume=function(e){return e===void 0&&(e=Uf()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},i.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},i.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},i.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},i.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},i.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},i.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},i.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},i.prototype.easing=function(e){return e===void 0&&(e=jl.Linear.None),this._easingFunction=e,this},i.prototype.interpolation=function(e){return e===void 0&&(e=cb.Linear),this._interpolationFunction=e,this},i.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},i.prototype.onStart=function(e){return this._onStartCallback=e,this},i.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},i.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},i.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},i.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},i.prototype.onStop=function(e){return this._onStopCallback=e,this},i.prototype.update=function(e,t){var n=this,r;if(e===void 0&&(e=Uf()),t===void 0&&(t=i.autoStartOnUpdate),this._isPaused)return!0;var s;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,u=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),c=this._duration+this._repeat*u,f=function(){if(n._duration===0||o>c)return 1;var S=Math.trunc(o/u),b=o-S*u,x=Math.min(b/n._duration,1);return x===0&&o===n._duration?1:x},d=f(),m=this._easingFunction(d);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,m),this._onUpdateCallback&&this._onUpdateCallback(this._object,d),this._duration===0||o>=this._duration)if(this._repeat>0){var g=Math.min(Math.trunc((o-this._duration)/u)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=g);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=u*g,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var _=0,v=this._chainedTweens.length;_<v;_++)this._chainedTweens[_].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},i.prototype._updateProperties=function(e,t,n,r){for(var s in n)if(t[s]!==void 0){var o=t[s]||0,u=n[s],c=Array.isArray(e[s]),f=Array.isArray(u),d=!c&&f;d?e[s]=this._interpolationFunction(u,r):typeof u=="object"&&u?this._updateProperties(e[s],o,u,r):(u=this._handleRelativeValue(o,u),typeof u=="number"&&(e[s]=o+(u-o)*r))}},i.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},i.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];typeof n=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},i.autoStartOnUpdate=!1,i}();tP.nextId;var Qs=hb;Qs.getAll.bind(Qs);Qs.removeAll.bind(Qs);Qs.add.bind(Qs);Qs.remove.bind(Qs);Qs.update.bind(Qs);var fb="http://www.w3.org/1999/xhtml";const mC={svg:"http://www.w3.org/2000/svg",xhtml:fb,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function nP(i){var e=i+="",t=e.indexOf(":");return t>=0&&(e=i.slice(0,t))!=="xmlns"&&(i=i.slice(t+1)),mC.hasOwnProperty(e)?{space:mC[e],local:i}:i}function RK(i){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===fb&&e.documentElement.namespaceURI===fb?e.createElement(i):e.createElementNS(t,i)}}function CK(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function iP(i){var e=nP(i);return(e.local?CK:RK)(e)}function NK(){}function rP(i){return i==null?NK:function(){return this.querySelector(i)}}function DK(i){typeof i!="function"&&(i=rP(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,u=n[r]=new Array(o),c,f,d=0;d<o;++d)(c=s[d])&&(f=i.call(c,c.__data__,d,s))&&("__data__"in c&&(f.__data__=c.__data__),u[d]=f);return new cs(n,this._parents)}function PK(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function LK(){return[]}function UK(i){return i==null?LK:function(){return this.querySelectorAll(i)}}function OK(i){return function(){return PK(i.apply(this,arguments))}}function BK(i){typeof i=="function"?i=OK(i):i=UK(i);for(var e=this._groups,t=e.length,n=[],r=[],s=0;s<t;++s)for(var o=e[s],u=o.length,c,f=0;f<u;++f)(c=o[f])&&(n.push(i.call(c,c.__data__,f,o)),r.push(c));return new cs(n,r)}function FK(i){return function(){return this.matches(i)}}function sP(i){return function(e){return e.matches(i)}}var IK=Array.prototype.find;function zK(i){return function(){return IK.call(this.children,i)}}function kK(){return this.firstElementChild}function GK(i){return this.select(i==null?kK:zK(typeof i=="function"?i:sP(i)))}var VK=Array.prototype.filter;function HK(){return Array.from(this.children)}function jK(i){return function(){return VK.call(this.children,i)}}function WK(i){return this.selectAll(i==null?HK:jK(typeof i=="function"?i:sP(i)))}function qK(i){typeof i!="function"&&(i=FK(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var s=e[r],o=s.length,u=n[r]=[],c,f=0;f<o;++f)(c=s[f])&&i.call(c,c.__data__,f,s)&&u.push(c);return new cs(n,this._parents)}function aP(i){return new Array(i.length)}function $K(){return new cs(this._enter||this._groups.map(aP),this._parents)}function Fg(i,e){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=e}Fg.prototype={constructor:Fg,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,e){return this._parent.insertBefore(i,e)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function XK(i){return function(){return i}}function YK(i,e,t,n,r,s){for(var o=0,u,c=e.length,f=s.length;o<f;++o)(u=e[o])?(u.__data__=s[o],n[o]=u):t[o]=new Fg(i,s[o]);for(;o<c;++o)(u=e[o])&&(r[o]=u)}function KK(i,e,t,n,r,s,o){var u,c,f=new Map,d=e.length,m=s.length,g=new Array(d),_;for(u=0;u<d;++u)(c=e[u])&&(g[u]=_=o.call(c,c.__data__,u,e)+"",f.has(_)?r[u]=c:f.set(_,c));for(u=0;u<m;++u)_=o.call(i,s[u],u,s)+"",(c=f.get(_))?(n[u]=c,c.__data__=s[u],f.delete(_)):t[u]=new Fg(i,s[u]);for(u=0;u<d;++u)(c=e[u])&&f.get(g[u])===c&&(r[u]=c)}function QK(i){return i.__data__}function ZK(i,e){if(!arguments.length)return Array.from(this,QK);var t=e?KK:YK,n=this._parents,r=this._groups;typeof i!="function"&&(i=XK(i));for(var s=r.length,o=new Array(s),u=new Array(s),c=new Array(s),f=0;f<s;++f){var d=n[f],m=r[f],g=m.length,_=JK(i.call(d,d&&d.__data__,f,n)),v=_.length,S=u[f]=new Array(v),b=o[f]=new Array(v),x=c[f]=new Array(g);t(d,m,S,b,x,_,e);for(var E=0,M=0,A,C;E<v;++E)if(A=S[E]){for(E>=M&&(M=E+1);!(C=b[M])&&++M<v;);A._next=C||null}}return o=new cs(o,n),o._enter=u,o._exit=c,o}function JK(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function eQ(){return new cs(this._exit||this._groups.map(aP),this._parents)}function tQ(i,e,t){var n=this.enter(),r=this,s=this.exit();return typeof i=="function"?(n=i(n),n&&(n=n.selection())):n=n.append(i+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?s.remove():t(s),n&&r?n.merge(r).order():r}function nQ(i){for(var e=i.selection?i.selection():i,t=this._groups,n=e._groups,r=t.length,s=n.length,o=Math.min(r,s),u=new Array(r),c=0;c<o;++c)for(var f=t[c],d=n[c],m=f.length,g=u[c]=new Array(m),_,v=0;v<m;++v)(_=f[v]||d[v])&&(g[v]=_);for(;c<r;++c)u[c]=t[c];return new cs(u,this._parents)}function iQ(){for(var i=this._groups,e=-1,t=i.length;++e<t;)for(var n=i[e],r=n.length-1,s=n[r],o;--r>=0;)(o=n[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function rQ(i){i||(i=sQ);function e(m,g){return m&&g?i(m.__data__,g.__data__):!m-!g}for(var t=this._groups,n=t.length,r=new Array(n),s=0;s<n;++s){for(var o=t[s],u=o.length,c=r[s]=new Array(u),f,d=0;d<u;++d)(f=o[d])&&(c[d]=f);c.sort(e)}return new cs(r,this._parents).order()}function sQ(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function aQ(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function oQ(){return Array.from(this)}function lQ(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,s=n.length;r<s;++r){var o=n[r];if(o)return o}return null}function uQ(){let i=0;for(const e of this)++i;return i}function cQ(){return!this.node()}function hQ(i){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],s=0,o=r.length,u;s<o;++s)(u=r[s])&&i.call(u,u.__data__,s,r);return this}function fQ(i){return function(){this.removeAttribute(i)}}function dQ(i){return function(){this.removeAttributeNS(i.space,i.local)}}function pQ(i,e){return function(){this.setAttribute(i,e)}}function mQ(i,e){return function(){this.setAttributeNS(i.space,i.local,e)}}function gQ(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(i):this.setAttribute(i,t)}}function _Q(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,t)}}function vQ(i,e){var t=nP(i);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((e==null?t.local?dQ:fQ:typeof e=="function"?t.local?_Q:gQ:t.local?mQ:pQ)(t,e))}function oP(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function yQ(i){return function(){this.style.removeProperty(i)}}function xQ(i,e,t){return function(){this.style.setProperty(i,e,t)}}function bQ(i,e,t){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(i):this.style.setProperty(i,n,t)}}function SQ(i,e,t){return arguments.length>1?this.each((e==null?yQ:typeof e=="function"?bQ:xQ)(i,e,t??"")):TQ(this.node(),i)}function TQ(i,e){return i.style.getPropertyValue(e)||oP(i).getComputedStyle(i,null).getPropertyValue(e)}function EQ(i){return function(){delete this[i]}}function MQ(i,e){return function(){this[i]=e}}function AQ(i,e){return function(){var t=e.apply(this,arguments);t==null?delete this[i]:this[i]=t}}function wQ(i,e){return arguments.length>1?this.each((e==null?EQ:typeof e=="function"?AQ:MQ)(i,e)):this.node()[i]}function lP(i){return i.trim().split(/^|\s+/)}function $S(i){return i.classList||new uP(i)}function uP(i){this._node=i,this._names=lP(i.getAttribute("class")||"")}uP.prototype={add:function(i){var e=this._names.indexOf(i);e<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var e=this._names.indexOf(i);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function cP(i,e){for(var t=$S(i),n=-1,r=e.length;++n<r;)t.add(e[n])}function hP(i,e){for(var t=$S(i),n=-1,r=e.length;++n<r;)t.remove(e[n])}function RQ(i){return function(){cP(this,i)}}function CQ(i){return function(){hP(this,i)}}function NQ(i,e){return function(){(e.apply(this,arguments)?cP:hP)(this,i)}}function DQ(i,e){var t=lP(i+"");if(arguments.length<2){for(var n=$S(this.node()),r=-1,s=t.length;++r<s;)if(!n.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?NQ:e?RQ:CQ)(t,e))}function PQ(){this.textContent=""}function LQ(i){return function(){this.textContent=i}}function UQ(i){return function(){var e=i.apply(this,arguments);this.textContent=e??""}}function OQ(i){return arguments.length?this.each(i==null?PQ:(typeof i=="function"?UQ:LQ)(i)):this.node().textContent}function BQ(){this.innerHTML=""}function FQ(i){return function(){this.innerHTML=i}}function IQ(i){return function(){var e=i.apply(this,arguments);this.innerHTML=e??""}}function zQ(i){return arguments.length?this.each(i==null?BQ:(typeof i=="function"?IQ:FQ)(i)):this.node().innerHTML}function kQ(){this.nextSibling&&this.parentNode.appendChild(this)}function GQ(){return this.each(kQ)}function VQ(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function HQ(){return this.each(VQ)}function jQ(i){var e=typeof i=="function"?i:iP(i);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function WQ(){return null}function qQ(i,e){var t=typeof i=="function"?i:iP(i),n=e==null?WQ:typeof e=="function"?e:rP(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function $Q(){var i=this.parentNode;i&&i.removeChild(this)}function XQ(){return this.each($Q)}function YQ(){var i=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function KQ(){var i=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function QQ(i){return this.select(i?KQ:YQ)}function ZQ(i){return arguments.length?this.property("__data__",i):this.node().__data__}function JQ(i){return function(e){i.call(this,e,this.__data__)}}function eZ(i){return i.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function tZ(i){return function(){var e=this.__on;if(e){for(var t=0,n=-1,r=e.length,s;t<r;++t)s=e[t],(!i.type||s.type===i.type)&&s.name===i.name?this.removeEventListener(s.type,s.listener,s.options):e[++n]=s;++n?e.length=n:delete this.__on}}}function nZ(i,e,t){return function(){var n=this.__on,r,s=JQ(e);if(n){for(var o=0,u=n.length;o<u;++o)if((r=n[o]).type===i.type&&r.name===i.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=t),r.value=e;return}}this.addEventListener(i.type,s,t),r={type:i.type,name:i.name,value:e,listener:s,options:t},n?n.push(r):this.__on=[r]}}function iZ(i,e,t){var n=eZ(i+""),r,s=n.length,o;if(arguments.length<2){var u=this.node().__on;if(u){for(var c=0,f=u.length,d;c<f;++c)for(r=0,d=u[c];r<s;++r)if((o=n[r]).type===d.type&&o.name===d.name)return d.value}return}for(u=e?nZ:tZ,r=0;r<s;++r)this.each(u(n[r],e,t));return this}function fP(i,e,t){var n=oP(i),r=n.CustomEvent;typeof r=="function"?r=new r(e,t):(r=n.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),i.dispatchEvent(r)}function rZ(i,e){return function(){return fP(this,i,e)}}function sZ(i,e){return function(){return fP(this,i,e.apply(this,arguments))}}function aZ(i,e){return this.each((typeof e=="function"?sZ:rZ)(i,e))}function*oZ(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,s=n.length,o;r<s;++r)(o=n[r])&&(yield o)}var lZ=[null];function cs(i,e){this._groups=i,this._parents=e}function uZ(){return this}cs.prototype={constructor:cs,select:DK,selectAll:BK,selectChild:GK,selectChildren:WK,filter:qK,data:ZK,enter:$K,exit:eQ,join:tQ,merge:nQ,selection:uZ,order:iQ,sort:rQ,call:aQ,nodes:oQ,node:lQ,size:uQ,empty:cQ,each:hQ,attr:vQ,style:SQ,property:wQ,classed:DQ,text:OQ,html:zQ,raise:GQ,lower:HQ,append:jQ,insert:qQ,remove:XQ,clone:QQ,datum:ZQ,on:iZ,dispatch:aZ,[Symbol.iterator]:oZ};function cZ(i){return typeof i=="string"?new cs([[document.querySelector(i)]],[document.documentElement]):new cs([[i]],lZ)}function hZ(i){let e;for(;e=i.sourceEvent;)i=e;return i}function fZ(i,e){if(i=hZ(i),e===void 0&&(e=i.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=i.clientX,n.y=i.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[i.clientX-r.left-e.clientLeft,i.clientY-r.top-e.clientTop]}}return[i.pageX,i.pageY]}var Gd,On,dP,pP,Il,gC,mP,gP,_P,XS,db,pb,Td={},vP=[],dZ=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,T_=Array.isArray;function Ws(i,e){for(var t in e)i[t]=e[t];return i}function YS(i){i&&i.parentNode&&i.parentNode.removeChild(i)}function pZ(i,e,t){var n,r,s,o={};for(s in e)s=="key"?n=e[s]:s=="ref"?r=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?Gd.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(s in i.defaultProps)o[s]==null&&(o[s]=i.defaultProps[s]);return Wf(i,o,n,r,null)}function Wf(i,e,t,n,r){var s={type:i,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++dP,__i:-1,__u:0};return r==null&&On.vnode!=null&&On.vnode(s),s}function E_(i){return i.children}function pg(i,e){this.props=i,this.context=e}function $c(i,e){if(e==null)return i.__?$c(i.__,i.__i+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?$c(i):null}function yP(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return yP(i)}}function _C(i){(!i.__d&&(i.__d=!0)&&Il.push(i)&&!Ig.__r++||gC!=On.debounceRendering)&&((gC=On.debounceRendering)||mP)(Ig)}function Ig(){for(var i,e,t,n,r,s,o,u=1;Il.length;)Il.length>u&&Il.sort(gP),i=Il.shift(),u=Il.length,i.__d&&(t=void 0,r=(n=(e=i).__v).__e,s=[],o=[],e.__P&&((t=Ws({},n)).__v=n.__v+1,On.vnode&&On.vnode(t),KS(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[r]:null,s,r??$c(n),!!(32&n.__u),o),t.__v=n.__v,t.__.__k[t.__i]=t,SP(s,t,o),t.__e!=r&&yP(t)));Ig.__r=0}function xP(i,e,t,n,r,s,o,u,c,f,d){var m,g,_,v,S,b,x=n&&n.__k||vP,E=e.length;for(c=mZ(t,e,x,c,E),m=0;m<E;m++)(_=t.__k[m])!=null&&(g=_.__i==-1?Td:x[_.__i]||Td,_.__i=m,b=KS(i,_,g,r,s,o,u,c,f,d),v=_.__e,_.ref&&g.ref!=_.ref&&(g.ref&&QS(g.ref,null,_),d.push(_.ref,_.__c||v,_)),S==null&&v!=null&&(S=v),4&_.__u||g.__k===_.__k?c=bP(_,c,i):typeof _.type=="function"&&b!==void 0?c=b:v&&(c=v.nextSibling),_.__u&=-7);return t.__e=S,c}function mZ(i,e,t,n,r){var s,o,u,c,f,d=t.length,m=d,g=0;for(i.__k=new Array(r),s=0;s<r;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(c=s+g,(o=i.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Wf(null,o,null,null,null):T_(o)?Wf(E_,{children:o},null,null,null):o.constructor==null&&o.__b>0?Wf(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=i,o.__b=i.__b+1,u=null,(f=o.__i=gZ(o,t,c,m))!=-1&&(m--,(u=t[f])&&(u.__u|=2)),u==null||u.__v==null?(f==-1&&(r>d?g--:r<d&&g++),typeof o.type!="function"&&(o.__u|=4)):f!=c&&(f==c-1?g--:f==c+1?g++:(f>c?g--:g++,o.__u|=4))):i.__k[s]=null;if(m)for(s=0;s<d;s++)(u=t[s])!=null&&(2&u.__u)==0&&(u.__e==n&&(n=$c(u)),EP(u,u));return n}function bP(i,e,t){var n,r;if(typeof i.type=="function"){for(n=i.__k,r=0;n&&r<n.length;r++)n[r]&&(n[r].__=i,e=bP(n[r],e,t));return e}i.__e!=e&&(e&&i.type&&!t.contains(e)&&(e=$c(i)),t.insertBefore(i.__e,e||null),e=i.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function gZ(i,e,t,n){var r,s,o=i.key,u=i.type,c=e[t];if(c===null&&i.key==null||c&&o==c.key&&u==c.type&&(2&c.__u)==0)return t;if(n>(c!=null&&(2&c.__u)==0?1:0))for(r=t-1,s=t+1;r>=0||s<e.length;){if(r>=0){if((c=e[r])&&(2&c.__u)==0&&o==c.key&&u==c.type)return r;r--}if(s<e.length){if((c=e[s])&&(2&c.__u)==0&&o==c.key&&u==c.type)return s;s++}}return-1}function vC(i,e,t){e[0]=="-"?i.setProperty(e,t??""):i[e]=t==null?"":typeof t!="number"||dZ.test(e)?t:t+"px"}function Zm(i,e,t,n,r){var s;e:if(e=="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof n=="string"&&(i.style.cssText=n=""),n)for(e in n)t&&e in t||vC(i.style,e,"");if(t)for(e in t)n&&t[e]==n[e]||vC(i.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(_P,"$1")),e=e.toLowerCase()in i||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),i.l||(i.l={}),i.l[e+s]=t,t?n?t.u=n.u:(t.u=XS,i.addEventListener(e,s?pb:db,s)):i.removeEventListener(e,s?pb:db,s);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in i)try{i[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?i.removeAttribute(e):i.setAttribute(e,e=="popover"&&t==1?"":t))}}function yC(i){return function(e){if(this.l){var t=this.l[e.type+i];if(e.t==null)e.t=XS++;else if(e.t<t.u)return;return t(On.event?On.event(e):e)}}}function KS(i,e,t,n,r,s,o,u,c,f){var d,m,g,_,v,S,b,x,E,M,A,C,w,N,L,P,D,I=e.type;if(e.constructor!=null)return null;128&t.__u&&(c=!!(32&t.__u),s=[u=e.__e=t.__e]),(d=On.__b)&&d(e);e:if(typeof I=="function")try{if(x=e.props,E="prototype"in I&&I.prototype.render,M=(d=I.contextType)&&n[d.__c],A=d?M?M.props.value:d.__:n,t.__c?b=(m=e.__c=t.__c).__=m.__E:(E?e.__c=m=new I(x,A):(e.__c=m=new pg(x,A),m.constructor=I,m.render=vZ),M&&M.sub(m),m.props=x,m.state||(m.state={}),m.context=A,m.__n=n,g=m.__d=!0,m.__h=[],m._sb=[]),E&&m.__s==null&&(m.__s=m.state),E&&I.getDerivedStateFromProps!=null&&(m.__s==m.state&&(m.__s=Ws({},m.__s)),Ws(m.__s,I.getDerivedStateFromProps(x,m.__s))),_=m.props,v=m.state,m.__v=e,g)E&&I.getDerivedStateFromProps==null&&m.componentWillMount!=null&&m.componentWillMount(),E&&m.componentDidMount!=null&&m.__h.push(m.componentDidMount);else{if(E&&I.getDerivedStateFromProps==null&&x!==_&&m.componentWillReceiveProps!=null&&m.componentWillReceiveProps(x,A),!m.__e&&m.shouldComponentUpdate!=null&&m.shouldComponentUpdate(x,m.__s,A)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(m.props=x,m.state=m.__s,m.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(j){j&&(j.__=e)}),C=0;C<m._sb.length;C++)m.__h.push(m._sb[C]);m._sb=[],m.__h.length&&o.push(m);break e}m.componentWillUpdate!=null&&m.componentWillUpdate(x,m.__s,A),E&&m.componentDidUpdate!=null&&m.__h.push(function(){m.componentDidUpdate(_,v,S)})}if(m.context=A,m.props=x,m.__P=i,m.__e=!1,w=On.__r,N=0,E){for(m.state=m.__s,m.__d=!1,w&&w(e),d=m.render(m.props,m.state,m.context),L=0;L<m._sb.length;L++)m.__h.push(m._sb[L]);m._sb=[]}else do m.__d=!1,w&&w(e),d=m.render(m.props,m.state,m.context),m.state=m.__s;while(m.__d&&++N<25);m.state=m.__s,m.getChildContext!=null&&(n=Ws(Ws({},n),m.getChildContext())),E&&!g&&m.getSnapshotBeforeUpdate!=null&&(S=m.getSnapshotBeforeUpdate(_,v)),P=d,d!=null&&d.type===E_&&d.key==null&&(P=TP(d.props.children)),u=xP(i,T_(P)?P:[P],e,t,n,r,s,o,u,c,f),m.base=e.__e,e.__u&=-161,m.__h.length&&o.push(m),b&&(m.__E=m.__=null)}catch(j){if(e.__v=null,c||s!=null)if(j.then){for(e.__u|=c?160:128;u&&u.nodeType==8&&u.nextSibling;)u=u.nextSibling;s[s.indexOf(u)]=null,e.__e=u}else for(D=s.length;D--;)YS(s[D]);else e.__e=t.__e,e.__k=t.__k;On.__e(j,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):u=e.__e=_Z(t.__e,e,t,n,r,s,o,c,f);return(d=On.diffed)&&d(e),128&e.__u?void 0:u}function SP(i,e,t){for(var n=0;n<t.length;n++)QS(t[n],t[++n],t[++n]);On.__c&&On.__c(e,i),i.some(function(r){try{i=r.__h,r.__h=[],i.some(function(s){s.call(r)})}catch(s){On.__e(s,r.__v)}})}function TP(i){return typeof i!="object"||i==null||i.__b&&i.__b>0?i:T_(i)?i.map(TP):Ws({},i)}function _Z(i,e,t,n,r,s,o,u,c){var f,d,m,g,_,v,S,b=t.props,x=e.props,E=e.type;if(E=="svg"?r="http://www.w3.org/2000/svg":E=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(f=0;f<s.length;f++)if((_=s[f])&&"setAttribute"in _==!!E&&(E?_.localName==E:_.nodeType==3)){i=_,s[f]=null;break}}if(i==null){if(E==null)return document.createTextNode(x);i=document.createElementNS(r,E,x.is&&x),u&&(On.__m&&On.__m(e,s),u=!1),s=null}if(E==null)b===x||u&&i.data==x||(i.data=x);else{if(s=s&&Gd.call(i.childNodes),b=t.props||Td,!u&&s!=null)for(b={},f=0;f<i.attributes.length;f++)b[(_=i.attributes[f]).name]=_.value;for(f in b)if(_=b[f],f!="children"){if(f=="dangerouslySetInnerHTML")m=_;else if(!(f in x)){if(f=="value"&&"defaultValue"in x||f=="checked"&&"defaultChecked"in x)continue;Zm(i,f,null,_,r)}}for(f in x)_=x[f],f=="children"?g=_:f=="dangerouslySetInnerHTML"?d=_:f=="value"?v=_:f=="checked"?S=_:u&&typeof _!="function"||b[f]===_||Zm(i,f,_,b[f],r);if(d)u||m&&(d.__html==m.__html||d.__html==i.innerHTML)||(i.innerHTML=d.__html),e.__k=[];else if(m&&(i.innerHTML=""),xP(e.type=="template"?i.content:i,T_(g)?g:[g],e,t,n,E=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,o,s?s[0]:t.__k&&$c(t,0),u,c),s!=null)for(f=s.length;f--;)YS(s[f]);u||(f="value",E=="progress"&&v==null?i.removeAttribute("value"):v!=null&&(v!==i[f]||E=="progress"&&!v||E=="option"&&v!=b[f])&&Zm(i,f,v,b[f],r),f="checked",S!=null&&S!=i[f]&&Zm(i,f,S,b[f],r))}return i}function QS(i,e,t){try{if(typeof i=="function"){var n=typeof i.__u=="function";n&&i.__u(),n&&e==null||(i.__u=i(e))}else i.current=e}catch(r){On.__e(r,t)}}function EP(i,e,t){var n,r;if(On.unmount&&On.unmount(i),(n=i.ref)&&(n.current&&n.current!=i.__e||QS(n,null,e)),(n=i.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(s){On.__e(s,e)}n.base=n.__P=null}if(n=i.__k)for(r=0;r<n.length;r++)n[r]&&EP(n[r],e,t||typeof i.type!="function");t||YS(i.__e),i.__c=i.__=i.__e=void 0}function vZ(i,e,t){return this.constructor(i,t)}function yZ(i,e,t){var n,r,s,o;e==document&&(e=document.documentElement),On.__&&On.__(i,e),r=(n=!1)?null:e.__k,s=[],o=[],KS(e,i=e.__k=pZ(E_,null,[i]),r||Td,Td,e.namespaceURI,r?null:e.firstChild?Gd.call(e.childNodes):null,s,r?r.__e:e.firstChild,n,o),SP(s,i,o)}function MP(i,e,t){var n,r,s,o,u=Ws({},i.props);for(s in i.type&&i.type.defaultProps&&(o=i.type.defaultProps),e)s=="key"?n=e[s]:s=="ref"?r=e[s]:u[s]=e[s]==null&&o!=null?o[s]:e[s];return arguments.length>2&&(u.children=arguments.length>3?Gd.call(arguments,2):t),Wf(i.type,u,n||i.key,r||i.ref,null)}Gd=vP.slice,On={__e:function(i,e,t,n){for(var r,s,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(i)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(i,n||{}),o=r.__d),o)return r.__E=r}catch(u){i=u}throw i}},dP=0,pP=function(i){return i!=null&&i.constructor==null},pg.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Ws({},this.state),typeof i=="function"&&(i=i(Ws({},t),this.props)),i&&Ws(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),_C(this))},pg.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),_C(this))},pg.prototype.render=E_,Il=[],mP=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,gP=function(i,e){return i.__v.__b-e.__v.__b},Ig.__r=0,_P=/(PointerCapture)$|Capture$/i,XS=0,db=yC(!1),pb=yC(!0);function xC(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function xZ(i){if(Array.isArray(i))return i}function bZ(i,e,t){return(e=wZ(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function SZ(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,f=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){f=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw r}}return u}}function TZ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bC(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function EZ(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bC(Object(t),!0).forEach(function(n){bZ(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):bC(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function MZ(i,e){return xZ(i)||SZ(i,e)||RZ(i,e)||TZ()}function AZ(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function wZ(i){var e=AZ(i,"string");return typeof e=="symbol"?e:e+""}function zg(i){"@babel/helpers - typeof";return zg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zg(i)}function RZ(i,e){if(i){if(typeof i=="string")return xC(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?xC(i,e):void 0}}var mb=function(e){if(zg(e)!=="object")return e;var t=MP(e);if(t.props){var n;t.props=EZ({},t.props),t!=null&&(n=t.props)!==null&&n!==void 0&&n.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(mb):mb(t.props.children))}return t},CZ=function(e){return pP(MP(e))},NZ=function(e,t){delete t.__k,yZ(mb(e),t)};function DZ(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}}var PZ=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;DZ(PZ);var LZ=i_({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n.style,s=r===void 0?{}:r,o=!!e&&zg(e)==="object"&&!!e.node&&typeof e.node=="function",u=cZ(o?e.node():e);u.style("position")==="static"&&u.style("position","relative"),t.tooltipEl=u.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(f){var d=MZ(f,2),m=d[0],g=d[1];return t.tooltipEl.style(m,g)}),t.tooltipEl.style("left","-10000px").style("display","none");var c="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,u.on("mousemove.".concat(c),function(f){t.mouseInside=!0;var d=fZ(f),m=u.node(),g=m.offsetWidth,_=m.offsetHeight,v=[t.offsetX===null||t.offsetX===void 0?"-".concat(d[0]/g*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?_>130&&_-d[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",d[0]+"px").style("top",d[1]+"px").style("transform","translate(".concat(v.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),u.on("mouseover.".concat(c),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),u.on("mouseout.".concat(c),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):CZ(e.content)?(e.tooltipEl.text(""),NZ(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function UZ(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}}var OZ=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;UZ(OZ);function gb(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function BZ(i){if(Array.isArray(i))return i}function FZ(i){if(Array.isArray(i))return gb(i)}function IZ(i,e,t){return(e=WZ(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zZ(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function kZ(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,o,u=[],c=!0,f=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(c=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(d){f=!0,r=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw r}}return u}}function GZ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HZ(i,e){return BZ(i)||kZ(i,e)||AP(i,e)||GZ()}function wl(i){return FZ(i)||zZ(i)||AP(i)||VZ()}function jZ(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function WZ(i){var e=jZ(i,"string");return typeof e=="symbol"?e:e+""}function AP(i,e){if(i){if(typeof i=="string")return gb(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?gb(i,e):void 0}}var Ln=window.THREE?window.THREE:{WebGLRenderer:T4,Scene:Kg,PerspectiveCamera:Ci,Raycaster:bN,SRGBColorSpace:ut,TextureLoader:DF,Vector2:Oe,Vector3:H,Box3:eu,Color:it,Mesh:oi,SphereGeometry:Ld,MeshBasicMaterial:Gs,BackSide:Tn,Clock:xN},wP=i_({props:{width:{default:window.innerWidth,onChange:function(e,t,n){isNaN(e)&&(t.width=n)}},height:{default:window.innerHeight,onChange:function(e,t,n){isNaN(e)&&(t.height=n)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(o){return o.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var n=null;if(e.hoverDuringDrag||!e.isPointerDragging){var r=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&r.sort(function(o,u){return e.hoverOrderComparator(o.object,u.object)});var s=r.find(function(o){return e.hoverFilter(o.object)})||null;n=s?s.object:null,e.intersection=s||null}n!==e.hoverObj&&(e.onHover(n,e.hoverObj,e.intersection),e.tooltip.content(n&&Zt(e.tooltipContent)(n,e.intersection)||null),e.hoverObj=n)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,n=t.x,r=t.y;return{x:n,y:r}},cameraPosition:function(e,t,n,r){var s=e.camera;if(t&&e.initialised){var o=t,u=n||{x:0,y:0,z:0};if(!r)d(o),m(u);else{var c=Object.assign({},s.position),f=g();e.tweenGroup.add(new pC(c).to(o,r).easing(jl.Quadratic.Out).onUpdate(d).start()),e.tweenGroup.add(new pC(f).to(u,r/3).easing(jl.Quadratic.Out).onUpdate(m).start())}return this}return Object.assign({},s.position,{lookAt:g()});function d(_){var v=_.x,S=_.y,b=_.z;v!==void 0&&(s.position.x=v),S!==void 0&&(s.position.y=S),b!==void 0&&(s.position.z=b)}function m(_){var v=new Ln.Vector3(_.x,_.y,_.z);e.controls.target?e.controls.target=v:s.lookAt(v)}function g(){return Object.assign(new Ln.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,r=arguments.length,s=new Array(r>3?r-3:0),o=3;o<r;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),t,n)},fitToBbox:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var o=new Ln.Vector3(0,0,0),u=Math.max.apply(Math,wl(Object.entries(t).map(function(_){var v=HZ(_,2),S=v[0],b=v[1];return Math.max.apply(Math,wl(b.map(function(x){return Math.abs(o[S]-x)})))})))*2,c=(1-r*2/e.height)*s.fov,f=u/Math.atan(c*Math.PI/180),d=f/s.aspect,m=Math.max(f,d);if(m>0){var g=o.clone().sub(s.position).normalize().multiplyScalar(-m);this.cameraPosition(g,o,n)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},n=new Ln.Box3(new Ln.Vector3(0,0,0),new Ln.Vector3(0,0,0)),r=e.objects.filter(t);return r.length?(r.forEach(function(s){return n.expandByObject(s)}),Object.assign.apply(Object,wl(["x","y","z"].map(function(s){return IZ({},s,[n.min[s],n.max[s]])})))):null},getScreenCoords:function(e,t,n,r){var s=new Ln.Vector3(t,n,r);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new Ln.Vector2(t/e.width*2-1,-(n/e.height)*2+1),o=new Ln.Raycaster;return o.setFromCamera(s,e.camera),Object.assign({},o.ray.at(r,new Ln.Vector3))},intersectingObjects:function(e,t,n){var r=new Ln.Vector2(t/e.width*2-1,-(n/e.height)*2+1),s=new Ln.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(r,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Ln.Scene,camera:new Ln.PerspectiveCamera,clock:new Ln.Clock,tweenGroup:new eP,lastRaycasterCheck:0}},init:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n.controlType,s=r===void 0?"trackball":r,o=n.useWebGPU,u=o===void 0?!1:o,c=n.rendererConfig,f=c===void 0?{}:c,d=n.extraRenderers,m=d===void 0?[]:d,g=n.waitForLoadComplete,_=g===void 0?!0:g;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new LZ(t.container),t.pointerPos=new Ln.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(v){return t.container.addEventListener(v,function(S){if(v==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&S.type==="pointermove"&&(S.pressure>0||t.isPointerPressed)&&(S.pointerType!=="touch"||S.movementX===void 0||[S.movementX,S.movementY].some(function(E){return Math.abs(E)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var b=x(t.container);t.pointerPos.x=S.pageX-b.left,t.pointerPos.y=S.pageY-b.top}function x(E){var M=E.getBoundingClientRect(),A=window.pageXOffset||document.documentElement.scrollLeft,C=window.pageYOffset||document.documentElement.scrollTop;return{top:M.top+C,left:M.left+A}}},{passive:!0})}),t.container.addEventListener("pointerup",function(v){t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){v.button===0&&t.onClick(t.hoverObj||null,v,t.intersection),v.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,v,t.intersection)})},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(v){t.onRightClick&&v.preventDefault()}),t.renderer=new(u?Y7:Ln.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},f)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=m,t.extraRenderers.forEach(function(v){v.domElement.style.position="absolute",v.domElement.style.top="0px",v.domElement.style.pointerEvents="none",t.container.appendChild(v.domElement)}),t.postProcessingComposer=new VY(t.renderer),t.postProcessingComposer.addPass(new HY(t.scene,t.camera)),t.controls=new{trackball:Q7,orbit:dY,fly:wY}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(wl(t.extraRenderers)).forEach(function(v){return v.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Ln.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!_,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var n,r=e.width,s=e.height;e.container.style.width="".concat(r,"px"),e.container.style.height="".concat(s,"px"),[e.renderer,e.postProcessingComposer].concat(wl(e.extraRenderers)).forEach(function(_){return _.setSize(r,s)}),e.camera.aspect=r/s;var o=e.viewOffset.slice(0,2);o.some(function(_){return _})&&(n=e.camera).setViewOffset.apply(n,[r,s].concat(wl(o),[r,s])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var u,c=e.width,f=e.height,d=e.viewOffset.slice(0,2);d.some(function(_){return _})?(u=e.camera).setViewOffset.apply(u,[c,f].concat(wl(d),[c,f])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Ln.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var m=qc(e.backgroundColor).alpha;m===void 0&&(m=1),e.renderer.setClearColor(new Ln.Color(xK(1,e.backgroundColor)),m)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new Ln.TextureLoader().load(e.backgroundImageUrl,function(_){_.colorSpace=Ln.SRGBColorSpace,e.skysphere.material=new Ln.MeshBasicMaterial({map:_,side:Ln.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&g()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&g())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(_){return e.scene.remove(_)}),e.lights.forEach(function(_){return e.scene.add(_)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(_){return e.scene.remove(_)}),e.objects.forEach(function(_){return e.scene.add(_)}));function g(){e.loadComplete=e.scene.visible=!0}}});function qZ(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}}var $Z=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;qZ($Z);function _b(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function XZ(i){if(Array.isArray(i))return _b(i)}function Vd(i,e,t){return(e=ZZ(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function YZ(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function KZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SC(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function Jm(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?SC(Object(t),!0).forEach(function(n){Vd(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):SC(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function M_(i){return XZ(i)||YZ(i)||JZ(i)||KZ()}function QZ(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function ZZ(i){var e=QZ(i,"string");return typeof e=="symbol"?e:e+""}function JZ(i,e){if(i){if(typeof i=="string")return _b(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_b(i,e):void 0}}function RP(i,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(r){return{default:t[r](),onChange:function(o,u){u[i][r](o)},triggerUpdate:!1}},linkMethod:function(r){return function(s){for(var o=s[i],u=arguments.length,c=new Array(u>1?u-1:0),f=1;f<u;f++)c[f-1]=arguments[f];var d=o[r].apply(o,c);return d===o?this:d}}}}var Sx=window.THREE?window.THREE:{AmbientLight:vN,DirectionalLight:_N,REVISION:Kc},eJ=170,CP=RP("forceGraph",o2),tJ=Object.assign.apply(Object,M_(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(i){return Vd({},i,CP.linkProp(i))}))),nJ=Object.assign.apply(Object,M_(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(i){return Vd({},i,CP.linkMethod(i))}))),mg=RP("renderObjs",wP),iJ=Object.assign.apply(Object,M_(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(i){return Vd({},i,mg.linkProp(i))}))),rJ=Object.assign.apply(Object,M_(["lights","cameraPosition","postProcessingComposer"].map(function(i){return Vd({},i,mg.linkMethod(i))})).concat([{graph2ScreenCoords:mg.linkMethod("getScreenCoords"),screen2GraphCoords:mg.linkMethod("getSceneCoords")}])),sJ=i_({props:Jm(Jm({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var n=t.renderObjs.controls();n&&(n.enabled=e,e&&n.domElement&&n.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},tJ),iJ),methods:Jm(Jm({zoomToFit:function(e,t,n){for(var r,s=arguments.length,o=new Array(s>3?s-3:0),u=3;u<s;u++)o[u-3]=arguments[u];return e.renderObjs.fitToBbox((r=e.forceGraph).getGraphBbox.apply(r,o),t,n),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},nJ),rJ),stateInit:function(e){var t=e.controlType,n=e.rendererConfig,r=e.extraRenderers,s=new o2;return{forceGraph:s,renderObjs:wP({controlType:t,rendererConfig:n,extraRenderers:r}).objects([s]).lights([new Sx.AmbientLight(13421772,Math.PI),new Sx.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var n=document.createElement("div");t.container.appendChild(n),t.renderObjs(n);var r=t.renderObjs.camera(),s=t.renderObjs.renderer(),o=t.renderObjs.controls();o.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=r.position.z;var u;t.container.appendChild(u=document.createElement("div")),u.className="graph-info-msg",u.textContent="",t.forceGraph.onLoading(function(){u.textContent="Loading..."}).onFinishLoading(function(){u.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),r.position.x===0&&r.position.y===0&&r.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(r.lookAt(t.forceGraph.position),t.lastSetCameraZ=r.position.z=Math.cbrt(t.graphData.nodes.length)*eJ)}).onFinishUpdate(function(){if(t._dragControls){var c=t.graphData.nodes.find(function(d){return d.__initialFixedPos&&!d.__disposeControlsAfterDrag});c?c.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var f=t._dragControls=new E4(t.graphData.nodes.map(function(d){return d.__threeObj}).filter(function(d){return d}),r,s.domElement);f.addEventListener("dragstart",function(d){var m=Aa(d.object);if(m){o.enabled=!1,d.object.__initialPos=d.object.position.clone(),d.object.__prevPos=d.object.position.clone();var g=m.__data;!g.__initialFixedPos&&(g.__initialFixedPos={fx:g.fx,fy:g.fy,fz:g.fz}),!g.__initialPos&&(g.__initialPos={x:g.x,y:g.y,z:g.z}),["x","y","z"].forEach(function(_){return g["f".concat(_)]=g[_]}),s.domElement.classList.add("grabbable")}}),f.addEventListener("drag",function(d){var m=Aa(d.object);if(m){if(!d.object.hasOwnProperty("__graphObjType")){var g=d.object.__initialPos,_=d.object.__prevPos,v=d.object.position;m.position.add(v.clone().sub(_)),_.copy(v),v.copy(g)}var S=m.__data,b=m.position,x={x:b.x-S.x,y:b.y-S.y,z:b.z-S.z};["x","y","z"].forEach(function(E){return S["f".concat(E)]=S[E]=b[E]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),S.__dragged=!0,t.onNodeDrag(S,x)}}),f.addEventListener("dragend",function(d){var m=Aa(d.object);if(m){delete d.object.__initialPos,delete d.object.__prevPos;var g=m.__data;g.__disposeControlsAfterDrag&&(f.dispose(),delete g.__disposeControlsAfterDrag);var _=g.__initialFixedPos,v=g.__initialPos,S={x:v.x-g.x,y:v.y-g.y,z:v.z-g.z};_&&(["x","y","z"].forEach(function(b){var x="f".concat(b);_[x]===void 0&&delete g[x]}),delete g.__initialFixedPos,delete g.__initialPos,g.__dragged&&(delete g.__dragged,t.onNodeDragEnd(g,S))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),s.domElement.classList.remove("grabbable")}})}}),Sx.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(c,f){var d=Aa(c);if(!d)return 1;var m=Aa(f);if(!m)return-1;var g=function(v){return v.__graphObjType==="node"};return g(m)-g(d)}).tooltipContent(function(c){var f=Aa(c);return f&&Zt(t["".concat(f.__graphObjType,"Label")])(f.__data)||""}).hoverDuringDrag(!1).onHover(function(c){var f=Aa(c);if(f!==t.hoverObj){var d=t.hoverObj?t.hoverObj.__graphObjType:null,m=t.hoverObj?t.hoverObj.__data:null,g=f?f.__graphObjType:null,_=f?f.__data:null;if(d&&d!==g){var v=t["on".concat(d==="node"?"Node":"Link","Hover")];v&&v(null,m)}if(g){var S=t["on".concat(g==="node"?"Node":"Link","Hover")];S&&S(_,d===g?m:null)}s.domElement.classList[f&&t["on".concat(g==="node"?"Node":"Link","Click")]||!f&&t.onBackgroundClick?"add":"remove"]("clickable"),t.hoverObj=f}}).clickAfterDrag(!1).onClick(function(c,f){var d=Aa(c);if(d){var m=t["on".concat(d.__graphObjType==="node"?"Node":"Link","Click")];m&&m(d.__data,f)}else t.onBackgroundClick&&t.onBackgroundClick(f)}).onRightClick(function(c,f){var d=Aa(c);if(d){var m=t["on".concat(d.__graphObjType==="node"?"Node":"Link","RightClick")];m&&m(d.__data,f)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(f)}),this._animationCycle()}});function Aa(i){for(var e=i;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var Tx={exports:{}},Ex,TC;function aJ(){if(TC)return Ex;TC=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Ex=i,Ex}var Mx,EC;function oJ(){if(EC)return Mx;EC=1;var i=aJ();function e(){}function t(){}return t.resetWarningCache=e,Mx=function(){function n(o,u,c,f,d,m){if(m!==i){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}n.isRequired=n;function r(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:r,element:n,elementType:n,instanceOf:r,node:n,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},Mx}var MC;function lJ(){return MC||(MC=1,Tx.exports=oJ()()),Tx.exports}var uJ=lJ();const ne=kg(uJ),A_={width:ne.number,height:ne.number,graphData:ne.shape({nodes:ne.arrayOf(ne.object).isRequired,links:ne.arrayOf(ne.object).isRequired}),backgroundColor:ne.string,nodeRelSize:ne.number,nodeId:ne.string,nodeLabel:ne.oneOfType([ne.string,ne.func]),nodeVal:ne.oneOfType([ne.number,ne.string,ne.func]),nodeVisibility:ne.oneOfType([ne.bool,ne.string,ne.func]),nodeColor:ne.oneOfType([ne.string,ne.func]),nodeAutoColorBy:ne.oneOfType([ne.string,ne.func]),onNodeHover:ne.func,onNodeClick:ne.func,linkSource:ne.string,linkTarget:ne.string,linkLabel:ne.oneOfType([ne.string,ne.func]),linkVisibility:ne.oneOfType([ne.bool,ne.string,ne.func]),linkColor:ne.oneOfType([ne.string,ne.func]),linkAutoColorBy:ne.oneOfType([ne.string,ne.func]),linkWidth:ne.oneOfType([ne.number,ne.string,ne.func]),linkCurvature:ne.oneOfType([ne.number,ne.string,ne.func]),linkDirectionalArrowLength:ne.oneOfType([ne.number,ne.string,ne.func]),linkDirectionalArrowColor:ne.oneOfType([ne.string,ne.func]),linkDirectionalArrowRelPos:ne.oneOfType([ne.number,ne.string,ne.func]),linkDirectionalParticles:ne.oneOfType([ne.number,ne.string,ne.func]),linkDirectionalParticleSpeed:ne.oneOfType([ne.number,ne.string,ne.func]),linkDirectionalParticleWidth:ne.oneOfType([ne.number,ne.string,ne.func]),linkDirectionalParticleColor:ne.oneOfType([ne.string,ne.func]),onLinkHover:ne.func,onLinkClick:ne.func,dagMode:ne.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:ne.number,dagNodeFilter:ne.func,onDagError:ne.func,d3AlphaMin:ne.number,d3AlphaDecay:ne.number,d3VelocityDecay:ne.number,warmupTicks:ne.number,cooldownTicks:ne.number,cooldownTime:ne.number,onEngineTick:ne.func,onEngineStop:ne.func,getGraphBbox:ne.func},NP={zoomToFit:ne.func,onNodeRightClick:ne.func,onNodeDrag:ne.func,onNodeDragEnd:ne.func,onLinkRightClick:ne.func,linkHoverPrecision:ne.number,onBackgroundClick:ne.func,onBackgroundRightClick:ne.func,enablePointerInteraction:ne.bool,enableNodeDrag:ne.bool},ZS={showNavInfo:ne.bool,nodeOpacity:ne.number,nodeResolution:ne.number,nodeThreeObject:ne.oneOfType([ne.object,ne.string,ne.func]),nodeThreeObjectExtend:ne.oneOfType([ne.bool,ne.string,ne.func]),linkOpacity:ne.number,linkResolution:ne.number,linkCurveRotation:ne.oneOfType([ne.number,ne.string,ne.func]),linkMaterial:ne.oneOfType([ne.object,ne.string,ne.func]),linkThreeObject:ne.oneOfType([ne.object,ne.string,ne.func]),linkThreeObjectExtend:ne.oneOfType([ne.bool,ne.string,ne.func]),linkPositionUpdate:ne.func,linkDirectionalArrowResolution:ne.number,linkDirectionalParticleResolution:ne.number,forceEngine:ne.oneOf(["d3","ngraph"]),ngraphPhysics:ne.object,numDimensions:ne.oneOf([1,2,3])};Object.assign({},A_,NP,{linkLineDash:ne.oneOfType([ne.arrayOf(ne.number),ne.string,ne.func]),nodeCanvasObjectMode:ne.oneOfType([ne.string,ne.func]),nodeCanvasObject:ne.func,nodePointerAreaPaint:ne.func,linkCanvasObjectMode:ne.oneOfType([ne.string,ne.func]),linkCanvasObject:ne.func,linkPointerAreaPaint:ne.func,autoPauseRedraw:ne.bool,minZoom:ne.number,maxZoom:ne.number,enableZoomInteraction:ne.oneOfType([ne.bool,ne.func]),enablePanInteraction:ne.oneOfType([ne.bool,ne.func]),onZoom:ne.func,onZoomEnd:ne.func,onRenderFramePre:ne.func,onRenderFramePost:ne.func});const cJ=Object.assign({},A_,NP,ZS,{enableNavigationControls:ne.bool,controlType:ne.oneOf(["trackball","orbit","fly"]),rendererConfig:ne.object,extraRenderers:ne.arrayOf(ne.shape({render:ne.func.isRequired}))});Object.assign({},A_,ZS,{nodeDesc:ne.oneOfType([ne.string,ne.func]),linkDesc:ne.oneOfType([ne.string,ne.func])});Object.assign({},A_,ZS,{markerAttrs:ne.object,yOffset:ne.number,glScale:ne.number});const JS=zB(sJ,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});JS.displayName="ForceGraph3D";JS.propTypes=cJ;const eg={file:"#1f77b4",class:"#ff7f0e",function:"#2ca02c",variable:"#d62728",module:"#888",default:"#888"},Ax={references:"#9467bd",imports:"#8c564b",default:"#bbb"},hJ=()=>{const[i,e]=he.useState([]),[t,n]=he.useState(!1),[r,s]=he.useState(""),[o,u]=he.useState(null),[c,f]=he.useState(null),[d,m]=he.useState(null),[g,_]=he.useState(!1),[v,S]=he.useState(null),[b,x]=he.useState(null),[E,M]=he.useState(""),A=he.useRef(null);he.useEffect(()=>{let $=!0;return Eb().then(k=>{$&&(e(k),n(!0))}),()=>{$=!1}},[]),he.useEffect(()=>{t&&i.length>0&&s(i[0].name)},[t,i]),he.useEffect(()=>{r&&(_(!0),u(null),fetch(`/api/graph?project=${encodeURIComponent(r)}`).then($=>$.json()).then($=>{f($),m($)}).catch(()=>{u("Failed to load graph")}).finally(()=>_(!1)))},[r]),he.useEffect(()=>{A.current&&A.current.d3Force("charge").strength(-200)},[d]);const C=(c==null?void 0:c.nodes.filter($=>$.type==="module"))||[],w=Array.from(new Set(C.map($=>$.name))).filter(Boolean);he.useEffect(()=>{if(!c||!v){m(c);return}const $=c.nodes.find(ce=>ce.type==="module"&&ce.name===v);if(!$){m({nodes:[],links:[]});return}const k=c.links.filter(ce=>ce.source===$.id||ce.target===$.id),G=new Set([$.id,...k.map(ce=>ce.source),...k.map(ce=>ce.target)]),W=c.nodes.filter(ce=>G.has(ce.id));m({nodes:W,links:k})},[c,v]);const N=()=>{if(!b||!d)return{nodes:new Set,links:new Set};const $=new Set,k=new Set;return $.add(b.id),d.links.forEach(G=>{G.source===b.id&&($.add(typeof G.target=="object"?G.target.id:G.target),k.add(G)),G.target===b.id&&($.add(typeof G.source=="object"?G.source.id:G.source),k.add(G))}),{nodes:$,links:k}},{nodes:L,links:P}=N(),D=$=>{if($.preventDefault(),!E||!c)return;const k=c.nodes.find(G=>G.name&&G.name.toLowerCase().includes(E.toLowerCase())||G.id.toLowerCase().includes(E.toLowerCase()));k&&(x(k),A.current&&(typeof A.current.cameraPosition=="function"?A.current.cameraPosition({x:k.x||0,y:k.y||0,z:k.z||0},void 0,1e3):console.warn("cameraPosition is not a function on fgRef.current:",A.current),typeof A.current.zoomToFit=="function"?A.current.zoomToFit(300,40,G=>G.id===k.id):console.warn("zoomToFit is not a function on fgRef.current:",A.current)))},I=()=>{A.current&&A.current.zoomToFit(400)},j=()=>{A.current&&A.current.cameraPosition({x:0,y:0,z:800},void 0,1e3)},J=$=>eg[$.type]||eg[$.group]||eg.default,ue=$=>Ax[$.relation]||Ax.default;return U.jsxs("div",{children:[U.jsx("h1",{children:"Code Relationships"}),U.jsxs("div",{style:{marginBottom:"1rem"},children:[U.jsx("label",{htmlFor:"project-select",children:"Project: "}),U.jsx("select",{id:"project-select",value:r,onChange:$=>s($.target.value),children:i.map($=>U.jsx("option",{value:$.name,children:$.name},$.name))})]}),g&&U.jsx("p",{children:"Loading graph..."}),o&&U.jsx("p",{style:{color:"red"},children:o}),c&&!g&&U.jsxs("div",{style:{height:"80vh",border:"1px solid lightgray",padding:8},children:[U.jsx("label",{htmlFor:"file-select",children:"Select file: "}),U.jsxs("select",{id:"file-select",value:v||"",onChange:$=>S($.target.value||null),children:[U.jsx("option",{value:"",children:"All files"}),w.map($=>U.jsx("option",{value:$,children:$},$))]}),U.jsxs("div",{style:{marginBottom:8,display:"flex",alignItems:"center",gap:12},children:[U.jsxs("form",{onSubmit:D,style:{display:"inline"},children:[U.jsx("input",{type:"text",placeholder:"Search node by name or id",value:E,onChange:$=>M($.target.value),style:{marginRight:4}}),U.jsx("button",{type:"submit",children:"Search"})]}),U.jsx("button",{onClick:I,children:"Zoom to Fit"}),U.jsx("button",{onClick:j,children:"Reset Camera"})]}),U.jsxs("div",{style:{marginBottom:8},children:[U.jsx("b",{children:"Legend:"}),U.jsx("span",{style:{marginLeft:8},children:Object.entries(eg).map(([$,k])=>$!=="default"?U.jsxs("span",{style:{color:k,marginRight:12},children:["■ ",$]},$):null)}),U.jsx("span",{style:{marginLeft:16},children:Object.entries(Ax).map(([$,k])=>$!=="default"?U.jsxs("span",{style:{color:k,marginRight:12},children:["→ ",$]},$):null)})]}),U.jsx(JS,{ref:A,graphData:d||{nodes:[],links:[]},nodeAutoColorBy:void 0,nodeColor:$=>L&&L.has($.id)?"#FFD700":J($),linkColor:$=>P&&P.has($)?"#FFD700":ue($),nodeLabel:$=>`<div>
                <b>${$.name||$.id}</b><br/>
                Type: ${$.type||$.group||"unknown"}<br/>
                File: ${$.file_path||""}<br/>
                ${$.start_line!==void 0?`Lines: ${$.start_line}-${$.end_line}`:""}
              </div>`,linkLabel:$=>`<div>
                <b>${$.relation||"relation"}</b><br/>
                ${typeof $.source=="object"?$.source.id:$.source} &rarr; ${typeof $.target=="object"?$.target.id:$.target}
              </div>`,linkDirectionalArrowLength:4,linkDirectionalArrowRelPos:1,onNodeClick:$=>x($)})]})]})},fJ=()=>{const[i,e]=he.useState(!1),t=async()=>{e(!0);try{(await fetch("/api/cache",{method:"DELETE"})).ok?alert("Cache cleared"):alert("Failed to clear cache")}catch(n){console.error(n),alert("Error clearing cache")}finally{e(!1)}};return U.jsx("button",{onClick:t,disabled:i,children:i?"Clearing...":"Clear Query Cache"})},dJ=()=>{const[i,e]=he.useState(null),[t,n]=he.useState(!1),r=async()=>{try{const o=await fetch("/api/health/");if(o.ok){const u=await o.json();e(u.status)}else e("unreachable")}catch(o){console.error(o),e("error")}};he.useEffect(()=>{r(),localStorage.getItem("theme")==="dark"&&(document.body.classList.add("dark-theme"),n(!0))},[]);const s=()=>{t?(document.body.classList.remove("dark-theme"),localStorage.setItem("theme","light"),n(!1)):(document.body.classList.add("dark-theme"),localStorage.setItem("theme","dark"),n(!0))};return U.jsxs("div",{children:[U.jsx("h1",{children:"Settings"}),U.jsxs("p",{children:["Server status: ",i||"loading..."]}),U.jsx(fJ,{}),U.jsx("div",{style:{marginTop:"1rem"},children:U.jsxs("button",{onClick:s,children:["Switch to ",t?"Light":"Dark"," Theme"]})}),U.jsx("p",{children:"Additional server status and settings will be added here."})]})},pJ=()=>U.jsxs("div",{children:[U.jsx("h1",{children:"MCP Tools"}),U.jsx("p",{children:"Interact with MCP server tools and resources here."}),U.jsxs("section",{style:{marginTop:"2em"},children:[U.jsx("h2",{children:"Augmentorium API Endpoints Reference"}),U.jsx("p",{style:{color:"gray"},children:"Below is a comprehensive list of backend API endpoints, grouped by feature. Click to expand for details and usage examples."}),U.jsx("h3",{style:{marginTop:"2em"},children:"Graph Endpoints"}),U.jsxs("table",{className:"api-table",children:[U.jsx("thead",{children:U.jsxs("tr",{children:[U.jsx("th",{children:"Method"}),U.jsx("th",{children:"Path"}),U.jsx("th",{children:"Description"}),U.jsx("th",{children:"Params/Body"}),U.jsx("th",{children:"Example"})]})}),U.jsxs("tbody",{children:[U.jsxs("tr",{children:[U.jsx("td",{children:"GET"}),U.jsx("td",{children:U.jsx("code",{children:"/api/graph/"})}),U.jsx("td",{children:"Get the full code relationship graph for a project."}),U.jsx("td",{children:U.jsx("code",{children:"?project=NAME"})}),U.jsx("td",{children:U.jsx("pre",{children:'curl -X GET "http://localhost:6655/api/graph/?project=demo"'})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"POST"}),U.jsx("td",{children:U.jsx("code",{children:"/api/graph/neighbors/"})}),U.jsx("td",{children:"Get neighbors (callers, callees, imports, etc) for a node in a project."}),U.jsx("td",{children:U.jsx("pre",{children:'{ "project": "NAME", "node_id": "NODE_ID" }'})}),U.jsx("td",{children:U.jsx("pre",{children:`curl -X POST http://localhost:6655/api/graph/neighbors/ -H "Content-Type: application/json" -d '{"project": "demo", "node_id": "my_func"}'`})})]})]})]}),U.jsx("h3",{style:{marginTop:"2em"},children:"Project & File Endpoints"}),U.jsxs("table",{className:"api-table",children:[U.jsx("thead",{children:U.jsxs("tr",{children:[U.jsx("th",{children:"Method"}),U.jsx("th",{children:"Path"}),U.jsx("th",{children:"Description"}),U.jsx("th",{children:"Params/Body"}),U.jsx("th",{children:"Example"})]})}),U.jsxs("tbody",{children:[U.jsxs("tr",{children:[U.jsx("td",{children:"GET"}),U.jsx("td",{children:U.jsx("code",{children:"/api/projects/"})}),U.jsx("td",{children:"List all projects with metadata."}),U.jsx("td",{children:"None"}),U.jsx("td",{children:U.jsx("pre",{children:"curl -X GET http://localhost:6655/api/projects/"})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"POST"}),U.jsx("td",{children:U.jsx("code",{children:"/api/projects/"})}),U.jsx("td",{children:"Add a new project."}),U.jsx("td",{children:U.jsx("pre",{children:'{ "path": "/path/to/project", "name": "demo" }'})}),U.jsx("td",{children:U.jsx("pre",{children:`curl -X POST http://localhost:6655/api/projects/ -H "Content-Type: application/json" -d '{"path": "/path/to/project", "name": "demo"}'`})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"DELETE"}),U.jsx("td",{children:U.jsx("code",{children:"/api/projects/<name>"})}),U.jsx("td",{children:"Delete a project."}),U.jsxs("td",{children:[U.jsx("code",{children:"name"})," in path"]}),U.jsx("td",{children:U.jsx("pre",{children:"curl -X DELETE http://localhost:6655/api/projects/demo"})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"GET"}),U.jsx("td",{children:U.jsx("code",{children:"/api/files/"})}),U.jsx("td",{children:"List indexed files in a project."}),U.jsx("td",{children:U.jsx("code",{children:"?project=NAME&max_files=20"})}),U.jsx("td",{children:U.jsx("pre",{children:'curl -X GET "http://localhost:6655/api/files/?project=demo"'})})]})]})]}),U.jsx("h3",{style:{marginTop:"2em"},children:"Indexer & Stats Endpoints"}),U.jsxs("table",{className:"api-table",children:[U.jsx("thead",{children:U.jsxs("tr",{children:[U.jsx("th",{children:"Method"}),U.jsx("th",{children:"Path"}),U.jsx("th",{children:"Description"}),U.jsx("th",{children:"Params/Body"}),U.jsx("th",{children:"Example"})]})}),U.jsxs("tbody",{children:[U.jsxs("tr",{children:[U.jsx("td",{children:"GET"}),U.jsx("td",{children:U.jsx("code",{children:"/api/indexer/status"})}),U.jsx("td",{children:"Get current indexer status."}),U.jsx("td",{children:"None"}),U.jsx("td",{children:U.jsx("pre",{children:"curl -X GET http://localhost:6655/api/indexer/status"})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"POST"}),U.jsx("td",{children:U.jsx("code",{children:"/api/indexer/status"})}),U.jsx("td",{children:"Update indexer status (internal use)."}),U.jsx("td",{children:U.jsx("pre",{children:'{ "projects": [...] }'})}),U.jsx("td",{children:U.jsx("pre",{children:`curl -X POST http://localhost:6655/api/indexer/status -H "Content-Type: application/json" -d '{"projects": [{"name": "demo", ...}]}'`})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"GET"}),U.jsx("td",{children:U.jsx("code",{children:"/api/stats/"})}),U.jsx("td",{children:"Get stats for a project."}),U.jsx("td",{children:U.jsx("code",{children:"?project=NAME"})}),U.jsx("td",{children:U.jsx("pre",{children:'curl -X GET "http://localhost:6655/api/stats/?project=demo"'})})]})]})]}),U.jsx("h3",{style:{marginTop:"2em"},children:"Document Endpoints"}),U.jsxs("table",{className:"api-table",children:[U.jsx("thead",{children:U.jsxs("tr",{children:[U.jsx("th",{children:"Method"}),U.jsx("th",{children:"Path"}),U.jsx("th",{children:"Description"}),U.jsx("th",{children:"Params/Body"}),U.jsx("th",{children:"Example"})]})}),U.jsxs("tbody",{children:[U.jsxs("tr",{children:[U.jsx("td",{children:"GET"}),U.jsx("td",{children:U.jsx("code",{children:"/api/documents/"})}),U.jsx("td",{children:"List indexed documents for a project."}),U.jsx("td",{children:U.jsx("code",{children:"?project=NAME"})}),U.jsx("td",{children:U.jsx("pre",{children:'curl -X GET "http://localhost:6655/api/documents/?project=demo"'})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"POST"}),U.jsx("td",{children:U.jsx("code",{children:"/api/documents/upload"})}),U.jsx("td",{children:"Upload a new document to a project."}),U.jsx("td",{children:U.jsx("pre",{children:'{ "project": "NAME", "name": "file.txt", "content": "..." }'})}),U.jsx("td",{children:U.jsx("pre",{children:`curl -X POST http://localhost:6655/api/documents/upload -H "Content-Type: application/json" -d '{"project": "demo", "name": "file.txt", "content": "..."}'`})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"POST"}),U.jsx("td",{children:U.jsx("code",{children:"/api/documents/<doc_id>/reindex"})}),U.jsx("td",{children:"Reindex a document for a project."}),U.jsx("td",{children:U.jsx("pre",{children:'{ "project": "NAME" }'})}),U.jsx("td",{children:U.jsx("pre",{children:`curl -X POST http://localhost:6655/api/documents/doc1/reindex -H "Content-Type: application/json" -d '{"project": "demo"}'`})})]})]})]}),U.jsx("h3",{style:{marginTop:"2em"},children:"Query & Search Endpoints"}),U.jsxs("table",{className:"api-table",children:[U.jsx("thead",{children:U.jsxs("tr",{children:[U.jsx("th",{children:"Method"}),U.jsx("th",{children:"Path"}),U.jsx("th",{children:"Description"}),U.jsx("th",{children:"Params/Body"}),U.jsx("th",{children:"Example"})]})}),U.jsxs("tbody",{children:[U.jsxs("tr",{children:[U.jsx("td",{children:"POST"}),U.jsx("td",{children:U.jsx("code",{children:"/api/query/"})}),U.jsx("td",{children:"Run a search/query over the codebase for a project."}),U.jsx("td",{children:U.jsx("pre",{children:'{ "project": "NAME", "query": "..." }'})}),U.jsx("td",{children:U.jsx("pre",{children:`curl -X POST http://localhost:6655/api/query/ -H "Content-Type: application/json" -d '{"project": "demo", "query": "import requests"}'`})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"DELETE"}),U.jsx("td",{children:U.jsx("code",{children:"/api/query/cache"})}),U.jsx("td",{children:"Clear query cache for a project."}),U.jsx("td",{children:U.jsx("code",{children:"?project=NAME"})}),U.jsx("td",{children:U.jsx("pre",{children:'curl -X DELETE "http://localhost:6655/api/query/cache?project=demo"'})})]}),U.jsxs("tr",{children:[U.jsx("td",{children:"POST"}),U.jsx("td",{children:U.jsx("code",{children:"/api/chunks/search"})}),U.jsx("td",{children:"Semantic search for code chunks/passages in a project."}),U.jsx("td",{children:U.jsx("pre",{children:'{ "project": "NAME", "query": "...", "n_results": 5 }'})}),U.jsx("td",{children:U.jsx("pre",{children:`curl -X POST http://localhost:6655/api/chunks/search -H "Content-Type: application/json" -d '{"project": "demo", "query": "def ", "n_results": 3}'`})})]})]})]}),U.jsx("h3",{style:{marginTop:"2em"},children:"Explainability"}),U.jsxs("table",{className:"api-table",children:[U.jsx("thead",{children:U.jsxs("tr",{children:[U.jsx("th",{children:"Method"}),U.jsx("th",{children:"Path"}),U.jsx("th",{children:"Description"}),U.jsx("th",{children:"Params/Body"}),U.jsx("th",{children:"Example"})]})}),U.jsx("tbody",{children:U.jsxs("tr",{children:[U.jsx("td",{children:"POST"}),U.jsx("td",{children:U.jsx("code",{children:"/api/explain/"})}),U.jsx("td",{children:"Explain why a result was retrieved (vector score, graph path, etc)."}),U.jsx("td",{children:U.jsx("pre",{children:'{ "project": "NAME", "query": "...", "result": {...} }'})}),U.jsx("td",{children:U.jsx("pre",{children:`curl -X POST http://localhost:6655/api/explain/ -H "Content-Type: application/json" -d '{"project": "demo", "query": "...", "result": {...}}'`})})]})})]}),U.jsx("h3",{style:{marginTop:"2em"},children:"Cache Endpoints"}),U.jsxs("table",{className:"api-table",children:[U.jsx("thead",{children:U.jsxs("tr",{children:[U.jsx("th",{children:"Method"}),U.jsx("th",{children:"Path"}),U.jsx("th",{children:"Description"}),U.jsx("th",{children:"Params/Body"}),U.jsx("th",{children:"Example"})]})}),U.jsx("tbody",{children:U.jsxs("tr",{children:[U.jsx("td",{children:"DELETE"}),U.jsx("td",{children:U.jsx("code",{children:"/api/cache/"})}),U.jsx("td",{children:"Clear general cache for a project."}),U.jsx("td",{children:U.jsx("code",{children:"?project=NAME"})}),U.jsx("td",{children:U.jsx("pre",{children:'curl -X DELETE "http://localhost:6655/api/cache/?project=demo"'})})]})})]}),U.jsx("style",{children:`
          .api-table { width: 100%; border-collapse: collapse; margin-bottom: 2em; }
          .api-table th, .api-table td { border: 1px solid #333; padding: 8px; background: #181818; color: #f1f1f1; }
          .api-table th { background: #232323; color: #fff; }
          .api-table td { vertical-align: top; }
          .api-table code, .api-table pre { background: #222; color: #fff; padding: 2px 5px; border-radius: 3px; font-size: 1em; word-break: break-all; white-space: pre-wrap; }
          .api-table td code, .api-table td pre { display: block; overflow-x: auto; max-width: 100%; }
          .api-table pre { margin: 0; font-size: 0.96em; background: #222; color: #fff; padding: 6px 10px; border-radius: 3px; }
          .api-table th:nth-child(2), .api-table td:nth-child(2) { min-width: 200px; max-width: 340px; }
          .api-table th:nth-child(4), .api-table td:nth-child(4) { min-width: 180px; max-width: 400px; }
        `})]})]}),mJ=()=>(he.useEffect(()=>{localStorage.getItem("theme")==="dark"?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")},[]),U.jsx(iB,{children:U.jsxs("div",{className:"app-container",children:[U.jsx("nav",{className:"top-navbar",children:U.jsxs("ul",{children:[U.jsx("li",{children:U.jsx(ac,{to:"/",end:!0,children:"Projects"})}),U.jsx("li",{children:U.jsx(ac,{to:"/query",children:"Query"})}),U.jsx("li",{children:U.jsx(ac,{to:"/graph",children:"Graph"})}),U.jsx("li",{children:U.jsx(ac,{to:"/settings",children:"Settings"})}),U.jsx("li",{children:U.jsx(ac,{to:"/mcp",children:"MCP Tools"})})]})}),U.jsx("main",{className:"main-content",children:U.jsxs(UO,{children:[U.jsx(sc,{path:"/",element:U.jsx(_B,{})}),U.jsx(sc,{path:"/query",element:U.jsx(yB,{})}),U.jsx(sc,{path:"/graph",element:U.jsx(hJ,{})}),U.jsx(sc,{path:"/settings",element:U.jsx(dJ,{})}),U.jsx(sc,{path:"/mcp",element:U.jsx(pJ,{})})]})})]})}));HU.createRoot(document.getElementById("root")).render(U.jsx(he.StrictMode,{children:U.jsx(mJ,{})}));
